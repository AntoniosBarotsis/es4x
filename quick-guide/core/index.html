<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vert.x core examples | ES for Eclipse Vert.x</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
    <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
    <script src="/es4x/player/asciinema-player.js"></script>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <link rel="preload" href="/es4x/assets/css/0.styles.2263bcb2.css" as="style"><link rel="preload" href="/es4x/assets/js/app.0ada8026.js" as="script"><link rel="preload" href="/es4x/assets/js/2.8321b957.js" as="script"><link rel="preload" href="/es4x/assets/js/26.8a076633.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.4eb49677.js"><link rel="prefetch" href="/es4x/assets/js/11.52ac937d.js"><link rel="prefetch" href="/es4x/assets/js/12.8b5ef7a4.js"><link rel="prefetch" href="/es4x/assets/js/13.9cf9c93b.js"><link rel="prefetch" href="/es4x/assets/js/14.26eacbc1.js"><link rel="prefetch" href="/es4x/assets/js/15.11949549.js"><link rel="prefetch" href="/es4x/assets/js/16.cb77bdad.js"><link rel="prefetch" href="/es4x/assets/js/17.b448b775.js"><link rel="prefetch" href="/es4x/assets/js/18.8a365fe8.js"><link rel="prefetch" href="/es4x/assets/js/19.8be7ff7f.js"><link rel="prefetch" href="/es4x/assets/js/20.973a0d2d.js"><link rel="prefetch" href="/es4x/assets/js/21.d67ee0ba.js"><link rel="prefetch" href="/es4x/assets/js/22.f16269cd.js"><link rel="prefetch" href="/es4x/assets/js/23.b10d0cf0.js"><link rel="prefetch" href="/es4x/assets/js/24.c8f7f5a6.js"><link rel="prefetch" href="/es4x/assets/js/25.25613ada.js"><link rel="prefetch" href="/es4x/assets/js/27.5531f0af.js"><link rel="prefetch" href="/es4x/assets/js/28.6fbd1580.js"><link rel="prefetch" href="/es4x/assets/js/29.9eb1dfa6.js"><link rel="prefetch" href="/es4x/assets/js/3.5be0044a.js"><link rel="prefetch" href="/es4x/assets/js/30.92b9479f.js"><link rel="prefetch" href="/es4x/assets/js/31.913d2b57.js"><link rel="prefetch" href="/es4x/assets/js/32.d29d7c3d.js"><link rel="prefetch" href="/es4x/assets/js/33.6adf4455.js"><link rel="prefetch" href="/es4x/assets/js/34.f1735afb.js"><link rel="prefetch" href="/es4x/assets/js/35.ed8f46b6.js"><link rel="prefetch" href="/es4x/assets/js/36.71f4afa5.js"><link rel="prefetch" href="/es4x/assets/js/37.b2c774f6.js"><link rel="prefetch" href="/es4x/assets/js/38.b7ebbbf6.js"><link rel="prefetch" href="/es4x/assets/js/39.7287c98c.js"><link rel="prefetch" href="/es4x/assets/js/4.19bb1c74.js"><link rel="prefetch" href="/es4x/assets/js/40.c7b9daff.js"><link rel="prefetch" href="/es4x/assets/js/41.51822e44.js"><link rel="prefetch" href="/es4x/assets/js/42.3b6eb390.js"><link rel="prefetch" href="/es4x/assets/js/5.768d8cba.js"><link rel="prefetch" href="/es4x/assets/js/6.9b2d78bb.js"><link rel="prefetch" href="/es4x/assets/js/7.f4761ae0.js"><link rel="prefetch" href="/es4x/assets/js/8.30641888.js"><link rel="prefetch" href="/es4x/assets/js/9.8bf611cc.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.2263bcb2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/quick-guide/" class="nav-link router-link-active">
  Quick Guides
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/quick-guide/core/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/quick-guide/" class="nav-link router-link-active">
  Quick Guides
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/quick-guide/core/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Quick Guides</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/quick-guide/" aria-current="page" class="sidebar-link">Quick Guides</a></li><li><a href="/es4x/quick-guide/core/" aria-current="page" class="active sidebar-link">Vert.x core examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#project-setup" class="sidebar-link">Project setup</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#net-examples" class="sidebar-link">Net examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#echo" class="sidebar-link">Echo</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#echo-ssl" class="sidebar-link">Echo SSL</a></li></ul></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#http-examples" class="sidebar-link">HTTP examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#simple" class="sidebar-link">Simple</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#https" class="sidebar-link">HTTPS</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#proxy-connect" class="sidebar-link">Proxy connect</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#proxy" class="sidebar-link">Proxy</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#sendfile" class="sidebar-link">Sendfile</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#simple-form" class="sidebar-link">Simple form</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#simple-form-file-upload" class="sidebar-link">Simple form file upload</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#http-request-body-upload" class="sidebar-link">Http request body upload</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#http-server-sharing" class="sidebar-link">HTTP Server Sharing</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#websockets-echo-example" class="sidebar-link">WebSockets echo example</a></li></ul></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#http-2-examples" class="sidebar-link">HTTP/2 examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#simple-2" class="sidebar-link">Simple</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#push" class="sidebar-link">Push</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#h2c" class="sidebar-link">H2C</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#custom-frames" class="sidebar-link">Custom frames</a></li></ul></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#event-bus-examples" class="sidebar-link">Event bus examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#point-to-point" class="sidebar-link">Point to point</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#publish-subscribe" class="sidebar-link">Publish / Subscribe</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#ssl" class="sidebar-link">SSL</a></li></ul></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#future" class="sidebar-link">Future</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#verticle-examples" class="sidebar-link">Verticle examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#deploy-example" class="sidebar-link">Deploy example</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#asynchronous-deployment-example" class="sidebar-link">Asynchronous deployment example</a></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#worker-verticle-example" class="sidebar-link">Worker Verticle example</a></li></ul></li><li class="sidebar-sub-header"><a href="/es4x/quick-guide/core/#high-availability" class="sidebar-link">High Availability</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vert-x-core-examples"><a href="#vert-x-core-examples" class="header-anchor">#</a> Vert.x core examples</h1> <p>Here you will find examples demonstrating Vert.x core in action.</p> <p>Vert.x core provides fairly low level functionality for a diverse range of functions including HTTP, TCP, UDP,
WebSockets, file system access, timers, verticles and more. For detailed documentation, consult the
Vert.x <a href="https://vertx.io/docs" target="_blank" rel="noopener noreferrer">core manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="project-setup"><a href="#project-setup" class="header-anchor">#</a> Project setup</h2> <p>To use es4x your own project use the following project as a template:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;core-examples&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;create-es4x-app&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@vertx/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;postinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es4x install&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="net-examples"><a href="#net-examples" class="header-anchor">#</a> Net examples</h2> <p>These examples demonstrate usage of Vert.x net servers and clients - these are used for TCP (and SSL) servers and clients.</p> <h3 id="echo"><a href="#echo" class="header-anchor">#</a> Echo</h3> <p>This example consists of an echo server verticle which serves TCP connections, and simply echoes back on the connection
whatever it receives.</p> <p>You can run the echo server then run <code>telnet localhost 1234</code> from a console to connect to it. Type some stuff and see it
echoed back to you.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Pump <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core'</span><span class="token punctuation">;</span>

vertx
  <span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token parameter">socket</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Create a pump</span>
    Pump<span class="token punctuation">.</span><span class="token function">pump</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> socket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Echo server is now listening&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>It also contains an echo client, which creates a connection to the server, sends some data and logs out what it receives
back. You can use that as an alternative to connecting via telnet.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>
vertx
  <span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token parameter">onConnect</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>onConnect<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> socket <span class="token operator">=</span> onConnect<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    socket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">buffer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Net client receiving: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Now send some data</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Net client sending: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>onConnect<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="echo-ssl"><a href="#echo-ssl" class="header-anchor">#</a> Echo SSL</h3> <p>This is the same as the <a href="#echo">Echo</a> example but using SSL to encrypt connections.</p> <p>The server:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Pump <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NetServerOptions<span class="token punctuation">,</span> JksOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core/options'</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'server-keystore.jks'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">'wibble'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token parameter">socket</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Create a pump</span>
  Pump<span class="token punctuation">.</span><span class="token function">pump</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> socket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Echo server is now listening&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The client:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> NetClientOptions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token parameter">onConnect</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>onConnect<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> socket <span class="token operator">=</span> onConnect<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">buff</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;client receiving &quot;</span> <span class="token operator">+</span> buff<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Now send some data</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Net client sending: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>onConnect<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="http-examples"><a href="#http-examples" class="header-anchor">#</a> HTTP examples</h2> <p>These examples demonstrate usage of HTTP with Vert.x.</p> <h3 id="simple"><a href="#simple" class="header-anchor">#</a> Simple</h3> <p>A very simple HTTP server which always responds with the same response:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

vertx
  <span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from vert.x!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>And a simple HTTP client which makes a request to the server.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

vertx
  <span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got response &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token parameter">body</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got data &quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="https"><a href="#https" class="header-anchor">#</a> HTTPS</h3> <p>Like the <a href="#simple">simple</a> example, but using HTTPS instead of HTTP</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpServerOptions<span class="token punctuation">,</span> JksOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core/options'</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'server-keystore.jks'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">'wibble'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from vert.x!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4443</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:4443" target="_blank" rel="noopener noreferrer">http://localhost:4443<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>And a simple HTTPS client which makes a request to the server.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClientOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Note! in real-life you wouldn't often set trust all</span>
<span class="token comment">// to true as it could leave you open to man in the</span>
<span class="token comment">// middle attacks.</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">4443</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got response &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got data &quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="proxy-connect"><a href="#proxy-connect" class="header-anchor">#</a> Proxy connect</h3> <p>Connecting to a web server using a proxy.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClientOptions<span class="token punctuation">,</span> ProxyOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ProxyType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/enums&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> request <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setVerifyHost</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setProxyOptions</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">ProxyOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span>ProxyType<span class="token punctuation">.</span><span class="token constant">HTTP</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">8282</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got response &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got data &quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;client-chunk-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The proxy receives requests and connects to the endpoint server using a socket, then pass
all the events between the client and the proxied server.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpMethod <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/enums&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> HttpMethod<span class="token punctuation">.</span><span class="token constant">CONNECT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Determine proxied server address</span>
    <span class="token keyword">var</span> proxyAddress <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> idx <span class="token operator">=</span> proxyAddress<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> host <span class="token operator">=</span> proxyAddress<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> port <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>proxyAddress<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connecting to proxy &quot;</span> <span class="token operator">+</span> proxyAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> host<span class="token punctuation">,</span> <span class="token parameter">onConnect</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>onConnect<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected to proxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> clientSocket <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">netSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        clientSocket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP/1.0 200 Connection established\n\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> serverSocket <span class="token operator">=</span> onConnect<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        serverSocket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">buff</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Forwarding server packet to the client&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          clientSocket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serverSocket<span class="token punctuation">.</span><span class="token function">closeHandler</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server socket closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          clientSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        clientSocket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">buff</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Forwarding client packet to the server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          serverSocket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        clientSocket<span class="token punctuation">.</span><span class="token function">closeHandler</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Client socket closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          serverSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Fail proxy connection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="proxy"><a href="#proxy" class="header-anchor">#</a> Proxy</h3> <p>A simple toy HTTP proxy. The proxy receives requests and forwards them to the endpoint server, it also takes responses
from the other server and passes them back to the client.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx
  <span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Proxying request: &quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> c_req <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8282</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">c_res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Proxying response: &quot;</span> <span class="token operator">+</span> c_res<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span>c_res<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>c_res<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      c_res<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Proxying response body: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      c_res<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    c_req
      <span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    req<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Proxying request body &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      c_req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    req<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      c_req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="sendfile"><a href="#sendfile" class="header-anchor">#</a> Sendfile</h3> <p>This example demonstrates how you can serve static files from disk using a Vert.x http server.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token comment">// In reality it's highly recommend you use Vert.x-Web for applications like this.</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> filename<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    filename <span class="token operator">=</span> <span class="token string">&quot;sendfile/index.html&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/page1.html&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    filename <span class="token operator">=</span> <span class="token string">&quot;sendfile/page1.html&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/page2.html&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    filename <span class="token operator">=</span> <span class="token string">&quot;sendfile/page2.html&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In practice you would probably actually use Vert.x-Web for this rather than writing a web server at this low level. Serving
files manually like this can leave you open to security exploits, e.g. by clients crafting URI paths which try to access
resources outside of the permitted area. Vert.x-Web provides URI path normalisation to avoid these kinds of exploits and comes
with a static file handler which also handles caching headers and other features that you would probably want when serving
static files in a web application.</p></div> <h3 id="simple-form"><a href="#simple-form" class="header-anchor">#</a> Simple form</h3> <p>This example demonstrates how you can handle an HTML form on the server.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Serve the index page</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/form&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">setExpectMultipart</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span><span class="token function">formAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">names</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">attr</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Got attr &quot;</span> <span class="token operator">+</span> attr <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span><span class="token function">formAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In practice you would probably also use Vert.x-Web for this rather than writing a server at this low level. Vert.x-Web
provides built in support for HTML forms, and avoids some of the security issues due to maliciously crafted URI paths.</p></div> <h3 id="simple-form-file-upload"><a href="#simple-form-file-upload" class="header-anchor">#</a> Simple form file upload</h3> <p>This example demonstrates how you can handle file uploads from an HTML form submission.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Serve the index page</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/form&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">setExpectMultipart</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">uploadHandler</span><span class="token punctuation">(</span><span class="token parameter">upload</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      upload<span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Upload failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      upload<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Successfully uploaded to &quot;</span> <span class="token operator">+</span> upload<span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// FIXME - Potential security exploit! In a real system you must check this filename</span>
      <span class="token comment">// to make sure you're not saving to a place where you don't want!</span>
      <span class="token comment">// Or better still, just use Vert.x-Web which controls the upload area.</span>
      upload<span class="token punctuation">.</span><span class="token function">streamToFileSystem</span><span class="token punctuation">(</span>upload<span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In practice you would probably also use Vert.x-Web for this rather than writing a server at this low level. Vert.x-Web
provides built in support for HTML forms, and avoids some of the security issues due to maliciously crafted URI paths.</p></div> <h3 id="http-request-body-upload"><a href="#http-request-body-upload" class="header-anchor">#</a> Http request body upload</h3> <p>This example demonstrates an HTTP server receiving a request and pumping the request body to a file on disk without
ever storing the entire request body fully in memory.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Pump <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OpenOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core/options'</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> filename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">temp-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.uploaded</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  vertx
    <span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">onOpen</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> file <span class="token operator">=</span> onOpen<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> pump <span class="token operator">=</span> Pump<span class="token punctuation">.</span><span class="token function">pump</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
      req<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token parameter">onClose</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Uploaded to &quot;</span> <span class="token operator">+</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
          req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pump<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      req<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>There's also a client which sends a request to the server and pumps a file from disk to the HTTP request body. The file
is uploaded successfully even if the file is very large (GigaBytes).</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Pump <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OpenOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core/options'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> req <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/someurl&quot;</span><span class="token punctuation">,</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Response &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> filename <span class="token operator">=</span> <span class="token string">&quot;upload.txt&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">props</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token parameter">onProps</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> props <span class="token operator">=</span> onProps<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;props is &quot;</span> <span class="token operator">+</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> size <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;content-length&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">onOpen</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> onOpen<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pump <span class="token operator">=</span> Pump<span class="token punctuation">.</span><span class="token function">pump</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>
    file<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pump<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre></div><h3 id="http-server-sharing"><a href="#http-server-sharing" class="header-anchor">#</a> HTTP Server Sharing</h3> <p>A server that illustrates the round robin orchestrated by vert.x when several verticles are opening HTTP servers on the same port:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> DeploymentOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>

vertx
  <span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span>
    <span class="token string">&quot;http_server_verticle.js&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setInstances</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>Server</code> deploys two instances of the <code>HttpServerVerticle</code> verticle.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

vertx
  <span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Requests will be handled by an instance after the other.</p> <p>The <code>Client</code> illustrates the round robin by periodically requesting the server and displays the response content.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

vertx
  <span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    vertx
      <span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can directly launch the <code>HTTPServerVerticle</code> using the <code>es4x run</code> command. Then you can set the number of instance you want:</p> <div class="language- extra-class"><pre class="language-text"><code>es4x run http_server_verticle.js -instances 4
</code></pre></div><h3 id="websockets-echo-example"><a href="#websockets-echo-example" class="header-anchor">#</a> WebSockets echo example</h3> <p>This example shows a Vert.x HTTP server which handles websockets connections. This example simply echoes back to the client
whatever it receives on the websocket.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">webSocketHandler</span><span class="token punctuation">(</span><span class="token parameter">ws</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>ws<span class="token punctuation">.</span>writeBinaryMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;ws.html&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>There's also a client which connects to the server, sends some data and logs out what it receives.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">websocket</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token parameter">websocket</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  websocket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received data &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  websocket<span class="token punctuation">.</span><span class="token function">writeBinaryMessage</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Javascript WebSockets client example:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Web Socket Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> socket<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>WebSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:8080/myapp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Received data from websocket: &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Web Socket opened!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Web Socket closed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Your browser does not support Websockets. (Use Chrome)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>WebSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>readyState <span class="token operator">==</span> WebSocket<span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;The socket is not open.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>return false;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Hello, World!<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Send Web Socket Data<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>send(this.form.message.value)<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In practice you would probably use Vert.x-Web to build a web application that uses WebSockets</p></div> <h2 id="http-2-examples"><a href="#http-2-examples" class="header-anchor">#</a> HTTP/2 examples</h2> <p>These examples demonstrate usage of HTTP/2 with Vert.x.</p> <h3 id="simple-2"><a href="#simple-2" class="header-anchor">#</a> Simple</h3> <p>A very simple HTTP/2 server which always responds with the same response:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpServerOptions<span class="token punctuation">,</span> PemKeyCertOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPemKeyCertOptions</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setKeyPath</span><span class="token punctuation">(</span><span class="token string">&quot;server-key.pem&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setCertPath</span><span class="token punctuation">(</span><span class="token string">&quot;server-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from vert.x!&lt;/h1&gt;&lt;p&gt;version = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8443</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>And a simple HTTP/2 client which makes a request to the server.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClientOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpVersion <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/enums&quot;</span><span class="token punctuation">;</span>


<span class="token comment">// Note! in real-life you wouldn't often set trust all to true as</span>
<span class="token comment">// it could leave you open to man in the middle attacks.</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProtocolVersion</span><span class="token punctuation">(</span>HttpVersion<span class="token punctuation">.</span><span class="token constant">HTTP_2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">8443</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got response &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; with protocol &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token parameter">body</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got data &quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="push"><a href="#push" class="header-anchor">#</a> Push</h3> <p>This example shows HTTP/2 push.</p> <p>The server pushes <code>script.js</code> along with <code>index.html</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpServerOptions<span class="token punctuation">,</span> PemKeyCertOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpMethod <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/enums&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemKeyCertOptions</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setKeyPath</span><span class="token punctuation">(</span><span class="token string">&quot;server-key.pem&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setCertPath</span><span class="token punctuation">(</span><span class="token string">&quot;server-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> path <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> resp <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span> <span class="token operator">==</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    resp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>HttpMethod<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">&quot;/script.js&quot;</span><span class="token punctuation">,</span> <span class="token parameter">onPush</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>onPush<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;sending push&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> pushedResp <span class="token operator">=</span> onPush<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pushedResp<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;script.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Sometimes Safari forbids push : &quot;Server push not allowed to opposite endpoint.&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    resp<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;/script.js&quot;</span> <span class="token operator">==</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    resp<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;script.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Not found &quot;</span> <span class="token operator">+</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8443</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the server then open a browser and point it at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>And a client sets a push handler to be notified of the incoming server side pushes:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClientOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpVersion <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/enums&quot;</span><span class="token punctuation">;</span>


<span class="token comment">// Note! in real-life you wouldn't often set trust all to true as</span>
<span class="token comment">// it could leave you open to man in the middle attacks.</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProtocolVersion</span><span class="token punctuation">(</span>HttpVersion<span class="token punctuation">.</span><span class="token constant">HTTP_2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">8443</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got response &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; with protocol &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token parameter">body</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got data &quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// Set handler for server side push</span>
  <span class="token punctuation">.</span><span class="token function">pushHandler</span><span class="token punctuation">(</span><span class="token parameter">pushedReq</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Receiving pushed content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pushedReq<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">pushedResp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      pushedResp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token parameter">body</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got pushed data &quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="h2c"><a href="#h2c" class="header-anchor">#</a> H2C</h3> <p>Like the simple server but using clear text, also known as <em>h2c</em>, without TLS:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">var</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from vert.x!&lt;/h1&gt;&lt;p&gt;version = &quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This example won't work with browsers are they don't support h2c</p></div> <p>And a client to connect to the server:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClientOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpVersion <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/enums&quot;</span><span class="token punctuation">;</span>


<span class="token comment">// Note! in real-life you wouldn't often set trust all to true as</span>
<span class="token comment">// it could leave you open to man in the middle attacks.</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProtocolVersion</span><span class="token punctuation">(</span>HttpVersion<span class="token punctuation">.</span><span class="token constant">HTTP_2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got response &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; with protocol &quot;</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token parameter">body</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got data &quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="custom-frames"><a href="#custom-frames" class="header-anchor">#</a> Custom frames</h3> <p>HTTP/2 can be extended with custom frames, this example shows how to write custom frames:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpServerOptions<span class="token punctuation">,</span> PemKeyCertOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPemKeyCertOptions</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setKeyPath</span><span class="token punctuation">(</span><span class="token string">&quot;server-key.pem&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setCertPath</span><span class="token punctuation">(</span><span class="token string">&quot;server-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> resp <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  req<span class="token punctuation">.</span><span class="token function">customFrameHandler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received client frame &quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Write the sam</span>
    resp<span class="token punctuation">.</span><span class="token function">writeCustomFrame</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;pong&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8443</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This examples shows how to receive custom frames:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClientOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpVersion <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/enums&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core'</span><span class="token punctuation">;</span>

<span class="token comment">// Note! in real-life you wouldn't often set trust all to true as</span>
<span class="token comment">// it could leave you open to man in the middle attacks.</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProtocolVersion</span><span class="token punctuation">(</span>HttpVersion<span class="token punctuation">.</span><span class="token constant">HTTP_2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> request <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">8443</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Print custom frames received from server</span>
  resp<span class="token punctuation">.</span><span class="token function">customFrameHandler</span><span class="token punctuation">(</span><span class="token parameter">frame</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got frame from server &quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">sendHead</span><span class="token punctuation">(</span><span class="token parameter">version</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Once head has been sent we can send custom frames</span>
  vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sending ping frame to server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">writeCustomFrame</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;ping&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="event-bus-examples"><a href="#event-bus-examples" class="header-anchor">#</a> Event bus examples</h2> <p>These examples demonstrate usage of the event bus in Vert.x</p> <h3 id="point-to-point"><a href="#point-to-point" class="header-anchor">#</a> Point to point</h3> <p>This example demonstrates point to point messaging between a receiver and a sender.</p> <p>The receiver listens on an address on the event bus for incoming messages. When it receives a message it replies to it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">var</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eb<span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;ping-address&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received message: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Now send back reply</span>
  message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;pong!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Receiver ready!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The sender sends a message to that address every second, when it receives a reply it logs it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">var</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a message every second</span>

vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  eb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;ping-address&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ping!&quot;</span><span class="token punctuation">,</span> <span class="token parameter">onSend</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>onSend<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received reply &quot;</span> <span class="token operator">+</span> onSend<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;No reply&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the sender and receiver at the command line.</p> <p>At the command line you should run Sender and Receiver in different consoles using the <code>-cluster</code> flag:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>es4x run eventbus/pointtopoint/receiver.js -cluster

es4x run eventbus/pointtopoint/sender.js -cluster
</code></pre></div><p>The <code>-cluster</code> flag allows different Vert.x instances on the network to cluster the event bus together into a single
event bus.</p> <h3 id="publish-subscribe"><a href="#publish-subscribe" class="header-anchor">#</a> Publish / Subscribe</h3> <p>This example demonstrates publish / subscribe messaging between a receivers and a sender. With pub/sub messaging
you can have multiple subscribers who all receive messages from publishers.</p> <p>A receiver listens on an address on the event bus for incoming messages. When it receives a message it logs it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">var</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eb<span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;news-feed&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received news on consumer 1: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eb<span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;news-feed&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received news on consumer 2: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eb<span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;news-feed&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received news on consumer 3: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Ready!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The sender sends a message to that address every second, when it receives a reply it logs it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">var</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a message every second</span>

vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  eb<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;news-feed&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Some news!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can start as many senders or receivers as you like at the command line.</p> <p>At the command line you should run Sender and Receiver in different consoles using the <code>-cluster</code> flag:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>es4x run eventbus/pubsub/receiver.js -cluster

es4x run eventbus/pubsub/sender.js -cluster
</code></pre></div><p>The <code>-cluster</code> flag allows different Vert.x instances on the network to cluster the event bus together into a single
event bus.</p> <h3 id="ssl"><a href="#ssl" class="header-anchor">#</a> SSL</h3> <p>This example demonstrates point to point messaging between a receiver and a sender with a transport level encryption.</p> <p>The receiver listens on an address on the event bus for incoming messages. When it receives a message it replies to it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">var</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eb<span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;ping-address&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received message: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Now send back reply</span>
  message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;pong!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Receiver ready!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The sender sends a message to that address every second, when it receives a reply it logs it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">var</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a message every second</span>

vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  eb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;ping-address&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ping!&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reply<span class="token punctuation">,</span> reply_err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reply_err <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received reply &quot;</span> <span class="token operator">+</span> reply<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;No reply&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can run the Java sender and receiver in the command line.</p> <p>At the command line you should run Sender and Receiver in different consoles using the <code>-cluster</code> flag:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>es4x run  eventbus/ssl/receiver.js -cluster

es4x run eventbus/ssl/sender.js -cluster
</code></pre></div><p>The <code>-cluster</code> flag allows different Vert.x instances on the network to cluster the event bus together into a single
event bus.</p> <h2 id="future"><a href="#future" class="header-anchor">#</a> Future</h2> <p>es4x handler <a href="https://vertx-web-site.github.io/docs/vertx-core/java/#_async_coordination" target="_blank" rel="noopener noreferrer">Vert.x Future<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>'s in a special
way. Behind the scenes, Vert.x Future's are enhanced to be a <code>Thenable</code> js object which means you can <code>await</code> on then
just like a js <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>You can still use the use the Vert.x API, for example, composition can be done as:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Promise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vertx/core'</span>

<span class="token keyword">var</span> <span class="token function-variable function">anotherAsyncAction</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// mimic something that take times</span>
  vertx<span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">l</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promise<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token string">&quot;hello &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">anAsyncAction</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// mimic something that take times</span>
  vertx<span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">l</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promise<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> future <span class="token operator">=</span> <span class="token function">anAsyncAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
future<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>anotherAsyncAction<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token parameter">onComplete</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>onComplete<span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Something bad happened&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>onComplete<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Result: &quot;</span> <span class="token operator">+</span> onComplete<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="verticle-examples"><a href="#verticle-examples" class="header-anchor">#</a> Verticle examples</h2> <p>These examples show verticles being deployed and undeployed.</p> <h3 id="deploy-example"><a href="#deploy-example" class="header-anchor">#</a> Deploy example</h3> <p>This example shows a verticle deploying another verticle in several different ways including:</p> <ul><li>Deploying without waiting for it to deploy</li> <li>Deploying and waiting for it to deploy</li> <li>Passing configuration to another verticle during deploy</li> <li>Deploying more than one instance</li> <li>Deploying as a worker verticle</li> <li>Undeploying a verticle deployment explicitly</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> DeploymentOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Main verticle has started, let's deploy some others...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Different ways of deploying verticles</span>

<span class="token comment">// Deploy a verticle and don't wait for it to start</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;io.vertx.example.core.verticle.deploy.OtherVerticle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy another instance and  want for it to start</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;io.vertx.example.core.verticle.deploy.OtherVerticle&quot;</span><span class="token punctuation">,</span> <span class="token parameter">onDeployVerticle</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>onDeployVerticle<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> deploymentID <span class="token operator">=</span> onDeployVerticle<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Other verticle deployed ok, deploymentID = &quot;</span> <span class="token operator">+</span> deploymentID<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// You can also explicitly undeploy a verticle deployment.</span>
    <span class="token comment">// Note that this is usually unnecessary as any verticles deployed by a verticle will be automatically</span>
    <span class="token comment">// undeployed when the parent verticle is undeployed</span>

    vertx<span class="token punctuation">.</span><span class="token function">undeploy</span><span class="token punctuation">(</span>deploymentID<span class="token punctuation">,</span> <span class="token parameter">onUndeploy</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>onUndeploy<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Undeployed ok!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>onUndeploy<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>onDeployVerticle<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy specifying some config</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span>
  <span class="token string">&quot;io.vertx.example.core.verticle.deploy.OtherVerticle&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">&quot;config&quot;</span><span class="token operator">:</span> config
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy 10 instances</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span>
  <span class="token string">&quot;io.vertx.example.core.verticle.deploy.OtherVerticle&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setInstances</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy it as a worker verticle</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span>
  <span class="token string">&quot;io.vertx.example.core.verticle.deploy.OtherVerticle&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setWorker</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre></div><h3 id="asynchronous-deployment-example"><a href="#asynchronous-deployment-example" class="header-anchor">#</a> Asynchronous deployment example</h3> <p>This is similar to the deployment example, but it shows how the start and stop of a verticle can be asynchronous. This
is useful if the verticle has some startup or cleanup to do that takes some time, and we wish to avoid blocking the
an event loop.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Main verticle has started, let's deploy some others...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy another instance and  want for it to start</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;io.vertx.example.core.verticle.asyncstart.OtherVerticle&quot;</span><span class="token punctuation">,</span> <span class="token parameter">onDeployVerticle</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>onDeployVerticle<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> deploymentID <span class="token operator">=</span> onDeployVerticle<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Other verticle deployed ok, deploymentID = &quot;</span> <span class="token operator">+</span> deploymentID<span class="token punctuation">)</span><span class="token punctuation">;</span>

    vertx<span class="token punctuation">.</span><span class="token function">undeploy</span><span class="token punctuation">(</span>deploymentID<span class="token punctuation">,</span> <span class="token parameter">onUndeploy</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>onUndeploy<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Undeployed ok!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>onUndeploy<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>onDeployVerticle<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre></div><h3 id="worker-verticle-example"><a href="#worker-verticle-example" class="header-anchor">#</a> Worker Verticle example</h3> <p>A simple example illustrating how worker verticle can be created and the thread switches when interacting with them. The worker verticle is not           System.out.println(Thread.currentThread());
ed in the event loop and so can do blocking operations.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> DeploymentOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core/options&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[Main] Running in &quot;</span> <span class="token operator">+</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span>
  <span class="token string">&quot;io.vertx.example.core.verticle.worker.WorkerVerticle&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setWorker</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;sample.data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello vert.x&quot;</span><span class="token punctuation">,</span> <span class="token parameter">onSend</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[Main] Receiving reply ' &quot;</span> <span class="token operator">+</span> onSend<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;' in &quot;</span> <span class="token operator">+</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[Worker] Starting in &quot;</span> <span class="token operator">+</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;sample.data&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[Worker] Consuming data in &quot;</span> <span class="token operator">+</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> body <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="high-availability"><a href="#high-availability" class="header-anchor">#</a> High Availability</h2> <p>This example demonstrates the high availability feature of vert.x. When enabled, vert.x redeploys verticles to another
node when the original node dies abruptly.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// &lt;reference types=&quot;es4x&quot; /&gt;</span>
<span class="token comment">// @ts-check</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> process<span class="token punctuation">.</span>pid<span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Happily served by &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To run this example, you need to have a working cluster. Configure Hazelcast and append the required <code>cluster-host</code>
to the commands if needed.</p> <p>To see the HA (high-availability) behavior you need three terminals.</p> <p>In the first terminal, go the the _core-examples` directory and launch:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>es4x run io.vertx.example.core.ha.Server -ha
</code></pre></div><p>Open a browser to <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. You should see something like:</p> <div class="language- extra-class"><pre class="language-text"><code>Happily served by 97284
</code></pre></div><p>Be displayed id is OS and JVM specific, so you may have something completely different.</p> <p>In the second terminal, launch:</p> <div class="language- extra-class"><pre class="language-text"><code>es4x bare
</code></pre></div><p>In the third terminal, display the list of the Java process and kill the first one (smaller pid):</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; jps | grep Launcher
97297 Launcher
97284 Launcher
&gt; kill -9 97284
</code></pre></div><p>In your browser, refresh the page, you should see a different id such as:</p> <div class="language- extra-class"><pre class="language-text"><code>Happily served by 97297
</code></pre></div><p>The verticle has been migrated.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/quick-guide/core/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/28/2020, 2:20:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/es4x/quick-guide/" class="prev router-link-active">
        Quick Guides
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.0ada8026.js" defer></script><script src="/es4x/assets/js/2.8321b957.js" defer></script><script src="/es4x/assets/js/26.8a076633.js" defer></script>
  </body>
</html>
