<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES for Eclipse Vert.x</title>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
  <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
  <script src="/es4x/player/asciinema-player.js"></script>
    
    <link rel="preload" href="/es4x/assets/css/0.styles.93ea0277.css" as="style"><link rel="preload" href="/es4x/assets/js/app.5c50c914.js" as="script"><link rel="preload" href="/es4x/assets/js/2.9528bf06.js" as="script"><link rel="preload" href="/es4x/assets/js/149.97b36e7e.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.3a8497eb.js"><link rel="prefetch" href="/es4x/assets/js/100.a16ae8c2.js"><link rel="prefetch" href="/es4x/assets/js/101.2f9de256.js"><link rel="prefetch" href="/es4x/assets/js/102.20df84c2.js"><link rel="prefetch" href="/es4x/assets/js/103.f5a0895a.js"><link rel="prefetch" href="/es4x/assets/js/104.ef6dd412.js"><link rel="prefetch" href="/es4x/assets/js/105.bbbf0dd0.js"><link rel="prefetch" href="/es4x/assets/js/106.db7eca08.js"><link rel="prefetch" href="/es4x/assets/js/107.c4898068.js"><link rel="prefetch" href="/es4x/assets/js/108.2dce77a0.js"><link rel="prefetch" href="/es4x/assets/js/109.c8cc9b8b.js"><link rel="prefetch" href="/es4x/assets/js/11.6cb08ab3.js"><link rel="prefetch" href="/es4x/assets/js/110.7e825b63.js"><link rel="prefetch" href="/es4x/assets/js/111.593de263.js"><link rel="prefetch" href="/es4x/assets/js/112.0670c01a.js"><link rel="prefetch" href="/es4x/assets/js/113.84f975b1.js"><link rel="prefetch" href="/es4x/assets/js/114.67df7f7d.js"><link rel="prefetch" href="/es4x/assets/js/115.335c4de1.js"><link rel="prefetch" href="/es4x/assets/js/116.b4b0b1b2.js"><link rel="prefetch" href="/es4x/assets/js/117.52c9c163.js"><link rel="prefetch" href="/es4x/assets/js/118.25ab0d2f.js"><link rel="prefetch" href="/es4x/assets/js/119.9b807fbd.js"><link rel="prefetch" href="/es4x/assets/js/12.5d225bcb.js"><link rel="prefetch" href="/es4x/assets/js/120.34b00517.js"><link rel="prefetch" href="/es4x/assets/js/121.1f1ea408.js"><link rel="prefetch" href="/es4x/assets/js/122.efa391c4.js"><link rel="prefetch" href="/es4x/assets/js/123.cbf2e99f.js"><link rel="prefetch" href="/es4x/assets/js/124.e97ccb7b.js"><link rel="prefetch" href="/es4x/assets/js/125.b11510bd.js"><link rel="prefetch" href="/es4x/assets/js/126.87f4fa0f.js"><link rel="prefetch" href="/es4x/assets/js/127.8f8eb948.js"><link rel="prefetch" href="/es4x/assets/js/128.13d038e0.js"><link rel="prefetch" href="/es4x/assets/js/129.dc2cd690.js"><link rel="prefetch" href="/es4x/assets/js/13.9a9233c3.js"><link rel="prefetch" href="/es4x/assets/js/130.dc646b26.js"><link rel="prefetch" href="/es4x/assets/js/131.52e2a779.js"><link rel="prefetch" href="/es4x/assets/js/132.1e4b89d1.js"><link rel="prefetch" href="/es4x/assets/js/133.a0fbb880.js"><link rel="prefetch" href="/es4x/assets/js/134.b49897ea.js"><link rel="prefetch" href="/es4x/assets/js/135.3f05f822.js"><link rel="prefetch" href="/es4x/assets/js/136.08fa614d.js"><link rel="prefetch" href="/es4x/assets/js/137.0cb036fd.js"><link rel="prefetch" href="/es4x/assets/js/138.0d35423f.js"><link rel="prefetch" href="/es4x/assets/js/139.243cc65d.js"><link rel="prefetch" href="/es4x/assets/js/14.4d1a91f0.js"><link rel="prefetch" href="/es4x/assets/js/140.36143b91.js"><link rel="prefetch" href="/es4x/assets/js/141.c5923bc7.js"><link rel="prefetch" href="/es4x/assets/js/142.fda59539.js"><link rel="prefetch" href="/es4x/assets/js/143.28297a8b.js"><link rel="prefetch" href="/es4x/assets/js/144.66f8db50.js"><link rel="prefetch" href="/es4x/assets/js/145.1d1d85e0.js"><link rel="prefetch" href="/es4x/assets/js/146.2810738b.js"><link rel="prefetch" href="/es4x/assets/js/147.5606ed15.js"><link rel="prefetch" href="/es4x/assets/js/148.80cd8489.js"><link rel="prefetch" href="/es4x/assets/js/15.32e17dad.js"><link rel="prefetch" href="/es4x/assets/js/150.fabcf288.js"><link rel="prefetch" href="/es4x/assets/js/151.f921c653.js"><link rel="prefetch" href="/es4x/assets/js/152.bf55767e.js"><link rel="prefetch" href="/es4x/assets/js/153.ed86c73a.js"><link rel="prefetch" href="/es4x/assets/js/154.ed046717.js"><link rel="prefetch" href="/es4x/assets/js/155.2b58da6a.js"><link rel="prefetch" href="/es4x/assets/js/156.fbc8b7da.js"><link rel="prefetch" href="/es4x/assets/js/157.63354900.js"><link rel="prefetch" href="/es4x/assets/js/158.4dfbf7de.js"><link rel="prefetch" href="/es4x/assets/js/159.42ae507c.js"><link rel="prefetch" href="/es4x/assets/js/16.fd9d1a51.js"><link rel="prefetch" href="/es4x/assets/js/160.3cf496ae.js"><link rel="prefetch" href="/es4x/assets/js/161.83304a96.js"><link rel="prefetch" href="/es4x/assets/js/162.d7cb8b75.js"><link rel="prefetch" href="/es4x/assets/js/163.98ad0a99.js"><link rel="prefetch" href="/es4x/assets/js/164.c60e6322.js"><link rel="prefetch" href="/es4x/assets/js/165.9f3eb69b.js"><link rel="prefetch" href="/es4x/assets/js/17.54bde0b4.js"><link rel="prefetch" href="/es4x/assets/js/18.b5c20f2c.js"><link rel="prefetch" href="/es4x/assets/js/19.5194252c.js"><link rel="prefetch" href="/es4x/assets/js/20.9bd5e5de.js"><link rel="prefetch" href="/es4x/assets/js/21.3a1f2566.js"><link rel="prefetch" href="/es4x/assets/js/22.c6abd98b.js"><link rel="prefetch" href="/es4x/assets/js/23.d0e8407e.js"><link rel="prefetch" href="/es4x/assets/js/24.24bd0c07.js"><link rel="prefetch" href="/es4x/assets/js/25.79b4d567.js"><link rel="prefetch" href="/es4x/assets/js/26.55e20f7d.js"><link rel="prefetch" href="/es4x/assets/js/27.954ec0d0.js"><link rel="prefetch" href="/es4x/assets/js/28.7328b6a0.js"><link rel="prefetch" href="/es4x/assets/js/29.70a1b946.js"><link rel="prefetch" href="/es4x/assets/js/3.ea01a935.js"><link rel="prefetch" href="/es4x/assets/js/30.72c26420.js"><link rel="prefetch" href="/es4x/assets/js/31.13bf88db.js"><link rel="prefetch" href="/es4x/assets/js/32.65ce4eb7.js"><link rel="prefetch" href="/es4x/assets/js/33.ae2a52a4.js"><link rel="prefetch" href="/es4x/assets/js/34.d6312781.js"><link rel="prefetch" href="/es4x/assets/js/35.bb3728a5.js"><link rel="prefetch" href="/es4x/assets/js/36.2217cb8a.js"><link rel="prefetch" href="/es4x/assets/js/37.b5eb90bc.js"><link rel="prefetch" href="/es4x/assets/js/38.7c03df83.js"><link rel="prefetch" href="/es4x/assets/js/39.e27e4593.js"><link rel="prefetch" href="/es4x/assets/js/4.fc776d3f.js"><link rel="prefetch" href="/es4x/assets/js/40.93417554.js"><link rel="prefetch" href="/es4x/assets/js/41.1f127357.js"><link rel="prefetch" href="/es4x/assets/js/42.b78cae14.js"><link rel="prefetch" href="/es4x/assets/js/43.912b9356.js"><link rel="prefetch" href="/es4x/assets/js/44.f0fd20e4.js"><link rel="prefetch" href="/es4x/assets/js/45.a7fdff61.js"><link rel="prefetch" href="/es4x/assets/js/46.cbceca3e.js"><link rel="prefetch" href="/es4x/assets/js/47.61ea5aa9.js"><link rel="prefetch" href="/es4x/assets/js/48.ae8f3a89.js"><link rel="prefetch" href="/es4x/assets/js/49.83e2beca.js"><link rel="prefetch" href="/es4x/assets/js/5.36188fd0.js"><link rel="prefetch" href="/es4x/assets/js/50.5e1d5ffb.js"><link rel="prefetch" href="/es4x/assets/js/51.ff2c55ca.js"><link rel="prefetch" href="/es4x/assets/js/52.2ab6b963.js"><link rel="prefetch" href="/es4x/assets/js/53.003dce91.js"><link rel="prefetch" href="/es4x/assets/js/54.f3ab8db1.js"><link rel="prefetch" href="/es4x/assets/js/55.03718cf7.js"><link rel="prefetch" href="/es4x/assets/js/56.7d18d4cf.js"><link rel="prefetch" href="/es4x/assets/js/57.cf1be33e.js"><link rel="prefetch" href="/es4x/assets/js/58.e81a6ae3.js"><link rel="prefetch" href="/es4x/assets/js/59.71d8f795.js"><link rel="prefetch" href="/es4x/assets/js/6.fc126a38.js"><link rel="prefetch" href="/es4x/assets/js/60.90f1735a.js"><link rel="prefetch" href="/es4x/assets/js/61.66d28a0d.js"><link rel="prefetch" href="/es4x/assets/js/62.0b18638e.js"><link rel="prefetch" href="/es4x/assets/js/63.ab499887.js"><link rel="prefetch" href="/es4x/assets/js/64.277b48e0.js"><link rel="prefetch" href="/es4x/assets/js/65.82c56c7b.js"><link rel="prefetch" href="/es4x/assets/js/66.86a2e5ed.js"><link rel="prefetch" href="/es4x/assets/js/67.c60348a1.js"><link rel="prefetch" href="/es4x/assets/js/68.dcab7f6b.js"><link rel="prefetch" href="/es4x/assets/js/69.9760a353.js"><link rel="prefetch" href="/es4x/assets/js/7.15d59e13.js"><link rel="prefetch" href="/es4x/assets/js/70.91d487f5.js"><link rel="prefetch" href="/es4x/assets/js/71.007f382a.js"><link rel="prefetch" href="/es4x/assets/js/72.dd8fc256.js"><link rel="prefetch" href="/es4x/assets/js/73.dabb918b.js"><link rel="prefetch" href="/es4x/assets/js/74.2d05d9d2.js"><link rel="prefetch" href="/es4x/assets/js/75.24e40fad.js"><link rel="prefetch" href="/es4x/assets/js/76.3917601b.js"><link rel="prefetch" href="/es4x/assets/js/77.8d933c53.js"><link rel="prefetch" href="/es4x/assets/js/78.889ea1de.js"><link rel="prefetch" href="/es4x/assets/js/79.707c2cfc.js"><link rel="prefetch" href="/es4x/assets/js/8.9d77fc4d.js"><link rel="prefetch" href="/es4x/assets/js/80.d16501dd.js"><link rel="prefetch" href="/es4x/assets/js/81.d6ddc5b3.js"><link rel="prefetch" href="/es4x/assets/js/82.83a52449.js"><link rel="prefetch" href="/es4x/assets/js/83.26253b37.js"><link rel="prefetch" href="/es4x/assets/js/84.55a5180b.js"><link rel="prefetch" href="/es4x/assets/js/85.0f669957.js"><link rel="prefetch" href="/es4x/assets/js/86.1ea59e44.js"><link rel="prefetch" href="/es4x/assets/js/87.1a523aae.js"><link rel="prefetch" href="/es4x/assets/js/88.c4790f82.js"><link rel="prefetch" href="/es4x/assets/js/89.943de6e9.js"><link rel="prefetch" href="/es4x/assets/js/9.6b0ac1d5.js"><link rel="prefetch" href="/es4x/assets/js/90.2ec0b578.js"><link rel="prefetch" href="/es4x/assets/js/91.4002b7d6.js"><link rel="prefetch" href="/es4x/assets/js/92.40b463c2.js"><link rel="prefetch" href="/es4x/assets/js/93.b7246002.js"><link rel="prefetch" href="/es4x/assets/js/94.ff76977a.js"><link rel="prefetch" href="/es4x/assets/js/95.62c8c9e0.js"><link rel="prefetch" href="/es4x/assets/js/96.e53f12ec.js"><link rel="prefetch" href="/es4x/assets/js/97.6dfe744d.js"><link rel="prefetch" href="/es4x/assets/js/98.59c44a32.js"><link rel="prefetch" href="/es4x/assets/js/99.afcf40c7.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.93ea0277.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/web/" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/web/" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Vert.x-Web is a set of building blocks for building web applications
with Vert.x. Think of it as a Swiss Army Knife for building modern,
scalable, web apps.</p> <p>Vert.x core provides a fairly low level set of functionality for
handling HTTP, and for some applications that will be sufficient.</p> <p>Vert.x-Web builds on Vert.x core to provide a richer set of
functionality for building real web applications, more easily.</p> <p>It’s the successor to <a href="http://pmlopes.github.io/yoke/" target="_blank" rel="noopener noreferrer">Yoke<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in Vert.x
2.x, and takes inspiration from projects such as
<a href="http://expressjs.com/" target="_blank" rel="noopener noreferrer">Express<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in the Node.js world and
<a href="http://www.sinatrarb.com/" target="_blank" rel="noopener noreferrer">Sinatra<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in the Ruby world.</p> <p>Vert.x-Web is designed to be powerful, un-opionated and fully
embeddable. You just use the parts you want and nothing more. Vert.x-Web
is not a container.</p> <p>You can use Vert.x-Web to create classic server-side web applications,
RESTful web applications, 'real-time' (server push) web applications, or
any other kind of web application you can think of. Vert.x-Web doesn’t
care. It’s up to you to chose the type of app you prefer, not
Vert.x-Web.</p> <p>Vert.x-Web is a great fit for writingRESTful HTTP micro-services*, but
we don’tforce* you to write apps like that.</p> <p>Some of the key features of Vert.x-Web include:</p> <ul><li><p>Routing (based on method, path, etc)</p></li> <li><p>Regular expression pattern matching for paths</p></li> <li><p>Extraction of parameters from paths</p></li> <li><p>Content negotiation</p></li> <li><p>Request body handling</p></li> <li><p>Body size limits</p></li> <li><p>Cookie parsing and handling</p></li> <li><p>Multipart forms</p></li> <li><p>Multipart file uploads</p></li> <li><p>Sub routers</p></li> <li><p>Session support - both local (for sticky sessions) and clustered
(for non sticky)</p></li> <li><p>CORS (Cross Origin Resource Sharing) support</p></li> <li><p>Error page handler</p></li> <li><p>Basic Authentication</p></li> <li><p>Redirect based authentication</p></li> <li><p>Authorisation handlers</p></li> <li><p>JWT based authorization</p></li> <li><p>User/role/permission authorisation</p></li> <li><p>Favicon handling</p></li> <li><p>Template support for server side rendering, including support for
the following template engines out of the box:</p> <ul><li><p>Handlebars</p></li> <li><p>Jade,</p></li> <li><p>MVEL</p></li> <li><p>Thymeleaf</p></li> <li><p>Apache FreeMarker</p></li> <li><p>Pebble</p></li> <li><p>Rocker</p></li></ul></li> <li><p>Response time handler</p></li> <li><p>Static file serving, including caching logic and directory listing.</p></li> <li><p>Request timeout support</p></li> <li><p>SockJS support</p></li> <li><p>Event-bus bridge</p></li> <li><p>CSRF Cross Site Request Forgery</p></li> <li><p>VirtualHost</p></li></ul> <p>Most features in Vert.x-Web are implemented as handlers so you can
always write your own. We envisage many more being written over time.</p> <p>We’ll discuss all these features in this manual.</p> <h1 id="using-vert-x-web"><a href="#using-vert-x-web" class="header-anchor">#</a> Using Vert.x Web</h1> <p>To use vert.x web, add the following dependency to the <em>dependencies</em>
section of your build descriptor:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.vertx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>vertx-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
 compile <span class="token string">'io.vertx:vertx-web:${maven.version}'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="development-mode"><a href="#development-mode" class="header-anchor">#</a> Development mode</h2> <p>Vert.x Web by default operates in production mode. You can switch the
development mode by assigning the <code>dev</code> value to either:</p> <ul><li><p>the <code>VERTXWEB_ENVIRONMENT</code> environment variable, or</p></li> <li><p>the <code>vertxweb.environment</code> system property</p></li></ul> <p>In development mode:</p> <ul><li><p>template engine caches are disabled</p></li> <li><p>the <code>ErrorHandler</code> does not display exception details</p></li> <li><p>the <code>StaticHandler</code> does not handle cache headers</p></li> <li><p>the GraphiQL development tool is disabled</p></li></ul> <h1 id="re-cap-on-vert-x-core-http-servers"><a href="#re-cap-on-vert-x-core-http-servers" class="header-anchor">#</a> Re-cap on Vert.x core HTTP servers</h1> <p>Vert.x-Web uses and exposes the API from Vert.x core, so it’s well worth
getting familiar with the basic concepts of writing HTTP servers using
Vert.x core, if you’re not already.</p> <p>The Vert.x core HTTP documentation goes into a lot of detail on this.</p> <p>Here’s a hello world web server written using Vert.x core. At this point
there is no Vert.x-Web involved:</p> <div class="language-java extra-class"><pre class="language-java"><code>let server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler gets called for each request that arrives on the server</span>
  let response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Write to the response and end it</span>
  response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We create an HTTP server instance, and we set a request handler on it.
The request handler will be called whenever a request arrives on the
server.</p> <p>When that happens we are just going to set the content type to
<code>text/plain</code>, and write <code>Hello World!</code> and end the response.</p> <p>We then tell the server to listen at port <code>8080</code> (default host is
<code>localhost</code>).</p> <p>You can run this, and point your browser at <code>http://localhost:8080</code> to
verify that it works as expected.</p> <h1 id="basic-vert-x-web-concepts"><a href="#basic-vert-x-web-concepts" class="header-anchor">#</a> Basic Vert.x-Web concepts</h1> <p>Here’s the 10000 foot view:</p> <p>A <code>Router</code> is one of the core concepts of Vert.x-Web. It’s an object
which maintains zero or more <code>Routes</code> .</p> <p>A router takes an HTTP request and finds the first matching route for
that request, and passes the request to that route.</p> <p>The route can have a <em>handler</em> associated with it, which then receives
the request. You then <em>do something</em> with the request, and then, either
end it or pass it to the next matching handler.</p> <p>Here’s a simple router example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for every request</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Write to the response and end it</span>
  response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World from Vert.x-Web!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It basically does the same thing as the Vert.x Core HTTP server hello
world example from the previous section, but this time using Vert.x-Web.</p> <p>We create an HTTP server as before, then we create a router. Once we’ve
done that we create a simple route with no matching criteria so it will
match <em>all</em> requests that arrive on the server.</p> <p>We then specify a handler for that route. That handler will be called
for all requests that arrive on the server.</p> <p>The object that gets passed into the handler is a <code>RoutingContext</code> -
this contains the standard Vert.x <code>HttpServerRequest</code> and
<code>HttpServerResponse</code> but also various other useful stuff that makes
working with Vert.x-Web simpler.</p> <p>For every request that is routed there is a unique routing context
instance, and the same instance is passed to all handlers for that
request.</p> <p>Once we’ve set up the handler, we set the request handler of the HTTP
server to pass all incoming requests to <code>handle</code>.</p> <p>So, that’s the basics. Now we’ll look at things in more detail:</p> <h1 id="handling-requests-and-calling-the-next-handler"><a href="#handling-requests-and-calling-the-next-handler" class="header-anchor">#</a> Handling requests and calling the next handler</h1> <p>When Vert.x-Web decides to route a request to a matching route, it calls
the handler of the route passing in an instance of <code>RoutingContext</code>. A
route can have different handlers, that you can append using <code>handler</code></p> <p>If you don’t end the response in your handler, you should call <code>next</code> so
another matching route can handle the request (if any).</p> <p>You don’t have to call <code>next</code> before the handler has finished executing.
You can do this some time later, if you want:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// enable chunked responses because we will be adding data as</span>
  <span class="token comment">// we execute over other handlers. This is only required once and</span>
  <span class="token comment">// only if several handlers do output.</span>
  response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route1\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Call the next matching route after a 5 second delay</span>
  routingContext<span class="token punctuation">.</span><span class="token function">vertx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">tid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route2\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Call the next matching route after a 5 second delay</span>
  routingContext<span class="token punctuation">.</span><span class="token function">vertx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">tid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now end the response</span>
  routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the above example <code>route1</code> is written to the response, then 5 seconds
later <code>route2</code> is written to the response, then 5 seconds later <code>route3</code>
is written to the response and the response is ended.</p> <p>Note, all this happens without any thread blocking.</p> <h1 id="using-blocking-handlers"><a href="#using-blocking-handlers" class="header-anchor">#</a> Using blocking handlers</h1> <p>Sometimes, you might have to do something in a handler that might block
the event loop for some time, e.g. call a legacy blocking API or do some
intensive calculation.</p> <p>You can’t do that in a normal handler, so we provide the ability to set
blocking handlers on a route.</p> <p>A blocking handler looks just like a normal handler but it’s called by
Vert.x using a thread from the worker pool not using an event loop.</p> <p>You set a blocking handler on a route with <code>blockingHandler</code>. Here’s an
example:</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">blockingHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Do something that might take some time synchronously</span>
  service<span class="token punctuation">.</span><span class="token function">doSomethingThatBlocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now call the next handler</span>
  routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default, any blocking handlers executed on the same context (e.g. the
same verticle instance) are <em>ordered</em> - this means the next one won’t be
executed until the previous one has completed. If you don’t care about
orderering and don’t mind your blocking handlers executing in parallel
you can set the blocking handler specifying <code>ordered</code> as false using
<code>blockingHandler</code>.</p> <p>Note, if you need to process multipart form data from a blocking
handler, you MUST use a non-blocking handler FIRST in order to call
<code>setExpectMultipart(true)</code>. Here is an example:</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/some/endpoint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setExpectMultipart</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">blockingHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... Do some blocking operation</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="routing-by-exact-path"><a href="#routing-by-exact-path" class="header-anchor">#</a> Routing by exact path</h1> <p>A route can be set-up to match the path from the request URI. In this
case it will match any request which has a path that’s the same as the
specified path.</p> <p>In the following example the handler will be called for a request
<code>/some/path/</code>. We also ignore trailing slashes so it will be called for
paths <code>/some/path</code> and <code>/some/path//</code> too:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// This handler will be called for the following request paths:</span>

  <span class="token comment">// `/some/path`</span>
  <span class="token comment">// `/some/path/`</span>
  <span class="token comment">// `/some/path//`</span>
  <span class="token comment">//</span>
  <span class="token comment">// but not:</span>
  <span class="token comment">// `/some/path/subdir`</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="routing-by-paths-that-begin-with-something"><a href="#routing-by-paths-that-begin-with-something" class="header-anchor">#</a> Routing by paths that begin with something</h1> <p>Often you want to route all requests that begin with a certain path. You
could use a regex to do this, but a simply way is to use an asterisk <code>*</code>
at the end of the path when declaring the route path.</p> <p>In the following example the handler will be called for any request with
a URI path that starts with <code>/some/path/</code>.</p> <p>For example <code>/some/path/foo.html</code> and <code>/some/path/otherdir/blah.css</code>
would both match.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// This handler will be called for any path that starts with</span>
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/some/path/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>g<span class="token punctuation">.</span>

  <span class="token operator">/</span><span class="token operator">/</span> `<span class="token operator">/</span>some<span class="token operator">/</span>path`
  <span class="token operator">/</span><span class="token operator">/</span> `<span class="token operator">/</span>some<span class="token operator">/</span>path<span class="token operator">/</span>`
  <span class="token operator">/</span><span class="token operator">/</span> `<span class="token operator">/</span>some<span class="token operator">/</span>path<span class="token operator">/</span>subdir`
  <span class="token operator">/</span><span class="token operator">/</span> `<span class="token operator">/</span>some<span class="token operator">/</span>path<span class="token operator">/</span>subdir<span class="token operator">/</span>blah<span class="token punctuation">.</span>html`
  <span class="token operator">/</span><span class="token operator">/</span>
  <span class="token operator">/</span><span class="token operator">/</span> but not<span class="token operator">:</span>
  <span class="token operator">/</span><span class="token operator">/</span> `<span class="token operator">/</span>some<span class="token operator">/</span>bath`
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With any path it can also be specified when creating the route:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// This handler will be called same as previous example</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="capturing-path-parameters"><a href="#capturing-path-parameters" class="header-anchor">#</a> Capturing path parameters</h1> <p>It’s possible to match paths using placeholders for parameters which are
then available in the request <code>params</code>.</p> <p>Here’s an example</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">&quot;/catalogue/products/:producttype/:productid/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> productType <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;producttype&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> productID <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;productid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Do something with them...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The placeholders consist of <code>:</code> followed by the parameter name.
Parameter names consist of any alphabetic character, numeric character
or underscore.</p> <p>In the above example, if a POST request is made to path:
<code>/catalogue/products/tools/drill123/</code> then the route will match and
<code>productType</code> will receive the value <code>tools</code> and productID will receive
the value <code>drill123</code>.</p> <h1 id="routing-with-regular-expressions"><a href="#routing-with-regular-expressions" class="header-anchor">#</a> Routing with regular expressions</h1> <p>Regular expressions can also be used to match URI paths in routes.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Matches any path ending with 'foo'</span>
<span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pathRegex</span><span class="token punctuation">(</span><span class="token string">&quot;.*foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for:</span>

  <span class="token comment">// /some/path/foo</span>
  <span class="token comment">// /foo</span>
  <span class="token comment">// /foo/bar/wibble/foo</span>
  <span class="token comment">// /bar/foo</span>

  <span class="token comment">// But not:</span>
  <span class="token comment">// /bar/wibble</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternatively the regex can be specified when creating the route:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">routeWithRegex</span><span class="token punctuation">(</span><span class="token string">&quot;.*foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called same as previous example</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="capturing-path-parameters-with-regular-expressions"><a href="#capturing-path-parameters-with-regular-expressions" class="header-anchor">#</a> Capturing path parameters with regular expressions</h1> <p>You can also capture path parameters when using regular expressions,
here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">routeWithRegex</span><span class="token punctuation">(</span><span class="token string">&quot;.*foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This regular expression matches paths that start with something like:</span>
<span class="token comment">// &quot;/foo/bar&quot; - where the &quot;foo&quot; is captured into param0 and the &quot;bar&quot; is captured into</span>
<span class="token comment">// param1</span>
route<span class="token punctuation">.</span><span class="token function">pathRegex</span><span class="token punctuation">(</span><span class="token string">&quot;\\/([^\\/]+)\\/([^\\/]+)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> productType <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;param0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> productID <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;param1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Do something with them...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the above example, if a request is made to path: <code>/tools/drill123/</code>
then the route will match and <code>productType</code> will receive the value
<code>tools</code> and productID will receive the value <code>drill123</code>.</p> <p>Captures are denoted in regular expressions with capture groups (i.e.
surrounding the capture with round brackets)</p> <h1 id="using-named-capture-groups"><a href="#using-named-capture-groups" class="header-anchor">#</a> Using named capture groups</h1> <p>Using int index param names might be troublesome in some cases. It’s
possible to use named capture groups in the regex path.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// This regular expression matches paths that start with something like: &quot;/foo/bar&quot;</span>
<span class="token comment">// It uses named regex groups to capture path params</span>
<span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">routeWithRegex</span><span class="token punctuation">(</span><span class="token string">&quot;\\/(?&lt;productType&gt;[^\\/]+)\\/(?&lt;productId&gt;[^\\/]+)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> productType <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;productType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> productID <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;productId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Do something with them...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the example above, named capture groups are mapped to path parameters
of the same name as the group.</p> <p>Additionally, you can still access group parameters as you would with
normal groups (i.e. <code>params0, params1…​</code>)</p> <h1 id="routing-by-http-method"><a href="#routing-by-http-method" class="header-anchor">#</a> Routing by HTTP method</h1> <p>By default a route will match all HTTP methods.</p> <p>If you want a route to only match for a specific HTTP method you can use
<code>method</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for any POST request</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or you can specify this with a path when creating the route:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for any POST request to a URI path starting with /some/path/</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you want to route for a specific HTTP method you can also use the
methods such as <code>get</code>, <code>post</code> and <code>put</code> named after the HTTP method
name. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Will be called for any GET request</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Will be called for any GET request to a path</span>
  <span class="token comment">// starting with /some/path</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">getWithRegex</span><span class="token punctuation">(</span><span class="token string">&quot;.*foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Will be called for any GET request to a path</span>
  <span class="token comment">// ending with `foo`</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// There are also equivalents to the above for PUT, POST, DELETE, HEAD and OPTIONS</span>
</code></pre></div><p>If you want to specify a route will match for more than HTTP method you
can call <code>method</code> multiple times:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'PUT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for any POST or PUT request</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="route-order"><a href="#route-order" class="header-anchor">#</a> Route order</h1> <p>By default routes are matched in the order they are added to the router.</p> <p>When a request arrives the router will step through each route and check
if it matches, if it matches then the handler for that route will be
called.</p> <p>If the handler subsequently calls <code>next</code> the handler for the next
matching route (if any) will be called. And so on.</p> <p>Here’s an example to illustrate this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route1 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// enable chunked responses because we will be adding data as</span>
  <span class="token comment">// we execute over other handlers. This is only required once and</span>
  <span class="token comment">// only if several handlers do output.</span>
  response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route1\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now call the next matching route</span>
  routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> route2 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route2\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now call the next matching route</span>
  routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> route3 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now end the response</span>
  routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the above example the response will contain:</p> <div class="language- extra-class"><pre><code>route1
route2
route3
</code></pre></div><p>As the routes have been called in that order for any request that starts
with <code>/some/path</code>.</p> <p>If you want to override the default ordering for routes, you can do so
using <code>order</code>, specifying an integer value.</p> <p>Routes are assigned an order at creation time corresponding to the order
in which they were added to the router, with the first route numbered
<code>0</code>, the second route numbered <code>1</code>, and so on.</p> <p>By specifying an order for the route you can override the default
ordering. Order can also be negative, e.g. if you want to ensure a route
is evaluated before route number <code>0</code>.</p> <p>Let’s change the ordering of route2 so it runs before route1:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route1 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route1\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now call the next matching route</span>
  routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> route2 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// enable chunked responses because we will be adding data as</span>
  <span class="token comment">// we execute over other handlers. This is only required once and</span>
  <span class="token comment">// only if several handlers do output.</span>
  response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route2\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now call the next matching route</span>
  routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> route3 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;route3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now end the response</span>
  routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>then the response will now contain:</p> <div class="language- extra-class"><pre><code>route2
route1
route3
</code></pre></div><p>If two matching routes have the same value of order, then they will be
called in the order they were added.</p> <p>You can also specify that a route is handled last, with <code>last</code></p> <p>Note: Route order can be specified only before you configure an
handler!</p> <h1 id="routing-based-on-mime-type-of-request"><a href="#routing-based-on-mime-type-of-request" class="header-anchor">#</a> Routing based on MIME type of request</h1> <p>You can specify that a route will match against matching request MIME
types using <code>consumes</code>.</p> <p>In this case, the request will contain a <code>content-type</code> header
specifying the MIME type of the request body. This will be matched
against the value specified in <code>consumes</code>.</p> <p>Basically, <code>consumes</code> is describing which MIME types the handler can
<em>consume</em>.</p> <p>Matching can be done on exact MIME type matches:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Exact match</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">consumes</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for any request with</span>
  <span class="token comment">// content-type header set to `text/html`</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Multiple exact matches can also be specified:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Multiple exact matches</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">consumes</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">consumes</span><span class="token punctuation">(</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for any request with</span>
  <span class="token comment">// content-type header set to `text/html` or `text/plain`.</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Matching on wildcards for the sub-type is supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Sub-type wildcard match</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">consumes</span><span class="token punctuation">(</span><span class="token string">&quot;text/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for any request with top level type `text`</span>
  <span class="token operator">/</span><span class="token operator">/</span> e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> content<span class="token operator">-</span>type header <span class="token keyword">set</span> to <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">text/html</span><span class="token template-punctuation string">`</span></span> or `text<span class="token operator">/</span>plain` will both match

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And you can also match on the top level type</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Top level type wildcard match</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">consumes</span><span class="token punctuation">(</span><span class="token string">&quot;*/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This handler will be called for any request with sub-type json</span>
  <span class="token comment">// e.g. content-type header set to `text/json` or `application/json` will both match</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you don’t specify a <code>/</code> in the consumers, it will assume you meant
the sub-type.</p> <h1 id="routing-based-on-mime-types-acceptable-by-the-client"><a href="#routing-based-on-mime-types-acceptable-by-the-client" class="header-anchor">#</a> Routing based on MIME types acceptable by the client</h1> <p>The HTTP <code>accept</code> header is used to signify which MIME types of the
response are acceptable to the client.</p> <p>An <code>accept</code> header can have multiple MIME types separated by ‘,’.</p> <p>MIME types can also have a <code>q</code> value appended to them* which signifies
a weighting to apply if more than one response MIME type is available
matching the accept header. The q value is a number between 0 and 1.0.
If omitted it defaults to 1.0.</p> <p>For example, the following <code>accept</code> header signifies the client will
accept a MIME type of only <code>text/plain</code>:</p> <p>Accept: text/plain</p> <p>With the following the client will accept <code>text/plain</code> or <code>text/html</code>
with no preference.</p> <p>Accept: text/plain, text/html</p> <p>With the following the client will accept <code>text/plain</code> or <code>text/html</code>
but prefers <code>text/html</code> as it has a higher <code>q</code> value (the default value
is q=1.0)</p> <p>Accept: text/plain; q=0.9, text/html</p> <p>If the server can provide both text/plain and text/html it should
provide the text/html in this case.</p> <p>By using <code>produces</code> you define which MIME type(s) the route produces,
e.g. the following handler produces a response with MIME type
<code>application/json</code>.</p> <div class="language-java extra-class"><pre class="language-java"><code>router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">produces</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>routingContext<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>

  let response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>someJSON<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this case the route will match with any request with an <code>accept</code>
header that matches <code>application/json</code>.</p> <p>Here are some examples of <code>accept</code> headers that will match:</p> <p>Accept: application/json Accept: application/* Accept:
application/json, text/html Accept: application/json;q=0.7,
text/html;q=0.8, text/plain</p> <p>You can also mark your route as producing more than one MIME type. If
this is the case, then you use <code>getAcceptableContentType</code> to find out
the actual MIME type that was accepted.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// This route can produce two different MIME types</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">produces</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">produces</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> response <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Get the actual MIME type acceptable</span>
  <span class="token keyword">let</span> acceptableContentType <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">getAcceptableContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> acceptableContentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>whatever<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the above example, if you sent a request with the following <code>accept</code>
header:</p> <p>Accept: application/json; q=0.7, text/html</p> <p>Then the route would match and <code>acceptableContentType</code> would contain
<code>text/html</code> as both are acceptable but that has a higher <code>q</code> value.</p> <h1 id="combining-routing-criteria"><a href="#combining-routing-criteria" class="header-anchor">#</a> Combining routing criteria</h1> <p>You can combine all the above routing criteria in many different ways,
for example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'PUT'</span><span class="token punctuation">,</span> <span class="token string">&quot;myapi/orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">consumes</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">produces</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This would be match for any PUT method to paths starting with &quot;myapi/orders&quot; with a</span>
  <span class="token comment">// content-type of &quot;application/json&quot;</span>
  <span class="token comment">// and an accept header matching &quot;application/json&quot;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="enabling-and-disabling-routes"><a href="#enabling-and-disabling-routes" class="header-anchor">#</a> Enabling and disabling routes</h1> <p>You can disable a route with <code>disable</code>. A disabled route will be ignored
when matching.</p> <p>You can re-enable a disabled route with <code>enable</code></p> <h1 id="context-data"><a href="#context-data" class="header-anchor">#</a> Context data</h1> <p>You can use the context data in the <code>RoutingContext</code> to maintain any
data that you want to share between handlers for the lifetime of the
request.</p> <p>Here’s an example where one handler sets some data in the context data
and a subsequent handler retrieves it:</p> <p>You can use the <code>put</code> to put any object, and <code>get</code> to retrieve any
object from the context data.</p> <p>A request sent to path <code>/some/path/other</code> will match both routes.</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  routingContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/other&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> bar <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Do something with bar</span>
  routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="reroute"><a href="#reroute" class="header-anchor">#</a> Reroute</h1> <p>Until now all routing mechanism allow you to handle your requests in a
sequential way, however there might be times where you will want to go
back. Since the context does not expose any information about the
previous or next handler, mostly because this information is dynamic
there is a way to restart the whole routing from the start of the
current Router.</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  routingContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  routingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  routingContext<span class="token punctuation">.</span><span class="token function">reroute</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>So from the code you can see that if a request arrives at <code>/some/path</code>
if first add a value to the context, then moves to the next handler that
re routes the request to <code>/some/path/B</code> which terminates the request.</p> <p>You can reroute based on a new path or based on a new path and method.
Note however that rerouting based on method might introduce security
issues since for example a usually safe GET request can become a DELETE.</p> <p>Reroute is also allowed on the failure handler, however due to the
nature of re router when called the current status code and failure
reason are reset. In order the rerouted handler should generate the
correct status code if needed, for example:</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/my-pretty-notfound-handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;NOT FOUND fancy html here!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">reroute</span><span class="token punctuation">(</span><span class="token string">&quot;/my-pretty-notfound-handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It should be clear that reroute works on <code>paths</code>, so if you need to
preserve and or add state across reroutes, one should use the
<code>RoutingContext</code> object. For example you want to reroute to a new path
with a extra parameter:</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/final-target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// continue from here...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// THE WRONG WAY! (Will reroute to /final-target excluding the query string)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">reroute</span><span class="token punctuation">(</span><span class="token string">&quot;/final-target?variable=value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// THE CORRECT WAY!</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;variable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reroute</span><span class="token punctuation">(</span><span class="token string">&quot;/final-target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Even though the wrong reroute path will warn you that the query string
is ignored, the reroute will happen since the implementation will strip
any query string or html fragment from the path.</p> <h1 id="sub-routers"><a href="#sub-routers" class="header-anchor">#</a> Sub-routers</h1> <p>Sometimes if you have a lot of handlers it can make sense to split them
up into multiple routers. This is also useful if you want to reuse a set
of handlers in a different application, rooted at a different path root.</p> <p>To do this you can mount a router at a <em>mount point</em> in another router.
The router that is mounted is called a <em>sub-router</em>. Sub routers can
mount other sub routers so you can have several levels of sub-routers if
you like.</p> <p>Let’s look at a simple example of a sub-router mounted with another
router.</p> <p>This sub-router will maintain the set of handlers that corresponds to a
simple fictional REST API. We will mount that on another router. The
full implementation of the REST API is not shown.</p> <p>Here’s the sub-router:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> restAPI <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

restAPI<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/products/:productID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO Handle the lookup of the product....</span>
  rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>productJSON<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

restAPI<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/products/:productID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO Add a new product...</span>
  rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

restAPI<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;/products/:productID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO delete the product...</span>
  rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If this router was used as a top level router, then GET/PUT/DELETE
requests to urls like <code>/products/product1234</code> would invoke the API.</p> <p>However, let’s say we already have a web-site as described by another
router:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">let</span> mainRouter <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Handle static resources</span>
mainRouter<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/static/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>myStaticHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

mainRouter<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;.*\\.templ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>myTemplateHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We can now mount the sub router on the main router, against a mount
point, in this case <code>/productsAPI</code></p> <div class="language-js extra-class"><pre class="language-js"><code>mainRouter<span class="token punctuation">.</span><span class="token function">mountSubRouter</span><span class="token punctuation">(</span><span class="token string">&quot;/productsAPI&quot;</span><span class="token punctuation">,</span> restAPI<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This means the REST API is now accessible via paths like:
<code>/productsAPI/products/product1234</code></p> <h1 id="localization"><a href="#localization" class="header-anchor">#</a> Localization</h1> <p>Vert.x Web parses the <code>Accept-Language</code> header and provides some helper
methods to identify which is the preferred locale for a client or the
sorted list of preferred locales by quality.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/localized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// although it might seem strange by running a loop with a switch we</span>
  <span class="token comment">// make sure that the locale order of preference is preserved when</span>
  <span class="token comment">// replying in the users language.</span>
  rc<span class="token punctuation">.</span><span class="token function">acceptableLanguages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">language</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// we do not know the user language so lets just inform that back:</span>
  rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Sorry we don't speak: &quot;</span> <span class="token operator">+</span> rc<span class="token punctuation">.</span><span class="token function">preferredLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The main method <code>acceptableLocales</code> will return the ordered list of
locales the user understands, if you’re only interested in the user
prefered locale then the helper: <code>preferredLocale</code> will return the 1st
element of the list or <code>null</code> if no locale was provided by the user.</p> <h1 id="route-match-failures"><a href="#route-match-failures" class="header-anchor">#</a> Route match failures</h1> <p>If no routes match for any particular request, Vert.x-Web will signal an
error depending on match failure:</p> <ul><li><p>404 If no route matches the path</p></li> <li><p>405 If a route matches the path but don’t match the HTTP Method</p></li> <li><p>406 If a route matches the path and the method but It can’t provide
a response with a content type matching <code>Accept</code> header</p></li> <li><p>415 If a route matches the path and the method but It can’t accept
the <code>Content-type</code></p></li> <li><p>400 If a route matches the path and the method but It can’t accept
an empty body</p></li></ul> <p>You can manually manage those failures using <code>errorHandler</code></p> <h1 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error handling</h1> <p>As well as setting handlers to handle requests you can also set handlers
to handle failures in routing.</p> <p>Failure handlers are used with the exact same route matching criteria
that you use with normal handlers.</p> <p>For example you can provide a failure handler that will only handle
failures on certain paths, or for certain HTTP methods.</p> <p>This allows you to set different failure handlers for different parts of
your application.</p> <p>Here’s an example failure handler that will only be called for failure
that occur when routing to GET requests to paths that start with
<code>/somepath/</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/somepath/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route<span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">frc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This will be called for failures that occur</span>
  <span class="token operator">/</span><span class="token operator">/</span> when routing requests to paths starting <span class="token keyword">with</span>
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token string">'/somepath/'</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Failure routing will occur if a handler throws an exception, or if a
handler calls <code>fail</code> specifying an HTTP status code to deliberately
signal a failure.</p> <p>If an exception is caught from a handler this will result in a failure
with status code <code>500</code> being signalled.</p> <p>When handling the failure, the failure handler is passed the routing
context which also allows the failure or failure code to be retrieved so
the failure handler can use that to generate a failure response.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> route1 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/somepath/path1/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route1<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Let's say this throws a RuntimeException</span>
  <span class="token keyword">throw</span> <span class="token string">&quot;something happened!&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> route2 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/somepath/path2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route2<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This one deliberately fails the request passing in the status code</span>
  <span class="token comment">// E.g. 403 - Forbidden</span>
  routingContext<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a failure handler</span>
<span class="token comment">// This will get called for any failures in the above handlers</span>
<span class="token keyword">let</span> route3 <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/somepath/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

route3<span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">failureRoutingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> statusCode <span class="token operator">=</span> failureRoutingContext<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Status code will be 500 for the RuntimeException or 403 for the other failure</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> failureRoutingContext<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Sorry! Not today&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For the eventuality that an error occurs when running the error handler
related usage of not allowed characters in status message header, then
the original status message will be changed to the default message from
the error code. This is a tradeoff to keep the semantics of the HTTP
protocol working instead of abruptly creash and close the socket without
properly completing the protocol.</p> <h1 id="request-body-handling"><a href="#request-body-handling" class="header-anchor">#</a> Request body handling</h1> <p>The <code>BodyHandler</code> allows you to retrieve request bodies, limit body
sizes and handle file uploads.</p> <p>You should make sure a body handler is on a matching route for any
requests that require this functionality.</p> <p>The usage of this handler requires that it is installed as soon as
possible in the router since it needs to install handlers to consume the
HTTP request body and this must be done before executing any async call.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BodyHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token comment">// This body handler will be called for all routes</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>BodyHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If an async call is required before, the <code>HttpServerRequest</code> should be
paused and then resumed so that the request events are not delivered
until the body handler is ready to process them.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BodyHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> request <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Pause the request</span>
  request<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">someAsyncCall</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Resume the request</span>
    request<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// And continue processing</span>
    routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This body handler will be called for all routes</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>BodyHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="getting-the-request-body"><a href="#getting-the-request-body" class="header-anchor">#</a> Getting the request body</h2> <p>If you know the request body is JSON, then you can use <code>getBodyAsJson</code>,
if you know it’s a string you can use <code>getBodyAsString</code>, or to retrieve
it as a buffer use <code>getBody</code>.</p> <h2 id="limiting-body-size"><a href="#limiting-body-size" class="header-anchor">#</a> Limiting body size</h2> <p>To limit the size of a request body, create the body handler then use
<code>setBodyLimit</code> to specifying the maximum body size, in bytes. This is
useful to avoid running out of memory with very large bodies.</p> <p>If an attempt to send a body greater than the maximum size is made, an
HTTP status code of 413 - <code>Request Entity Too Large</code>, will be sent.</p> <p>There is no body limit by default.</p> <h2 id="merging-form-attributes"><a href="#merging-form-attributes" class="header-anchor">#</a> Merging form attributes</h2> <p>By default, the body handler will merge any form attributes into the
request parameters. If you don’t want this behaviour you can use disable
it with <code>setMergeFormAttributes</code>.</p> <h2 id="handling-file-uploads"><a href="#handling-file-uploads" class="header-anchor">#</a> Handling file uploads</h2> <p>Body handler is also used to handle multi-part file uploads.</p> <p>If a body handler is on a matching route for the request, any file
uploads will be automatically streamed to the uploads directory, which
is <code>file-uploads</code> by default.</p> <p>Each file will be given an automatically generated file name, and the
file uploads will be available on the routing context with
<code>fileUploads</code>.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BodyHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>BodyHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/some/path/uploads&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> uploads <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">fileUploads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Do something with uploads....</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Each file upload is described by a <code>FileUpload</code> instance, which allows
various properties such as the name, file-name and size to be accessed.</p> <h1 id="handling-cookies"><a href="#handling-cookies" class="header-anchor">#</a> Handling cookies</h1> <p>Vert.x-Web has out of the box cookies support.</p> <p>Before 3.8.1, cookie required to use the <code>CookieHandler</code> to active this
functionality.</p> <p>Since 3.8.1, the <code>CookieHandler</code> has been deprecated and should not be
used anymore.</p> <h2 id="manipulating-cookies"><a href="#manipulating-cookies" class="header-anchor">#</a> Manipulating cookies</h2> <p>You use <code>getCookie</code> to retrieve a cookie by name, or use <code>cookieMap</code> to
retrieve the entire set.</p> <p>To remove a cookie, use <code>removeCookie</code>.</p> <p>To add a cookie use <code>addCookie</code>.</p> <p>The set of cookies will be written back in the response automatically
when the response headers are written so the browser can store them.</p> <p>Cookies are described by instances of <code>Cookie</code>. This allows you to
retrieve the name, value, domain, path and other normal cookie
properties.</p> <p>Here’s an example of querying and adding cookies:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Cookie <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> someCookie <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">&quot;mycookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cookieValue <span class="token operator">=</span> someCookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Do something with cookie...</span>

<span class="token comment">// Add a cookie - this will get written back in the response automatically</span>
routingContext<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>Cookie<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&quot;othercookie&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;somevalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="handling-sessions"><a href="#handling-sessions" class="header-anchor">#</a> Handling sessions</h1> <p>Vert.x-Web provides out of the box support for sessions.</p> <p>Sessions last between HTTP requests for the length of a browser session
and give you a place where you can add session-scope information, such
as a shopping basket.</p> <p>Vert.x-Web uses session cookies to identify a session. The session
cookie is temporary and will be deleted by your browser when it’s
closed.</p> <p>We don’t put the actual data of your session in the session cookie - the
cookie simply uses an identifier to look-up the actual session on the
server. The identifier is a random UUID generated using a secure random,
so it should be effectively unguessable.</p> <p>Cookies are passed across the wire in HTTP requests and responses so
it’s always wise to make sure you are using HTTPS when sessions are
being used. Vert.x will warn you if you attempt to use sessions over
straight HTTP.</p> <p>To enable sessions in your application you must have a <code>SessionHandler</code>
on a matching route before your application logic.</p> <p>The session handler handles the creation of session cookies and the
lookup of the session so you don’t have to do that yourself.</p> <h2 id="session-stores"><a href="#session-stores" class="header-anchor">#</a> Session stores</h2> <p>To create a session handler you need to have a session store instance.
The session store is the object that holds the actual sessions for your
application.</p> <p>The session store is responsible for holding a secure pseudo random
number generator in order to guarantee secure session ids. This PRNG is
independent of the store which means that given a session id from store
A one cannot derive the session id of store B since they have different
seeds and states.</p> <p>By default this PRNG uses a mixed mode, blocking for seeding, non
blocking for generating. The PRNG will also reseed every 5 minutes with
64bits of new entropy. However this can all be configured using the
system properties:</p> <ul><li><p>io.vertx.ext.auth.prng.algorithm e.g.: SHA1PRNG</p></li> <li><p>io.vertx.ext.auth.prng.seed.interval e.g.: 1000 (every second)</p></li> <li><p>io.vertx.ext.auth.prng.seed.bits e.g.: 128</p></li></ul> <p>Most users should not need to configure these values unless if you
notice that the performance of your application is being affected by the
PRNG algorithm.</p> <p>Vert.x-Web comes with two session store implementations out of the box,
and you can also write your own if you prefer.</p> <p>The implementations are expected to follow the <code>ServiceLoader</code>
conventions and all stores that are available at runtime from the
classpath will be exposed. When more than 1 implementations are
available the first one that can be instantiated and configured with
success becomes the default. If none is available, then the default
depends on the mode Vert.x was created. If cluster mode is available the
the clustered session store is the default otherwise the local storage
is the default.</p> <h3 id="local-session-store"><a href="#local-session-store" class="header-anchor">#</a> Local session store</h3> <p>With this store, sessions are stored locally in memory and only
available in this instance.</p> <p>This store is appropriate if you have just a single Vert.x instance of
you are using sticky sessions in your application and have configured
your load balancer to always route HTTP requests to the same Vert.x
instance.</p> <p>If you can’t ensure your requests will all terminate on the same server
then don’t use this store as your requests might end up on a server
which doesn’t know about your session.</p> <p>Local session stores are implemented by using a shared local map, and
have a reaper which clears out expired sessions.</p> <p>The reaper interval can be configured with a json message with the key:
<code>reaperInterval</code>.</p> <p>Here are some examples of creating a local <code>SessionStore</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> LocalSessionStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token comment">// Create a local session store using defaults</span>
<span class="token keyword">let</span> store1 <span class="token operator">=</span> LocalSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a local session store specifying the local shared map name to use</span>
<span class="token comment">// This might be useful if you have more than one application in the same</span>
<span class="token comment">// Vert.x instance and want to use different maps for different applications</span>
<span class="token keyword">let</span> store2 <span class="token operator">=</span> LocalSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token string">&quot;myapp3.sessionmap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a local session store specifying the local shared map name to use and</span>
<span class="token comment">// setting the reaper interval for expired sessions to 10 seconds</span>
<span class="token keyword">let</span> store3 <span class="token operator">=</span> LocalSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token string">&quot;myapp3.sessionmap&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="clustered-session-store"><a href="#clustered-session-store" class="header-anchor">#</a> Clustered session store</h3> <p>With this store, sessions are stored in a distributed map which is
accessible across the Vert.x cluster.</p> <p>This store is appropriate if you’re <em>not</em> using sticky sessions, i.e.
your load balancer is distributing different requests from the same
browser to different servers.</p> <p>Your session is accessible from any node in the cluster using this
store.</p> <p>To you use a clustered session store you should make sure your Vert.x
instance is clustered.</p> <p>Here are some examples of creating a clustered <code>SessionStore</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ClusteredSessionStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Vertx <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// a clustered Vert.x</span>
Vertx<span class="token punctuation">.</span><span class="token function">clusteredVertx</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VertxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClustered</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> vertx <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Create a clustered session store using defaults</span>
  <span class="token keyword">let</span> store1 <span class="token operator">=</span> ClusteredSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Create a clustered session store specifying the distributed map name to use</span>
  <span class="token comment">// This might be useful if you have more than one application in the cluster</span>
  <span class="token comment">// and want to use different maps for different applications</span>
  <span class="token keyword">let</span> store2 <span class="token operator">=</span> ClusteredSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token string">&quot;myclusteredapp3.sessionmap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="creating-the-session-handler"><a href="#creating-the-session-handler" class="header-anchor">#</a> Creating the session handler</h2> <p>Once you’ve created a session store you can create a session handler,
and add it to a route. You should make sure your session handler is
routed to before your application handlers.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ClusteredSessionStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SessionHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a clustered session store using defaults</span>
<span class="token keyword">let</span> store <span class="token operator">=</span> ClusteredSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sessionHandler <span class="token operator">=</span> SessionHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make sure all requests are routed through the session handler too</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>sessionHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Now your application handlers</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/somepath/blah/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> session <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  session<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// etc</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The session handler will ensure that your session is automatically
looked up (or created if no session exists) from the session store and
set on the routing context before it gets to your application handlers.</p> <h2 id="using-the-session"><a href="#using-the-session" class="header-anchor">#</a> Using the session</h2> <p>In your handlers you can access the session instance with <code>session</code>.</p> <p>You put data into the session with <code>put</code>, you get data from the session
with <code>get</code>, and you remove data from the session with <code>remove</code>.</p> <p>The keys for items in the session are always strings. The values can be
any type for a local session store, and for a clustered session store
they can be any basic type, or <code>Buffer</code>, <code>JsonObject</code>, <code>JsonArray</code> or a
serializable object, as the values have to serialized across the
cluster.</p> <p>Here’s an example of manipulating session data:</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>sessionHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Now your application handlers</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/somepath/blah&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> session <span class="token operator">=</span> routingContext<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Put some data from the session</span>
  session<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Retrieve some data from a session</span>
  <span class="token keyword">let</span> age <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Remove some data from a session</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;myobj&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sessions are automatically written back to the store after after
responses are complete.</p> <p>You can manually destroy a session using <code>destroy</code>. This will remove the
session from the context and the session store. Note that if there is no
session a new one will be automatically created for the next request
from the browser that’s routed through the session handler.</p> <h2 id="session-timeout"><a href="#session-timeout" class="header-anchor">#</a> Session timeout</h2> <p>Sessions will be automatically timed out if they are not accessed for a
time greater than the timeout period. When a session is timed out, it is
removed from the store.</p> <p>Sessions are automatically marked as accessed when a request arrives and
the session is looked up and and when the response is complete and the
session is stored back in the store.</p> <p>You can also use <code>setAccessed</code> to manually mark a session as accessed.</p> <p>The session timeout can be configured when creating the session handler.
Default timeout is 30 minutes.</p> <h1 id="authentication-authorisation"><a href="#authentication-authorisation" class="header-anchor">#</a> Authentication / authorisation</h1> <p>Vert.x comes with some out-of-the-box handlers for handling both
authentication and authorisation.</p> <h2 id="creating-an-auth-handler"><a href="#creating-an-auth-handler" class="header-anchor">#</a> Creating an auth handler</h2> <p>To create an auth handler you need an instance of <code>AuthProvider</code>. Auth
provider is used for authentication and authorisation of users. Vert.x
provides several auth provider instances out of the box in the
vertx-auth project. For full information on auth providers and how to
use and configure them please consult the auth documentation.</p> <p>Here’s a simple example of creating a basic auth handler given an auth
provider.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> LocalSessionStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SessionHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BasicAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>SessionHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>LocalSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> basicAuthHandler <span class="token operator">=</span> BasicAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-auth-in-your-application"><a href="#handling-auth-in-your-application" class="header-anchor">#</a> Handling auth in your application</h2> <p>Let’s say you want all requests to paths that start with <code>/private/</code> to
be subject to auth. To do that you make sure your auth handler is before
your application handlers on those paths:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> LocalSessionStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SessionHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BasicAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>SessionHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>LocalSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthProvider</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> basicAuthHandler <span class="token operator">=</span> BasicAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All requests to paths starting with '/private/' will be protected</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/private/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>basicAuthHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/someotherpath&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// This will be public access - no login required</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/private/somepath&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token operator">/</span><span class="token operator">/</span> This will require a login

  <span class="token operator">/</span><span class="token operator">/</span> This will have the value <span class="token boolean">true</span>
  <span class="token keyword">let</span> isAuthenticated <span class="token operator">=</span> <span class="token punctuation">(</span>routingContext<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> routingContext<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the auth handler has successfully authenticated and authorised the
user it will inject a <code>User</code> object into the <code>RoutingContext</code> so it’s
available in your handlers with: <code>user</code>.</p> <p>If you want your User object to be stored in the session so it’s
available between requests so you don’t have to authenticate on each
request, then you should make sure you have a session handler and a user
session handler on matching routes before the auth handler.</p> <p>Once you have your user object you can also programmatically use the
methods on it to authorise the user.</p> <p>If you want to cause the user to be logged out you can call <code>clearUser</code>
on the routing context.</p> <h2 id="http-basic-authentication"><a href="#http-basic-authentication" class="header-anchor">#</a> HTTP Basic Authentication</h2> <p><a href="http://en.wikipedia.org/wiki/Basic_access_authentication" target="_blank" rel="noopener noreferrer">HTTP Basic
Authentication<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
is a simple means of authentication that can be appropriate for simple
applications.</p> <p>With basic auth, credentials are sent unencrypted across the wire in
HTTP headers so it’s essential that you serve your application using
HTTPS not HTTP.</p> <p>With basic auth, if a user requests a resource that requires
authorisation, the basic auth handler will send back a <code>401</code> response
with the header <code>WWW-Authenticate</code> set. This prompts the browser to show
a log-in dialogue and prompt the user to enter their username and
password.</p> <p>The request is made to the resource again, this time with the
<code>Authorization</code> header set, containing the username and password encoded
in Base64.</p> <p>When the basic auth handler receives this information, it calls the
configured <code>AuthProvider</code> with the username and password to authenticate
the user. If the authentication is successful the handler attempts to
authorise the user. If that is successful then the routing of the
request is allowed to continue to the application handlers, otherwise a
<code>403</code> response is returned to signify that access is denied.</p> <p>The auth handler can be set-up with a set of authorities that are
required for access to the resources to be granted.</p> <h2 id="redirect-auth-handler"><a href="#redirect-auth-handler" class="header-anchor">#</a> Redirect auth handler</h2> <p>With redirect auth handling the user is redirected to towards a login
page in the case they are trying to access a protected resource and they
are not logged in.</p> <p>The user then fills in the login form and submits it. This is handled by
the server which authenticates the user and, if authenticated redirects
the user back to the original resource.</p> <p>To use redirect auth you configure an instance of <code>RedirectAuthHandler</code>
instead of a basic auth handler.</p> <p>You will also need to setup handlers to serve your actual login page,
and a handler to handle the actual login itself. To handle the login we
provide a prebuilt handler <code>FormLoginHandler</code> for the purpose.</p> <p>Here’s an example of a simple app, using a redirect auth handler on the
default redirect url <code>/loginpage</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> LocalSessionStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SessionHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RedirectAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> FormLoginHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StaticHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>SessionHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>LocalSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthProvider</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> redirectAuthHandler <span class="token operator">=</span> RedirectAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All requests to paths starting with '/private/' will be protected</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/private/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>redirectAuthHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Handle the actual login</span>
<span class="token operator">/</span><span class="token operator">/</span> One <span class="token keyword">of</span> your pages must <span class="token constant">POST</span> form login data
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>FormLoginHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">/</span> Set a <span class="token keyword">static</span> server to serve <span class="token keyword">static</span> resources<span class="token punctuation">,</span> e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> the login page
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>StaticHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/someotherpath&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">/</span><span class="token operator">/</span> This will be <span class="token keyword">public</span> access <span class="token operator">-</span> no login required
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/private/somepath&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token operator">/</span><span class="token operator">/</span> This will require a login

  <span class="token operator">/</span><span class="token operator">/</span> This will have the value <span class="token boolean">true</span>
  <span class="token keyword">let</span> isAuthenticated <span class="token operator">=</span> <span class="token punctuation">(</span>routingContext<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> routingContext<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="jwt-authorisation"><a href="#jwt-authorisation" class="header-anchor">#</a> JWT authorisation</h2> <p>With JWT authorisation resources can be protected by means of
permissions and users without enough rights are denied access. You need
to add the <code>io.vertx:vertx-auth-jwt:${maven.version}</code> dependency to use
<code>JWTAuthProvider</code></p> <p>To use this handler there are 2 steps involved:</p> <ul><li><p>Setup an handler to issue tokens (or rely on a 3rd party)</p></li> <li><p>Setup the handler to filter the requests</p></li></ul> <p>Please note that these 2 handlers should be only available on HTTPS, not
doing so allows sniffing the tokens in transit which leads to session
hijacking attacks.</p> <p>Here’s an example on how to issue tokens:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> JWTAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-jwt&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> authConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JWTAuthOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStore</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">KeyStoreOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;jceks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;keystore.jceks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> authProvider <span class="token operator">=</span> JWTAuth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> authConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// this is an example, authentication should be done with another provider...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;paulo&quot;</span> <span class="token operator">==</span> ctx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;secret&quot;</span> <span class="token operator">==</span> ctx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">.</span><span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">&quot;sub&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;paulo&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JWTOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now that your client has a token all it is required is that forall*
consequent request the HTTP header <code>Authorization</code> is filled with:
<code>Bearer &lt;token&gt;</code> e.g.:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> JWTAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-jwt&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> JWTAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> authConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JWTAuthOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStore</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">KeyStoreOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;jceks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;keystore.jceks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> authProvider <span class="token operator">=</span> JWTAuth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> authConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>JWTAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/somepage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// some handle code...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>JWT allows you to add any information you like to the token itself. By
doing this there is no state in the server which allows you to scale
your applications without need for clustered session data. In order to
add data to the token, during the creation of the token just add data to
the JsonObject parameter:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> JWTAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-jwt&quot;</span>

<span class="token keyword">let</span> authConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JWTAuthOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStore</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">KeyStoreOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;jceks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;keystore.jceks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> authProvider <span class="token operator">=</span> JWTAuth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> authConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

authProvider<span class="token punctuation">.</span><span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;sub&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;paulo&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;someKey&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some value&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JWTOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And the same when consuming:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> theSubject <span class="token operator">=</span> rc<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">principal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sub<span class="token punctuation">;</span>
  <span class="token keyword">let</span> someKey <span class="token operator">=</span> rc<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">principal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>someKey<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-required-authorities"><a href="#configuring-required-authorities" class="header-anchor">#</a> Configuring required authorities</h2> <p>With any auth handler you can also configure required authorities to
access the resource.</p> <p>By default, if no authorities are configured then it is sufficient to be
logged in to access the resource, otherwise the user must be both logged
in (authenticated) and have the required authorities.</p> <p>Here’s an example of configuring an app so that different authorities
are required for different parts of the app. Note that the meaning of
the authorities is determined by the underlying auth provider that you
use. E.g. some may support a role/permission based model but others
might use another model.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RedirectAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> listProductsAuthHandler <span class="token operator">=</span> RedirectAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
listProductsAuthHandler<span class="token punctuation">.</span><span class="token function">addAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;list_products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Need &quot;list_products&quot; authority to list products</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/listproducts/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>listProductsAuthHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> settingsAuthHandler <span class="token operator">=</span> RedirectAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
settingsAuthHandler<span class="token punctuation">.</span><span class="token function">addAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;role:admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Only &quot;admin&quot; has access to /private/settings</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/private/settings/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>settingsAuthHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="chaining-multiple-auth-handlers"><a href="#chaining-multiple-auth-handlers" class="header-anchor">#</a> Chaining multiple auth handlers</h2> <p>There are times when you want to support multiple authN/authZ mechanisms
in a single application. For this you can use the <code>ChainAuthHandler</code>.
The chain auth handler will attempt to perform authentication on a chain
of handlers. The chain works both for AuthN and AuthZ, so if the
authentication is valid at a given handler of the chain, then that same
handler will be used to perform authorization (if requested).</p> <p>It is important to know that some handlers require specific providers,
for example:</p> <ul><li><p>The <code>JWTAuthHandler</code> requires <code>JWTAuth</code>.</p></li> <li><p>The <code>DigestAuthHandler</code> requires <code>HtdigestAuth</code>.</p></li> <li><p>The <code>OAuth2AuthHandler</code> requires <code>OAuth2Auth</code>.</p></li></ul> <p>So it is not expected that the providers will be shared across all
handlers. There are cases where one can share the provider across
handlers, for example:</p> <ul><li><p>The <code>BasicAuthHandler</code> can take any provider.</p></li> <li><p>The <code>RedirectAuthHandler</code> can take any provider.</p></li></ul> <p>So say that you want to create an application that accepts both <code>HTTP Basic Authentication</code> and <code>Form Redirect</code>. You would start configuring
your chain as:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ChainAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BasicAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RedirectAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> chain <span class="token operator">=</span> ChainAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// add http basic auth handler to the chain</span>
chain<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>BasicAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// add form redirect auth handler to the chain</span>
chain<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>RedirectAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// secure your route</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/secure/resource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// your app</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/secure/resource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>So when a user makes a request without a <code>Authorization</code> header, this
means that the chain will fail to authenticate with the basic auth
handler and will attempt to authenticate with the redirect handler.
Since the redirect handler always redirects you will be sent to the
login form that you configured in that handler.</p> <p>Like the normal routing in vertx-web, auth chaning is a sequence, so if
you would prefer to fallback to your browser asking for the user
credentials using HTTP Basic authentication instead of the redirect all
you need to to is reverse the order of appending to the chain.</p> <p>Now assume that you make a request where you provide the header
<code>Authorization</code> with the value <code>Basic [token]</code>. In this case the basic
auth handler will attempt to authenticate and if it is sucessful the
chain will stop and vertx-web will continue to process your handlers. If
the token is not valid, for example bad username/password, then the
chain will continue to the following entry. In this specific case the
redirect auth handler.</p> <h1 id="serving-static-resources"><a href="#serving-static-resources" class="header-anchor">#</a> Serving static resources</h1> <p>Vert.x-Web comes with an out of the box handler for serving static web
resources so you can write static web servers very easily.</p> <p>To serve static resources such as <code>.html</code>, <code>.css</code>, <code>.js</code> or any other
static resource, you use an instance of <code>StaticHandler</code>.</p> <p>Any requests to paths handled by the static handler will result in files
being served from a directory on the file system or from the classpath.
The default static file directory is <code>webroot</code> but this can be
configured.</p> <p>In the following example all requests to paths starting with <code>/static/</code>
will get served from the directory <code>webroot</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> StaticHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/static/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>StaticHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For example, if there was a request with path <code>/static/css/mystyles.css</code>
the static serve will look for a file in the directory
<code>webroot/css/mystyle.css</code>.</p> <p>It will also look for a file on the classpath called
<code>webroot/css/mystyle.css</code>. This means you can package up all your static
resources into a jar file (or fatjar) and distribute them like that.</p> <p>When Vert.x finds a resource on the classpath for the first time it
extracts it and caches it in a temporary directory on disk so it doesn’t
have to do this each time.</p> <p>The handler will handle range aware requests. When a client makes a
request to a static resource, the handler will notify that it can handle
range aware request by stating the unit on the <code>Accept-Ranges</code> header.
Further requests that contain the <code>Range</code> header with the correct unit
and start and end indexes will then receive partial responses with the
correct <code>Content-Range</code> header.</p> <h2 id="configuring-caching"><a href="#configuring-caching" class="header-anchor">#</a> Configuring caching</h2> <p>By default the static handler will set cache headers to enable browsers
to effectively cache files.</p> <p>Vert.x-Web sets the headers <code>cache-control</code>,<code>last-modified</code>, and <code>date</code>.</p> <p><code>cache-control</code> is set to <code>max-age=86400</code> by default. This corresponds
to one day. This can be configured with <code>setMaxAgeSeconds</code> if required.</p> <p>If a browser sends a GET or a HEAD request with an <code>if-modified-since</code>
header and the resource has not been modified since that date, a <code>304</code>
status is returned which tells the browser to use its locally cached
resource.</p> <p>If handling of cache headers is not required, it can be disabled with
<code>setCachingEnabled</code>.</p> <p>When cache handling is enabled Vert.x-Web will cache the last modified
date of resources in memory, this avoids a disk hit to check the actual
last modified date every time.</p> <p>Entries in the cache have an expiry time, and after that time, the file
on disk will be checked again and the cache entry updated.</p> <p>If you know that your files never change on disk, then the cache entry
will effectively never expire. This is the default.</p> <p>If you know that your files might change on disk when the server is
running then you can set files read only to false with
<code>setFilesReadOnly</code>.</p> <p>To enable the maximum number of entries that can be cached in memory at
any one time you can use <code>setMaxCacheSize</code>.</p> <p>To configure the expiry time of cache entries you can use
<code>setCacheEntryTimeout</code>.</p> <h2 id="configuring-the-index-page"><a href="#configuring-the-index-page" class="header-anchor">#</a> Configuring the index page</h2> <p>Any requests to the root path <code>/</code> will cause the index page to be
served. By default the index page is <code>index.html</code>. This can be
configured with <code>setIndexPage</code>.</p> <h2 id="changing-the-web-root"><a href="#changing-the-web-root" class="header-anchor">#</a> Changing the web root</h2> <p>By default static resources will be served from the directory <code>webroot</code>.
To configure this use <code>setWebRoot</code>.</p> <h2 id="serving-hidden-files"><a href="#serving-hidden-files" class="header-anchor">#</a> Serving hidden files</h2> <p>By default the serve will serve hidden files (files starting with <code>.</code>).</p> <p>If you do not want hidden files to be served you can configure it with
<code>setIncludeHidden</code>.</p> <h2 id="directory-listing"><a href="#directory-listing" class="header-anchor">#</a> Directory listing</h2> <p>The server can also perform directory listing. By default directory
listing is disabled. To enabled it use <code>setDirectoryListing</code>.</p> <p>When directory listing is enabled the content returned depends on the
content type in the <code>accept</code> header.</p> <p>For <code>text/html</code> directory listing, the template used to render the
directory listing page can be configured with <code>setDirectoryTemplate</code>.</p> <h2 id="disabling-file-caching-on-disk"><a href="#disabling-file-caching-on-disk" class="header-anchor">#</a> Disabling file caching on disk</h2> <p>By default, Vert.x will cache files that are served from the classpath
into a file on disk in a sub-directory of a directory called <code>.vertx</code> in
the current working directory. This is mainly useful when deploying
services as fatjars in production where serving a file from the
classpath every time can be slow.</p> <p>In development this can cause a problem, as if you update your static
content while the server is running, the cached file will be served not
the updated file.</p> <p>To disable file caching you can provide your vert.x options the property
<code>fileResolverCachingEnabled</code> to <code>false</code>. For backwards compatibility it
will also default that value to the system property
<code>vertx.disableFileCaching</code>. E.g. you could set up a run configuration in
your IDE to set this when running your main class.</p> <h1 id="cors-handling"><a href="#cors-handling" class="header-anchor">#</a> CORS handling</h1> <p><a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener noreferrer">Cross Origin Resource
Sharing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is
a safe mechanism for allowing resources to be requested from one domain
and served from another.</p> <p>Vert.x-Web includes a handler <code>CorsHandler</code> that handles the CORS
protocol for you.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CorsHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token comment">// Will only accept GET requests from origin &quot;vertx.io&quot;</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>CorsHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;vertx\\.io&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allowedMethod</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Your app handlers</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="multi-tenant"><a href="#multi-tenant" class="header-anchor">#</a> Multi Tenant</h1> <p>There are cases where your application needs to handle more than just 1
tenant. In this case a helper handler is provided that simplifies
setting up the application.</p> <p>In the case the tenant is identified by a HTTP header, say for example
<code>X-Tenant</code>, then creating the handler is as simple as:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MultiTenantHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>MultiTenantHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;X-Tenant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You now should register what handler should be executed for the given
tenant:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MultiTenantHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
MultiTenantHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;X-Tenant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTenantHandler</span><span class="token punctuation">(</span><span class="token string">&quot;tenant-A&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something for tenant A...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTenantHandler</span><span class="token punctuation">(</span><span class="token string">&quot;tenant-B&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something for tenant B...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addDefaultHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something when no tenant matches...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This is useful for security situations:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> GithubAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2AuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2Auth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MultiTenantHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token comment">// create an OAuth2 provider, clientID and clientSecret should be requested to github</span>
<span class="token keyword">let</span> gitHubAuthProvider <span class="token operator">=</span> GithubAuth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token string">&quot;CLIENT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// create a oauth2 handler on our running server</span>
<span class="token comment">// the second argument is the full url to the callback as you entered in your provider management console.</span>
<span class="token keyword">let</span> githubOAuth2 <span class="token operator">=</span> OAuth2AuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>gitHubAuthProvider<span class="token punctuation">,</span> <span class="token string">&quot;https://myserver.com/github-callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// setup the callback handler for receiving the GitHub callback</span>
githubOAuth2<span class="token punctuation">.</span><span class="token function">setupCallback</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create an OAuth2 provider, clientID and clientSecret should be requested to Google</span>
<span class="token keyword">let</span> googleAuthProvider <span class="token operator">=</span> OAuth2Auth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2ClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientID</span><span class="token punctuation">(</span><span class="token string">&quot;CLIENT_ID&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientSecret</span><span class="token punctuation">(</span><span class="token string">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setFlow</span><span class="token punctuation">(</span><span class="token string">&quot;AUTH_CODE&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSite</span><span class="token punctuation">(</span><span class="token string">&quot;https://accounts.google.com&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTokenPath</span><span class="token punctuation">(</span><span class="token string">&quot;https://www.googleapis.com/oauth2/v3/token&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAuthorizationPath</span><span class="token punctuation">(</span><span class="token string">&quot;/o/oauth2/auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create a oauth2 handler on our domain: &quot;http://localhost:8080&quot;</span>
<span class="token keyword">let</span> googleOAuth2 <span class="token operator">=</span> OAuth2AuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>googleAuthProvider<span class="token punctuation">,</span> <span class="token string">&quot;http://localhost:8080&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


MultiTenantHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;X-Tenant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTenantHandler</span><span class="token punctuation">(</span><span class="token string">&quot;tenant-github&quot;</span><span class="token punctuation">,</span> githubOAuth2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTenantHandler</span><span class="token punctuation">(</span><span class="token string">&quot;tenant-google&quot;</span><span class="token punctuation">,</span> googleOAuth2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addDefaultHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="templates"><a href="#templates" class="header-anchor">#</a> Templates</h1> <p>Vert.x-Web includes dynamic page generation capabilities by including
out of the box support for several popular template engines. You can
also easily add your own.</p> <p>Template engines are described by <code>TemplateEngine</code>. In order to render a
template <code>render</code> is used.</p> <p>The simplest way to use templates is not to call the template engine
directly but to use the <code>TemplateHandler</code>. This handler calls the
template engine for you based on the path in the HTTP request.</p> <p>By default the template handler will look for templates in a directory
called <code>templates</code>. This can be configured.</p> <p>The handler will return the results of rendering with a content type of
<code>text/html</code> by default. This can also be configured.</p> <p>When you create the template handler you pass in an instance of the
template engine you want. Template engines are not embedded in vertx-web
so, you need to configure your project to access them. Configuration is
provided for each template engine.</p> <p>Here are some examples:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> HandlebarsTemplateEngine <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vertx-web-js/handlebars_template_engine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> TemplateHandler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vertx-web-js/template_handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> engine <span class="token operator">=</span> HandlebarsTemplateEngine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> handler <span class="token operator">=</span> TemplateHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>engine<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This will route all GET requests starting with /dynamic/ to the template handler</span>
<span class="token comment">// E.g. /dynamic/graph.hbs will look for a template in /templates/graph.hbs</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/dynamic/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>handler<span class="token punctuation">.</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Route all GET requests for resource ending in .hbs to the template handler</span>
router<span class="token punctuation">.</span><span class="token function">getWithRegex</span><span class="token punctuation">(</span><span class="token string">&quot;.+\\.hbs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>handler<span class="token punctuation">.</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mvel-template-engine"><a href="#mvel-template-engine" class="header-anchor">#</a> MVEL template engine</h2> <p>To use MVEL, you need to add the following <em>dependency</em> to your project:
<code>${maven.groupId}:vertx-web-templ-mvel:${maven.version}</code>. Create an
instance of the MVEL template engine using:
<code>io.vertx.ext.web.templ.MVELTemplateEngine#create()</code></p> <p>When using the MVEL template engine, it will by default look for
templates with the <code>.templ</code> extension if no extension is specified in
the file name.</p> <p>The routing context <code>RoutingContext</code> is available in the MVEL template
as the <code>context</code> variable, this means you can render the template based
on anything in the context including the request, response, session or
context data.</p> <p>Here are some examples:</p> <div class="language- extra-class"><pre><code>The request path is @{context.request().path()}

The variable 'foo' from the session is @{context.session().get('foo')}

The value 'bar' from the context data is @{context.get('bar')}
</code></pre></div><p>Please consult the <a href="http://mvel.codehaus.org/MVEL+2.0+Templating+Guide" target="_blank" rel="noopener noreferrer">MVEL templates
documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for
how to write MVEL templates.</p> <h2 id="jade-template-engine"><a href="#jade-template-engine" class="header-anchor">#</a> Jade template engine</h2> <p>To use the Jade template engine, you need to add the following
<em>dependency</em> to your project:
<code>${maven.groupId}:vertx-web-templ-jade:${maven.version}</code>. Create an
instance of the Jade template engine using:
<code>io.vertx.ext.web.templ.JadeTemplateEngine#create()</code>.</p> <p>When using the Jade template engine, it will by default look for
templates with the <code>.jade</code> extension if no extension is specified in the
file name.</p> <p>The routing context <code>RoutingContext</code> is available in the Jade template
as the <code>context</code> variable, this means you can render the template based
on anything in the context including the request, response, session or
context data.</p> <p>Here are some examples:</p> <div class="language- extra-class"><pre><code>!!! 5
html
 head
   title= context.get('foo') + context.request().path()
 body
</code></pre></div><p>Please consult the <a href="https://github.com/neuland/jade4j" target="_blank" rel="noopener noreferrer">Jade4j
documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for how to write Jade
templates.</p> <h2 id="handlebars-template-engine"><a href="#handlebars-template-engine" class="header-anchor">#</a> Handlebars template engine</h2> <p>To use Handlebars, you need to add the following <em>dependency</em> to your
project: <code>${maven.groupId}:vertx-web-templ-handlebars:${maven.version}</code>.
Create an instance of the Handlebars template engine using:
<code>io.vertx.ext.web.templ.HandlebarsTemplateEngine#create()</code>.</p> <p>When using the Handlebars template engine, it will by default look for
templates with the <code>.hbs</code> extension if no extension is specified in the
file name.</p> <p>Handlebars templates are not able to call arbitrary methods in objects
so we can’t just pass the routing context into the template and let the
template introspect it like we can with other template engines.</p> <p>Instead, the context <code>data</code> is available in the template.</p> <p>If you want to have access to other data like the request path, request
params or session data you should add it the context data in a handler
before the template handler. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> TemplateHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> handler <span class="token operator">=</span> TemplateHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>engine<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/dynamic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  routingContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;request_path&quot;</span><span class="token punctuation">,</span> routingContext<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  routingContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;session_data&quot;</span><span class="token punctuation">,</span> routingContext<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  routingContext<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/dynamic/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Please consult the <a href="https://github.com/jknack/handlebars.java" target="_blank" rel="noopener noreferrer">Handlebars Java port
documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for how to
write handlebars templates.</p> <h2 id="thymeleaf-template-engine"><a href="#thymeleaf-template-engine" class="header-anchor">#</a> Thymeleaf template engine</h2> <p>To use Thymeleaf, you need to add the following <em>dependency</em> to your
project: <code>${maven.groupId}:vertx-web-templ-thymeleaf:${maven.version}</code>.
Create an instance of the Thymeleaf template engine using:
<code>io.vertx.ext.web.templ.ThymeleafTemplateEngine#create()</code>.</p> <p>When using the Thymeleaf template engine, it will by default look for
templates with the <code>.html</code> extension if no extension is specified in the
file name.</p> <p>The routing context <code>RoutingContext</code> is available in the Thymeleaf
template as the <code>context</code> variable, this means you can render the
template based on anything in the context including the request,
response, session or context data.</p> <p>Here are some examples:</p> <div class="language-html extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.get('foo')}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.get('bar')}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.normalisedPath()}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.request().params().get('param1')}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.request().params().get('param2')}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Please consult the <a href="http://www.thymeleaf.org/" target="_blank" rel="noopener noreferrer">Thymeleaf documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for how to write Thymeleaf templates.</p> <h2 id="apache-freemarker-template-engine"><a href="#apache-freemarker-template-engine" class="header-anchor">#</a> Apache FreeMarker template engine</h2> <p>To use Apache FreeMarker, you need to add the following <em>dependency</em> to
your project:
<code>${maven.groupId}:vertx-web-templ-freemarker:${maven.version}</code>. Create
an instance of the Apache FreeMarker template engine using:
<code>io.vertx.ext.web.templ.Engine#create()</code>.</p> <p>When using the Apache FreeMarker template engine, it will by default
look for templates with the <code>.ftl</code> extension if no extension is
specified in the file name.</p> <p>The routing context <code>RoutingContext</code> is available in the Apache
FreeMarker template as the <code>context</code> variable, this means you can render
the template based on anything in the context including the request,
response, session or context data.</p> <p>Here are some examples:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.foo}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.bar}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.normalisedPath()}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.request().params().param1}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${context.request().params().param2}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Please consult the <a href="http://www.freemarker.org/" target="_blank" rel="noopener noreferrer">Apache FreeMarker
documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for how to write Apache
FreeMarker templates.</p> <h2 id="pebble-template-engine"><a href="#pebble-template-engine" class="header-anchor">#</a> Pebble template engine</h2> <p>To use Pebble, you need to add the following <em>dependency</em> to your
project: <code>io.vertx:vertx-web-templ-pebble:${maven.version}</code>. Create an
instance of the Pebble template engine using:
<code>io.vertx.ext.web.templ.PebbleTemplateEngine#create(vertx)</code>.</p> <p>When using the Pebble template engine, it will by default look for
templates with the <code>.peb</code> extension if no extension is specified in the
file name.</p> <p>The routing context <code>RoutingContext</code> is available in the Pebble template
as the <code>context</code> variable, this means you can render the template based
on anything in the context including the request, response, session or
context data.</p> <p>Here are some examples:</p> <div class="language-html extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{context.foo}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{context.bar}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{context.normalisedPath()}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{context.request().params().param1}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{context.request().params().param2}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Please consult the <a href="http://www.mitchellbosecke.com/pebble/home/" target="_blank" rel="noopener noreferrer">Pebble
documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for how to
write Pebble templates.</p> <h2 id="rocker-template-engine"><a href="#rocker-template-engine" class="header-anchor">#</a> Rocker template engine</h2> <p>To use Rocker, then add
<code>io.vertx:vertx-web-templ-rocker:${maven.version}</code> as a dependency to
your project. You can then create a Rocker template engine instance with
<code>io.vertx.ext.web.templ.rocker#create()</code>.</p> <p>The values of the JSON context object passed to the <code>render</code> method are
then exposed as template parameters. Given:</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">final</span> <span class="token class-name">JsonObject</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;badger&quot;</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fox&quot;</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;context&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/foo/bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    engine<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">&quot;somedir/TestRockerTemplate2&quot;</span><span class="token punctuation">,</span> render <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
     <span class="token comment">// (...)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>then the template can be as the following
<code>somedir/TestRockerTemplate2.rocker.html</code> resource file:</p> <div class="language- extra-class"><pre><code>@import io.vertx.core.json.JsonObject
@args (JsonObject context, String foo, String bar)
Hello @foo and @bar
Request path is @context.getString(&quot;path&quot;)
</code></pre></div><h2 id="disabling-caching"><a href="#disabling-caching" class="header-anchor">#</a> Disabling caching</h2> <p>During development you might want to disable template caching so that
the template gets reevaluated on each request. In order to do this you
need to set the system property:
<code>io.vertx.ext.web.TemplateEngine.disableCache</code> to <code>true</code>.</p> <p>By default it will be false. So caching is always enabled.</p> <h1 id="error-handler"><a href="#error-handler" class="header-anchor">#</a> Error handler</h1> <p>You can render your own errors using a template handler or otherwise but
Vert.x-Web also includes an out of the boxy &quot;pretty&quot; error handler that
can render error pages for you.</p> <p>The handler is <code>ErrorHandler</code>. To use the error handler just set it as a
failure handler for any paths that you want covered.</p> <h1 id="request-logger"><a href="#request-logger" class="header-anchor">#</a> Request logger</h1> <p>Vert.x-Web includes a handler <code>LoggerHandler</code> that you can use to log
HTTP requests. You should mount this handler before any handler that
could fail the <code>RoutingContext</code></p> <p>By default requests are logged to the Vert.x logger which can be
configured to use JUL logging, log4j or SLF4J.</p> <p>See <code>LoggerFormat</code>.</p> <h1 id="serving-favicons"><a href="#serving-favicons" class="header-anchor">#</a> Serving favicons</h1> <p>Vert.x-Web includes the handler <code>FaviconHandler</code> especially for serving
favicons.</p> <p>Favicons can be specified using a path to the filesystem, or by default
Vert.x-Web will look for a file on the classpath with the name
<code>favicon.ico</code>. This means you bundle the favicon in the jar of your
application.</p> <h1 id="timeout-handler"><a href="#timeout-handler" class="header-anchor">#</a> Timeout handler</h1> <p>Vert.x-Web includes a timeout handler that you can use to timeout
requests if they take too long to process.</p> <p>This is configured using an instance of <code>TimeoutHandler</code>.</p> <p>If a request times out before the response is written a <code>503</code> response
will be returned to the client.</p> <p>Here’s an example of using a timeout handler which will timeout all
requests to paths starting with <code>/foo</code> after 5 seconds:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> TimeoutHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/foo/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>TimeoutHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="response-time-handler"><a href="#response-time-handler" class="header-anchor">#</a> Response time handler</h1> <p>This handler sets the header <code>x-response-time</code> response header
containing the time from when the request was received to when the
response headers were written, in ms., e.g.:</p> <p>x-response-time: 1456ms</p> <h1 id="content-type-handler"><a href="#content-type-handler" class="header-anchor">#</a> Content type handler</h1> <p>The <code>ResponseContentTypeHandler</code> can set the <code>Content-Type</code> header
automatically. Suppose we are building a RESTful web application. We
need to set the content type in all our handlers:</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/books&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">produces</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">findBooks</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token function">toJson</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      rc<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the API surface becomes pretty large, setting the content type can
become cumbersome. To avoid this situation, add the
<code>ResponseContentTypeHandler</code> to the corresponding routes:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ResponseContentTypeHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/api/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>ResponseContentTypeHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/books&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">produces</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">findBooks</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token function">toJson</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      rc<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The handler gets the approriate content type from
<code>getAcceptableContentType</code>. As a consequence, you can easily share the
same handler to produce data of different types:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ResponseContentTypeHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/api/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>ResponseContentTypeHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/books&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">produces</span><span class="token punctuation">(</span><span class="token string">&quot;text/xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">produces</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">findBooks</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">.</span><span class="token function">getAcceptableContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;text/xml&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token function">toXML</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token function">toJson</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      rc<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="sockjs"><a href="#sockjs" class="header-anchor">#</a> SockJS</h1> <p>SockJS is a client side JavaScript library and protocol which provides a
simple WebSocket-like interface allowing you to make connections to
SockJS servers irrespective of whether the actual browser or network
will allow real WebSockets.</p> <p>It does this by supporting various different transports between browser
and server, and choosing one at run-time according to browser and
network capabilities.</p> <p>All this is transparent to you - you are simply presented with the
WebSocket-like interface which <em>just works</em>.</p> <p>Please see the <a href="https://github.com/sockjs/sockjs-client" target="_blank" rel="noopener noreferrer">SockJS website<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for more information on SockJS.</p> <h2 id="sockjs-handler"><a href="#sockjs-handler" class="header-anchor">#</a> SockJS handler</h2> <p>Vert.x provides an out of the box handler called <code>SockJSHandler</code> for
using SockJS in your Vert.x-Web applications.</p> <p>You should create one handler per SockJS application using
<code>SockJSHandler.create</code>. You can also specify configuration options when
creating the instance. The configuration options are described with an
instance of <code>SockJSHandlerOptions</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SockJSHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SockJSHandlerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHeartbeatInterval</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sockJSHandler <span class="token operator">=</span> SockJSHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/myapp/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>sockJSHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-sockjs-sockets"><a href="#handling-sockjs-sockets" class="header-anchor">#</a> Handling SockJS sockets</h2> <p>On the server-side you set a handler on the SockJS handler, and this
will be called every time a SockJS connection is made from a client:</p> <p>The object passed into the handler is a <code>SockJSSocket</code>. This has a
familiar socket-like interface which you can read and write to similarly
to a <code>NetSocket</code> or a <code>WebSocket</code>. It also implements <code>ReadStream</code> and
<code>WriteStream</code> so you can pump it to and from other read and write
streams.</p> <p>Here’s an example of a simple SockJS handler that simply echoes back any
back any data that it reads:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SockJSHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SockJSHandlerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHeartbeatInterval</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sockJSHandler <span class="token operator">=</span> SockJSHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

sockJSHandler<span class="token punctuation">.</span><span class="token function">socketHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sockJSSocket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Just echo the data back</span>
  sockJSSocket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>sockJSSocket<span class="token punctuation">.</span>write<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/myapp/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>sockJSHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="the-client-side"><a href="#the-client-side" class="header-anchor">#</a> The client side</h2> <p>In client side JavaScript you use the SockJS client side library to make
connections.</p> <p>You can find that
<a href="http://cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Full details for using the SockJS JavaScript client are on the <a href="https://github.com/sockjs/sockjs-client" target="_blank" rel="noopener noreferrer">SockJS
website<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, but in summary you
use it something like this:</p> <div class="language- extra-class"><pre><code>var sock = new SockJS('http://mydomain.com/myapp');

sock.onopen = function() {
 console.log('open');
};

sock.onmessage = function(e) {
 console.log('message', e.data);
};

sock.onclose = function() {
 console.log('close');
};

sock.send('test');

sock.close();
</code></pre></div><h2 id="configuring-the-sockjs-handler"><a href="#configuring-the-sockjs-handler" class="header-anchor">#</a> Configuring the SockJS handler</h2> <p>The handler can be configured with various options using
<code>SockJSHandlerOptions</code>.</p> <ul><li><p><code>insertJSESSIONID</code>
Insert a JSESSIONID cookie so load-balancers ensure requests for a
specific SockJS session are always routed to the correct server.
Default is <code>true</code>.</p></li> <li><p><code>sessionTimeout</code>
The server sends a <code>close</code> event when a client receiving connection
have not been seen for a while. This delay is configured by this
setting. By default the <code>close</code> event will be emitted when a
receiving connection wasn’t seen for 5 seconds.</p></li> <li><p><code>heartbeatInterval</code>
In order to keep proxies and load balancers from closing long
running http requests we need to pretend that the connection is
active and send a heartbeat packet once in a while. This setting
controls how often this is done. By default a heartbeat packet is
sent every 25 seconds.</p></li> <li><p><code>maxBytesStreaming</code>
Most streaming transports save responses on the client side and
don’t free memory used by delivered messages. Such transports need
to be garbage-collected once in a while. <code>max_bytes_streaming</code> sets
a minimum number of bytes that can be send over a single http
streaming request before it will be closed. After that client needs
to open new request. Setting this value to one effectively disables
streaming and will make streaming transports to behave like polling
transports. The default value is 128K.</p></li> <li><p><code>libraryURL</code>
Transports which don’t support cross-domain communication natively
('eventsource' to name one) use an iframe trick. A simple page is
served from the SockJS server (using its foreign domain) and is
placed in an invisible iframe. Code run from this iframe doesn’t
need to worry about cross-domain issues, as it’s being run from
domain local to the SockJS server. This iframe also does need to
load SockJS javascript client library, and this option lets you
specify its url (if you’re unsure, point it to the latest minified
SockJS client release, this is the default). The default value is
<code>http://cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js</code></p></li> <li><p><code>disabledTransports</code>
This is a list of transports that you want to disable. Possible
values are WEBSOCKET, EVENT_SOURCE, HTML_FILE, JSON_P, XHR.</p></li></ul> <h1 id="sockjs-event-bus-bridge"><a href="#sockjs-event-bus-bridge" class="header-anchor">#</a> SockJS event bus bridge</h1> <p>Vert.x-Web comes with a built-in SockJS socket handler called the event
bus bridge which effectively extends the server-side Vert.x event bus
into client side JavaScript.</p> <p>This creates a distributed event bus which not only spans multiple
Vert.x instances on the server side, but includes client side JavaScript
running in browsers.</p> <p>We can therefore create a huge distributed bus encompassing many
browsers and servers. The browsers don’t have to be connected to the
same server as long as the servers are connected.</p> <p>This is done by providing a simple client side JavaScript library called
<code>vertx-eventbus.js</code> which provides an API very similar to the
server-side Vert.x event-bus API, which allows you to send and publish
messages to the event bus and register handlers to receive messages.</p> <p>This JavaScript library uses the JavaScript SockJS client to tunnel the
event bus traffic over SockJS connections terminating at at a
<code>SockJSHandler</code> on the server-side.</p> <p>A special SockJS socket handler is then installed on the <code>SockJSHandler</code>
which handles the SockJS data and bridges it to and from the server side
event bus.</p> <p>To activate the bridge you simply call <code>bridge</code> on the SockJS handler.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SockJSHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sockJSHandler <span class="token operator">=</span> SockJSHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mount the bridge on the router</span>
router<span class="token punctuation">.</span><span class="token function">mountSubRouter</span><span class="token punctuation">(</span><span class="token string">&quot;/eventbus&quot;</span><span class="token punctuation">,</span> sockJSHandler<span class="token punctuation">.</span><span class="token function">bridge</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In client side JavaScript you use the 'vertx-eventbus.js` library to
create connections to the event bus and to send and receive messages:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>vertx-eventbus.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">var</span> eb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080/eventbus'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eb<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

 <span class="token comment">// set a handler to receive a message</span>
 eb<span class="token punctuation">.</span><span class="token function">registerHandler</span><span class="token punctuation">(</span><span class="token string">'some-address'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'received a message: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// send a message</span>
 eb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'some-address'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'tim'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">587</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The first thing the example does is to create a instance of the event
bus</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> eb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080/eventbus'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The parameter to the constructor is the URI where to connect to the
event bus. Since we create our bridge with the prefix <code>eventbus</code> we will
connect there.</p> <p>You can’t actually do anything with the connection until it is opened.
When it is open the <code>onopen</code> handler will be called.</p> <p>The bridge supports automatic reconnection, with configurable delay and
backoff options.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> eb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080/eventbus'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
eb<span class="token punctuation">.</span><span class="token function">enableReconnect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
eb<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Set up handlers here, will be called on initial connection and all reconnections</span>
eb<span class="token punctuation">.</span><span class="token function-variable function">onreconnect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Optional, will only be called on reconnections</span>

<span class="token comment">// Alternatively, pass in an options object</span>
<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
   vertxbus_reconnect_attempts_max<span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span> <span class="token comment">// Max reconnect attempts</span>
   vertxbus_reconnect_delay_min<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// Initial delay (in ms) before first reconnect attempt</span>
   vertxbus_reconnect_delay_max<span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token comment">// Max delay (in ms) between reconnect attempts</span>
   vertxbus_reconnect_exponent<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// Exponential backoff factor</span>
   vertxbus_randomization_factor<span class="token operator">:</span> <span class="token number">0.5</span> <span class="token comment">// Randomization factor between 0 and 1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> eb2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080/eventbus'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
eb2<span class="token punctuation">.</span><span class="token function">enableReconnect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Set up handlers...</span>
</code></pre></div><p>You can retrieve the client library using a dependency manager:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>${maven.groupId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>${maven.artifactId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classifier</span><span class="token punctuation">&gt;</span></span>client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classifier</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>js<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>compile <span class="token string">'${maven.groupId}:${maven.artifactId}:${maven.version}:client'</span>
</code></pre></div><p>The library is also available on:</p> <ul><li><p><a href="https://www.npmjs.com/package/vertx3-eventbus-client" target="_blank" rel="noopener noreferrer">NPM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/vert-x3/vertx-bus-bower" target="_blank" rel="noopener noreferrer">Bower<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://cdnjs.com/libraries/vertx" target="_blank" rel="noopener noreferrer">cdnjs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <p>Notice that the API has changed between the 3.0.0 and 3.1.0 version.
Please check the changelog. The previous client is still compatible and
can still be used, but the new client offers more feature and is closer
to the vert.x event bus API.</p> <h2 id="securing-the-bridge"><a href="#securing-the-bridge" class="header-anchor">#</a> Securing the Bridge</h2> <p>If you started a bridge like in the above example without securing it,
and attempted to send messages through it you’d find that the messages
mysteriously disappeared. What happened to them?</p> <p>For most applications you probably don’t want client side JavaScript
being able to send just any message to any handlers on the server side
or to all other browsers.</p> <p>For example, you may have a service on the event bus which allows data
to be accessed or deleted. We don’t want badly behaved or malicious
clients being able to delete all the data in your database!</p> <p>Also, we don’t necessarily want any client to be able to listen in on
any event bus address.</p> <p>To deal with this, a SockJS bridge will by default refuse to let through
any messages. It’s up to you to tell the bridge what messages are ok for
it to pass through. (There is an exception for reply messages which are
always allowed through).</p> <p>In other words the bridge acts like a kind of firewall which has a
default <em>deny-all</em> policy.</p> <p>Configuring the bridge to tell it what messages it should pass through
is easy.</p> <p>You can specify which <em>matches</em> you want to allow for inbound and
outbound traffic using the <code>BridgeOptions</code> that you pass in when calling
bridge.</p> <p>Each match is a <code>PermittedOptions</code> object:</p> <ul><li><p><code>setAddress</code>
This represents the exact address the message is being sent to. If
you want to allow messages based on an exact address you use this
field.</p></li> <li><p><code>setAddressRegex</code>
This is a regular expression that will be matched against the
address. If you want to allow messages based on a regular expression
you use this field. If the <code>address</code> field is specified this field
will be ignored.</p></li> <li><p><code>setMatch</code>
This allows you to allow messages based on their structure. Any
fields in the match must exist in the message with the same values
for them to be allowed. This currently only works with JSON
messages.</p></li></ul> <p>If a message is <em>in-bound</em> (i.e. being sent from client side JavaScript
to the server) when it is received Vert.x-Web will look through any
inbound permitted matches. If any match, it will be allowed through.</p> <p>If a message is <em>out-bound</em> (i.e. being sent from the server to client
side JavaScript) before it is sent to the client Vert.x-Web will look
through any outbound permitted matches. If any match, it will be allowed
through.</p> <p>The actual matching works as follows:</p> <p>If an <code>address</code> field has been specified then the <code>address</code> must match
<em>exactly</em> with the address of the message for it to be considered
matched.</p> <p>If an <code>address</code> field has not been specified and an <code>addressRegex</code> field
has been specified then the regular expression in <code>address_re</code> must
match with the address of the message for it to be considered matched.</p> <p>If a <code>match</code> field has been specified, then also the structure of the
message must match. Structuring matching works by looking at all the
fields and values in the match object and checking they all exist in the
actual message body.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SockJSHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sockJSHandler <span class="token operator">=</span> SockJSHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// Let through any messages sent to 'demo.orderMgr' from the client</span>
<span class="token keyword">let</span> inboundPermitted1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;demo.orderMgr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Allow calls to the address 'demo.persistor' from the client as long as the messages</span>
<span class="token comment">// have an action field with value 'find' and a collection field with value</span>
<span class="token comment">// 'albums'</span>
<span class="token keyword">let</span> inboundPermitted2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;demo.persistor&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;action&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;find&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;collection&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;albums&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Allow through any message with a field `wibble` with value `foo`.</span>
<span class="token keyword">let</span> inboundPermitted3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;wibble&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// First let's define what we're going to allow from server -&gt; client</span>

<span class="token comment">// Let through any messages coming from address 'ticker.mystock'</span>
<span class="token keyword">let</span> outboundPermitted1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;ticker.mystock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Let through any messages from addresses starting with &quot;news.&quot; (e.g. news.europe, news.usa, etc)</span>
<span class="token keyword">let</span> outboundPermitted2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddressRegex</span><span class="token punctuation">(</span><span class="token string">&quot;news\\..+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Let's define what we're going to allow from client -&gt; server</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInboundPermitteds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>inboundPermitted1<span class="token punctuation">,</span> inboundPermitted1<span class="token punctuation">,</span> inboundPermitted3<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setOutboundPermitteds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>outboundPermitted1<span class="token punctuation">,</span> outboundPermitted2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// mount the bridge on the router</span>
router<span class="token punctuation">.</span><span class="token function">mountSubRouter</span><span class="token punctuation">(</span><span class="token string">&quot;/eventbus&quot;</span><span class="token punctuation">,</span> sockJSHandler<span class="token punctuation">.</span><span class="token function">bridge</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="requiring-authorisation-for-messages"><a href="#requiring-authorisation-for-messages" class="header-anchor">#</a> Requiring authorisation for messages</h2> <p>The event bus bridge can also be configured to use the Vert.x-Web
authorisation functionality to require authorisation for messages,
either in-bound or out-bound on the bridge.</p> <p>To do this, you can add extra fields to the match described in the
previous section that determine what authority is required for the
match.</p> <p>To declare that a specific authority for the logged-in user is required
in order to access allow the messages you use the <code>setRequiredAuthority</code>
field.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Let through any messages sent to 'demo.orderService' from the client</span>
<span class="token keyword">let</span> inboundPermitted <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;demo.orderService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// But only if the user is logged in and has the authority &quot;place_orders&quot;</span>
inboundPermitted<span class="token punctuation">.</span>requiredAuthority <span class="token operator">=</span> <span class="token string">&quot;place_orders&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInboundPermitteds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>inboundPermitted<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For the user to be authorised they must be first logged in and secondly
have the required authority.</p> <p>To handle the login and actually auth you can configure the normal
Vert.x auth handlers. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SockJSHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LocalSessionStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SessionHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BasicAuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Let through any messages sent to 'demo.orderService' from the client</span>
<span class="token keyword">let</span> inboundPermitted <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;demo.orderService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// But only if the user is logged in and has the authority &quot;place_orders&quot;</span>
inboundPermitted<span class="token punctuation">.</span>requiredAuthority <span class="token operator">=</span> <span class="token string">&quot;place_orders&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sockJSHandler <span class="token operator">=</span> SockJSHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Now set up some basic auth handling:</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>SessionHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>LocalSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> basicAuthHandler <span class="token operator">=</span> BasicAuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/eventbus/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>basicAuthHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// mount the bridge on the router</span>
router<span class="token punctuation">.</span><span class="token function">mountSubRouter</span><span class="token punctuation">(</span><span class="token string">&quot;/eventbus&quot;</span><span class="token punctuation">,</span> sockJSHandler<span class="token punctuation">.</span><span class="token function">bridge</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BridgeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInboundPermitteds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>inboundPermitted<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-event-bus-bridge-events"><a href="#handling-event-bus-bridge-events" class="header-anchor">#</a> Handling event bus bridge events</h2> <p>If you want to be notified when an event occurs on the bridge you can
provide a handler when calling <code>bridge</code>.</p> <p>Whenever an event occurs on the bridge it will be passed to the handler.
The event is described by an instance of <code>BridgeEvent</code>.</p> <p>The event can be one of the following types:</p> <ul><li><p>SOCKET_CREATED
This event will occur when a new SockJS socket is created.</p></li> <li><p>SOCKET_IDLE
This event will occur when SockJS socket is on idle for longer
period of time than initially configured.</p></li> <li><p>SOCKET_PING
This event will occur when the last ping timestamp is updated for
the SockJS socket.</p></li> <li><p>SOCKET_CLOSED
This event will occur when a SockJS socket is closed.</p></li> <li><p>SEND
This event will occur when a message is attempted to be sent from
the client to the server.</p></li> <li><p>PUBLISH
This event will occur when a message is attempted to be published
from the client to the server.</p></li> <li><p>RECEIVE
This event will occur when a message is attempted to be delivered
from the server to the client.</p></li> <li><p>REGISTER
This event will occur when a client attempts to register a handler.</p></li> <li><p>UNREGISTER
This event will occur when a client attempts to unregister a
handler.</p></li></ul> <p>The event enables you to retrieve the type using <code>type</code> and inspect the
raw message of the event using <code>getRawMessage</code>.</p> <p>The raw message is a JSON object with the following structure:</p> <div class="language- extra-class"><pre><code>{
 &quot;type&quot;: &quot;send&quot;|&quot;publish&quot;|&quot;receive&quot;|&quot;register&quot;|&quot;unregister&quot;,
 &quot;address&quot;: the event bus address being sent/published/registered/unregistered
 &quot;body&quot;: the body of the message
}
</code></pre></div><p>The event is also an instance of <code>Future</code>. When you are finished
handling the event you can complete the future with <code>true</code> to enable
further processing.</p> <p>If you don’t want the event to be processed you can complete the future
with <code>false</code>. This is a useful feature that enables you to do your own
filtering on messages passing through the bridge, or perhaps apply some
fine grained authorisation or metrics.</p> <p>Here’s an example where we reject all messages flowing through the
bridge if they contain the word &quot;Armadillos&quot;.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SockJSHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Let through any messages sent to 'demo.orderMgr' from the client</span>
<span class="token keyword">let</span> inboundPermitted <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;demo.someService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sockJSHandler <span class="token operator">=</span> SockJSHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInboundPermitteds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>inboundPermitted<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// mount the bridge on the router</span>
router<span class="token punctuation">.</span><span class="token function">mountSubRouter</span><span class="token punctuation">(</span><span class="token string">&quot;/eventbus&quot;</span><span class="token punctuation">,</span> sockJSHandler<span class="token punctuation">.</span><span class="token function">bridge</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">be</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>be<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'PUBLISH'</span> <span class="token operator">||</span> be<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'RECEIVE'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>be<span class="token punctuation">.</span><span class="token function">getRawMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>body <span class="token operator">==</span> <span class="token string">&quot;armadillos&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Reject it</span>
      be<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  be<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here’s an example how to configure and handle SOCKET_IDLE bridge event
type. Notice <code>setPingTimeout(5000)</code> which says that if ping message
doesn’t arrive from client within 5 seconds then the SOCKET_IDLE bridge
event would be triggered.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SockJSHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Initialize SockJS handler</span>
<span class="token keyword">let</span> sockJSHandler <span class="token operator">=</span> SockJSHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInboundPermitteds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>inboundPermitted<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPingTimeout</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// mount the bridge on the router</span>
router<span class="token punctuation">.</span><span class="token function">mountSubRouter</span><span class="token punctuation">(</span><span class="token string">&quot;/eventbus&quot;</span><span class="token punctuation">,</span> sockJSHandler<span class="token punctuation">.</span><span class="token function">bridge</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">be</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>be<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'SOCKET_IDLE'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do some custom handling...</span>
  <span class="token punctuation">}</span>

  be<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In client side JavaScript you use the 'vertx-eventbus.js` library to
create connections to the event bus and to send and receive messages:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>vertx-eventbus.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">var</span> eb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080/eventbus'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;vertxbus_ping_interval&quot;</span><span class="token operator">:</span> <span class="token number">300000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sends ping every 5 minutes.</span>

eb<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token comment">// set a handler to receive a message</span>
eb<span class="token punctuation">.</span><span class="token function">registerHandler</span><span class="token punctuation">(</span><span class="token string">'some-address'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'received a message: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// send a message</span>
eb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'some-address'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'tim'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">587</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The first thing the example does is to create a instance of the event
bus</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> eb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080/eventbus'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;vertxbus_ping_interval&quot;</span><span class="token operator">:</span> <span class="token number">300000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The 2nd parameter to the constructor tells the sockjs library to send
ping message every 5 minutes. since the server was configured to expect
ping every 5 seconds → <code>SOCKET_IDLE</code> would be triggered on the server.</p> <p>You can also amend the raw message, e.g. change the body. For messages
that are flowing in from the client you can also add headers to the
message, here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SockJSHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> Router<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Let through any messages sent to 'demo.orderService' from the client</span>
<span class="token keyword">let</span> inboundPermitted <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermittedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;demo.orderService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sockJSHandler <span class="token operator">=</span> SockJSHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInboundPermitteds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>inboundPermitted<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// mount the bridge on the router</span>
router<span class="token punctuation">.</span><span class="token function">mountSubRouter</span><span class="token punctuation">(</span><span class="token string">&quot;/eventbus&quot;</span><span class="token punctuation">,</span> sockJSHandler<span class="token punctuation">.</span><span class="token function">bridge</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">be</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>be<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'PUBLISH'</span> <span class="token operator">||</span> be<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'SEND'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Add some headers</span>
    <span class="token keyword">let</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;header1&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;val&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;header2&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;val2&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> rawMessage <span class="token operator">=</span> be<span class="token punctuation">.</span><span class="token function">getRawMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rawMessage<span class="token punctuation">.</span>headers <span class="token operator">=</span> headers<span class="token punctuation">;</span>
    be<span class="token punctuation">.</span><span class="token function">setRawMessage</span><span class="token punctuation">(</span>rawMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  be<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="csrf-cross-site-request-forgery"><a href="#csrf-cross-site-request-forgery" class="header-anchor">#</a> CSRF Cross Site Request Forgery</h1> <p>CSRF or sometimes also known as XSRF is a technique by which an
unauthorized site can gain your user’s private data. Vert.x-Web includes
a handler <code>CSRFHandler</code> that you can use to prevent cross site request
forgery requests.</p> <p>On each get request under this handler a cookie is added to the response
with a unique token. Clients are then expected to return this token back
in a header. Since cookies are sent it is required that the cookie
handler is also present on the router.</p> <p>When developing non single page applications that rely on the User-Agent
to perform the <code>POST</code> action, Headers cannot be specified on HTML Forms.
In order to solve this problem the header value will also be checked if
and only if no header was present in the Form attributes under the same
name as the header, e.g.:</p> <div class="language-html extra-class"><pre class="language-html"><code>---
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-XSRF-TOKEN<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>abracadabra<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
---
</code></pre></div><p>It is the responsibility of the user to fill in the right value for the
form field. Users who prefer to use an HTML only solution can fill this
value by fetching the the token value from the routing context under the
key <code>X-XSRF-TOKEN</code> or the header name they have chosen during the
instantiation of the <code>CSRFHandler</code> object.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CSRFHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>CSRFHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;abracadabra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="using-ajax"><a href="#using-ajax" class="header-anchor">#</a> Using AJAX</h2> <p>When accessing protected routes via ajax both the csrf token will need
to be passed in the request. Typically this is done using a request
header, as adding a request header can typically be done at a central
location easily without payload modification.</p> <p>The CSRF token is obtained from the server side context under the key
<code>X-XSRF-TOKEN</code> (unless you specified a different name). This token needs
to be exposed to the client-side, typically by including it in the
initial page content. One possibility is to store it in an HTML &lt;meta&gt;
tag, where value can then be retrieved at the time of the request by
JavaScript.</p> <p>The following can be included in your view (handlebar example below):</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>csrf-token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${X-XSRF-TOKEN}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The following is an example of using the Fetch API to post to the
/process route with the CSRF token from the &lt;meta&gt; tag on the page:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Read the CSRF token from the &lt;meta&gt; tag</span>
<span class="token keyword">var</span> token <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'meta[name=&quot;csrf-token&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>

<span class="token comment">// Make a request using the Fetch API</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/process'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
 credentials<span class="token operator">:</span> <span class="token string">'same-origin'</span><span class="token punctuation">,</span> <span class="token comment">// &lt;-- includes cookies in the request</span>
 headers<span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token string">'X-XSRF-TOKEN'</span><span class="token operator">:</span> token <span class="token comment">// &lt;-- is the csrf token as a header</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
 body<span class="token operator">:</span> <span class="token punctuation">{</span>
   key<span class="token operator">:</span> <span class="token string">'value'</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="virtualhost-handler"><a href="#virtualhost-handler" class="header-anchor">#</a> VirtualHost Handler</h1> <p>The Virtual Host Handler will verify the request hostname and if it
matches it will send the request to the registered handler, otherwise
will continue inside the normal handlers chain.</p> <p>Request are checked against the <code>Host</code> header to a match and patterns
allow the usage of <code></code> wildcards, as for example <code>&lt;/emphasis&gt;.vertx.io</code>
or fully domain names as <code>www.vertx.io</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> VirtualHostHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>VirtualHostHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;*.vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">routingContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something if the request is for *.vertx.io</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="oauth2authhandler-handler"><a href="#oauth2authhandler-handler" class="header-anchor">#</a> OAuth2AuthHandler Handler</h1> <p>The <code>OAuth2AuthHandler</code> allows quick setup of secure routes using the
OAuth2 protocol. This handler simplifies the authCode flow. An example
of using it to protect some resource and authenticate with GitHub can be
implemented as:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> GithubAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2AuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token comment">// create an OAuth2 provider, clientID and clientSecret should be requested to github</span>
<span class="token keyword">let</span> authProvider <span class="token operator">=</span> GithubAuth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token string">&quot;CLIENT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create a oauth2 handler on our running server</span>
<span class="token comment">// the second argument is the full url to the callback as you entered in your provider management console.</span>
<span class="token keyword">let</span> oauth2 <span class="token operator">=</span> OAuth2AuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">,</span> <span class="token string">&quot;https://myserver.com/callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// setup the callback handler for receiving the GitHub callback</span>
oauth2<span class="token punctuation">.</span><span class="token function">setupCallback</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// protect everything under /protected</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>oauth2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mount some handler under the protected zone</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/somepage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome to the protected resource!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">/</span> welcome page
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&lt;br&gt;&lt;a href=\&quot;/protected/somepage\&quot;&gt;Protected by Github&lt;/a&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The OAuth2AuthHandler will setup a proper callback OAuth2 handler so the
user does not need to deal with validation of the authority server
response. It is quite important to know that authority server responses
are only valid once, this means that if a client issues a reload of the
callback URL it will be asserted as a invalid request since the
validation will fail.</p> <p>A rule of thumb is once a valid callback is executed issue a client side
redirect to a protected resource. This redirect should also create a
session cookie (or other session mechanism) so the user is not required
to authenticate for every request.</p> <p>Due to the nature of OAuth2 spec there are slight changes required in
order to use other OAuth2 providers but vertx-auth provides you with
many out of the box implementations:</p> <ul><li><p>Azure Active Directory <code>AzureADAuth</code></p></li> <li><p>Box.com <code>BoxAuth</code></p></li> <li><p>Dropbox <code>DropboxAuth</code></p></li> <li><p>Facebook <code>FacebookAuth</code></p></li> <li><p>Foursquare <code>FoursquareAuth</code></p></li> <li><p>Github <code>GithubAuth</code></p></li> <li><p>Google <code>GoogleAuth</code></p></li> <li><p>Instagram <code>InstagramAuth</code></p></li> <li><p>Keycloak <code>KeycloakAuth</code></p></li> <li><p>LinkedIn <code>LinkedInAuth</code></p></li> <li><p>Mailchimp <code>MailchimpAuth</code></p></li> <li><p>Salesforce <code>SalesforceAuth</code></p></li> <li><p>Shopify <code>ShopifyAuth</code></p></li> <li><p>Soundcloud <code>SoundcloudAuth</code></p></li> <li><p>Stripe <code>StripeAuth</code></p></li> <li><p>Twitter <code>TwitterAuth</code></p></li></ul> <p>However if you’re using an unlisted provider you can still do it using
the base API like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2Auth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2AuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>

<span class="token comment">// create an OAuth2 provider, clientID and clientSecret should be requested to Google</span>
<span class="token keyword">let</span> authProvider <span class="token operator">=</span> OAuth2Auth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token string">'AUTH_CODE'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2ClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientID</span><span class="token punctuation">(</span><span class="token string">&quot;CLIENT_ID&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientSecret</span><span class="token punctuation">(</span><span class="token string">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSite</span><span class="token punctuation">(</span><span class="token string">&quot;https://accounts.google.com&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTokenPath</span><span class="token punctuation">(</span><span class="token string">&quot;https://www.googleapis.com/oauth2/v3/token&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAuthorizationPath</span><span class="token punctuation">(</span><span class="token string">&quot;/o/oauth2/auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create a oauth2 handler on our domain: &quot;http://localhost:8080&quot;</span>
<span class="token keyword">let</span> oauth2 <span class="token operator">=</span> OAuth2AuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">,</span> <span class="token string">&quot;http://localhost:8080&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// these are the scopes</span>
oauth2<span class="token punctuation">.</span><span class="token function">addAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;profile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// setup the callback handler for receiving the Google callback</span>
oauth2<span class="token punctuation">.</span><span class="token function">setupCallback</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// protect everything under /protected</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>oauth2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mount some handler under the protected zone</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/somepage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rc<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome to the protected resource!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">/</span> welcome page
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&lt;br&gt;&lt;a href=\&quot;/protected/somepage\&quot;&gt;Protected by Google&lt;/a&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You will need to provide all the details of your provider manually but
the end result is the same.</p> <p>The handler will pin your application the the configured callback url.
The usage is simple as providing the handler a route instance and all
setup will be done for you. In a typical use case your provider will ask
you what is the callback url to your application, your then enter a url
like: <code>https://myserver.com/callback</code>. This is the second argument to
the handler now you just need to set it up. To make it easier to the end
user all you need to do is call the setupCallback method.</p> <p>This is how you pin your handler to the server
<code>https://myserver.com:8447/callback</code>. Note that the port number is not
mandatory for the default values, 80 for http, 443 for https.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2AuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token comment">// create a oauth2 handler pinned to myserver.com: &quot;https://myserver.com:8447/callback&quot;</span>
<span class="token keyword">let</span> oauth2 <span class="token operator">=</span> OAuth2AuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>provider<span class="token punctuation">,</span> <span class="token string">&quot;https://myserver.com:8447/callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// now allow the handler to setup the callback url for you</span>
oauth2<span class="token punctuation">.</span><span class="token function">setupCallback</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the example the route object is created inline by <code>Router.route()</code>
however if you want to have full control of the order the handler is
called (for example you want it to be called as soon as possible in the
chain) you can always create the route object before and pass it as a
reference to this method.</p> <h2 id="a-real-world-example"><a href="#a-real-world-example" class="header-anchor">#</a> A real world example</h2> <p>Up to now you have learned how to use the Oauth2 Handler however you
will notice that for each request you will need to authenticate. This is
because the handler has no state and there was no state management
applied in the examples.</p> <p>Although having no state is recommended for API facing endpoints, for
example, using JWT (we will cover those later) for user facing endpoinst
we can keep the authentication result stored in the session. For this to
work we would need an application like the following snippet:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> GithubAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LocalSessionStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SessionHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2AuthHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web&quot;</span>
<span class="token comment">// To simplify the development of the web components</span>
<span class="token comment">// we use a Router to route all HTTP requests</span>
<span class="token comment">// to organize our code in a reusable way.</span>

<span class="token comment">// Simple auth service which uses a GitHub to</span>
<span class="token comment">// authenticate the user</span>
<span class="token keyword">let</span> authProvider <span class="token operator">=</span> GithubAuth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token string">&quot;YOUR PROVIDER CLIENTID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YOUR PROVIDER CLIENT SECRET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// We need a user session handler too to make sure</span>
<span class="token comment">// the user is stored in the session between requests</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>SessionHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>LocalSessionStore<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthProvider</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// we now protect the resource under the path &quot;/protected&quot;</span>
router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/protected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>OAuth2AuthHandler<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>authProvider<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setupCallback</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;user:email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Entry point to the application, this will render</span>
<span class="token comment">// a custom template.</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;html&gt;\n  &lt;body&gt;\n    &lt;p&gt;\n      Well, hello there!\n    &lt;/p&gt;\n    &lt;p&gt;\n      We're going to the protected resource, if there is no\n      user in the session we will talk to the GitHub API. Ready?\n      &lt;a href=\&quot;/protected\&quot;&gt;Click here&lt;/a&gt; to begin!&lt;/a&gt;\n    &lt;/p&gt;\n    &lt;p&gt;\n      &lt;b&gt;If that link doesn't work&lt;/b&gt;, remember to provide\n      your own &lt;a href=\&quot;https://github.com/settings/applications/new\&quot;&gt;\n      Client ID&lt;/a&gt;!\n    &lt;/p&gt;\n  &lt;/body&gt;\n&lt;/html&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// The protected resource</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/protected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// at this moment your user object should contain the info</span>
  <span class="token comment">// from the Oauth2 response, since this is a protected resource</span>
  <span class="token comment">// as specified above in the handler config the user object is never null</span>
  <span class="token keyword">let</span> user <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// just dump it to the client for demo purposes</span>
  ctx<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mixing-oauth2-and-jwt"><a href="#mixing-oauth2-and-jwt" class="header-anchor">#</a> Mixing OAuth2 and JWT</h2> <p>Some providers use JWT tokens as access tokens, this is a feature of
<a href="https://tools.ietf.org/html/rfc6750" target="_blank" rel="noopener noreferrer">RFC6750<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and can be quite useful
when one wants to mix client based authentication and API authorization.
For example say that you have a application that provides some protected
HTML documents but you also want it to be available for API’s to
consume. In this case an API cannot easily perform the redirect
handshake required by OAuth2 but can use a Token provided before hand.</p> <p>This is handled automatically by the handler as long as the provider is
configured to support JWTs.</p> <p>In real life this means that your API’s can access your protected
resources using the header <code>Authorization</code> with the value <code>Bearer BASE64_ACCESS_TOKEN</code>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/web/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/12/2020, 10:17:53 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.5c50c914.js" defer></script><script src="/es4x/assets/js/2.9528bf06.js" defer></script><script src="/es4x/assets/js/149.97b36e7e.js" defer></script>
  </body>
</html>
