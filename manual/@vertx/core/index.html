<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES for Eclipse Vert.x</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
    <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
    <script src="/es4x/player/asciinema-player.js"></script>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <link rel="preload" href="/es4x/assets/css/0.styles.57be2129.css" as="style"><link rel="preload" href="/es4x/assets/js/app.cfb14a02.js" as="script"><link rel="preload" href="/es4x/assets/js/2.96613d0f.js" as="script"><link rel="preload" href="/es4x/assets/js/75.96ffdfe8.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.25f493b2.js"><link rel="prefetch" href="/es4x/assets/js/100.cfb483ce.js"><link rel="prefetch" href="/es4x/assets/js/101.e546445b.js"><link rel="prefetch" href="/es4x/assets/js/102.9c678484.js"><link rel="prefetch" href="/es4x/assets/js/103.58ddcfc8.js"><link rel="prefetch" href="/es4x/assets/js/104.5d636807.js"><link rel="prefetch" href="/es4x/assets/js/105.9c9f8986.js"><link rel="prefetch" href="/es4x/assets/js/106.fb797c19.js"><link rel="prefetch" href="/es4x/assets/js/107.29eb69ad.js"><link rel="prefetch" href="/es4x/assets/js/108.d97e0b4e.js"><link rel="prefetch" href="/es4x/assets/js/109.28629ef4.js"><link rel="prefetch" href="/es4x/assets/js/11.6250afa8.js"><link rel="prefetch" href="/es4x/assets/js/110.3dd0cba3.js"><link rel="prefetch" href="/es4x/assets/js/111.601b115c.js"><link rel="prefetch" href="/es4x/assets/js/112.a49c45ac.js"><link rel="prefetch" href="/es4x/assets/js/113.ea0e864c.js"><link rel="prefetch" href="/es4x/assets/js/114.24c46597.js"><link rel="prefetch" href="/es4x/assets/js/115.65241419.js"><link rel="prefetch" href="/es4x/assets/js/116.a69493f0.js"><link rel="prefetch" href="/es4x/assets/js/117.03106a2c.js"><link rel="prefetch" href="/es4x/assets/js/118.50ed2245.js"><link rel="prefetch" href="/es4x/assets/js/119.beb4913a.js"><link rel="prefetch" href="/es4x/assets/js/12.1f7f2bd3.js"><link rel="prefetch" href="/es4x/assets/js/120.f13c267c.js"><link rel="prefetch" href="/es4x/assets/js/121.197dd995.js"><link rel="prefetch" href="/es4x/assets/js/122.b44c98b3.js"><link rel="prefetch" href="/es4x/assets/js/123.4586e425.js"><link rel="prefetch" href="/es4x/assets/js/124.d00a049e.js"><link rel="prefetch" href="/es4x/assets/js/125.1f32b7a7.js"><link rel="prefetch" href="/es4x/assets/js/126.e0bbd98d.js"><link rel="prefetch" href="/es4x/assets/js/127.fc93d280.js"><link rel="prefetch" href="/es4x/assets/js/128.98e5a4cc.js"><link rel="prefetch" href="/es4x/assets/js/129.fb3a3f88.js"><link rel="prefetch" href="/es4x/assets/js/13.1a7b9986.js"><link rel="prefetch" href="/es4x/assets/js/130.5cd4d89d.js"><link rel="prefetch" href="/es4x/assets/js/131.6ac7fa33.js"><link rel="prefetch" href="/es4x/assets/js/132.c8ad9a79.js"><link rel="prefetch" href="/es4x/assets/js/133.90881bb4.js"><link rel="prefetch" href="/es4x/assets/js/134.f7596c11.js"><link rel="prefetch" href="/es4x/assets/js/135.f8db6a39.js"><link rel="prefetch" href="/es4x/assets/js/136.bd2de92d.js"><link rel="prefetch" href="/es4x/assets/js/137.eabfa5f6.js"><link rel="prefetch" href="/es4x/assets/js/138.c19e308b.js"><link rel="prefetch" href="/es4x/assets/js/139.e437bff1.js"><link rel="prefetch" href="/es4x/assets/js/14.b66836b1.js"><link rel="prefetch" href="/es4x/assets/js/140.8d09b641.js"><link rel="prefetch" href="/es4x/assets/js/141.4d46fb84.js"><link rel="prefetch" href="/es4x/assets/js/142.99040345.js"><link rel="prefetch" href="/es4x/assets/js/143.7d902150.js"><link rel="prefetch" href="/es4x/assets/js/144.0543ff8f.js"><link rel="prefetch" href="/es4x/assets/js/145.6a2886f8.js"><link rel="prefetch" href="/es4x/assets/js/146.01466845.js"><link rel="prefetch" href="/es4x/assets/js/147.42e445c8.js"><link rel="prefetch" href="/es4x/assets/js/148.e677edea.js"><link rel="prefetch" href="/es4x/assets/js/149.50959280.js"><link rel="prefetch" href="/es4x/assets/js/15.bd087613.js"><link rel="prefetch" href="/es4x/assets/js/150.eabb62e5.js"><link rel="prefetch" href="/es4x/assets/js/151.a6f046ed.js"><link rel="prefetch" href="/es4x/assets/js/152.78e21db3.js"><link rel="prefetch" href="/es4x/assets/js/153.eef01fd9.js"><link rel="prefetch" href="/es4x/assets/js/154.f5b66c27.js"><link rel="prefetch" href="/es4x/assets/js/155.f5cbe3be.js"><link rel="prefetch" href="/es4x/assets/js/156.3fdf30f1.js"><link rel="prefetch" href="/es4x/assets/js/157.aeebd96f.js"><link rel="prefetch" href="/es4x/assets/js/158.bec405e9.js"><link rel="prefetch" href="/es4x/assets/js/159.f81bc2fa.js"><link rel="prefetch" href="/es4x/assets/js/16.a392a655.js"><link rel="prefetch" href="/es4x/assets/js/160.611a570e.js"><link rel="prefetch" href="/es4x/assets/js/161.400aed1c.js"><link rel="prefetch" href="/es4x/assets/js/162.60fdd908.js"><link rel="prefetch" href="/es4x/assets/js/163.841834be.js"><link rel="prefetch" href="/es4x/assets/js/164.368aca3b.js"><link rel="prefetch" href="/es4x/assets/js/165.6ed202c4.js"><link rel="prefetch" href="/es4x/assets/js/166.cd243b01.js"><link rel="prefetch" href="/es4x/assets/js/167.74493e23.js"><link rel="prefetch" href="/es4x/assets/js/168.26ae4c80.js"><link rel="prefetch" href="/es4x/assets/js/169.adffbf41.js"><link rel="prefetch" href="/es4x/assets/js/17.f58ddc3f.js"><link rel="prefetch" href="/es4x/assets/js/170.ec119bad.js"><link rel="prefetch" href="/es4x/assets/js/171.8ce41d74.js"><link rel="prefetch" href="/es4x/assets/js/172.c0640f4c.js"><link rel="prefetch" href="/es4x/assets/js/18.d0e693e8.js"><link rel="prefetch" href="/es4x/assets/js/19.2cfa07bf.js"><link rel="prefetch" href="/es4x/assets/js/20.83c2c4e9.js"><link rel="prefetch" href="/es4x/assets/js/21.bfb22c95.js"><link rel="prefetch" href="/es4x/assets/js/22.80259bfc.js"><link rel="prefetch" href="/es4x/assets/js/23.d3df90af.js"><link rel="prefetch" href="/es4x/assets/js/24.47cf75e1.js"><link rel="prefetch" href="/es4x/assets/js/25.af00dd42.js"><link rel="prefetch" href="/es4x/assets/js/26.2c5dd1f3.js"><link rel="prefetch" href="/es4x/assets/js/27.313c4d9d.js"><link rel="prefetch" href="/es4x/assets/js/28.c3fa5296.js"><link rel="prefetch" href="/es4x/assets/js/29.bc391437.js"><link rel="prefetch" href="/es4x/assets/js/3.4d2250de.js"><link rel="prefetch" href="/es4x/assets/js/30.ab72b827.js"><link rel="prefetch" href="/es4x/assets/js/31.360cf0c4.js"><link rel="prefetch" href="/es4x/assets/js/32.a454f02e.js"><link rel="prefetch" href="/es4x/assets/js/33.9072e3dc.js"><link rel="prefetch" href="/es4x/assets/js/34.2cd817f7.js"><link rel="prefetch" href="/es4x/assets/js/35.1499c4b4.js"><link rel="prefetch" href="/es4x/assets/js/36.b24867f2.js"><link rel="prefetch" href="/es4x/assets/js/37.8a1d9476.js"><link rel="prefetch" href="/es4x/assets/js/38.1caa3e15.js"><link rel="prefetch" href="/es4x/assets/js/39.ab25bad3.js"><link rel="prefetch" href="/es4x/assets/js/4.2410671b.js"><link rel="prefetch" href="/es4x/assets/js/40.13850330.js"><link rel="prefetch" href="/es4x/assets/js/41.1f30e160.js"><link rel="prefetch" href="/es4x/assets/js/42.f65b46db.js"><link rel="prefetch" href="/es4x/assets/js/43.86bd3898.js"><link rel="prefetch" href="/es4x/assets/js/44.25aede52.js"><link rel="prefetch" href="/es4x/assets/js/45.fbb6033a.js"><link rel="prefetch" href="/es4x/assets/js/46.13bb4f87.js"><link rel="prefetch" href="/es4x/assets/js/47.01a4d32b.js"><link rel="prefetch" href="/es4x/assets/js/48.4ef5e818.js"><link rel="prefetch" href="/es4x/assets/js/49.896ad60c.js"><link rel="prefetch" href="/es4x/assets/js/5.f2fd7a11.js"><link rel="prefetch" href="/es4x/assets/js/50.54a8010f.js"><link rel="prefetch" href="/es4x/assets/js/51.26142f55.js"><link rel="prefetch" href="/es4x/assets/js/52.b132a309.js"><link rel="prefetch" href="/es4x/assets/js/53.dc983026.js"><link rel="prefetch" href="/es4x/assets/js/54.3ae4a5b7.js"><link rel="prefetch" href="/es4x/assets/js/55.4b3e9675.js"><link rel="prefetch" href="/es4x/assets/js/56.2cc05aac.js"><link rel="prefetch" href="/es4x/assets/js/57.f8c33e2c.js"><link rel="prefetch" href="/es4x/assets/js/58.7b7e6201.js"><link rel="prefetch" href="/es4x/assets/js/59.beab06b9.js"><link rel="prefetch" href="/es4x/assets/js/6.7eb69711.js"><link rel="prefetch" href="/es4x/assets/js/60.ad528007.js"><link rel="prefetch" href="/es4x/assets/js/61.7462fe68.js"><link rel="prefetch" href="/es4x/assets/js/62.c7245534.js"><link rel="prefetch" href="/es4x/assets/js/63.91dfc6d8.js"><link rel="prefetch" href="/es4x/assets/js/64.a9a5d5d7.js"><link rel="prefetch" href="/es4x/assets/js/65.bd897469.js"><link rel="prefetch" href="/es4x/assets/js/66.b6b4afbd.js"><link rel="prefetch" href="/es4x/assets/js/67.b882907b.js"><link rel="prefetch" href="/es4x/assets/js/68.32bb2628.js"><link rel="prefetch" href="/es4x/assets/js/69.6e7fa7f2.js"><link rel="prefetch" href="/es4x/assets/js/7.e56c8e30.js"><link rel="prefetch" href="/es4x/assets/js/70.9fa2afb4.js"><link rel="prefetch" href="/es4x/assets/js/71.228413c9.js"><link rel="prefetch" href="/es4x/assets/js/72.4a3f3614.js"><link rel="prefetch" href="/es4x/assets/js/73.abf3fc90.js"><link rel="prefetch" href="/es4x/assets/js/74.13ff27d1.js"><link rel="prefetch" href="/es4x/assets/js/76.ef6180eb.js"><link rel="prefetch" href="/es4x/assets/js/77.7c3517c1.js"><link rel="prefetch" href="/es4x/assets/js/78.a4cb55ca.js"><link rel="prefetch" href="/es4x/assets/js/79.2a3d8a2f.js"><link rel="prefetch" href="/es4x/assets/js/8.3d81d937.js"><link rel="prefetch" href="/es4x/assets/js/80.80c9d719.js"><link rel="prefetch" href="/es4x/assets/js/81.7be9486c.js"><link rel="prefetch" href="/es4x/assets/js/82.f30975e2.js"><link rel="prefetch" href="/es4x/assets/js/83.2e22eebd.js"><link rel="prefetch" href="/es4x/assets/js/84.60798b2c.js"><link rel="prefetch" href="/es4x/assets/js/85.a6928290.js"><link rel="prefetch" href="/es4x/assets/js/86.0be2ea51.js"><link rel="prefetch" href="/es4x/assets/js/87.ad51e710.js"><link rel="prefetch" href="/es4x/assets/js/88.81d5d220.js"><link rel="prefetch" href="/es4x/assets/js/89.aac46f66.js"><link rel="prefetch" href="/es4x/assets/js/9.2edb4e2b.js"><link rel="prefetch" href="/es4x/assets/js/90.4a4fd3dc.js"><link rel="prefetch" href="/es4x/assets/js/91.065cc9a5.js"><link rel="prefetch" href="/es4x/assets/js/92.055a4ecc.js"><link rel="prefetch" href="/es4x/assets/js/93.71b53f02.js"><link rel="prefetch" href="/es4x/assets/js/94.b096f725.js"><link rel="prefetch" href="/es4x/assets/js/95.af24f6b1.js"><link rel="prefetch" href="/es4x/assets/js/96.38f15cba.js"><link rel="prefetch" href="/es4x/assets/js/97.c53fc06f.js"><link rel="prefetch" href="/es4x/assets/js/98.3426a32c.js"><link rel="prefetch" href="/es4x/assets/js/99.fa951d15.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.57be2129.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/core/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/core/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" aria-current="page" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>At the heart of Vert.x is a set of Java APIs that we call <strong>Vert.x
Core</strong></p> <p><a href="https://github.com/eclipse/vert.x" target="_blank" rel="noopener noreferrer">Repository<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Vert.x core provides functionality for things like:</p> <ul><li><p>Writing TCP clients and servers</p></li> <li><p>Writing HTTP clients and servers including support for WebSockets</p></li> <li><p>The Event bus</p></li> <li><p>Shared data - local maps and clustered distributed maps</p></li> <li><p>Periodic and delayed actions</p></li> <li><p>Deploying and undeploying Verticles</p></li> <li><p>Datagram Sockets</p></li> <li><p>DNS client</p></li> <li><p>File system access</p></li> <li><p>High availability</p></li> <li><p>Native transports</p></li> <li><p>Clustering</p></li></ul> <p>The functionality in core is fairly low level - you won’t find stuff
like database access, authorisation or high level web functionality here</p> <ul><li>that kind of stuff you’ll find in <strong>Vert.x ext</strong> (extensions).</li></ul> <p>Vert.x core is small and lightweight. You just use the parts you want.
It’s also entirely embeddable in your existing applications - we don’t
force you to structure your applications in a special way just so you
can use Vert.x.</p> <p>You can use core from any of the other languages that Vert.x supports.
But here’a a cool bit - we don’t force you to use the Java API directly
from, say, JavaScript or Ruby - after all, different languages have
different conventions and idioms, and it would be odd to force Java
idioms on Ruby developers (for example). Instead, we automatically
generate an <strong>idiomatic</strong> equivalent of the core Java APIs for each
language.</p> <p>From now on we’ll just use the word <strong>core</strong> to refer to Vert.x core.</p> <p>If you are using Maven or Gradle, add the following dependency to the
<em>dependencies</em> section of your project descriptor to access the Vert.x
Core API:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.vertx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>vertx-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.6.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
  compile <span class="token string">'io.vertx:vertx-core:3.6.3'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Let’s discuss the different concepts and features in core.</p> <h1 id="in-the-beginning-there-was-vert-x"><a href="#in-the-beginning-there-was-vert-x" class="header-anchor">#</a> In the beginning there was Vert.x</h1> <p>You can’t do much in Vert.x-land unless you can communicate with a
{@link io.vertx.core.Vertx} object!</p> <p>It’s the control centre of Vert.x and is how you do pretty much
everything, including creating clients and servers, getting a reference
to the event bus, setting timers, as well as many other things.</p> <p>So how do you get an instance?</p> <p>If you’re embedding Vert.x then you simply create an instance as
follows:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.CoreExamples#example1}
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>Most applications will only need a single Vert.x instance, but it’s
possible to create multiple Vert.x instances if you require, for
example, isolation between the event bus or different groups of
servers and clients.</p></blockquote> <h2 id="specifying-options-when-creating-a-vertx-object"><a href="#specifying-options-when-creating-a-vertx-object" class="header-anchor">#</a> Specifying options when creating a Vertx object</h2> <p>When creating a Vert.x object you can also specify options if the
defaults aren’t right for you:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.CoreExamples#example2}
</code></pre></div><p>The {@link io.vertx.core.VertxOptions} object has many settings and
allows you to configure things like clustering, high availability, pool
sizes and various other settings.</p> <h2 id="creating-a-clustered-vert-x-object"><a href="#creating-a-clustered-vert-x-object" class="header-anchor">#</a> Creating a clustered Vert.x object</h2> <p>If you’re creating a <strong>clustered Vert.x</strong> (See the section on the <a href="#event_bus">event
bus</a> for more information on clustering the event bus), then
you will normally use the asynchronous variant to create the Vertx
object.</p> <p>This is because it usually takes some time (maybe a few seconds) for the
different Vert.x instances in a cluster to group together. During that
time, we don’t want to block the calling thread, so we give the result
to you asynchronously.</p> <h1 id="are-you-fluent"><a href="#are-you-fluent" class="header-anchor">#</a> Are you fluent?</h1> <p>You may have noticed that in the previous examples a <strong>fluent</strong> API was
used.</p> <p>A fluent API is where multiple methods calls can be chained together.
For example:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This is a common pattern throughout Vert.x APIs, so get used to it.</p> <p>Chaining calls like this allows you to write code that’s a little bit
less verbose. Of course, if you don’t like the fluent approach <strong>we
don’t force you</strong> to do it that way, you can happily ignore it if you
prefer and write your code like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="don-t-call-us-we-ll-call-you"><a href="#don-t-call-us-we-ll-call-you" class="header-anchor">#</a> Don’t call us, we’ll call you.</h1> <p>The Vert.x APIs are largely <em>event driven</em>. This means that when things
happen in Vert.x that you are interested in, Vert.x will call you by
sending you events.</p> <p>Some example events are:</p> <ul><li><p>a timer has fired</p></li> <li><p>some data has arrived on a socket,</p></li> <li><p>some data has been read from disk</p></li> <li><p>an exception has occurred</p></li> <li><p>an HTTP server has received a request</p></li></ul> <p>You handle events by providing <em>handlers</em> to the Vert.x APIs. For
example to receive a timer event every second you would do:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// This handler will get called every second</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;timer fired!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or to receive an HTTP request:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Respond to each http request with &quot;Hello World&quot;</span>
server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// This handler will be called every time an HTTP request is received at the server</span>
  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Some time later when Vert.x has an event to pass to your handler Vert.x
will call it <strong>asynchronously</strong>.</p> <p>This leads us to some important concepts in Vert.x:</p> <h1 id="don-t-block-me"><a href="#don-t-block-me" class="header-anchor">#</a> Don’t block me!</h1> <p>With very few exceptions (i.e. some file system operations ending in
'Sync'), none of the APIs in Vert.x block the calling thread.</p> <p>If a result can be provided immediately, it will be returned
immediately, otherwise you will usually provide a handler to receive
events some time later.</p> <p>Because none of the Vert.x APIs block threads that means you can use
Vert.x to handle a lot of concurrency using just a small number of
threads.</p> <p>With a conventional blocking API the calling thread might block when:</p> <ul><li><p>Reading data from a socket</p></li> <li><p>Writing data to disk</p></li> <li><p>Sending a message to a recipient and waiting for a reply.</p></li> <li><p>…​ Many other situations</p></li></ul> <p>In all the above cases, when your thread is waiting for a result it
can’t do anything else - it’s effectively useless.</p> <p>This means that if you want a lot of concurrency using blocking APIs
then you need a lot of threads to prevent your application grinding to a
halt.</p> <p>Threads have overhead in terms of the memory they require (e.g. for
their stack) and in context switching.</p> <p>For the levels of concurrency required in many modern applications, a
blocking approach just doesn’t scale.</p> <h1 id="reactor-and-multi-reactor"><a href="#reactor-and-multi-reactor" class="header-anchor">#</a> Reactor and Multi-Reactor</h1> <p>We mentioned before that Vert.x APIs are event driven - Vert.x passes
events to handlers when they are available.</p> <p>In most cases Vert.x calls your handlers using a thread called an
<strong>event loop</strong>.</p> <p>As nothing in Vert.x or your application blocks, the event loop can
merrily run around delivering events to different handlers in succession
as they arrive.</p> <p>Because nothing blocks, an event loop can potentially deliver huge
amounts of events in a short amount of time. For example a single event
loop can handle many thousands of HTTP requests very quickly.</p> <p>We call this the <a href="http://en.wikipedia.org/wiki/Reactor_pattern" target="_blank" rel="noopener noreferrer">Reactor
Pattern<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>You may have heard of this before - for example Node.js implements this
pattern.</p> <p>In a standard reactor implementation there is a <strong>single event loop</strong>
thread which runs around in a loop delivering all events to all handlers
as they arrive.</p> <p>The trouble with a single thread is it can only run on a single core at
any one time, so if you want your single threaded reactor application
(e.g. your Node.js application) to scale over your multi-core server you
have to start up and manage many different processes.</p> <p>Vert.x works differently here. Instead of a single event loop, each
Vertx instance maintains <strong>several event loops</strong>. By default we choose
the number based on the number of available cores on the machine, but
this can be overridden.</p> <p>This means a single Vertx process can scale across your server, unlike
Node.js.</p> <p>We call this pattern the <strong>Multi-Reactor Pattern</strong> to distinguish it
from the single threaded reactor pattern.</p> <blockquote><p><strong>Note</strong></p> <p>Even though a Vertx instance maintains multiple event loops, any
particular handler will never be executed concurrently, and in most
cases (with the exception of <a href="#worker_verticles">worker verticles</a>)
will always be called using the <strong>exact same event loop</strong>.</p></blockquote> <h1 id="the-golden-rule-don-t-block-the-event-loop"><a href="#the-golden-rule-don-t-block-the-event-loop" class="header-anchor">#</a> The Golden Rule - Don’t Block the Event Loop</h1> <p>We already know that the Vert.x APIs are non blocking and won’t block
the event loop, but that’s not much help if you block the event loop
<strong>yourself</strong> in a handler.</p> <p>If you do that, then that event loop will not be able to do anything
else while it’s blocked. If you block all of the event loops in Vertx
instance then your application will grind to a complete halt!</p> <p>So don’t do it! <strong>You have been warned</strong>.</p> <p>Examples of blocking include:</p> <ul><li><p>Thread.sleep()</p></li> <li><p>Waiting on a lock</p></li> <li><p>Waiting on a mutex or monitor (e.g. synchronized section)</p></li> <li><p>Doing a long lived database operation and waiting for a result</p></li> <li><p>Doing a complex calculation that takes some significant time.</p></li> <li><p>Spinning in a loop</p></li></ul> <p>If any of the above stop the event loop from doing anything else for a
<strong>significant amount of time</strong> then you should go immediately to the
naughty step, and await further instructions.</p> <p>So…​ what is a <strong>significant amount of time</strong>?</p> <p>How long is a piece of string? It really depends on your application and
the amount of concurrency you require.</p> <p>If you have a single event loop, and you want to handle 10000 http
requests per second, then it’s clear that each request can’t take more
than 0.1 ms to process, so you can’t block for any more time than that.</p> <p><strong>The maths is not hard and shall be left as an exercise for the
reader.</strong></p> <p>If your application is not responsive it might be a sign that you are
blocking an event loop somewhere. To help you diagnose such issues,
Vert.x will automatically log warnings if it detects an event loop
hasn’t returned for some time. If you see warnings like these in your
logs, then you should investigate.</p> <div class="language- extra-class"><pre><code>Thread vertx-eventloop-thread-3 has been blocked for 20458 ms
</code></pre></div><p>Vert.x will also provide stack traces to pinpoint exactly where the
blocking is occurring.</p> <p>If you want to turn off these warnings or change the settings, you can
do that in the <code>VertxOptions</code> object before creating the Vertx object.</p> <h1 id="running-blocking-code"><a href="#running-blocking-code" class="header-anchor">#</a> Running blocking code</h1> <p>In a perfect world, there will be no war or hunger, all APIs will be
written asynchronously and bunny rabbits will skip hand-in-hand with
baby lambs across sunny green meadows.</p> <p><strong>But…​ the real world is not like that. (Have you watched the news
lately?)</strong></p> <p>Fact is, many, if not most libraries, especially in the JVM ecosystem
have synchronous APIs and many of the methods are likely to block. A
good example is the JDBC API - it’s inherently synchronous, and no
matter how hard it tries, Vert.x cannot sprinkle magic pixie dust on it
to make it asynchronous.</p> <p>We’re not going to rewrite everything to be asynchronous overnight so we
need to provide you a way to use &quot;traditional&quot; blocking APIs safely
within a Vert.x application.</p> <p>As discussed before, you can’t call blocking operations directly from an
event loop, as that would prevent it from doing any other useful work.
So how can you do this?</p> <p>It’s done by calling <code>executeBlocking</code> specifying both the blocking code
to execute and a result handler to be called back asynchronous when the
blocking code has been executed.</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">executeBlocking</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Call some blocking API that takes a significant amount of time to return</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> someAPI<span class="token punctuation">.</span><span class="token function">blockingMethod</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The result is: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Warning</strong></p> <p>Blocking code should block for a reasonable amount of time (i.e no
more than a few seconds). Long blocking operations or polling
operations (i.e a thread that spin in a loop polling events in a
blocking fashion) are precluded. When the blocking operation lasts
more than the 10 seconds, a message will be printed on the console by
the blocked thread checker. Long blocking operations should use a
dedicated thread managed by the application, which can interact with
verticles using the event-bus or <code>runOnContext</code></p></blockquote> <p>By default, if executeBlocking is called several times from the same
context (e.g. the same verticle instance) then the different
executeBlocking are executed <em>serially</em> (i.e. one after another).</p> <p>If you don’t care about ordering you can call <code>executeBlocking</code>
specifying <code>false</code> as the argument to <code>ordered</code>. In this case any
executeBlocking may be executed in parallel on the worker pool.</p> <p>An alternative way to run blocking code is to use a <a href="#worker_verticles">worker
verticle</a></p> <p>A worker verticle is always executed with a thread from the worker pool.</p> <p>By default blocking code is executed on the Vert.x worker pool,
configured with <code>setWorkerPoolSize</code>.</p> <p>Additional pools can be created for different purposes:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> executor <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createSharedWorkerExecutor</span><span class="token punctuation">(</span><span class="token string">&quot;my-worker-pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
executor<span class="token punctuation">.</span><span class="token function">executeBlocking</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Call some blocking API that takes a significant amount of time to return</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> someAPI<span class="token punctuation">.</span><span class="token function">blockingMethod</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The result is: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The worker executor must be closed when it’s not necessary anymore:</p> <div class="language-js extra-class"><pre class="language-js"><code>executor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When several workers are created with the same name, they will share the
same pool. The worker pool is destroyed when all the worker executors
using it are closed.</p> <p>When an executor is created in a Verticle, Vert.x will close it
automatically for you when the Verticle is undeployed.</p> <p>Worker executors can be configured when created:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//</span>
<span class="token comment">// 10 threads max</span>
<span class="token keyword">let</span> poolSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">// 2 minutes</span>
<span class="token keyword">let</span> maxExecuteTime <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> maxExecuteTimeUnit <span class="token operator">=</span> TimeUnit<span class="token punctuation">.</span><span class="token constant">MINUTES</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> executor <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createSharedWorkerExecutor</span><span class="token punctuation">(</span><span class="token string">&quot;my-worker-pool&quot;</span><span class="token punctuation">,</span> poolSize<span class="token punctuation">,</span> maxExecuteTime<span class="token punctuation">,</span> maxExecuteTimeUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>the configuration is set when the worker pool is created</p></blockquote> <h1 id="async-coordination"><a href="#async-coordination" class="header-anchor">#</a> Async coordination</h1> <p>Coordination of multiple asynchronous results can be achieved with
Vert.x <code>futures</code>. It supports concurrent composition (run several async
operations in parallel) and sequential composition (chain async
operations).</p> <h2 id="concurrent-composition"><a href="#concurrent-composition" class="header-anchor">#</a> Concurrent composition</h2> <p><code>CompositeFuture.all</code> takes several futures arguments (up to 6) and
returns a future that is <em>succeeded</em> when all the futures are and
<em>failed</em> when at least one of the futures is failed:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Future <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CompositeFuture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> httpServerFuture <span class="token operator">=</span> Future<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  httpServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> netServerFuture <span class="token operator">=</span> Future<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  netServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

CompositeFuture<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>httpServerFuture<span class="token punctuation">,</span> netServerFuture<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// All servers started</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// At least one server failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The operations run concurrently, the <code>Handler</code> attached to the returned
future is invoked upon completion of the composition. When one of the
operation fails (one of the passed future is marked as a failure), the
resulting future is marked as failed too. When all the operations
succeed, the resulting future is completed with a success.</p> <p>Alternatively, you can pass a list (potentially empty) of futures:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CompositeFuture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
CompositeFuture<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>future1<span class="token punctuation">,</span> future2<span class="token punctuation">,</span> future3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>While the <code>all</code> composition <em>waits</em> until all futures are successful (or
one fails), the <code>any</code> composition <em>waits</em> for the first succeeded
future. <code>CompositeFuture.any</code> takes several futures arguments (up to 6)
and returns a future that is succeeded when one of the futures is, and
failed when all the futures are failed:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CompositeFuture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
CompositeFuture<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>future1<span class="token punctuation">,</span> future2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// At least one is succeeded</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// All failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A list of futures can be used also:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CompositeFuture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
CompositeFuture<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>join</code> composition <em>waits</em> until all futures are completed, either
with a success or a failure. <code>CompositeFuture.join</code> takes several
futures arguments (up to 6) and returns a future that is succeeded when
all the futures are succeeded, and failed when all the futures are
completed and at least one of them is failed:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CompositeFuture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
CompositeFuture<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>future1<span class="token punctuation">,</span> future2<span class="token punctuation">,</span> future3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// All succeeded</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// All completed and at least one failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A list of futures can be used also:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CompositeFuture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
CompositeFuture<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span>future1<span class="token punctuation">,</span> future2<span class="token punctuation">,</span> future3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="sequential-composition"><a href="#sequential-composition" class="header-anchor">#</a> Sequential composition</h2> <p>While <code>all</code> and <code>any</code> are implementing concurrent composition, <code>compose</code>
can be used for chaining futures (so sequential composition).</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Future <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> fs <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> fut1 <span class="token operator">=</span> Future<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">createFile</span><span class="token punctuation">(</span><span class="token string">&quot;/foo&quot;</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> startFuture <span class="token operator">=</span> fut1<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// When the file is created (fut1), execute this:</span>
  <span class="token keyword">return</span> Future<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;/foo&quot;</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// When the file is written (fut2), execute this:</span>
  <span class="token keyword">return</span> Future<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">&quot;/foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/bar&quot;</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this example, 3 operations are chained:</p> <ol><li><p>a file is created (<code>fut1</code>)</p></li> <li><p>something is written in the file (<code>fut2</code>)</p></li> <li><p>the file is moved (<code>startFuture</code>)</p></li></ol> <p>When these 3 steps are successful, the final future (<code>startFuture</code>) is
succeeded. However, if one of the steps fails, the final future is
failed.</p> <p>This example uses:</p> <ul><li><p><code>compose</code>: when the current future completes, run the given
function, that returns a future. When this returned future
completes, it completes the composition.</p></li> <li><p><code>compose</code>: when the current future completes, run the given handler
that completes the given <code>future</code> (next).</p></li></ul> <p>In this second case, the <code>Handler</code> should complete the <code>next</code> future to
report its success or failure.</p> <h2 id="completionstage-interoperability"><a href="#completionstage-interoperability" class="header-anchor">#</a> CompletionStage interoperability</h2> <p>The Vert.x <code>Future</code> API offers compatibility <em>from</em> and <em>to</em> <code>CompletionStage</code> which is the JDK interface for composable asynchronous
operations.</p> <p>We can go from a Vert.x <code>Future</code> to a <code>CompletionStage</code> using the
<code>toCompletionStage</code> method, as in:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Promise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toCompletionStage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ip<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>err <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Could not resolve vertx.io&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    err<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io =&gt; &quot;</span> <span class="token operator">+</span> ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We can conversely go from a <code>CompletionStage</code> to Vert.x <code>Future</code> using
<code>Future.fromCompletionStage</code>. There are 2 variants:</p> <ol><li><p>the first variant takes just a <code>CompletionStage</code> and calls the
<code>Future</code> methods from the thread that resolves the <code>CompletionStage</code>
instance, and</p></li> <li><p>the second variant takes an extra <code>Context</code> parameter to call the
<code>Future</code> methods on a Vert.x context.</p></li></ol> <blockquote><p><strong>Important</strong></p> <p>In most cases the variant with a <code>CompletionStage</code> and a <code>Context</code> is
the one you will want to use to respect the Vert.x threading model,
since Vert.x <code>Future</code> are more likely to be used with Vert.x code,
libraries and clients.</p></blockquote> <p>Here is an example of going from a <code>CompletionStage</code> to a Vert.x
<code>Future</code> and dispatching on a context:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Future <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
Future<span class="token punctuation">.</span><span class="token function">fromCompletionStage</span><span class="token punctuation">(</span>completionStage<span class="token punctuation">,</span> vertx<span class="token punctuation">.</span><span class="token function">getOrCreateContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> key <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.UUID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">storeInDb</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> str<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;We have a result: &quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onFailure</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;We have a problem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  err<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="verticles"><a href="#verticles" class="header-anchor">#</a> Verticles</h1> <p>Vert.x comes with a simple, scalable, <em>actor-like</em> deployment and
concurrency model out of the box that you can use to save you writing
your own.</p> <p><strong>This model is entirely optional and Vert.x does not force you to
create your applications in this way if you don’t want to.</strong>.</p> <p>The model does not claim to be a strict actor-model implementation, but
it does share similarities especially with respect to concurrency,
scaling and deployment.</p> <p>To use this model, you write your code as set of <strong>verticles</strong>.</p> <p>Verticles are chunks of code that get deployed and run by Vert.x. A
Vert.x instance maintains N event loop threads (where N by default is
core*2) by default. Verticles can be written in any of the languages
that Vert.x supports and a single application can include verticles
written in multiple languages.</p> <p>You can think of a verticle as a bit like an actor in the <a href="http://en.wikipedia.org/wiki/Actor_model" target="_blank" rel="noopener noreferrer">Actor
Model<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>An application would typically be composed of many verticle instances
running in the same Vert.x instance at the same time. The different
verticle instances communicate with each other by sending messages on
the <a href="#event_bus">event bus</a>.</p> <h2 id="writing-verticles"><a href="#writing-verticles" class="header-anchor">#</a> Writing Verticles</h2> <p>Verticle classes must implement the {@link io.vertx.core.Verticle}
interface.</p> <p>They can implement it directly if you like but usually it’s simpler to
extend the abstract class {@link io.vertx.core.AbstractVerticle}.</p> <p>Here’s an example verticle:</p> <div class="language- extra-class"><pre><code>public class MyVerticle extends AbstractVerticle {

  // Called when verticle is deployed
  public void start() {
  }

  // Optional - called when verticle is undeployed
  public void stop() {
  }

}
</code></pre></div><p>Normally you would override the start method like in the example above.</p> <p>When Vert.x deploys the verticle it will call the start method, and when
the method has completed the verticle will be considered started.</p> <p>You can also optionally override the stop method. This will be called by
Vert.x when the verticle is undeployed and when the method has completed
the verticle will be considered stopped.</p> <h2 id="asynchronous-verticle-start-and-stop"><a href="#asynchronous-verticle-start-and-stop" class="header-anchor">#</a> Asynchronous Verticle start and stop</h2> <p>Sometimes you want to do something in your verticle start-up which takes
some time and you don’t want the verticle to be considered deployed
until that happens. For example you might want to start an HTTP server
in the start method and propagate the asynchronous result of the server
<code>listen</code> method.</p> <p>You can’t block waiting for the HTTP server to bind in your start method
as that would break the <a href="#golden_rule">Golden Rule</a>.</p> <p>So how can you do this?</p> <p>The way to do it is to implement the <strong>asynchronous</strong> start method. This
version of the method takes a Future as a parameter. When the method
returns the verticle will <strong>not</strong> be considered deployed.</p> <p>Some time later, after you’ve done everything you need to do (e.g. start
the HTTP server), you can call complete on the Future (or fail) to
signal that you’re done.</p> <p>Here’s an example:</p> <div class="language- extra-class"><pre><code>public class MyVerticle extends AbstractVerticle {

  private HttpServer server;

  public void start(Future&lt;Void&gt; startFuture) {
    server = vertx.createHttpServer().requestHandler(req -&gt; {
      req.response()
        .putHeader(&quot;content-type&quot;, &quot;text/plain&quot;)
        .end(&quot;Hello from Vert.x!&quot;);
      });

    // Now bind the server:
    server.listen(8080, res -&gt; {
      if (res.succeeded()) {
        startFuture.complete();
      } else {
        startFuture.fail(res.cause());
      }
    });
  }
}
</code></pre></div><p>Similarly, there is an asynchronous version of the stop method too. You
use this if you want to do some verticle cleanup that takes some time.</p> <div class="language- extra-class"><pre><code>public class MyVerticle extends AbstractVerticle {

  public void start() {
    // Do something
  }

  public void stop(Future&lt;Void&gt; stopFuture) {
    obj.doSomethingThatTakesTime(res -&gt; {
      if (res.succeeded()) {
        stopFuture.complete();
      } else {
        stopFuture.fail();
      }
    });
  }
}
</code></pre></div><p>INFO: You don’t need to manually stop the HTTP server started by a
verticle, in the verticle’s stop method. Vert.x will automatically stop
any running server when the verticle is undeployed.</p> <h2 id="verticle-types"><a href="#verticle-types" class="header-anchor">#</a> Verticle Types</h2> <p>There are two different types of verticles:</p> <ul><li><p>Standard Verticles<br>
These are the most common and useful type - they are always executed
using an event loop thread. We’ll discuss this more in the next
section.</p></li> <li><p>Worker Verticles<br>
These run using a thread from the worker pool. An instance is never
executed concurrently by more than one thread.</p></li></ul> <h2 id="standard-verticles"><a href="#standard-verticles" class="header-anchor">#</a> Standard verticles</h2> <p>Standard verticles are assigned an event loop thread when they are
created and the start method is called with that event loop. When you
call any other methods that takes a handler on a core API from an event
loop then Vert.x will guarantee that those handlers, when called, will
be executed on the same event loop.</p> <p>This means we can guarantee that all the code in your verticle instance
is always executed on the same event loop (as long as you don’t create
your own threads and call it!).</p> <p>This means you can write all the code in your application as single
threaded and let Vert.x worry about the threading and scaling. No more
worrying about synchronized and volatile any more, and you also avoid
many other cases of race conditions and deadlock so prevalent when doing
hand-rolled 'traditional' multi-threaded application development.</p> <h2 id="worker-verticles"><a href="#worker-verticles" class="header-anchor">#</a> Worker verticles</h2> <p>A worker verticle is just like a standard verticle but it’s executed
using a thread from the Vert.x worker thread pool, rather than using an
event loop.</p> <p>Worker verticles are designed for calling blocking code, as they won’t
block any event loops.</p> <p>If you don’t want to use a worker verticle to run blocking code, you can
also run <a href="#blocking_code">inline blocking code</a> directly while on an
event loop.</p> <p>If you want to deploy a verticle as a worker verticle you do that with
<code>setWorker</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setWorker</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;com.mycompany.MyOrderProcessorVerticle&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Worker verticle instances are never executed concurrently by Vert.x by
more than one thread, but can executed by different threads at different
times.</p> <h2 id="deploying-verticles-programmatically"><a href="#deploying-verticles-programmatically" class="header-anchor">#</a> Deploying verticles programmatically</h2> <p>You can deploy a verticle using one of the <code>deployVerticle</code> method,
specifying a verticle name or you can pass in a verticle instance you
have already created yourself.</p> <blockquote><p><strong>Note</strong></p> <p>Deploying Verticle <strong>instances</strong> is Java only.</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>let myVerticle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token class-name">Java</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;examples.CoreExamples.MyVerticle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span>myVerticle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also deploy verticles by specifying the verticle <strong>name</strong>.</p> <p>The verticle name is used to look up the specific <code>VerticleFactory</code> that
will be used to instantiate the actual verticle instance(s).</p> <p>Different verticle factories are available for instantiating verticles
in different languages and for various other reasons such as loading
services and getting verticles from Maven at run-time.</p> <p>This allows you to deploy verticles written in any language from any
other language that Vert.x supports.</p> <p>Here’s an example of deploying some different types of verticles:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Deploy a Java verticle - the name is the fully qualified class name of the verticle class</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;com.mycompany.MyOrderProcessorVerticle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy a JavaScript verticle</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;verticles/myverticle.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy a Ruby verticle verticle</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;verticles/my_verticle.rb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="rules-for-mapping-a-verticle-name-to-a-verticle-factory"><a href="#rules-for-mapping-a-verticle-name-to-a-verticle-factory" class="header-anchor">#</a> Rules for mapping a verticle name to a verticle factory</h2> <p>When deploying verticle(s) using a name, the name is used to select the
actual verticle factory that will instantiate the verticle(s).</p> <p>Verticle names can have a prefix - which is a string followed by a
colon, which if present will be used to look-up the factory, e.g.</p> <p>js:foo.js // Use the JavaScript verticle factory
groovy:com.mycompany.SomeGroovyCompiledVerticle // Use the Groovy
verticle factory service:com.mycompany:myorderservice // Uses the
service verticle factory</p> <p>If no prefix is present, Vert.x will look for a suffix and use that to
lookup the factory, e.g.</p> <p>foo.js // Will also use the JavaScript verticle factory
SomeScript.groovy // Will use the Groovy verticle factory</p> <p>If no prefix or suffix is present, Vert.x will assume it’s a Java fully
qualified class name (FQCN) and try and instantiate that.</p> <h2 id="how-are-verticle-factories-located"><a href="#how-are-verticle-factories-located" class="header-anchor">#</a> How are Verticle Factories located?</h2> <p>Most Verticle factories are loaded from the classpath and registered at
Vert.x startup.</p> <p>You can also programmatically register and unregister verticle factories
using <code>registerVerticleFactory</code> and <code>unregisterVerticleFactory</code> if you
wish.</p> <h2 id="waiting-for-deployment-to-complete"><a href="#waiting-for-deployment-to-complete" class="header-anchor">#</a> Waiting for deployment to complete</h2> <p>Verticle deployment is asynchronous and may complete some time after the
call to deploy has returned.</p> <p>If you want to be notified when deployment is complete you can deploy
specifying a completion handler:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;com.mycompany.MyOrderProcessorVerticle&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Deployment id is: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Deployment failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The completion handler will be passed a result containing the deployment
ID string, if deployment succeeded.</p> <p>This deployment ID can be used later if you want to undeploy the
deployment.</p> <h2 id="undeploying-verticle-deployments"><a href="#undeploying-verticle-deployments" class="header-anchor">#</a> Undeploying verticle deployments</h2> <p>Deployments can be undeployed with <code>undeploy</code>.</p> <p>Un-deployment is itself asynchronous so if you want to be notified when
un-deployment is complete you can deploy specifying a completion
handler:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">undeploy</span><span class="token punctuation">(</span>deploymentID<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Undeployed ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Undeploy failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="specifying-number-of-verticle-instances"><a href="#specifying-number-of-verticle-instances" class="header-anchor">#</a> Specifying number of verticle instances</h2> <p>When deploying a verticle using a verticle name, you can specify the
number of verticle instances that you want to deploy:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInstances</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;com.mycompany.MyOrderProcessorVerticle&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This is useful for scaling easily across multiple cores. For example you
might have a web-server verticle to deploy and multiple cores on your
machine, so you want to deploy multiple instances to utilise all the
cores.</p> <h2 id="passing-configuration-to-a-verticle"><a href="#passing-configuration-to-a-verticle" class="header-anchor">#</a> Passing configuration to a verticle</h2> <p>Configuration in the form of JSON can be passed to a verticle at
deployment time:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.CoreExamples#example13}
</code></pre></div><p>This configuration is then available via the {@link
io.vertx.core.Context} object or directly using the {@link
io.vertx.core.AbstractVerticle#config()} method. The configuration is
returned as a JSON object so you can retrieve data as follows:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.ConfigurableVerticleExamples#start()}
</code></pre></div><h2 id="accessing-environment-variables-in-a-verticle"><a href="#accessing-environment-variables-in-a-verticle" class="header-anchor">#</a> Accessing environment variables in a Verticle</h2> <p>Environment variables and system properties are accessible using the
Java API:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.CoreExamples#systemAndEnvProperties()}
</code></pre></div><h2 id="verticle-isolation-groups"><a href="#verticle-isolation-groups" class="header-anchor">#</a> Verticle Isolation Groups</h2> <p>By default, Vert.x has a <em>flat classpath</em>. I.e, when Vert.x deploys
verticles it does so with the current classloader - it doesn’t create a
new one. In the majority of cases this is the simplest, clearest, and
sanest thing to do.</p> <p>However, in some cases you may want to deploy a verticle so the classes
of that verticle are isolated from others in your application.</p> <p>This might be the case, for example, if you want to deploy two different
versions of a verticle with the same class name in the same Vert.x
instance, or if you have two different verticles which use different
versions of the same jar library.</p> <p>When using an isolation group you provide a list of the class names that
you want isolated using <code>setIsolatedClasses</code>- an entry can be a fully
qualified classname such as <code>com.mycompany.myproject.engine.MyClass</code> or
it can be a wildcard which will match any classes in a package and any
sub-packages, e.g. <code>com.mycompany.myproject.*</code> would match any classes
in the package <code>com.mycompany.myproject</code> or any sub-packages.</p> <p>Please note that <em>only</em> the classes that match will be isolated - any
other classes will be loaded by the current class loader.</p> <p>Extra classpath entries can also be provided with <code>setExtraClasspath</code> so
if you want to load classes or resources that aren’t already present on
the main classpath you can add this.</p> <blockquote><p><strong>Warning</strong></p> <p>Use this feature with caution. Class-loaders can be a can of worms,
and can make debugging difficult, amongst other things.</p></blockquote> <p>Here’s an example of using an isolation group to isolate a verticle
deployment.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setIsolationGroup</span><span class="token punctuation">(</span><span class="token string">&quot;mygroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
options<span class="token punctuation">.</span>isolatedClasses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;com.mycompany.myverticle.*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.mycompany.somepkg.SomeClass&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.somelibrary.*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;com.mycompany.myverticle.VerticleClass&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="high-availability"><a href="#high-availability" class="header-anchor">#</a> High Availability</h2> <p>Verticles can be deployed with High Availability (HA) enabled. In that
context, when a verticle is deployed on a vert.x instance that dies
abruptly, the verticle is redeployed on another vert.x instance from the
cluster.</p> <p>To run an verticle with the high availability enabled, just append the
<code>-ha</code> switch:</p> <div class="language- extra-class"><pre><code>vertx run my-verticle.js -ha
</code></pre></div><p>When enabling high availability, no need to add <code>-cluster</code>.</p> <p>More details about the high availability feature and configuration in
the <a href="#_high_availability_and_fail_over">High Availability and Fail-Over</a>
section.</p> <h2 id="running-verticles-from-the-command-line"><a href="#running-verticles-from-the-command-line" class="header-anchor">#</a> Running Verticles from the command line</h2> <p>You can use Vert.x directly in your Maven or Gradle projects in the
normal way by adding a dependency to the Vert.x core library and hacking
from there.</p> <p>However you can also run Vert.x verticles directly from the command line
if you wish.</p> <p>To do this you need to download and install a Vert.x distribution, and
add the <code>bin</code> directory of the installation to your <code>PATH</code> environment
variable. Also make sure you have a Java 8 JDK on your <code>PATH</code>.</p> <blockquote><p><strong>Note</strong></p> <p>The JDK is required to support on the fly compilation of Java code.</p></blockquote> <p>You can now run verticles by using the <code>vertx run</code> command. Here are
some examples:</p> <div class="language- extra-class"><pre><code># Run a JavaScript verticle
vertx run my_verticle.js

# Run a Ruby verticle
vertx run a_n_other_verticle.rb

# Run a Groovy script verticle, clustered
vertx run FooVerticle.groovy -cluster
</code></pre></div><p>You can even run Java source verticles without compiling them first!</p> <div class="language- extra-class"><pre><code>vertx run SomeJavaSourceFile.java
</code></pre></div><p>Vert.x will compile the Java source file on the fly before running it.
This is really useful for quickly prototyping verticles and great for
demos. No need to set-up a Maven or Gradle build first to get going!</p> <p>For full information on the various options available when executing
<code>vertx</code> on the command line, type <code>vertx</code> at the command line.</p> <h2 id="causing-vert-x-to-exit"><a href="#causing-vert-x-to-exit" class="header-anchor">#</a> Causing Vert.x to exit</h2> <p>Threads maintained by Vert.x instances are not daemon threads so they
will prevent the JVM from exiting.</p> <p>If you are embedding Vert.x and you have finished with it, you can call
<code>close</code> to close it down.</p> <p>This will shut-down all internal thread pools and close other resources,
and will allow the JVM to exit.</p> <h2 id="the-context-object"><a href="#the-context-object" class="header-anchor">#</a> The Context object</h2> <p>When Vert.x provides an event to a handler or calls the start or stop
methods of a <code>Verticle</code>, the execution is associated with a <code>Context</code>.
Usually a context is an <strong>event-loop context</strong> and is tied to a specific
event loop thread. So executions for that context always occur on that
exact same event loop thread. In the case of worker verticles and
running inline blocking code a worker context will be associated with
the execution which will use a thread from the worker thread pool.</p> <p>To retrieve the context, use the <code>getOrCreateContext</code> method:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> context <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">getOrCreateContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the current thread has a context associated with it, it reuses the
context object. If not a new instance of context is created. You can
test the <em>type</em> of context you have retrieved:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Context <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> context <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">getOrCreateContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">isEventLoopContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Context attached to Event Loop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">isWorkerContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Context attached to Worker Thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">isMultiThreadedWorkerContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Context attached to Worker Thread - multi threaded worker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Context<span class="token punctuation">.</span><span class="token function">isOnVertxThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Context not attached to a thread managed by vert.x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When you have retrieved the context object, you can run code in this
context asynchronously. In other words, you submit a task that will be
eventually run in the same context, but later:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">getOrCreateContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runOnContext</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;This will be executed asynchronously in the same context&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When several handlers run in the same context, they may want to share
data. The context object offers methods to store and retrieve data
shared in the context. For instance, it lets you pass data to some
action run with <code>runOnContext</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> context <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">getOrCreateContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">runOnContext</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> hello <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The context object also let you access verticle configuration using the
<code>config</code> method. Check the <a href="#_passing_configuration_to_a_verticle">Passing configuration to a
verticle</a> section for more
details about this configuration.</p> <h2 id="executing-periodic-and-delayed-actions"><a href="#executing-periodic-and-delayed-actions" class="header-anchor">#</a> Executing periodic and delayed actions</h2> <p>It’s very common in Vert.x to want to perform an action after a delay,
or periodically.</p> <p>In standard verticles you can’t just make the thread sleep to introduce
a delay, as that will block the event loop thread.</p> <p>Instead you use Vert.x timers. Timers can be <strong>one-shot</strong> or
<strong>periodic</strong>. We’ll discuss both</p> <h3 id="one-shot-timers"><a href="#one-shot-timers" class="header-anchor">#</a> One-shot Timers</h3> <p>A one shot timer calls an event handler after a certain delay, expressed
in milliseconds.</p> <p>To set a timer to fire once you use <code>setTimer</code> method passing in the
delay and a handler</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> timerID <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;And one second later this is printed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;First this is printed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The return value is a unique timer id which can later be used to cancel
the timer. The handler is also passed the timer id.</p> <h3 id="periodic-timers"><a href="#periodic-timers" class="header-anchor">#</a> Periodic Timers</h3> <p>You can also set a timer to fire periodically by using <code>setPeriodic</code>.</p> <p>There will be an initial delay equal to the period.</p> <p>The return value of <code>setPeriodic</code> is a unique timer id (long). This can
be later used if the timer needs to be cancelled.</p> <p>The argument passed into the timer event handler is also the unique
timer id:</p> <p>Keep in mind that the timer will fire on a periodic basis. If your
periodic treatment takes a long amount of time to proceed, your timer
events could run continuously or even worse : stack up.</p> <p>In this case, you should consider using <code>setTimer</code> instead. Once your
treatment has finished, you can set the next timer.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> timerID <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;And every second this is printed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;First this is printed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cancelling-timers"><a href="#cancelling-timers" class="header-anchor">#</a> Cancelling timers</h3> <p>To cancel a periodic timer, call <code>cancelTimer</code> specifying the timer id.
For example:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">cancelTimer</span><span class="token punctuation">(</span>timerID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="automatic-clean-up-in-verticles"><a href="#automatic-clean-up-in-verticles" class="header-anchor">#</a> Automatic clean-up in verticles</h3> <p>If you’re creating timers from inside verticles, those timers will be
automatically closed when the verticle is undeployed.</p> <h2 id="verticle-worker-pool"><a href="#verticle-worker-pool" class="header-anchor">#</a> Verticle worker pool</h2> <p>Verticles use the Vert.x worker pool for executing blocking actions, i.e
<code>executeBlocking</code> or worker verticle.</p> <p>A different worker pool can be specified in deployment options:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;the-verticle&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setWorkerPoolName</span><span class="token punctuation">(</span><span class="token string">&quot;the-specific-pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="the-event-bus"><a href="#the-event-bus" class="header-anchor">#</a> The Event Bus</h1> <p>The <code>event bus</code> is the <strong>nervous system</strong> of Vert.x.</p> <p>There is a single event bus instance for every Vert.x instance and it is
obtained using the method <code>eventBus</code>.</p> <p>The event bus allows different parts of your application to communicate
with each other, irrespective of what language they are written in, and
whether they’re in the same Vert.x instance, or in a different Vert.x
instance.</p> <p>It can even be bridged to allow client-side JavaScript running in a
browser to communicate on the same event bus.</p> <p>The event bus forms a distributed peer-to-peer messaging system spanning
multiple server nodes and multiple browsers.</p> <p>The event bus supports publish/subscribe, point-to-point, and
request-response messaging.</p> <p>The event bus API is very simple. It basically involves registering
handlers, unregistering handlers and sending and publishing messages.</p> <p>First some theory:</p> <h2 id="the-theory"><a href="#the-theory" class="header-anchor">#</a> The Theory</h2> <h3 id="addressing"><a href="#addressing" class="header-anchor">#</a> Addressing</h3> <p>Messages are sent on the event bus to an <strong>address</strong>.</p> <p>Vert.x doesn’t bother with any fancy addressing schemes. In Vert.x an
address is simply a string. Any string is valid. However it is wise to
use some kind of scheme, <em>e.g.</em> using periods to demarcate a namespace.</p> <p>Some examples of valid addresses are europe.news.feed1,
acme.games.pacman, sausages, and X.</p> <h3 id="handlers"><a href="#handlers" class="header-anchor">#</a> Handlers</h3> <p>Messages are received by handlers. You register a handler at an address.</p> <p>Many different handlers can be registered at the same address.</p> <p>A single handler can be registered at many different addresses.</p> <h3 id="publish-subscribe-messaging"><a href="#publish-subscribe-messaging" class="header-anchor">#</a> Publish / subscribe messaging</h3> <p>The event bus supports <strong>publishing</strong> messages.</p> <p>Messages are published to an address. Publishing means delivering the
message to all handlers that are registered at that address.</p> <p>This is the familiar <strong>publish/subscribe</strong> messaging pattern.</p> <h3 id="point-to-point-and-request-response-messaging"><a href="#point-to-point-and-request-response-messaging" class="header-anchor">#</a> Point-to-point and Request-Response messaging</h3> <p>The event bus also supports <strong>point-to-point</strong> messaging.</p> <p>Messages are sent to an address. Vert.x will then route them to just one
of the handlers registered at that address.</p> <p>If there is more than one handler registered at the address, one will be
chosen using a non-strict round-robin algorithm.</p> <p>With point-to-point messaging, an optional reply handler can be
specified when sending the message.</p> <p>When a message is received by a recipient, and has been handled, the
recipient can optionally decide to reply to the message. If they do so,
the reply handler will be called.</p> <p>When the reply is received back by the sender, it too can be replied to.
This can be repeated <em>ad infinitum</em>, and allows a dialog to be set up
between two different verticles.</p> <p>This is a common messaging pattern called the <strong>request-response</strong>
pattern.</p> <h3 id="best-effort-delivery"><a href="#best-effort-delivery" class="header-anchor">#</a> Best-effort delivery</h3> <p>Vert.x does its best to deliver messages and won’t consciously throw
them away. This is called <strong>best-effort</strong> delivery.</p> <p>However, in case of failure of all or parts of the event bus, there is a
possibility messages might be lost.</p> <p>If your application cares about lost messages, you should code your
handlers to be idempotent, and your senders to retry after recovery.</p> <h3 id="types-of-messages"><a href="#types-of-messages" class="header-anchor">#</a> Types of messages</h3> <p>Out of the box Vert.x allows any primitive/simple type, String, or
<code>buffers</code> to be sent as messages.</p> <p>However it’s a convention and common practice in Vert.x to send messages
as <a href="http://json.org/" target="_blank" rel="noopener noreferrer">JSON<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>JSON is very easy to create, read and parse in all the languages that
Vert.x supports so it has become a kind of <em>lingua franca</em> for Vert.x.</p> <p>However you are not forced to use JSON if you don’t want to.</p> <p>The event bus is very flexible and also supports sending arbitrary
objects over the event bus. You can do this by defining a <code>codec</code> for
the objects you want to send.</p> <h2 id="the-event-bus-api"><a href="#the-event-bus-api" class="header-anchor">#</a> The Event Bus API</h2> <p>Let’s jump into the API.</p> <h3 id="getting-the-event-bus"><a href="#getting-the-event-bus" class="header-anchor">#</a> Getting the event bus</h3> <p>You get a reference to the event bus as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>There is a single instance of the event bus per Vert.x instance.</p> <h3 id="registering-handlers"><a href="#registering-handlers" class="header-anchor">#</a> Registering Handlers</h3> <p>This simplest way to register a handler is using <code>consumer</code>. Here’s an
example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eb<span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;news.uk.sport&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I have received a message: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When a message arrives for your handler, your handler will be called,
passing in the <code>message</code>.</p> <p>The object returned from call to consumer() is an instance of
<code>MessageConsumer</code>.</p> <p>This object can subsequently be used to unregister the handler, or use
the handler as a stream.</p> <p>Alternatively you can use <code>consumer</code> to return a MessageConsumer with no
handler set, and then set the handler on that. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> eb <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> consumer <span class="token operator">=</span> eb<span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;news.uk.sport&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I have received a message: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When registering a handler on a clustered event bus, it can take some
time for the registration to reach all nodes of the cluster.</p> <p>If you want to be notified when this has completed, you can register a
<code>completion handler</code> on the MessageConsumer object.</p> <div class="language-js extra-class"><pre class="language-js"><code>consumer<span class="token punctuation">.</span><span class="token function">completionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The handler registration has reached all nodes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Registration failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="un-registering-handlers"><a href="#un-registering-handlers" class="header-anchor">#</a> Un-registering Handlers</h3> <p>To unregister a handler, call <code>unregister</code>.</p> <p>If you are on a clustered event bus, un-registering can take some time
to propagate across the nodes. If you want to be notified when this is
complete, use <code>unregister</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>consumer<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The handler un-registration has reached all nodes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Un-registration failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="publishing-messages"><a href="#publishing-messages" class="header-anchor">#</a> Publishing messages</h3> <p>Publishing a message is simple. Just use <code>publish</code> specifying the
address to publish it to.</p> <div class="language-js extra-class"><pre class="language-js"><code>eventBus<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;news.uk.sport&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Yay! Someone kicked a ball&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>That message will then be delivered to all handlers registered against
the address news.uk.sport.</p> <h3 id="sending-messages"><a href="#sending-messages" class="header-anchor">#</a> Sending messages</h3> <p>Sending a message will result in only one handler registered at the
address receiving the message. This is the point-to-point messaging
pattern. The handler is chosen in a non-strict round-robin fashion.</p> <p>You can send a message with <code>send</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>eventBus<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;news.uk.sport&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Yay! Someone kicked a ball&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="setting-headers-on-messages"><a href="#setting-headers-on-messages" class="header-anchor">#</a> Setting headers on messages</h3> <p>Messages sent over the event bus can also contain headers. This can be
specified by providing a {@link io.vertx.core.eventbus.DeliveryOptions}
when sending or publishing:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link docoverride.eventbus.Examples#headers(io.vertx.core.eventbus.EventBus)}
</code></pre></div><h3 id="message-ordering"><a href="#message-ordering" class="header-anchor">#</a> Message ordering</h3> <p>Vert.x will deliver messages to any particular handler in the same order
they were sent from any particular sender.</p> <h3 id="the-message-object"><a href="#the-message-object" class="header-anchor">#</a> The Message object</h3> <p>The object you receive in a message handler is a <code>Message</code>.</p> <p>The <code>body</code> of the message corresponds to the object that was sent or
published.</p> <p>The headers of the message are available with <code>headers</code>.</p> <h3 id="acknowledging-messages-sending-replies"><a href="#acknowledging-messages-sending-replies" class="header-anchor">#</a> Acknowledging messages / sending replies</h3> <p>When using <code>send</code> the event bus attempts to deliver the message to a
<code>MessageConsumer</code> registered with the event bus.</p> <p>In some cases it’s useful for the sender to know when the consumer has
received the message and &quot;processed&quot; it using <strong>request-response</strong>
pattern.</p> <p>To acknowledge that the message has been processed, the consumer can
reply to the message by calling <code>reply</code>.</p> <p>When this happens it causes a reply to be sent back to the sender and
the reply handler is invoked with the reply.</p> <p>An example will make this clear:</p> <p>The receiver:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> consumer <span class="token operator">=</span> eventBus<span class="token punctuation">.</span><span class="token function">consumer</span><span class="token punctuation">(</span><span class="token string">&quot;news.uk.sport&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I have received a message: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  message<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;how interesting!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The sender:</p> <div class="language-js extra-class"><pre class="language-js"><code>eventBus<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&quot;news.uk.sport&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Yay! Someone kicked a ball across a patch of grass&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received reply: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The reply can contain a message body which can contain useful
information.</p> <p>What the &quot;processing&quot; actually means is application-defined and depends
entirely on what the message consumer does and is not something that the
Vert.x event bus itself knows or cares about.</p> <p>Some examples:</p> <ul><li><p>A simple message consumer which implements a service which returns
the time of the day would acknowledge with a message containing the
time of day in the reply body</p></li> <li><p>A message consumer which implements a persistent queue, might
acknowledge with <code>true</code> if the message was successfully persisted in
storage, or <code>false</code> if not.</p></li> <li><p>A message consumer which processes an order might acknowledge with
<code>true</code> when the order has been successfully processed so it can be
deleted from the database</p></li></ul> <h3 id="sending-with-timeouts"><a href="#sending-with-timeouts" class="header-anchor">#</a> Sending with timeouts</h3> <p>When sending a message with a reply handler, you can specify a timeout
in the <code>DeliveryOptions</code>.</p> <p>If a reply is not received within that time, the reply handler will be
called with a failure.</p> <p>The default timeout is 30 seconds.</p> <h3 id="send-failures"><a href="#send-failures" class="header-anchor">#</a> Send Failures</h3> <p>Message sends can fail for other reasons, including:</p> <ul><li><p>There are no handlers available to send the message to</p></li> <li><p>The recipient has explicitly failed the message using <code>fail</code></p></li></ul> <p>In all cases, the reply handler will be called with the specific
failure.</p> <h3 id="message-codecs"><a href="#message-codecs" class="header-anchor">#</a> Message Codecs</h3> <p>You can send any object you like across the event bus if you define and
register a {@link io.vertx.core.eventbus.MessageCodec message codec} for
it.</p> <p>Message codecs have a name and you specify that name in the {@link
io.vertx.core.eventbus.DeliveryOptions} when sending or publishing the
message:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>eventbus<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example10<span class="token punctuation">}</span>
</code></pre></div><p>If you always want the same codec to be used for a particular type then
you can register a default codec for it, then you don’t have to specify
the codec on each send in the delivery options:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>eventbus<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example11<span class="token punctuation">}</span>
</code></pre></div><p>You unregister a message codec with {@link
io.vertx.core.eventbus.EventBus#unregisterCodec}.</p> <p>Message codecs don’t always have to encode and decode as the same type.
For example you can write a codec that allows a MyPOJO class to be sent,
but when that message is sent to a handler it arrives as a MyOtherPOJO
class.</p> <h3 id="clustered-event-bus"><a href="#clustered-event-bus" class="header-anchor">#</a> Clustered Event Bus</h3> <p>The event bus doesn’t just exist in a single Vert.x instance. By
clustering different Vert.x instances together on your network they can
form a single, distributed event bus.</p> <h3 id="clustering-programmatically"><a href="#clustering-programmatically" class="header-anchor">#</a> Clustering programmatically</h3> <p>If you’re creating your Vert.x instance programmatically you get a
clustered event bus by configuring the Vert.x instance as clustered;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Vertx <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VertxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vertx<span class="token punctuation">.</span><span class="token function">clusteredVertx</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> vertx <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> eventBus <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">eventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;We now have a clustered event bus: &quot;</span> <span class="token operator">+</span> eventBus<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You should also make sure you have a <code>ClusterManager</code> implementation on
your classpath, for example the Hazelcast cluster manager.</p> <h3 id="clustering-on-the-command-line"><a href="#clustering-on-the-command-line" class="header-anchor">#</a> Clustering on the command line</h3> <p>You can run Vert.x clustered on the command line with</p> <div class="language- extra-class"><pre><code>vertx run my-verticle.js -cluster
</code></pre></div><h2 id="automatic-clean-up-in-verticles-2"><a href="#automatic-clean-up-in-verticles-2" class="header-anchor">#</a> Automatic clean-up in verticles</h2> <p>If you’re registering event bus handlers from inside verticles, those
handlers will be automatically unregistered when the verticle is
undeployed.</p> <h1 id="configuring-the-event-bus"><a href="#configuring-the-event-bus" class="header-anchor">#</a> Configuring the event bus</h1> <p>The event bus can be configured. It is particularly useful when the
event bus is clustered. Under the hood the event bus uses TCP
connections to send and receive messages, so the {@link
io.vertx.core.eventbus.EventBusOptions} let you configure all aspects of
these TCP connections. As the event bus acts as a server and client, the
configuration is close to {@link io.vertx.core.net.NetClientOptions} and
{@link io.vertx.core.net.NetServerOptions}.</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.EventBusExamples#example13}
</code></pre></div><p>The previous snippet depicts how you can use SSL connections for the
event bus, instead of plain TCP connections.</p> <p><strong>WARNING</strong>: to enforce the security in clustered mode, you <strong>must</strong>
configure the cluster manager to use encryption or enforce security.
Refer to the documentation of the cluster manager for further details.</p> <p>The event bus configuration needs to be consistent in all the cluster
nodes.</p> <p>The {@link io.vertx.core.eventbus.EventBusOptions} also lets you specify
whether or not the event bus is clustered, the port and host.</p> <p>When used in containers, you can also configure the public host and
port:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.EventBusExamples#example14}
</code></pre></div><h1 id="json"><a href="#json" class="header-anchor">#</a> JSON</h1> <p>Unlike some other languages, Java does not have first class support for
<a href="http://json.org/" target="_blank" rel="noopener noreferrer">JSON<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> so we provide two classes to make handling JSON
in your Vert.x applications a bit easier.</p> <h2 id="json-objects"><a href="#json-objects" class="header-anchor">#</a> JSON objects</h2> <p>The {@link io.vertx.core.json.JsonObject} class represents JSON objects.</p> <p>A JSON object is basically just a map which has string keys and values
can be of one of the JSON supported types (string, number, boolean).</p> <p>JSON objects also support null values.</p> <h3 id="creating-json-objects"><a href="#creating-json-objects" class="header-anchor">#</a> Creating JSON objects</h3> <p>Empty JSON objects can be created with the default constructor.</p> <p>You can create a JSON object from a string JSON representation as
follows:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example0_1<span class="token punctuation">}</span>
</code></pre></div><p>You can create a JSON object from a map as follows:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#exampleCreateFromMap<span class="token punctuation">}</span>
</code></pre></div><h3 id="putting-entries-into-a-json-object"><a href="#putting-entries-into-a-json-object" class="header-anchor">#</a> Putting entries into a JSON object</h3> <p>Use the {@link io.vertx.core.json.JsonObject#put} methods to put values
into the JSON object.</p> <p>The method invocations can be chained because of the fluent API:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example1<span class="token punctuation">}</span>
</code></pre></div><h3 id="getting-values-from-a-json-object"><a href="#getting-values-from-a-json-object" class="header-anchor">#</a> Getting values from a JSON object</h3> <p>You get values from a JSON object using the <code>getXXX</code> methods, for
example:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example2<span class="token punctuation">}</span>
</code></pre></div><h3 id="mapping-between-json-objects-and-java-objects"><a href="#mapping-between-json-objects-and-java-objects" class="header-anchor">#</a> Mapping between JSON objects and Java objects</h3> <p>You can create a JSON object from the fields of a Java object as
follows:</p> <p>You can instantiate a Java object and populate its fields from a JSON
object as follows:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#mapToPojo<span class="token punctuation">}</span>
</code></pre></div><p>Note that both of the above mapping directions use Jackson’s
<code>ObjectMapper#convertValue()</code> to perform the mapping. See the Jackson
documentation for information on the impact of field and constructor
visibility, caveats on serialization and deserialization across object
references, etc.</p> <p>However, in the simplest case, both <code>mapFrom</code> and <code>mapTo</code> should succeed
if all fields of the Java class are public (or have public
getters/setters), and if there is a public default constructor (or no
defined constructors).</p> <p>Referenced objects will be transitively serialized/deserialized to/from
nested JSON objects as long as the object graph is acyclic.</p> <h3 id="encoding-a-json-object-to-a-string"><a href="#encoding-a-json-object-to-a-string" class="header-anchor">#</a> Encoding a JSON object to a String</h3> <p>You use {@link io.vertx.core.json.JsonObject#encode} to encode the
object to a String form.</p> <h2 id="json-arrays"><a href="#json-arrays" class="header-anchor">#</a> JSON arrays</h2> <p>The {@link io.vertx.core.json.JsonArray} class represents JSON arrays.</p> <p>A JSON array is a sequence of values (string, number, boolean).</p> <p>JSON arrays can also contain null values.</p> <h3 id="creating-json-arrays"><a href="#creating-json-arrays" class="header-anchor">#</a> Creating JSON arrays</h3> <p>Empty JSON arrays can be created with the default constructor.</p> <p>You can create a JSON array from a string JSON representation as
follows:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example0_2<span class="token punctuation">}</span>
</code></pre></div><h3 id="adding-entries-into-a-json-array"><a href="#adding-entries-into-a-json-array" class="header-anchor">#</a> Adding entries into a JSON array</h3> <p>You add entries to a JSON array using the {@link
io.vertx.core.json.JsonArray#add} methods.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example3<span class="token punctuation">}</span>
</code></pre></div><h3 id="getting-values-from-a-json-array"><a href="#getting-values-from-a-json-array" class="header-anchor">#</a> Getting values from a JSON array</h3> <p>You get values from a JSON array using the <code>getXXX</code> methods, for
example:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example4<span class="token punctuation">}</span>
</code></pre></div><h3 id="encoding-a-json-array-to-a-string"><a href="#encoding-a-json-array-to-a-string" class="header-anchor">#</a> Encoding a JSON array to a String</h3> <p>You use {@link io.vertx.core.json.JsonArray#encode} to encode the array
to a String form.</p> <h3 id="creating-arbitrary-json"><a href="#creating-arbitrary-json" class="header-anchor">#</a> Creating arbitrary JSON</h3> <p>Creating JSON object and array assumes you are using valid string
representation.</p> <p>When you are unsure of the string validity then you should use instead
<code>{@link io.vertx.core.json.Json#decodeValue(java.lang.String)}</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example5<span class="token punctuation">}</span>
</code></pre></div><h1 id="json-pointers"><a href="#json-pointers" class="header-anchor">#</a> Json Pointers</h1> <p>Vert.x provides an implementation of <a href="https://tools.ietf.org/html/rfc6901" target="_blank" rel="noopener noreferrer">Json Pointers from
RFC6901<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. You can use pointers both
for querying and for writing. You can build your <code>JsonPointer</code> using a
string, a URI or manually appending paths:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token class-name">JsonPointer</span> <span class="token punctuation">}</span> from <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// Build a pointer from a string</span>
let pointer1 <span class="token operator">=</span> <span class="token class-name">JsonPointer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;/hello/world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Build a pointer manually</span>
let pointer2 <span class="token operator">=</span> <span class="token class-name">JsonPointer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>After instantiating your pointer, use <code>queryJson</code> to query a JSON value.
You can update a Json Value using <code>writeJson</code>:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Query a JsonObject</span>
let result1 <span class="token operator">=</span> objectPointer<span class="token punctuation">.</span><span class="token function">queryJson</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Query a JsonArray</span>
let result2 <span class="token operator">=</span> arrayPointer<span class="token punctuation">.</span><span class="token function">queryJson</span><span class="token punctuation">(</span>jsonArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Write starting from a JsonObject</span>
objectPointer<span class="token punctuation">.</span><span class="token function">writeJson</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">,</span> <span class="token string">&quot;new element&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Write starting from a JsonObject</span>
arrayPointer<span class="token punctuation">.</span><span class="token function">writeJson</span><span class="token punctuation">(</span>jsonArray<span class="token punctuation">,</span> <span class="token string">&quot;new element&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can use Vert.x Json Pointer with any object model by providing a
custom implementation of <code>JsonPointerIterator</code></p> <h1 id="buffers"><a href="#buffers" class="header-anchor">#</a> Buffers</h1> <p>Most data is shuffled around inside Vert.x using buffers.</p> <p>A buffer is a sequence of zero or more bytes that can read from or
written to and which expands automatically as necessary to accommodate
any bytes written to it. You can perhaps think of a buffer as smart byte
array.</p> <h2 id="creating-buffers"><a href="#creating-buffers" class="header-anchor">#</a> Creating buffers</h2> <p>Buffers can create by using one of the static <code>Buffer.buffer</code> methods.</p> <p>Buffers can be initialised from strings or byte arrays, or empty buffers
can be created.</p> <p>Here are some examples of creating buffers:</p> <p>Create a new empty buffer:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Create a buffer from a String. The String will be encoded in the buffer
using UTF-8.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;some string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Create a buffer from a String: The String will be encoded using the
specified encoding, e.g:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;some string&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Create a buffer from a byte[]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example4<span class="token punctuation">}</span>
</code></pre></div><p>Create a buffer with an initial size hint. If you know your buffer will
have a certain amount of data written to it you can create the buffer
and specify this size. This makes the buffer initially allocate that
much memory and is more efficient than the buffer automatically resizing
multiple times as data is written to it.</p> <p>Note that buffers created this way <strong>are empty</strong>. It does not create a
buffer filled with zeros up to the specified size.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="writing-to-a-buffer"><a href="#writing-to-a-buffer" class="header-anchor">#</a> Writing to a Buffer</h2> <p>There are two ways to write to a buffer: appending, and random access.
In either case buffers will always expand automatically to encompass the
bytes. It’s not possible to get an <code>IndexOutOfBoundsException</code> with a
buffer.</p> <h3 id="appending-to-a-buffer"><a href="#appending-to-a-buffer" class="header-anchor">#</a> Appending to a Buffer</h3> <p>To append to a buffer, you use the <code>appendXXX</code> methods. Append methods
exist for appending various different types.</p> <p>The return value of the <code>appendXXX</code> methods is the buffer itself, so
these can be chained:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

buff<span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendString</span><span class="token punctuation">(</span><span class="token string">&quot;hello\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="random-access-buffer-writes"><a href="#random-access-buffer-writes" class="header-anchor">#</a> Random access buffer writes</h3> <p>You can also write into the buffer at a specific index, by using the
<code>setXXX</code> methods. Set methods exist for various different data types.
All the set methods take an index as the first argument - this
represents the position in the buffer where to start writing the data.</p> <p>The buffer will always expand as necessary to accommodate the data.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

buff<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buff<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="reading-from-a-buffer"><a href="#reading-from-a-buffer" class="header-anchor">#</a> Reading from a Buffer</h2> <p>Data is read from a buffer using the <code>getXXX</code> methods. Get methods exist
for various datatypes. The first argument to these methods is an index
in the buffer from where to get the data.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buff<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;int value at &quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot; is &quot;</span> <span class="token operator">+</span> buff<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="working-with-unsigned-numbers"><a href="#working-with-unsigned-numbers" class="header-anchor">#</a> Working with unsigned numbers</h2> <p>Unsigned numbers can be read from or appended/set to a buffer with the
<code>getUnsignedXXX</code>, <code>appendUnsignedXXX</code> and <code>setUnsignedXXX</code> methods. This
is useful when implementing a codec for a network protocol optimized to
minimize bandwidth consumption.</p> <p>In the following example, value 200 is set at specified position with
just one byte:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pos <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
buff<span class="token punctuation">.</span><span class="token function">setUnsignedByte</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buff<span class="token punctuation">.</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The console shows '200'.</p> <h2 id="buffer-length"><a href="#buffer-length" class="header-anchor">#</a> Buffer length</h2> <p>Use <code>length</code> to obtain the length of the buffer. The length of a buffer
is the index of the byte in the buffer with the largest index + 1.</p> <h2 id="copying-buffers"><a href="#copying-buffers" class="header-anchor">#</a> Copying buffers</h2> <p>Use <code>copy</code> to make a copy of the buffer</p> <h2 id="slicing-buffers"><a href="#slicing-buffers" class="header-anchor">#</a> Slicing buffers</h2> <p>A sliced buffer is a new buffer which backs onto the original buffer,
i.e. it does not copy the underlying data. Use <code>slice</code> to create a
sliced buffers</p> <h2 id="buffer-re-use"><a href="#buffer-re-use" class="header-anchor">#</a> Buffer re-use</h2> <p>After writing a buffer to a socket or other similar place, they cannot
be re-used.</p> <h1 id="writing-tcp-servers-and-clients"><a href="#writing-tcp-servers-and-clients" class="header-anchor">#</a> Writing TCP servers and clients</h1> <p>Vert.x allows you to easily write non blocking TCP clients and servers.</p> <h2 id="creating-a-tcp-server"><a href="#creating-a-tcp-server" class="header-anchor">#</a> Creating a TCP server</h2> <p>The simplest way to create a TCP server, using all default options is as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-a-tcp-server"><a href="#configuring-a-tcp-server" class="header-anchor">#</a> Configuring a TCP server</h2> <p>If you don’t want the default, a server can be configured by passing in
a <code>NetServerOptions</code> instance when creating it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">4321</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="start-the-server-listening"><a href="#start-the-server-listening" class="header-anchor">#</a> Start the Server Listening</h2> <p>To tell the server to listen for incoming requests you use one of the
<code>listen</code> alternatives.</p> <p>To tell the server to listen at the host and port as specified in the
options:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or to specify the host and port in the call to listen, ignoring what is
configured in the options:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The default host is <code>0.0.0.0</code> which means 'listen on all available
addresses' and the default port is <code>0</code>, which is a special value that
instructs the server to find a random unused local port and use that.</p> <p>The actual bind is asynchronous so the server might not actually be
listening until some time <strong>after</strong> the call to listen has returned.</p> <p>If you want to be notified when the server is actually listening you can
provide a handler to the <code>listen</code> call. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server is now listening!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to bind!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="listening-on-a-random-port"><a href="#listening-on-a-random-port" class="header-anchor">#</a> Listening on a random port</h2> <p>If <code>0</code> is used as the listening port, the server will find an unused
random port to listen on.</p> <p>To find out the real port the server is listening on you can call
<code>actualPort</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server is now listening on actual port: &quot;</span> <span class="token operator">+</span> server<span class="token punctuation">.</span><span class="token function">actualPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to bind!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="getting-notified-of-incoming-connections"><a href="#getting-notified-of-incoming-connections" class="header-anchor">#</a> Getting notified of incoming connections</h2> <p>To be notified when a connection is made you need to set a
<code>connectHandler</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handle the connection in here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When a connection is made the handler will be called with an instance of
<code>NetSocket</code>.</p> <p>This is a socket-like interface to the actual connection, and allows you
to read and write data as well as do various other things like close the
socket.</p> <h2 id="reading-data-from-the-socket"><a href="#reading-data-from-the-socket" class="header-anchor">#</a> Reading data from the socket</h2> <p>To read data from the socket you set the <code>handler</code> on the socket.</p> <p>This handler will be called with an instance of <code>Buffer</code> every time data
is received on the socket.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I received some bytes: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="writing-data-to-a-socket"><a href="#writing-data-to-a-socket" class="header-anchor">#</a> Writing data to a socket</h2> <p>You write to a socket using one of <code>write</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Write a buffer</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendFloat</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write a string in UTF-8 encoding</span>
socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write a string using the specified encoding</span>
socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Write operations are asynchronous and may not occur until some time
after the call to write has returned.</p> <h2 id="closed-handler"><a href="#closed-handler" class="header-anchor">#</a> Closed handler</h2> <p>If you want to be notified when a socket is closed, you can set a
<code>closeHandler</code> on it:</p> <div class="language-js extra-class"><pre class="language-js"><code>socket<span class="token punctuation">.</span><span class="token function">closeHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The socket has been closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-exceptions"><a href="#handling-exceptions" class="header-anchor">#</a> Handling exceptions</h2> <p>You can set an <code>exceptionHandler</code> to receive any exceptions that happen
on the socket.</p> <p>You can set an <code>exceptionHandler</code> to receive any exceptions that happens
before the connection is passed to the <code>connectHandler</code> , e.g during the
TLS handshake.</p> <h2 id="event-bus-write-handler"><a href="#event-bus-write-handler" class="header-anchor">#</a> Event bus write handler</h2> <p>Every socket automatically registers a handler on the event bus, and
when any buffers are received in this handler, it writes them to itself.
Those are local subscriptions not routed on the cluster.</p> <p>This enables you to write data to a socket which is potentially in a
completely different verticle by sending the buffer to the address of
that handler.</p> <p>The address of the handler is given by <code>writeHandlerID</code></p> <h2 id="local-and-remote-addresses"><a href="#local-and-remote-addresses" class="header-anchor">#</a> Local and remote addresses</h2> <p>The local address of a <code>NetSocket</code> can be retrieved using
<code>localAddress</code>.</p> <p>The remote address, (i.e. the address of the other end of the
connection) of a <code>NetSocket</code> can be retrieved using <code>remoteAddress</code>.</p> <h2 id="sending-files-or-resources-from-the-classpath"><a href="#sending-files-or-resources-from-the-classpath" class="header-anchor">#</a> Sending files or resources from the classpath</h2> <p>Files and classpath resources can be written to the socket directly
using <code>sendFile</code>. This can be a very efficient way to send files, as it
can be handled by the OS kernel directly where supported by the
operating system.</p> <p>Please see the chapter about <a href="#classpath">serving files from the
classpath</a> for restrictions of the classpath resolution or
disabling it.</p> <div class="language-js extra-class"><pre class="language-js"><code>socket<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;myfile.dat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="streaming-sockets"><a href="#streaming-sockets" class="header-anchor">#</a> Streaming sockets</h2> <p>Instances of <code>NetSocket</code> are also <code>ReadStream</code> and <code>WriteStream</code>
instances so they can be used to pipe data to or from other read and
write streams.</p> <p>See the chapter on <a href="#streams">streams</a> for more information.</p> <h2 id="upgrading-connections-to-ssl-tls"><a href="#upgrading-connections-to-ssl-tls" class="header-anchor">#</a> Upgrading connections to SSL/TLS</h2> <p>A non SSL/TLS connection can be upgraded to SSL/TLS using
<code>upgradeToSsl</code>.</p> <p>The server or client must be configured for SSL/TLS for this to work
correctly. Please see the <a href="#ssl">chapter on SSL/TLS</a> for more
information.</p> <h2 id="closing-a-tcp-server"><a href="#closing-a-tcp-server" class="header-anchor">#</a> Closing a TCP Server</h2> <p>Call <code>close</code> to close the server. Closing the server closes any open
connections and releases all server resources.</p> <p>The close is actually asynchronous and might not complete until some
time after the call has returned. If you want to be notified when the
actual close has completed then you can pass in a handler.</p> <p>This handler will then be called when the close has fully completed.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server is now closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;close failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="automatic-clean-up-in-verticles-3"><a href="#automatic-clean-up-in-verticles-3" class="header-anchor">#</a> Automatic clean-up in verticles</h2> <p>If you’re creating TCP servers and clients from inside verticles, those
servers and clients will be automatically closed when the verticle is
undeployed.</p> <h2 id="scaling-sharing-tcp-servers"><a href="#scaling-sharing-tcp-servers" class="header-anchor">#</a> Scaling - sharing TCP servers</h2> <p>The handlers of any TCP server are always executed on the same event
loop thread.</p> <p>This means that if you are running on a server with a lot of cores, and
you only have this one instance deployed then you will have at most one
core utilised on your server.</p> <p>In order to utilise more cores of your server you will need to deploy
more instances of the server.</p> <p>You can instantiate more instances programmatically in your code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Create a few instances so we can utilise cores</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Just echo back the data</span>
      socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>or, if you are using verticles you can simply deploy more instances of
your server verticle by using the <code>-instances</code> option on the command
line:</p> <p>vertx run com.mycompany.MyVerticle -instances 10</p> <p>or when programmatically deploying your verticle</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInstances</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;com.mycompany.MyVerticle&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Once you do this you will find the echo server works functionally
identically to before, but all your cores on your server can be utilised
and more work can be handled.</p> <p>At this point you might be asking yourself <strong>'How can you have more than
one server listening on the same host and port? Surely you will get port
conflicts as soon as you try and deploy more than one instance?'</strong></p> <p><em>Vert.x does a little magic here.*</em></p> <p>When you deploy another server on the same host and port as an existing
server it doesn’t actually try and create a new server listening on the
same host/port.</p> <p>Instead it internally maintains just a single server, and, as incoming
connections arrive it distributes them in a round-robin fashion to any
of the connect handlers.</p> <p>Consequently Vert.x TCP servers can scale over available cores while
each instance remains single threaded.</p> <h2 id="creating-a-tcp-client"><a href="#creating-a-tcp-client" class="header-anchor">#</a> Creating a TCP client</h2> <p>The simplest way to create a TCP client, using all default options is as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-a-tcp-client"><a href="#configuring-a-tcp-client" class="header-anchor">#</a> Configuring a TCP client</h2> <p>If you don’t want the default, a client can be configured by passing in
a <code>NetClientOptions</code> instance when creating it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="making-connections"><a href="#making-connections" class="header-anchor">#</a> Making connections</h2> <p>To make a connection to a server you use <code>connect</code>, specifying the port
and host of the server and a handler that will be called with a result
containing the <code>NetSocket</code> when connection is successful or with a
failure if connection failed.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token number">4321</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> socket <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to connect: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-connection-attempts"><a href="#configuring-connection-attempts" class="header-anchor">#</a> Configuring connection attempts</h2> <p>A client can be configured to automatically retry connecting to the
server in the event that it cannot connect. This is configured with
<code>setReconnectInterval</code> and <code>setReconnectAttempts</code>.</p> <blockquote><p><strong>Note</strong></p> <p>Currently Vert.x will not attempt to reconnect if a connection fails,
reconnect attempts and interval only apply to creating initial
connections.</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setReconnectAttempts</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setReconnectInterval</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default, multiple connection attempts are disabled.</p> <h2 id="logging-network-activity"><a href="#logging-network-activity" class="header-anchor">#</a> Logging network activity</h2> <p>For debugging purposes, network activity can be logged:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLogActivity</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>for the client</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLogActivity</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Network activity is logged by Netty with the <code>DEBUG</code> level and with the
<code>io.netty.handler.logging.LoggingHandler</code> name. When using network
activity logging there are a few things to keep in mind:</p> <ul><li><p>logging is not performed by Vert.x logging but by Netty</p></li> <li><p>this is <strong>not</strong> a production feature</p></li></ul> <p>You should read the <a href="#netty-logging">Netty logging</a> section.</p> <h2 id="configuring-servers-and-clients-to-work-with-ssl-tls"><a href="#configuring-servers-and-clients-to-work-with-ssl-tls" class="header-anchor">#</a> Configuring servers and clients to work with SSL/TLS</h2> <p>TCP clients and servers can be configured to use <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener noreferrer">Transport Layer
Security<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -
earlier versions of TLS were known as SSL.</p> <p>The APIs of the servers and clients are identical whether or not SSL/TLS
is used, and it’s enabled by configuring the <code>NetClientOptions</code> or
<code>NetServerOptions</code> instances used to create the servers or clients.</p> <h3 id="enabling-ssl-tls-on-the-server"><a href="#enabling-ssl-tls-on-the-server" class="header-anchor">#</a> Enabling SSL/TLS on the server</h3> <p>SSL/TLS is enabled with <code>ssl</code>.</p> <p>By default it is disabled.</p> <h3 id="specifying-key-certificate-for-the-server"><a href="#specifying-key-certificate-for-the-server" class="header-anchor">#</a> Specifying key/certificate for the server</h3> <p>SSL/TLS servers usually provide certificates to clients in order verify
their identity to clients.</p> <p>Certificates/keys can be configured for servers in several ways:</p> <p>The first method is by specifying the location of a Java key-store which
contains the certificate and private key.</p> <p>Java key stores can be managed with the
<a href="http://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html" target="_blank" rel="noopener noreferrer">keytool<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
utility which ships with the JDK.</p> <p>The password for the key store should also be provided:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-keystore.jks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternatively you can read the key store yourself as a buffer and
provide that directly:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myKeyStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-keystore.jks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> jksOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>myKeyStoreAsABuffer<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>jksOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Key/certificate in PKCS#12 format
(<a href="http://en.wikipedia.org/wiki/PKCS_12" target="_blank" rel="noopener noreferrer">http://en.wikipedia.org/wiki/PKCS_12<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>), usually with the <code>.pfx</code> or the
<code>.p12</code> extension can also be loaded in a similar fashion than JKS key
stores:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPfxKeyCertOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PfxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-keystore.pfx&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myKeyStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-keystore.pfx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pfxOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PfxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>myKeyStoreAsABuffer<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPfxKeyCertOptions</span><span class="token punctuation">(</span>pfxOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Another way of providing server private key and certificate separately
using <code>.pem</code> files.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemKeyCertOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setKeyPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-key.pem&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setCertPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myKeyAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-key.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> myCertAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pemOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyValue</span><span class="token punctuation">(</span>myKeyAsABuffer<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCertValue</span><span class="token punctuation">(</span>myCertAsABuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemKeyCertOptions</span><span class="token punctuation">(</span>pemOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Vert.x supports reading of unencrypted RSA and/or ECC based private keys
from PKCS8 PEM files. RSA based private keys can also be read from PKCS1
PEM files. X.509 certificates can be read from PEM files containing a
textual encoding of the certificate as defined by <a href="https://tools.ietf.org/html/rfc7468#section-5" target="_blank" rel="noopener noreferrer">RFC 7468,
Section 5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <blockquote><p><strong>Warning</strong></p> <p>Keep in mind that the keys contained in an unencrypted PKCS8 or a
PKCS1 PEM file can be extracted by anybody who can read the file.
Thus, make sure to put proper access restrictions on such PEM files in
order to prevent misuse.</p></blockquote> <h3 id="specifying-trust-for-the-server"><a href="#specifying-trust-for-the-server" class="header-anchor">#</a> Specifying trust for the server</h3> <p>SSL/TLS servers can use a certificate authority in order to verify the
identity of the clients.</p> <p>Certificate authorities can be configured for servers in several ways:</p> <p>Java trust stores can be managed with the
<a href="http://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html" target="_blank" rel="noopener noreferrer">keytool<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
utility which ships with the JDK.</p> <p>The password for the trust store should also be provided:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientAuth</span><span class="token punctuation">(</span><span class="token string">&quot;REQUIRED&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustStoreOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/truststore.jks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-truststore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternatively you can read the trust store yourself as a buffer and
provide that directly:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myTrustStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/truststore.jks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientAuth</span><span class="token punctuation">(</span><span class="token string">&quot;REQUIRED&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustStoreOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>myTrustStoreAsABuffer<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-truststore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Certificate authority in PKCS#12 format
(<a href="http://en.wikipedia.org/wiki/PKCS_12" target="_blank" rel="noopener noreferrer">http://en.wikipedia.org/wiki/PKCS_12<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>), usually with the <code>.pfx</code> or the
<code>.p12</code> extension can also be loaded in a similar fashion than JKS trust
stores:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientAuth</span><span class="token punctuation">(</span><span class="token string">&quot;REQUIRED&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPfxTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PfxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/truststore.pfx&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-truststore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myTrustStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/truststore.pfx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientAuth</span><span class="token punctuation">(</span><span class="token string">&quot;REQUIRED&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPfxTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PfxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>myTrustStoreAsABuffer<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-truststore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Another way of providing server certificate authority using a list
<code>.pem</code> files.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientAuth</span><span class="token punctuation">(</span><span class="token string">&quot;REQUIRED&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PemTrustOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setCertPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;/path/to/your/server-ca.pem&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myCaAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/server-ca.pfx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientAuth</span><span class="token punctuation">(</span><span class="token string">&quot;REQUIRED&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PemTrustOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setCertValues</span><span class="token punctuation">(</span><span class="token punctuation">[</span>myCaAsABuffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="enabling-ssl-tls-on-the-client"><a href="#enabling-ssl-tls-on-the-client" class="header-anchor">#</a> Enabling SSL/TLS on the client</h3> <p>Net Clients can also be easily configured to use SSL. They have the
exact same API when using SSL as when using standard sockets.</p> <p>To enable SSL on a NetClient the function setSSL(true) is called.</p> <h3 id="client-trust-configuration"><a href="#client-trust-configuration" class="header-anchor">#</a> Client trust configuration</h3> <p>If the <code>trustALl</code> is set to true on the client, then the client will
trust all server certificates. The connection will still be encrypted
but this mode is vulnerable to 'man in the middle' attacks. I.e. you
can’t be sure who you are connecting to. Use this with caution.
Default value is false.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If <code>trustAll</code> is not set then a client trust store must be configured
and should contain the certificates of the servers that the client
trusts.</p> <p>By default, host verification is disabled on the client. To enable host
verification, set the algorithm to use on your client (only HTTPS and
LDAPS is currently supported):</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHostnameVerificationAlgorithm</span><span class="token punctuation">(</span><span class="token string">&quot;HTTPS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Likewise server configuration, the client trust can be configured in
several ways:</p> <p>The first method is by specifying the location of a Java trust-store
which contains the certificate authority.</p> <p>It is just a standard Java key store, the same as the key stores on the
server side. The client trust store location is set by using the
function <code>path</code> on the <code>jks options</code>. If a server presents a certificate
during connection which is not in the client trust store, the connection
attempt will not succeed.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustStoreOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/truststore.jks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-truststore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myTrustStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/truststore.jks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustStoreOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>myTrustStoreAsABuffer<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-truststore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Certificate authority in PKCS#12 format
(<a href="http://en.wikipedia.org/wiki/PKCS_12" target="_blank" rel="noopener noreferrer">http://en.wikipedia.org/wiki/PKCS_12<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>), usually with the <code>.pfx</code> or the
<code>.p12</code> extension can also be loaded in a similar fashion than JKS trust
stores:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPfxTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PfxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/truststore.pfx&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-truststore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myTrustStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/truststore.pfx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPfxTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PfxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>myTrustStoreAsABuffer<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-truststore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Another way of providing server certificate authority using a list
<code>.pem</code> files.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PemTrustOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setCertPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;/path/to/your/ca-cert.pem&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myTrustStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/ca-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PemTrustOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setCertValues</span><span class="token punctuation">(</span><span class="token punctuation">[</span>myTrustStoreAsABuffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="specifying-key-certificate-for-the-client"><a href="#specifying-key-certificate-for-the-client" class="header-anchor">#</a> Specifying key/certificate for the client</h3> <p>If the server requires client authentication then the client must
present its own certificate to the server when connecting. The client
can be configured in several ways:</p> <p>The first method is by specifying the location of a Java key-store which
contains the key and certificate. Again it’s just a regular Java key
store. The client keystore location is set by using the function <code>path</code>
on the <code>jks options</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/client-keystore.jks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myKeyStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/client-keystore.jks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> jksOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>myKeyStoreAsABuffer<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>jksOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Key/certificate in PKCS#12 format
(<a href="http://en.wikipedia.org/wiki/PKCS_12" target="_blank" rel="noopener noreferrer">http://en.wikipedia.org/wiki/PKCS_12<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>), usually with the <code>.pfx</code> or the
<code>.p12</code> extension can also be loaded in a similar fashion than JKS key
stores:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPfxKeyCertOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PfxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/client-keystore.pfx&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myKeyStoreAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/client-keystore.pfx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pfxOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PfxOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>myKeyStoreAsABuffer<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password-of-your-keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPfxKeyCertOptions</span><span class="token punctuation">(</span>pfxOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Another way of providing server private key and certificate separately
using <code>.pem</code> files.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemKeyCertOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setKeyPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/client-key.pem&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setCertPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/client-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myKeyAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/client-key.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> myCertAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/client-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pemOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyValue</span><span class="token punctuation">(</span>myKeyAsABuffer<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCertValue</span><span class="token punctuation">(</span>myCertAsABuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemKeyCertOptions</span><span class="token punctuation">(</span>pemOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Keep in mind that pem configuration, the private key is not crypted.</p> <h3 id="self-signed-certificates-for-testing-and-development-purposes"><a href="#self-signed-certificates-for-testing-and-development-purposes" class="header-anchor">#</a> Self-signed certificates for testing and development purposes</h3> <blockquote><p><strong>Caution</strong></p> <p>Do not use this in production settings, and note that the generated
keys are very insecure.</p></blockquote> <p>It is very often the case that self-signed certificates are required, be
it for unit / integration tests or for running a development version of
an application.</p> <p><code>SelfSignedCertificate</code> can be used to provide self-signed PEM
certificate helpers and give <code>KeyCertOptions</code> and <code>TrustOptions</code>
configurations:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> SelfSignedCertificate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> certificate <span class="token operator">=</span> SelfSignedCertificate<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> serverOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyCertOptions</span><span class="token punctuation">(</span>certificate<span class="token punctuation">.</span><span class="token function">keyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustOptions</span><span class="token punctuation">(</span>certificate<span class="token punctuation">.</span><span class="token function">trustOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>serverOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> clientOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyCertOptions</span><span class="token punctuation">(</span>certificate<span class="token punctuation">.</span><span class="token function">keyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustOptions</span><span class="token punctuation">(</span>certificate<span class="token punctuation">.</span><span class="token function">trustOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>clientOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Woops: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The client can also be configured to trust all certificates:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> clientOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Note that self-signed certificates also work for other TCP protocols
like HTTPS:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> SelfSignedCertificate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> certificate <span class="token operator">=</span> SelfSignedCertificate<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyCertOptions</span><span class="token punctuation">(</span>certificate<span class="token punctuation">.</span><span class="token function">keyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustOptions</span><span class="token punctuation">(</span>certificate<span class="token punctuation">.</span><span class="token function">trustOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="revoking-certificate-authorities"><a href="#revoking-certificate-authorities" class="header-anchor">#</a> Revoking certificate authorities</h3> <p>Trust can be configured to use a certificate revocation list (CRL) for
revoked certificates that should no longer be trusted. The <code>crlPath</code>
configures the crl list to use:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustStoreOptions</span><span class="token punctuation">(</span>trustOptions<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCrlPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;/path/to/your/crl.pem&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Buffer configuration is also supported:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myCrlAsABuffer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/your/crl.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustStoreOptions</span><span class="token punctuation">(</span>trustOptions<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCrlValues</span><span class="token punctuation">(</span><span class="token punctuation">[</span>myCrlAsABuffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="configuring-the-cipher-suite"><a href="#configuring-the-cipher-suite" class="header-anchor">#</a> Configuring the Cipher suite</h3> <p>By default, the TLS configuration will use the Cipher suite of the JVM
running Vert.x. This Cipher suite can be configured with a suite of
enabled ciphers:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>keyStoreOptions<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setEnabledCipherSuites</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;ECDHE-RSA-AES128-GCM-SHA256&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ECDHE-ECDSA-AES128-GCM-SHA256&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ECDHE-RSA-AES256-GCM-SHA384&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CDHE-ECDSA-AES256-GCM-SHA384&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Cipher suite can be specified on the <code>NetServerOptions</code> or
<code>NetClientOptions</code> configuration.</p> <h3 id="configuring-tls-protocol-versions"><a href="#configuring-tls-protocol-versions" class="header-anchor">#</a> Configuring TLS protocol versions</h3> <p>By default, the TLS configuration will use the following protocol
versions: SSLv2Hello, TLSv1, TLSv1.1 and TLSv1.2. Protocol versions can
be configured by explicitly adding enabled protocols:</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><p>Protocol versions can be specified on the <code>NetServerOptions</code> or
<code>NetClientOptions</code> configuration.</p> <h3 id="ssl-engine"><a href="#ssl-engine" class="header-anchor">#</a> SSL engine</h3> <p>The engine implementation can be configured to use
<a href="https://www.openssl.org" target="_blank" rel="noopener noreferrer">OpenSSL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> instead of the JDK implementation.
OpenSSL provides better performances and CPU usage than the JDK engine,
as well as JDK version independence.</p> <p>The engine options to use is</p> <ul><li><p>the <code>getSslEngineOptions</code> options when it is set</p></li> <li><p>otherwise <code>JdkSSLEngineOptions</code></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Use JDK SSL engine</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>keyStoreOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use JDK SSL engine explicitly</span>
options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>keyStoreOptions<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setJdkSslEngineOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JdkSSLEngineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use OpenSSL engine</span>
options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>keyStoreOptions<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setOpenSslEngineOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OpenSSLEngineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="server-name-indication-sni"><a href="#server-name-indication-sni" class="header-anchor">#</a> Server Name Indication (SNI)</h3> <p>Server Name Indication (SNI) is a TLS extension by which a client
specifies a hostname attempting to connect: during the TLS handshake the
client gives a server name and the server can use it to respond with a
specific certificate for this server name instead of the default
deployed certificate. If the server requires client authentication the
server can use a specific trusted CA certificate depending on the
indicated server name.</p> <p>When SNI is active the server uses</p> <ul><li><p>the certificate CN or SAN DNS (Subject Alternative Name with DNS) to
do an exact match, e.g <code>www.example.com</code></p></li> <li><p>the certificate CN or SAN DNS certificate to match a wildcard name,
e.g <code>*.example.com</code></p></li> <li><p>otherwise the first certificate when the client does not present a
server name or the presented server name cannot be matched</p></li></ul> <p>When the server additionally requires client authentication:</p> <ul><li><p>if <code>JksOptions</code> were used to set the trust options (<code>options</code>) then
an exact match with the trust store alias is done</p></li> <li><p>otherwise the available CA certificates are used in the same way as
if no SNI is in place</p></li></ul> <p>You can enable SNI on the server by setting <code>setSni</code> to <code>true</code> and
configured the server with multiple key/certificate pairs.</p> <p>Java KeyStore files or PKCS12 files can store multiple key/cert pairs
out of the box.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> keyCertOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;keystore.jks&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;wibble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> netServer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span>keyCertOptions<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSni</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>PemKeyCertOptions</code> can be configured to hold multiple entries:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> keyCertOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;default-key.pem&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;host1-key.pem&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;etc...&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCertPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;default-cert.pem&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;host2-key.pem&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;etc...&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> netServer <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemKeyCertOptions</span><span class="token punctuation">(</span>keyCertOptions<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSni</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The client implicitly sends the connecting host as an SNI server name
for Fully Qualified Domain Name (FQDN).</p> <p>You can provide an explicit server name when connecting a socket</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustStoreOptions</span><span class="token punctuation">(</span>trustOptions<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Connect to 'localhost' and present 'server.name' server name</span>
client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;server.name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> socket <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to connect: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It can be used for different purposes:</p> <ul><li><p>present a server name different than the server host</p></li> <li><p>present a server name while connecting to an IP</p></li> <li><p>force to present a server name when using shortname</p></li></ul> <h3 id="application-layer-protocol-negotiation-alpn"><a href="#application-layer-protocol-negotiation-alpn" class="header-anchor">#</a> Application-Layer Protocol Negotiation (ALPN)</h3> <p>Application-Layer Protocol Negotiation (ALPN) is a TLS extension for
application layer protocol negotiation. It is used by HTTP/2: during the
TLS handshake the client gives the list of application protocols it
accepts and the server responds with a protocol it supports.</p> <p>If you are using Java 9, you are fine and you can use HTTP/2 out of the
box without extra steps.</p> <p>Java 8 does not supports ALPN out of the box, so ALPN should be enabled
by other means:</p> <ul><li><p><em>OpenSSL</em> support</p></li> <li><p><em>Jetty-ALPN</em> support</p></li></ul> <p>The engine options to use is</p> <ul><li><p>the <code>getSslEngineOptions</code> options when it is set</p></li> <li><p><code>JdkSSLEngineOptions</code> when ALPN is available for JDK</p></li> <li><p><code>OpenSSLEngineOptions</code> when ALPN is available for OpenSSL</p></li> <li><p>otherwise it fails</p></li></ul> <h4 id="openssl-alpn-support"><a href="#openssl-alpn-support" class="header-anchor">#</a> OpenSSL ALPN support</h4> <p>OpenSSL provides native ALPN support.</p> <p>OpenSSL requires to configure <code>setOpenSslEngineOptions</code> and use
<a href="http://netty.io/wiki/forked-tomcat-native.html" target="_blank" rel="noopener noreferrer">netty-tcnative<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> jar on
the classpath. Using tcnative may require OpenSSL to be installed on
your OS depending on the tcnative implementation.</p> <h4 id="jetty-alpn-support"><a href="#jetty-alpn-support" class="header-anchor">#</a> Jetty-ALPN support</h4> <p>Jetty-ALPN is a small jar that overrides a few classes of Java 8
distribution to support ALPN.</p> <p>The JVM must be started with the <em>alpn-boot-${version}.jar</em> in its
<code>bootclasspath</code>:</p> <div class="language- extra-class"><pre><code>-Xbootclasspath/p:/path/to/alpn-boot${version}.jar
</code></pre></div><p>where ${version} depends on the JVM version, e.g. <em>8.1.7.v20160121</em> for
<em>OpenJDK 1.8.0u74</em> . The complete list is available on the <a href="http://www.eclipse.org/jetty/documentation/current/alpn-chapter.html" target="_blank" rel="noopener noreferrer">Jetty-ALPN
page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>The main drawback is that the version depends on the JVM.</p> <p>To solve this problem the <em><a href="https://github.com/jetty-project/jetty-alpn-agent" target="_blank" rel="noopener noreferrer">Jetty ALPN
agent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em> can be use
instead. The agent is a JVM agent that will chose the correct ALPN
version for the JVM running it:</p> <div class="language- extra-class"><pre><code>-javaagent:/path/to/alpn/agent
</code></pre></div><h2 id="using-a-proxy-for-client-connections"><a href="#using-a-proxy-for-client-connections" class="header-anchor">#</a> Using a proxy for client connections</h2> <p>The <code>NetClient</code> supports either a HTTP/1.x <em>CONNECT</em>, <em>SOCKS4a</em> or
<em>SOCKS5</em> proxy.</p> <p>The proxy can be configured in the <code>NetClientOptions</code> by setting a
<code>ProxyOptions</code> object containing proxy type, hostname, port and
optionally username and password.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProxyOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProxyOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;SOCKS5&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1080</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The DNS resolution is always done on the proxy server, to achieve the
functionality of a SOCKS4 client, it is necessary to resolve the DNS
address locally.</p> <h1 id="writing-http-servers-and-clients"><a href="#writing-http-servers-and-clients" class="header-anchor">#</a> Writing HTTP servers and clients</h1> <p>Vert.x allows you to easily write non blocking HTTP clients and servers.</p> <p>Vert.x supports the HTTP/1.0, HTTP/1.1 and HTTP/2 protocols.</p> <p>The base API for HTTP is the same for HTTP/1.x and HTTP/2, specific API
features are available for dealing with the HTTP/2 protocol.</p> <h2 id="creating-an-http-server"><a href="#creating-an-http-server" class="header-anchor">#</a> Creating an HTTP Server</h2> <p>The simplest way to create an HTTP server, using all default options is
as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-an-http-server"><a href="#configuring-an-http-server" class="header-anchor">#</a> Configuring an HTTP server</h2> <p>If you don’t want the default, a server can be configured by passing in
a <code>HttpServerOptions</code> instance when creating it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxWebSocketFrameSize</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-an-http-2-server"><a href="#configuring-an-http-2-server" class="header-anchor">#</a> Configuring an HTTP/2 server</h2> <p>Vert.x supports HTTP/2 over TLS <code>h2</code> and over TCP <code>h2c</code>.</p> <ul><li><p><code>h2</code> identifies the HTTP/2 protocol when used over TLS negotiated by
<a href="https://en.wikipedia.org/wiki/Application-Layer_Protocol_Negotiation" target="_blank" rel="noopener noreferrer">Application-Layer Protocol
Negotiation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
(ALPN)</p></li> <li><p><code>h2c</code> identifies the HTTP/2 protocol when using in clear text over
TCP, such connections are established either with an HTTP/1.1
upgraded request or directly</p></li></ul> <p>To handle <code>h2</code> requests, TLS must be enabled along with <code>setUseAlpn</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/my/keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ALPN is a TLS extension that negotiates the protocol before the client
and the server start to exchange data.</p> <p>Clients that don’t support ALPN will still be able to do a <em>classic</em> SSL
handshake.</p> <p>ALPN will usually agree on the <code>h2</code> protocol, although <code>http/1.1</code> can be
used if the server or the client decides so.</p> <p>To handle <code>h2c</code> requests, TLS must be disabled, the server will upgrade
to HTTP/2 any request HTTP/1.1 that wants to upgrade to HTTP/2. It will
also accept a direct <code>h2c</code> connection beginning with the <code>PRI * HTTP/2.0\r\nSM\r\n</code> preface.</p> <blockquote><p><strong>Warning</strong></p> <p>most browsers won’t support <code>h2c</code>, so for serving web sites you should
use <code>h2</code> and not <code>h2c</code>.</p></blockquote> <p>When a server accepts an HTTP/2 connection, it sends to the client its
<code>initial settings</code>. The settings define how the client can use the
connection, the default initial settings for a server are:</p> <ul><li><p><code>getMaxConcurrentStreams</code>: <code>100</code> as recommended by the HTTP/2 RFC</p></li> <li><p>the default HTTP/2 settings values for the others</p></li></ul> <blockquote><p><strong>Note</strong></p> <p>Worker Verticles are not compatible with HTTP/2</p></blockquote> <h2 id="logging-network-server-activity"><a href="#logging-network-server-activity" class="header-anchor">#</a> Logging network server activity</h2> <p>For debugging purposes, network activity can be logged.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLogActivity</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>See the chapter on <a href="#logging_network_activity">logging network activity</a>
for a detailed explanation.</p> <h2 id="start-the-server-listening-2"><a href="#start-the-server-listening-2" class="header-anchor">#</a> Start the Server Listening</h2> <p>To tell the server to listen for incoming requests you use one of the
<code>listen</code> alternatives.</p> <p>To tell the server to listen at the host and port as specified in the
options:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or to specify the host and port in the call to listen, ignoring what is
configured in the options:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;myhost.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The default host is <code>0.0.0.0</code> which means 'listen on all available
addresses' and the default port is <code>80</code>.</p> <p>The actual bind is asynchronous so the server might not actually be
listening until some time <strong>after</strong> the call to listen has returned.</p> <p>If you want to be notified when the server is actually listening you can
provide a handler to the <code>listen</code> call. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;myhost.com&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server is now listening!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to bind!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="getting-notified-of-incoming-requests"><a href="#getting-notified-of-incoming-requests" class="header-anchor">#</a> Getting notified of incoming requests</h2> <p>To be notified when a request arrives you need to set a
<code>requestHandler</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handle the request in here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-requests"><a href="#handling-requests" class="header-anchor">#</a> Handling requests</h2> <p>When a request arrives, the request handler is called passing in an
instance of <code>HttpServerRequest</code>. This object represents the server side
HTTP request.</p> <p>The handler is called when the headers of the request have been fully
read.</p> <p>If the request contains a body, that body will arrive at the server some
time after the request handler has been called.</p> <p>The server request object allows you to retrieve the <code>uri</code>, <code>path</code>,
<code>params</code> and <code>headers</code>, amongst other things.</p> <p>Each server request object is associated with one server response
object. You use <code>response</code> to get a reference to the
<code>HttpServerResponse</code> object.</p> <p>Here’s a simple example of a server handling a request and replying with
&quot;hello world&quot; to it.</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="request-version"><a href="#request-version" class="header-anchor">#</a> Request version</h3> <p>The version of HTTP specified in the request can be retrieved with
<code>version</code></p> <h3 id="request-method"><a href="#request-method" class="header-anchor">#</a> Request method</h3> <p>Use <code>method</code> to retrieve the HTTP method of the request. (i.e. whether
it’s GET, POST, PUT, DELETE, HEAD, OPTIONS, etc).</p> <h3 id="request-uri"><a href="#request-uri" class="header-anchor">#</a> Request URI</h3> <p>Use <code>uri</code> to retrieve the URI of the request.</p> <p>Note that this is the actual URI as passed in the HTTP request, and it’s
almost always a relative URI.</p> <p>The URI is as defined in <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html" target="_blank" rel="noopener noreferrer">Section 5.1.2 of the HTTP specification -
Request-URI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="request-path"><a href="#request-path" class="header-anchor">#</a> Request path</h3> <p>Use <code>path</code> to return the path part of the URI</p> <p>For example, if the request URI was:</p> <p>a/b/c/page.html?param1=abc&amp;param2=xyz</p> <p>Then the path would be</p> <p>/a/b/c/page.html</p> <h3 id="request-query"><a href="#request-query" class="header-anchor">#</a> Request query</h3> <p>Use <code>query</code> to return the query part of the URI</p> <p>For example, if the request URI was:</p> <p>a/b/c/page.html?param1=abc&amp;param2=xyz</p> <p>Then the query would be</p> <p>param1=abc&amp;param2=xyz</p> <h3 id="request-headers"><a href="#request-headers" class="header-anchor">#</a> Request headers</h3> <p>Use <code>headers</code> to return the headers of the HTTP request.</p> <p>This returns an instance of <code>MultiMap</code> - which is like a normal Map or
Hash but allows multiple values for the same key - this is because HTTP
allows multiple header values with the same key.</p> <p>It also has case-insensitive keys, that means you can do the following:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> headers <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the User-Agent:</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User agent is &quot;</span> <span class="token operator">+</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;user-agent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// You can also do this and get the same result:</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User agent is &quot;</span> <span class="token operator">+</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="request-host"><a href="#request-host" class="header-anchor">#</a> Request host</h3> <p>Use <code>host</code> to return the host of the HTTP request.</p> <p>For HTTP/1.x requests the <code>host</code> header is returned, for HTTP/1 requests
the <code>:authority</code> pseudo header is returned.</p> <h3 id="request-parameters"><a href="#request-parameters" class="header-anchor">#</a> Request parameters</h3> <p>Use <code>params</code> to return the parameters of the HTTP request.</p> <p>Just like <code>headers</code> this returns an instance of <code>MultiMap</code> as there can
be more than one parameter with the same name.</p> <p>Request parameters are sent on the request URI, after the path. For
example if the URI was:</p> <p>/page.html?param1=abc&amp;param2=xyz</p> <p>Then the parameters would contain the following:</p> <div class="language- extra-class"><pre><code>param1: 'abc'
param2: 'xyz
</code></pre></div><p>Note that these request parameters are retrieved from the URL of the
request. If you have form attributes that have been sent as part of the
submission of an HTML form submitted in the body of a
<code>multi-part/form-data</code> request then they will not appear in the params
here.</p> <h3 id="remote-address"><a href="#remote-address" class="header-anchor">#</a> Remote address</h3> <p>The address of the sender of the request can be retrieved with
<code>remoteAddress</code>.</p> <h3 id="absolute-uri"><a href="#absolute-uri" class="header-anchor">#</a> Absolute URI</h3> <p>The URI passed in an HTTP request is usually relative. If you wish to
retrieve the absolute URI corresponding to the request, you can get it
with <code>absoluteURI</code></p> <h3 id="end-handler"><a href="#end-handler" class="header-anchor">#</a> End handler</h3> <p>The <code>endHandler</code> of the request is invoked when the entire request,
including any body has been fully read.</p> <h3 id="reading-data-from-the-request-body"><a href="#reading-data-from-the-request-body" class="header-anchor">#</a> Reading Data from the Request Body</h3> <p>Often an HTTP request contains a body that we want to read. As
previously mentioned the request handler is called when just the headers
of the request have arrived so the request object does not have a body
at that point.</p> <p>This is because the body may be very large (e.g. a file upload) and we
don’t generally want to buffer the entire body in memory before handing
it to you, as that could cause the server to exhaust available memory.</p> <p>To receive the body, you can use the <code>handler</code> on the request, this will
get called every time a chunk of the request body arrives. Here’s an
example:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I have received a chunk of the body of length &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The object passed into the handler is a <code>Buffer</code>, and the handler can be
called multiple times as data arrives from the network, depending on the
size of the body.</p> <p>In some cases (e.g. if the body is small) you will want to aggregate the
entire body in memory, so you could do the aggregation yourself as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Create an empty buffer</span>
<span class="token keyword">let</span> totalBuffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I have received a chunk of the body of length &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  totalBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Full body received, length = &quot;</span> <span class="token operator">+</span> totalBuffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This is such a common case, that Vert.x provides a <code>bodyHandler</code> to do
this for you. The body handler is called once when all the body has been
received:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">totalBuffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Full body received, length = &quot;</span> <span class="token operator">+</span> totalBuffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="streaming-requests"><a href="#streaming-requests" class="header-anchor">#</a> Streaming requests</h3> <p>The request object is a <code>ReadStream</code> so you can pipe the request body to
any <code>WriteStream</code> instance.</p> <p>See the chapter on <a href="#streams">streams</a> for a detailed explanation.</p> <h3 id="handling-html-forms"><a href="#handling-html-forms" class="header-anchor">#</a> Handling HTML forms</h3> <p>HTML forms can be submitted with either a content type of
<code>application/x-www-form-urlencoded</code> or <code>multipart/form-data</code>.</p> <p>For url encoded forms, the form attributes are encoded in the url, just
like normal query parameters.</p> <p>For multi-part forms they are encoded in the request body, and as such
are not available until the entire body has been read from the wire.</p> <p>Multi-part forms can also contain file uploads.</p> <p>If you want to retrieve the attributes of a multi-part form you should
tell Vert.x that you expect to receive such a form <strong>before</strong> any of the
body is read by calling <code>setExpectMultipart</code> with true, and then you
should retrieve the actual attributes using <code>formAttributes</code> once the
entire body has been read:</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">setExpectMultipart</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The body has now been fully read, so retrieve the form attributes</span>
    <span class="token keyword">let</span> formAttributes <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">formAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-form-file-uploads"><a href="#handling-form-file-uploads" class="header-anchor">#</a> Handling form file uploads</h3> <p>Vert.x can also handle file uploads which are encoded in a multi-part
request body.</p> <p>To receive file uploads you tell Vert.x to expect a multi-part form and
set an <code>uploadHandler</code> on the request.</p> <p>This handler will be called once for every upload that arrives on the
server.</p> <p>The object passed into the handler is a <code>HttpServerFileUpload</code> instance.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">setExpectMultipart</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">uploadHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">upload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got a file upload &quot;</span> <span class="token operator">+</span> upload<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>File uploads can be large we don’t provide the entire upload in a single
buffer as that might result in memory exhaustion, instead, the upload
data is received in chunks:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">uploadHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">upload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  upload<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a chunk of the upload of length &quot;</span> <span class="token operator">+</span> chunk<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The upload object is a <code>ReadStream</code> so you can pipe the request body to
any <code>WriteStream</code> instance. See the chapter on <a href="#streams">streams</a> for a
detailed explanation.</p> <p>If you just want to upload the file to disk somewhere you can use
<code>streamToFileSystem</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">uploadHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">upload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  upload<span class="token punctuation">.</span><span class="token function">streamToFileSystem</span><span class="token punctuation">(</span><span class="token string">&quot;myuploads_directory/&quot;</span> <span class="token operator">+</span> upload<span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Warning</strong></p> <p>Make sure you check the filename in a production system to avoid
malicious clients uploading files to arbitrary places on your
filesystem. See <a href="#_security_notes">security notes</a> for more
information.</p></blockquote> <h3 id="handling-cookies"><a href="#handling-cookies" class="header-anchor">#</a> Handling cookies</h3> <p>You use <code>getCookie</code> to retrieve a cookie by name, or use <code>cookieMap</code> to
retrieve all the cookies.</p> <p>To remove a cookie, use <code>removeCookie</code>.</p> <p>To add a cookie use <code>addCookie</code>.</p> <p>The set of cookies will be written back in the response automatically
when the response headers are written so the browser can store them.</p> <p>Cookies are described by instances of <code>Cookie</code>. This allows you to
retrieve the name, value, domain, path and other normal cookie
properties.</p> <p>Same Site Cookies let servers require that a cookie shouldn’t be sent
with cross-site (where Site is defined by the registrable domain)
requests, which provides some protection against cross-site request
forgery attacks. This kind of cookies are enabled using the setter:
<code>setSameSite</code>.</p> <p>Same site cookies can have one of 3 values:</p> <ul><li><p>None - The browser will send cookies with both cross-site requests
and same-site requests.</p></li> <li><p>Strict - he browser will only send cookies for same-site requests
(requests originating from the site that set the cookie). If the
request originated from a different URL than the URL of the current
location, none of the cookies tagged with the Strict attribute will
be included.</p></li> <li><p>Lax - Same-site cookies are withheld on cross-site subrequests, such
as calls to load images or frames, but will be sent when a user
navigates to the URL from an external site; for example, by
following a link.</p></li></ul> <p>Here’s an example of querying and adding cookies:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Cookie <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> someCookie <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">&quot;mycookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cookieValue <span class="token operator">=</span> someCookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Do something with cookie...</span>

<span class="token comment">// Add a cookie - this will get written back in the response automatically</span>
request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>Cookie<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&quot;othercookie&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;somevalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-compressed-body"><a href="#handling-compressed-body" class="header-anchor">#</a> Handling compressed body</h3> <p>Vert.x can handle compressed body payloads which are encoded by the
client with the <em>deflate</em> or <em>gzip</em> algorithms.</p> <p>To enable decompression set <code>setDecompressionSupported</code> on the options
when creating the server.</p> <p>By default decompression is disabled.</p> <h3 id="receiving-custom-http-2-frames"><a href="#receiving-custom-http-2-frames" class="header-anchor">#</a> Receiving custom HTTP/2 frames</h3> <p>HTTP/2 is a framed protocol with various frames for the HTTP
request/response model. The protocol allows other kind of frames to be
sent and received.</p> <p>To receive custom frames, you can use the <code>customFrameHandler</code> on the
request, this will get called every time a custom frame arrives. Here’s
an example:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">customFrameHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a frame type=&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; payload&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>HTTP/2 frames are not subject to flow control - the frame handler will
be called immediatly when a custom frame is received whether the request
is paused or is not</p> <h3 id="non-standard-http-methods"><a href="#non-standard-http-methods" class="header-anchor">#</a> Non standard HTTP methods</h3> <p>The <code>OTHER</code> HTTP method is used for non standard methods, in this case
<code>rawMethod</code> returns the HTTP method as sent by the client.</p> <h2 id="sending-back-responses"><a href="#sending-back-responses" class="header-anchor">#</a> Sending back responses</h2> <p>The server response object is an instance of <code>HttpServerResponse</code> and is
obtained from the request with <code>response</code>.</p> <p>You use the response object to write a response back to the HTTP client.</p> <h3 id="setting-status-code-and-message"><a href="#setting-status-code-and-message" class="header-anchor">#</a> Setting status code and message</h3> <p>The default HTTP status code for a response is <code>200</code>, representing <code>OK</code>.</p> <p>Use <code>setStatusCode</code> to set a different code.</p> <p>You can also specify a custom status message with <code>setStatusMessage</code>.</p> <p>If you don’t specify a status message, the default one corresponding to
the status code will be used.</p> <blockquote><p><strong>Note</strong></p> <p>for HTTP/2 the status won’t be present in the response since the
protocol won’t transmit the message to the client</p></blockquote> <h3 id="writing-http-responses"><a href="#writing-http-responses" class="header-anchor">#</a> Writing HTTP responses</h3> <p>To write data to an HTTP response, you use one of the <code>write</code>
operations.</p> <p>These can be invoked multiple times before the response is ended. They
can be invoked in a few ways:</p> <p>With a single buffer:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With a string. In this case the string will encoded using UTF-8 and the
result written to the wire.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With a string and an encoding. In this case the string will encoded
using the specified encoding and the result written to the wire.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Writing to a response is asynchronous and always returns immediately
after the write has been queued.</p> <p>If you are just writing a single string or buffer to the HTTP response
you can write it and end the response in a single call to the <code>end</code></p> <p>The first call to write results in the response header being written to
the response. Consequently, if you are not using HTTP chunking then you
must set the <code>Content-Length</code> header before writing to the response,
since it will be too late otherwise. If you are using HTTP chunking you
do not have to worry.</p> <h3 id="ending-http-responses"><a href="#ending-http-responses" class="header-anchor">#</a> Ending HTTP responses</h3> <p>Once you have finished with the HTTP response you should <code>end</code> it.</p> <p>This can be done in several ways:</p> <p>With no arguments, the response is simply ended.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It can also be called with a string or buffer in the same way <code>write</code> is
called. In this case it’s just the same as calling write with a string
or buffer followed by calling end with no arguments. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="closing-the-underlying-connection"><a href="#closing-the-underlying-connection" class="header-anchor">#</a> Closing the underlying connection</h3> <p>You can close the underlying TCP connection with <code>close</code>.</p> <p>Non keep-alive connections will be automatically closed by Vert.x when
the response is ended.</p> <p>Keep-alive connections are not automatically closed by Vert.x by
default. If you want keep-alive connections to be closed after an idle
time, then you configure <code>setIdleTimeout</code>.</p> <p>HTTP/2 connections send a {@literal GOAWAY} frame before closing the
response.</p> <h3 id="setting-response-headers"><a href="#setting-response-headers" class="header-anchor">#</a> Setting response headers</h3> <p>HTTP response headers can be added to the response by adding them
directly to the <code>headers</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> headers <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;other-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wibble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or you can use <code>putHeader</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;other-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wibble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Headers must all be added before any parts of the response body are
written.</p> <h3 id="chunked-http-responses-and-trailers"><a href="#chunked-http-responses-and-trailers" class="header-anchor">#</a> Chunked HTTP responses and trailers</h3> <p>Vert.x supports <a href="http://en.wikipedia.org/wiki/Chunked_transfer_encoding" target="_blank" rel="noopener noreferrer">HTTP Chunked Transfer
Encoding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>This allows the HTTP response body to be written in chunks, and is
normally used when a large response body is being streamed to a client
and the total size is not known in advance.</p> <p>You put the HTTP response into chunked mode as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Default is non-chunked. When in chunked mode, each call to one of the
<code>write</code> methods will result in a new HTTP chunk being written out.</p> <p>When in chunked mode you can also write HTTP response trailers to the
response. These are actually written in the final chunk of the response.</p> <blockquote><p><strong>Note</strong></p> <p>chunked response has no effect for an HTTP/2 stream</p></blockquote> <p>To add trailers to the response, add them directly to the <code>trailers</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> trailers <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">trailers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
trailers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-wibble&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;woobble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-quux&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;flooble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or use <code>putTrailer</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">putTrailer</span><span class="token punctuation">(</span><span class="token string">&quot;X-wibble&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;woobble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTrailer</span><span class="token punctuation">(</span><span class="token string">&quot;X-quux&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;flooble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="serving-files-directly-from-disk-or-the-classpath"><a href="#serving-files-directly-from-disk-or-the-classpath" class="header-anchor">#</a> Serving files directly from disk or the classpath</h3> <p>If you were writing a web server, one way to serve a file from disk
would be to open it as an <code>AsyncFile</code> and pipe it to the HTTP response.</p> <p>Or you could load it it one go using <code>readFile</code> and write it straight to
the response.</p> <p>Alternatively, Vert.x provides a method which allows you to serve a file
from disk or the filesystem to an HTTP response in one operation. Where
supported by the underlying operating system this may result in the OS
directly transferring bytes from the file to the socket without being
copied through user-space at all.</p> <p>This is done by using <code>sendFile</code>, and is usually more efficient for
large files, but may be slower for small files.</p> <p>Here’s a very simple web server that serves files from the file system
using sendFile:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file <span class="token operator">=</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;web/&quot;</span> <span class="token operator">+</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sending a file is asynchronous and may not complete until some time
after the call has returned. If you want to be notified when the file
has been writen you can use <code>sendFile</code></p> <p>Please see the chapter about <a href="#classpath">serving files from the
classpath</a> for restrictions about the classpath resolution
or disabling it.</p> <blockquote><p><strong>Note</strong></p> <p>If you use <code>sendFile</code> while using HTTPS it will copy through
user-space, since if the kernel is copying data directly from disk to
socket it doesn’t give us an opportunity to apply any encryption.</p></blockquote> <blockquote><p><strong>Warning</strong></p> <p>If you’re going to write web servers directly using Vert.x be careful
that users cannot exploit the path to access files outside the
directory from which you want to serve them or the classpath It may be
safer instead to use Vert.x Web.</p></blockquote> <p>When there is a need to serve just a segment of a file, say starting
from a given byte, you can achieve this by doing:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    offset <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling...</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">let</span> end <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    end <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling...</span>
  <span class="token punctuation">}</span>


  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;web/mybigfile.txt&quot;</span><span class="token punctuation">,</span> offset<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You are not required to supply the length if you want to send a file
starting from an offset until the end, in this case you can just do:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    offset <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling...</span>
  <span class="token punctuation">}</span>


  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;web/mybigfile.txt&quot;</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="piping-responses"><a href="#piping-responses" class="header-anchor">#</a> Piping responses</h3> <p>The server response is a <code>WriteStream</code> instance so you can pipe to it
from any <code>ReadStream</code>, e.g. <code>AsyncFile</code>, <code>NetSocket</code>, <code>WebSocket</code> or
<code>HttpServerRequest</code>.</p> <p>Here’s an example which echoes the request body back in the response for
any PUT methods. It uses a pipe for the body, so it will work even if
the HTTP request body is much larger than can fit in memory at any one
time:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> HttpMethod<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">pipeTo</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-http-2-frames"><a href="#writing-http-2-frames" class="header-anchor">#</a> Writing HTTP/2 frames</h3> <p>HTTP/2 is a framed protocol with various frames for the HTTP
request/response model. The protocol allows other kind of frames to be
sent and received.</p> <p>To send such frames, you can use the <code>writeCustomFrame</code> on the response.
Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> frameType <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> frameStatus <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> payload <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sending a frame to the client</span>
response<span class="token punctuation">.</span><span class="token function">writeCustomFrame</span><span class="token punctuation">(</span>frameType<span class="token punctuation">,</span> frameStatus<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>These frames are sent immediately and are not subject to flow control -
when such frame is sent there it may be done before other {@literal
DATA} frames.</p> <h3 id="stream-reset"><a href="#stream-reset" class="header-anchor">#</a> Stream reset</h3> <p>HTTP/1.x does not allow a clean reset of a request or a response stream,
for example when a client uploads a resource already present on the
server, the server needs to accept the entire response.</p> <p>HTTP/2 supports stream reset at any time during the request/response:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Reset the stream</span>
request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default the <code>NO_ERROR</code> (0) error code is sent, another code can sent
instead:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Cancel the stream</span>
request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The HTTP/2 specification defines the list of <a href="http://httpwg.org/specs/rfc7540.html#ErrorCodes" target="_blank" rel="noopener noreferrer">error
codes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> one can use.</p> <p>The request handler are notified of stream reset events with the
<code>request handler</code> and <code>response handler</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">StreamResetException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> reset <span class="token operator">=</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Stream reset &quot;</span> <span class="token operator">+</span> reset<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="server-push"><a href="#server-push" class="header-anchor">#</a> Server push</h3> <p>Server push is a new feature of HTTP/2 that enables sending multiple
responses in parallel for a single client request.</p> <p>When a server process a request, it can push a request/response to the
client:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Push main.js to the client</span>
response<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>HttpMethod<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">&quot;/main.js&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// The server is ready to push the response</span>
    <span class="token keyword">let</span> pushedResponse <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Send main.js response</span>
    pushedResponse<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;alert(\&quot;Push response hello\&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Could not push client resource &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send the requested resource</span>
response<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;html&gt;&lt;head&gt;&lt;script src=\&quot;/main.js\&quot;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When the server is ready to push the response, the push response handler
is called and the handler can send the response.</p> <p>The push response handler may receive a failure, for instance the client
may cancel the push because it already has <code>main.js</code> in its cache and
does not want it anymore.</p> <p>The <code>push</code> method must be called before the initiating response ends,
however the pushed response can be written after.</p> <h3 id="handling-exceptions-2"><a href="#handling-exceptions-2" class="header-anchor">#</a> Handling exceptions</h3> <p>You can set an <code>exceptionHandler</code> to receive any exceptions that happens
before the connection is passed to the <code>requestHandler</code> or to the
<code>webSocketHandler</code>, e.g during the TLS handshake.</p> <h2 id="http-compression"><a href="#http-compression" class="header-anchor">#</a> HTTP Compression</h2> <p>Vert.x comes with support for HTTP Compression out of the box.</p> <p>This means you are able to automatically compress the body of the
responses before they are sent back to the client.</p> <p>If the client does not support HTTP compression the responses are sent
back without compressing the body.</p> <p>This allows to handle Client that support HTTP Compression and those
that not support it at the same time.</p> <p>To enable compression use can configure it with
<code>setCompressionSupported</code>.</p> <p>By default compression is not enabled.</p> <p>When HTTP compression is enabled the server will check if the client
includes an <code>Accept-Encoding</code> header which includes the supported
compressions. Commonly used are deflate and gzip. Both are supported by
Vert.x.</p> <p>If such a header is found the server will automatically compress the
body of the response with one of the supported compressions and send it
back to the client.</p> <p>Whenever the response needs to be sent without compression you can set
the header <code>content-encoding</code> to <code>identity</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Disable compression and send an image</span>
request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;io.vertx.core.http.HttpHeaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ENCODING</span><span class="token punctuation">,</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;io.vertx.core.http.HttpHeaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/image.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Be aware that compression may be able to reduce network traffic but is
more CPU-intensive.</p> <p>To address this latter issue Vert.x allows you to tune the 'compression
level' parameter that is native of the gzip/deflate compression
algorithms.</p> <p>Compression level allows to configure gizp/deflate algorithms in terms
of the compression ratio of the resulting data and the computational
cost of the compress/decompress operation.</p> <p>The compression level is an integer value ranged from '1' to '9', where
'1' means lower compression ratio but fastest algorithm and '9' means
maximum compression ratio available but a slower algorithm.</p> <p>Using compression levels higher that 1-2 usually allows to save just
some bytes in size - the gain is not linear, and depends on the specific
data to be compressed - but it comports a non-trascurable cost in term
of CPU cycles required to the server while generating the compressed
response data ( Note that at moment Vert.x doesn’t support any form
caching of compressed response data, even for static files, so the
compression is done on-the-fly at every request body generation ) and in
the same way it affects client(s) while decoding (inflating) received
responses, operation that becomes more CPU-intensive the more the level
increases.</p> <p>By default - if compression is enabled via <code>setCompressionSupported</code> -
Vert.x will use '6' as compression level, but the parameter can be
configured to address any case with <code>setCompressionLevel</code>.</p> <h2 id="creating-an-http-client"><a href="#creating-an-http-client" class="header-anchor">#</a> Creating an HTTP client</h2> <p>You create an <code>HttpClient</code> instance with default options as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you want to configure options for the client, you create it as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeepAlive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Vert.x supports HTTP/2 over TLS <code>h2</code> and over TCP <code>h2c</code>.</p> <p>By default the http client performs HTTP/1.1 requests, to perform HTTP/2
requests the <code>setProtocolVersion</code> must be set to <code>HTTP_2</code>.</p> <p>For <code>h2</code> requests, TLS must be enabled with <em>Application-Layer Protocol
Negotiation</em>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProtocolVersion</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_2&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For <code>h2c</code> requests, TLS must be disabled, the client will do an HTTP/1.1
requests and try an upgrade to HTTP/2:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProtocolVersion</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>h2c</code> connections can also be established directly, i.e connection
started with a prior knowledge, when <code>setHttp2ClearTextUpgrade</code> options
is set to false: after the connection is established, the client will
send the HTTP/2 connection preface and expect to receive the same
preface from the server.</p> <p>The http server may not support HTTP/2, the actual version can be
checked with <code>version</code> when the response arrives.</p> <p>When a clients connects to an HTTP/2 server, it sends to the server its
<code>initial settings</code>. The settings define how the server can use the
connection, the default initial settings for a client are the default
values defined by the HTTP/2 RFC.</p> <h2 id="logging-network-client-activity"><a href="#logging-network-client-activity" class="header-anchor">#</a> Logging network client activity</h2> <p>For debugging purposes, network activity can be logged.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLogActivity</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>See the chapter on <a href="#logging_network_activity">logging network activity</a>
for a detailed explanation.</p> <h2 id="making-requests"><a href="#making-requests" class="header-anchor">#</a> Making requests</h2> <p>The http client is very flexible and there are various ways you can make
requests with it.</p> <p>Often you want to make many requests to the same host/port with an http
client. To avoid you repeating the host/port every time you make a
request you can configure the client with a default host/port:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Set the default host</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDefaultHost</span><span class="token punctuation">(</span><span class="token string">&quot;wibble.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Can also set default port if you want...</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternatively if you find yourself making lots of requests to different
host/ports with the same client you can simply specify the host/port
when doing the request.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Specify both port and host name</span>
client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;myserver.mycompany.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This time use the default port 80 but specify the host name</span>
client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;foo.othercompany.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/other-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Both methods of specifying host/port are supported for all the different
ways of making requests with the client.</p> <h3 id="simple-requests-with-no-request-body"><a href="#simple-requests-with-no-request-body" class="header-anchor">#</a> Simple requests with no request body</h3> <p>Often, you’ll want to make HTTP requests with no request body. This is
usually the case with HTTP GET, OPTIONS and HEAD requests.</p> <p>The simplest way to do this with the Vert.x http client is using the
methods suffixed with <code>Now</code>. For example <code>getNow</code>.</p> <p>These methods create the http request and send it in a single method
call and allow you to provide a handler that will be called with the
http response when it comes back.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a GET request</span>
client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a GET request</span>
client<span class="token punctuation">.</span><span class="token function">headNow</span><span class="token punctuation">(</span><span class="token string">&quot;/other-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-general-requests"><a href="#writing-general-requests" class="header-anchor">#</a> Writing general requests</h3> <p>At other times you don’t know the request method you want to send until
run-time. For that use case we provide general purpose request methods
such as <code>request</code> which allow you to specify the HTTP method at
run-time:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>HttpMethod<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>HttpMethod<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">,</span> <span class="token string">&quot;foo-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;some-data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-request-bodies"><a href="#writing-request-bodies" class="header-anchor">#</a> Writing request bodies</h3> <p>Sometimes you’ll want to write requests which have a body, or perhaps
you want to write headers to a request before sending it.</p> <p>To do this you can call one of the specific request methods such as
<code>post</code> or one of the general purpose request methods such as <code>request</code>.</p> <p>These methods don’t send the request immediately, but instead return an
instance of <code>HttpClientRequest</code> which can be used to write to the
request body or write headers.</p> <p>Here are some examples of writing a POST request with a body: m</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Now do stuff with the request</span>
request<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-length&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make sure the request is ended when you're done with it</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Or fluently:</span>

client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-length&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Or event more simply:</span>

client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Methods exist to write strings in UTF-8 encoding and in any specific
encoding and to write buffers:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Write string encoded in UTF-8</span>
request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write string encoded in specific encoding</span>
request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some other data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write a buffer</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buffer<span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendLong</span><span class="token punctuation">(</span><span class="token number">245</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you are just writing a single string or buffer to the HTTP request
you can write it and end the request in a single call to the <code>end</code>
function.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Write string and end the request (send it) in a single call</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;some simple data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write buffer and end the request (send it) in a single call</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendDouble</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendLong</span><span class="token punctuation">(</span><span class="token number">432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When you’re writing to a request, the first call to <code>write</code> will result
in the request headers being written out to the wire.</p> <p>The actual write is asynchronous and might not occur until some time
after the call has returned.</p> <p>Non-chunked HTTP requests with a request body require a <code>Content-Length</code>
header to be provided.</p> <p>Consequently, if you are not using chunked HTTP then you must set the
<code>Content-Length</code> header before writing to the request, as it will be too
late otherwise.</p> <p>If you are calling one of the <code>end</code> methods that take a string or buffer
then Vert.x will automatically calculate and set the <code>Content-Length</code>
header before writing the request body.</p> <p>If you are using HTTP chunking a a <code>Content-Length</code> header is not
required, so you do not have to calculate the size up-front.</p> <h3 id="writing-request-headers"><a href="#writing-request-headers" class="header-anchor">#</a> Writing request headers</h3> <p>You can write headers to a request using the <code>headers</code> multi-map as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Write some headers using the headers() multimap</span>

<span class="token keyword">let</span> headers <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;other-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The headers are an instance of <code>MultiMap</code> which provides operations for
adding, setting and removing entries. Http headers allow more than one
value for a specific key.</p> <p>You can also write headers using <code>putHeader</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Write some headers using the putHeader method</span>

request<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;other-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you wish to write headers to the request you must do so before any
part of the request body is written.</p> <h3 id="non-standard-http-methods-2"><a href="#non-standard-http-methods-2" class="header-anchor">#</a> Non standard HTTP methods</h3> <p>The <code>OTHER</code> HTTP method is used for non standard methods, when this
method is used, <code>setRawMethod</code> must be used to set the raw method to
send to the server.</p> <h3 id="ending-http-requests"><a href="#ending-http-requests" class="header-anchor">#</a> Ending HTTP requests</h3> <p>Once you have finished with the HTTP request you must end it with one of
the <code>end</code> operations.</p> <p>Ending a request causes any headers to be written, if they have not
already been written and the request to be marked as complete.</p> <p>Requests can be ended in several ways. With no arguments the request is
simply ended:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or a string or buffer can be provided in the call to <code>end</code>. This is like
calling <code>write</code> with the string or buffer before calling <code>end</code> with no
arguments</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// End the request with a string</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;some-data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// End it with a buffer</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendFloat</span><span class="token punctuation">(</span><span class="token number">12.3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">321</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="chunked-http-requests"><a href="#chunked-http-requests" class="header-anchor">#</a> Chunked HTTP requests</h3> <p>Vert.x supports <a href="http://en.wikipedia.org/wiki/Chunked_transfer_encoding" target="_blank" rel="noopener noreferrer">HTTP Chunked Transfer
Encoding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for
requests.</p> <p>This allows the HTTP request body to be written in chunks, and is
normally used when a large request body is being streamed to the server,
whose size is not known in advance.</p> <p>You put the HTTP request into chunked mode using <code>setChunked</code>.</p> <p>In chunked mode each call to write will cause a new chunk to be written
to the wire. In chunked mode there is no need to set the
<code>Content-Length</code> of the request up-front.</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write some chunks</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;this-is-chunk-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="request-timeouts"><a href="#request-timeouts" class="header-anchor">#</a> Request timeouts</h3> <p>You can set a timeout for a specific http request using <code>setTimeout</code>.</p> <p>If the request does not return any data within the timeout period an
exception will be passed to the exception handler (if provided) and the
request will be closed.</p> <h3 id="handling-exceptions-3"><a href="#handling-exceptions-3" class="header-anchor">#</a> Handling exceptions</h3> <p>You can handle exceptions corresponding to a request by setting an
exception handler on the <code>HttpClientRequest</code> instance:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received exception: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This does not handle non <em>2xx</em> response that need to be handled in the
<code>HttpClientResponse</code> code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Everything fine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected behavior on the server side&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Important</strong></p> <p><code>XXXNow</code> methods cannot receive an exception handler.</p></blockquote> <h3 id="specifying-a-handler-on-the-client-request"><a href="#specifying-a-handler-on-the-client-request" class="header-anchor">#</a> Specifying a handler on the client request</h3> <p>Instead of providing a response handler in the call to create the client
request object, alternatively, you can not provide a handler when the
request is created and set it later on the request object itself, using
<code>handler</code>, for example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="using-the-request-as-a-stream"><a href="#using-the-request-as-a-stream" class="header-anchor">#</a> Using the request as a stream</h3> <p>The <code>HttpClientRequest</code> instance is also a <code>WriteStream</code> which means you
can pump to it from any <code>ReadStream</code> instance.</p> <p>For, example, you could pump a file on disk to a http request body as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Pump <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

request<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pump <span class="token operator">=</span> Pump<span class="token punctuation">.</span><span class="token function">pump</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
file<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pump<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-http-2-frames-2"><a href="#writing-http-2-frames-2" class="header-anchor">#</a> Writing HTTP/2 frames</h3> <p>HTTP/2 is a framed protocol with various frames for the HTTP
request/response model. The protocol allows other kind of frames to be
sent and received.</p> <p>To send such frames, you can use the <code>write</code> on the request. Here’s an
example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> frameType <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> frameStatus <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> payload <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sending a frame to the server</span>
request<span class="token punctuation">.</span><span class="token function">writeCustomFrame</span><span class="token punctuation">(</span>frameType<span class="token punctuation">,</span> frameStatus<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="stream-reset-2"><a href="#stream-reset-2" class="header-anchor">#</a> Stream reset</h3> <p>HTTP/1.x does not allow a clean reset of a request or a response stream,
for example when a client uploads a resource already present on the
server, the server needs to accept the entire response.</p> <p>HTTP/2 supports stream reset at any time during the request/response:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default the NO_ERROR (0) error code is sent, another code can sent
instead:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The HTTP/2 specification defines the list of <a href="http://httpwg.org/specs/rfc7540.html#ErrorCodes" target="_blank" rel="noopener noreferrer">error
codes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> one can use.</p> <p>The request handler are notified of stream reset events with the
<code>request handler</code> and <code>response handler</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">StreamResetException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> reset <span class="token operator">=</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Stream reset &quot;</span> <span class="token operator">+</span> reset<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-http-responses"><a href="#handling-http-responses" class="header-anchor">#</a> Handling HTTP responses</h2> <p>You receive an instance of <code>HttpClientResponse</code> into the handler that
you specify in of the request methods or by setting a handler directly
on the <code>HttpClientRequest</code> object.</p> <p>You can query the status code and the status message of the response
with <code>statusCode</code> and <code>statusMessage</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// the status code - e.g. 200 or 404</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Status code is &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// the status message e.g. &quot;OK&quot; or &quot;Not Found&quot;.</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Status message is &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="using-the-response-as-a-stream"><a href="#using-the-response-as-a-stream" class="header-anchor">#</a> Using the response as a stream</h3> <p>The <code>HttpClientResponse</code> instance is also a <code>ReadStream</code> which means you
can pipe it to any <code>WriteStream</code> instance.</p> <h3 id="response-headers-and-trailers"><a href="#response-headers-and-trailers" class="header-anchor">#</a> Response headers and trailers</h3> <p>Http responses can contain headers. Use <code>headers</code> to get the headers.</p> <p>The object returned is a <code>MultiMap</code> as HTTP headers can contain multiple
values for single keys.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> contentType <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> contentLength <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content-lengh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Chunked HTTP responses can also contain trailers - these are sent in the
last chunk of the response body.</p> <p>You use <code>trailers</code> to get the trailers. Trailers are also a <code>MultiMap</code>.</p> <h3 id="reading-the-request-body"><a href="#reading-the-request-body" class="header-anchor">#</a> Reading the request body</h3> <p>The response handler is called when the headers of the response have
been read from the wire.</p> <p>If the response has a body this might arrive in several pieces some time
after the headers have been read. We don’t wait for all the body to
arrive before calling the response handler as the response could be very
large and we might be waiting a long time, or run out of memory for
large responses.</p> <p>As parts of the response body arrive, the <code>handler</code> is called with a
<code>Buffer</code> representing the piece of the body:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  response<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a part of the response body: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you know the response body is not very large and want to aggregate it
all in memory before handling it, you can either aggregate it yourself:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Create an empty buffer</span>
  <span class="token keyword">let</span> totalBuffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a part of the response body: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    totalBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Now all the body has been read</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Total response body length is &quot;</span> <span class="token operator">+</span> totalBuffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or you can use the convenience <code>bodyHandler</code> which is called with the
entire body when the response has been fully read:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  response<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">totalBuffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Now all the body has been read</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Total response body length is &quot;</span> <span class="token operator">+</span> totalBuffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="response-end-handler"><a href="#response-end-handler" class="header-anchor">#</a> Response end handler</h3> <p>The response <code>endHandler</code> is called when the entire response body has
been read or immediately after the headers have been read and the
response handler has been called if there is no body.</p> <h3 id="reading-cookies-from-the-response"><a href="#reading-cookies-from-the-response" class="header-anchor">#</a> Reading cookies from the response</h3> <p>You can retrieve the list of cookies from a response using <code>cookies</code>.</p> <p>Alternatively you can just parse the <code>Set-Cookie</code> headers yourself in
the response.</p> <h3 id="_30x-redirection-handling"><a href="#_30x-redirection-handling" class="header-anchor">#</a> 30x redirection handling</h3> <p>The client can be configured to follow HTTP redirections provided by the
<code>Location</code> response header when the client receives:</p> <ul><li><p>a <code>301</code>, <code>302</code>, <code>307</code> or <code>308</code> status code along with a HTTP GET or
HEAD method</p></li> <li><p>a <code>303</code> status code, in addition the directed request perform an
HTTP GET methodn</p></li></ul> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFollowRedirects</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The maximum redirects is <code>16</code> by default and can be changed with
<code>setMaxRedirects</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxRedirects</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFollowRedirects</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>One size does not fit all and the default redirection policy may not be
adapted to your needs.</p> <p>The default redirection policy can changed with a custom implementation:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Future <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

client<span class="token punctuation">.</span><span class="token function">redirectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Only follow 301 code</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">301</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Compute the redirect URI</span>
    <span class="token keyword">let</span> absoluteURI <span class="token operator">=</span> <span class="token function">resolveURI</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">absoluteURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create a new ready to use request that the client will use</span>
    <span class="token keyword">return</span> Future<span class="token punctuation">.</span><span class="token function">succeededFuture</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getAbs</span><span class="token punctuation">(</span>absoluteURI<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// We don't redirect</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The policy handles the original <code>HttpClientResponse</code> received and
returns either <code>null</code> or a <code>Future&lt;HttpClientRequest&gt;</code>.</p> <ul><li><p>when <code>null</code> is returned, the original response is processed</p></li> <li><p>when a future is returned, the request will be sent on its
successful completion</p></li> <li><p>when a future is returned, the exception handler set on the request
is called on its failure</p></li></ul> <p>The returned request must be unsent so the original request handlers can
be sent and the client can send it after.</p> <p>Most of the original request settings will be propagated to the new
request:</p> <ul><li><p>request headers, unless if you have set some headers (including
<code>setHost</code>)</p></li> <li><p>request body unless the returned request uses a <code>GET</code> method</p></li> <li><p>response handler</p></li> <li><p>request exception handler</p></li> <li><p>request timeout</p></li></ul> <h3 id="_100-continue-handling"><a href="#_100-continue-handling" class="header-anchor">#</a> 100-Continue handling</h3> <p>According to the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html" target="_blank" rel="noopener noreferrer">HTTP 1.1
specification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> a
client can set a header <code>Expect: 100-Continue</code> and send the request
header before sending the rest of the request body.</p> <p>The server can then respond with an interim response status <code>Status: 100 (Continue)</code> to signify to the client that it is ok to send the rest of
the body.</p> <p>The idea here is it allows the server to authorise and accept/reject the
request before large amounts of data are sent. Sending large amounts of
data if the request might not be accepted is a waste of bandwidth and
ties up the server in reading data that it will just discard.</p> <p>Vert.x allows you to set a <code>continueHandler</code> on the client request
object</p> <p>This will be called if the server sends back a <code>Status: 100 (Continue)</code>
response to signify that it is ok to send the rest of the request.</p> <p>This is used in conjunction with
`<a href="/es4x/es4x/@vertx/core/classes/httpclientrequest.html#sendhead">sendHead</a>`to
send the head of the request.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Expect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;100-Continue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">continueHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// OK to send rest of body</span>
  request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Some more data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>On the server side a Vert.x http server can be configured to
automatically send back 100 Continue interim responses when it receives
an <code>Expect: 100-Continue</code> header.</p> <p>This is done by setting the option <code>setHandle100ContinueAutomatically</code>.</p> <p>If you’d prefer to decide whether to send back continue responses
manually, then this property should be set to <code>false</code> (the default),
then you can inspect the headers and call <code>writeContinue</code> to have the
client continue sending the body:</p> <div class="language-js extra-class"><pre class="language-js"><code>httpServer<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Expect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;100-Continue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Send a 100 continue response</span>
    request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeContinue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// The client should send the body when it receives the 100 response</span>
    request<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Do something with body</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also reject the request by sending back a failure status code
directly: in this case the body should either be ignored or the
connection should be closed (100-Continue is a performance hint and
cannot be a logical protocol constraint):</p> <div class="language-js extra-class"><pre class="language-js"><code>httpServer<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Expect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;100-Continue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//</span>
    <span class="token keyword">let</span> rejectAndClose <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rejectAndClose<span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// Reject with a failure code and close the connection</span>
      <span class="token comment">// this is probably best with persistent connection</span>
      request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Connection&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

      <span class="token comment">// Reject with a failure code and ignore the body</span>
      <span class="token comment">// this may be appropriate if the body is small</span>
      request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="client-push"><a href="#client-push" class="header-anchor">#</a> Client push</h3> <p>Server push is a new feature of HTTP/2 that enables sending multiple
responses in parallel for a single client request.</p> <p>A push handler can be set on a request to receive the request/response
pushed by the server:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Process index.html response</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set a push handler to be aware of any resource pushed by the server</span>
request<span class="token punctuation">.</span><span class="token function">pushHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pushedRequest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// A resource is pushed for this request</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server pushed &quot;</span> <span class="token operator">+</span> pushedRequest<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Set an handler for the response</span>
  pushedRequest<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pushedResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The response for the pushed request&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// End the request</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the client does not want to receive a pushed request, it can reset
the stream:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">pushHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pushedRequest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pushedRequest<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/main.js&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pushedRequest<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle it</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When no handler is set, any stream pushed will be automatically
cancelled by the client with a stream reset (<code>8</code> error code).</p> <h3 id="receiving-custom-http-2-frames-2"><a href="#receiving-custom-http-2-frames-2" class="header-anchor">#</a> Receiving custom HTTP/2 frames</h3> <p>HTTP/2 is a framed protocol with various frames for the HTTP
request/response model. The protocol allows other kind of frames to be
sent and received.</p> <p>To receive custom frames, you can use the customFrameHandler on the
request, this will get called every time a custom frame arrives. Here’s
an example:</p> <div class="language-js extra-class"><pre class="language-js"><code>response<span class="token punctuation">.</span><span class="token function">customFrameHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a frame type=&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; payload&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="enabling-compression-on-the-client"><a href="#enabling-compression-on-the-client" class="header-anchor">#</a> Enabling compression on the client</h2> <p>The http client comes with support for HTTP Compression out of the box.</p> <p>This means the client can let the remote http server know that it
supports compression, and will be able to handle compressed response
bodies.</p> <p>An http server is free to either compress with one of the supported
compression algorithms or to send the body back without compressing it
at all. So this is only a hint for the Http server which it may ignore
at will.</p> <p>To tell the http server which compression is supported by the client it
will include an <code>Accept-Encoding</code> header with the supported compression
algorithm as value. Multiple compression algorithms are supported. In
case of Vert.x this will result in the following header added:</p> <p>Accept-Encoding: gzip, deflate</p> <p>The server will choose then from one of these. You can detect if a
server ompressed the body by checking for the <code>Content-Encoding</code> header
in the response sent back from it.</p> <p>If the body of the response was compressed via gzip it will include for
example the following header:</p> <p>Content-Encoding: gzip</p> <p>To enable compression set <code>setTryUseCompression</code> on the options used
when creating the client.</p> <p>By default compression is disabled.</p> <h2 id="http-1-x-pooling-and-keep-alive"><a href="#http-1-x-pooling-and-keep-alive" class="header-anchor">#</a> HTTP/1.x pooling and keep alive</h2> <p>Http keep alive allows http connections to be used for more than one
request. This can be a more efficient use of connections when you’re
making multiple requests to the same server.</p> <p>For HTTP/1.x versions, the http client supports pooling of connections,
allowing you to reuse connections between requests.</p> <p>For pooling to work, keep alive must be true using <code>setKeepAlive</code> on the
options used when configuring the client. The default value is true.</p> <p>When keep alive is enabled. Vert.x will add a <code>Connection: Keep-Alive</code>
header to each HTTP/1.0 request sent. When keep alive is disabled.
Vert.x will add a <code>Connection: Close</code> header to each HTTP/1.1 request
sent to signal that the connection will be closed after completion of
the response.</p> <p>The maximum number of connections to pool <strong>for each server</strong> is
configured using <code>setMaxPoolSize</code></p> <p>When making a request with pooling enabled, Vert.x will create a new
connection if there are less than the maximum number of connections
already created for that server, otherwise it will add the request to a
queue.</p> <p>Keep alive connections will be closed by the client automatically after
a timeout. The timeout can be specified by the server using the
<code>keep-alive</code> header:</p> <div class="language- extra-class"><pre><code>keep-alive: timeout=30
</code></pre></div><p>You can set the default timeout using <code>setKeepAliveTimeout</code> - any
connections not used within this timeout will be closed. Please note the
timeout value is in seconds not milliseconds.</p> <h2 id="http-1-1-pipe-lining"><a href="#http-1-1-pipe-lining" class="header-anchor">#</a> HTTP/1.1 pipe-lining</h2> <p>The client also supports pipe-lining of requests on a connection.</p> <p>Pipe-lining means another request is sent on the same connection before
the response from the preceding one has returned. Pipe-lining is not
appropriate for all requests.</p> <p>To enable pipe-lining, it must be enabled using <code>setPipelining</code>. By
default pipe-lining is disabled.</p> <p>When pipe-lining is enabled requests will be written to connections
without waiting for previous responses to return.</p> <p>The number of pipe-lined requests over a single connection is limited by
<code>setPipeliningLimit</code>. This option defines the maximum number of http
requests sent to the server awaiting for a response. This limit ensures
the fairness of the distribution of the client requests over the
connections to the same server.</p> <h2 id="http-2-multiplexing"><a href="#http-2-multiplexing" class="header-anchor">#</a> HTTP/2 multiplexing</h2> <p>HTTP/2 advocates to use a single connection to a server, by default the
http client uses a single connection for each server, all the streams to
the same server are multiplexed over the same connection.</p> <p>When the clients needs to use more than a single connection and use
pooling, the <code>setHttp2MaxPoolSize</code> shall be used.</p> <p>When it is desirable to limit the number of multiplexed streams per
connection and use a connection pool instead of a single connection,
<code>setHttp2MultiplexingLimit</code> can be used.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> clientOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHttp2MultiplexingLimit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHttp2MaxPoolSize</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Uses up to 3 connections and up to 10 streams per connection</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>clientOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The multiplexing limit for a connection is a setting set on the client
that limits the number of streams of a single connection. The effective
value can be even lower if the server sets a lower limit with the
<code>SETTINGS_MAX_CONCURRENT_STREAMS</code> setting.</p> <p>HTTP/2 connections will not be closed by the client automatically. To
close them you can call <code>close</code> or close the client instance.</p> <p>Alternatively you can set idle timeout using <code>setIdleTimeout</code> - any
connections not used within this timeout will be closed. Please note the
idle timeout value is in seconds not milliseconds.</p> <h2 id="http-connections"><a href="#http-connections" class="header-anchor">#</a> HTTP connections</h2> <p>The <code>HttpConnection</code> offers the API for dealing with HTTP connection
events, lifecycle and settings.</p> <p>HTTP/2 implements fully the <code>HttpConnection</code> API.</p> <p>HTTP/1.x implements partially the <code>HttpConnection</code> API: only the close
operation, the close handler and exception handler are implemented. This
protocol does not provide semantics for the other operations.</p> <h3 id="server-connections"><a href="#server-connections" class="header-anchor">#</a> Server connections</h3> <p>The <code>connection</code> method returns the request connection on the server:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> connection <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A connection handler can be set on the server to be notified of any
incoming connection:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>http2Options<span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">connectionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">connection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A client connected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="client-connections"><a href="#client-connections" class="header-anchor">#</a> Client connections</h3> <p>The <code>connection</code> method returns the request connection on the client:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> connection <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A connection handler can be set on the client to be notified when a
connection has been established happens:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">connectionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">connection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected to the server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="connection-settings"><a href="#connection-settings" class="header-anchor">#</a> Connection settings</h3> <p>The configuration of an HTTP/2 is configured by the <code>Http2Settings</code> data
object.</p> <p>Each endpoint must respect the settings sent by the other side of the
connection.</p> <p>When a connection is established, the client and the server exchange
initial settings. Initial settings are configured by
<code>setInitialSettings</code> on the client and <code>setInitialSettings</code> on the
server.</p> <p>The settings can be changed at any time after the connection is
established:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">updateSettings</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Http2Settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxConcurrentStreams</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As the remote side should acknowledge on reception of the settings
update, it’s possible to give a callback to be notified of the
acknowledgment:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">updateSettings</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Http2Settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxConcurrentStreams</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The settings update has been acknowledged &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Conversely the <code>remoteSettingsHandler</code> is notified when the new remote
settings are received:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">remoteSettingsHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">settings</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received new settings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>this only applies to the HTTP/2 protocol</p></blockquote> <h3 id="connection-ping"><a href="#connection-ping" class="header-anchor">#</a> Connection ping</h3> <p>HTTP/2 connection ping is useful for determining the connection
round-trip time or check the connection validity: <code>ping</code> sends a
{@literal PING} frame to the remote endpoint:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">.</span><span class="token function">appendByte</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
connection<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">pong</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Remote side replied&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Vert.x will send automatically an acknowledgement when a {@literal PING}
frame is received, an handler can be set to be notified for each ping
received:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">pingHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ping</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got pinged by remote side&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The handler is just notified, the acknowledgement is sent whatsoever.
Such feature is aimed for implementing protocols on top of HTTP/2.</p> <blockquote><p><strong>Note</strong></p> <p>this only applies to the HTTP/2 protocol</p></blockquote> <h3 id="connection-shutdown-and-go-away"><a href="#connection-shutdown-and-go-away" class="header-anchor">#</a> Connection shutdown and go away</h3> <p>Calling <code>shutdown</code> will send a {@literal GOAWAY} frame to the remote
side of the connection, asking it to stop creating streams: a client
will stop doing new requests and a server will stop pushing responses.
After the {@literal GOAWAY} frame is sent, the connection waits some
time (30 seconds by default) until all current streams closed and close
the connection:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>shutdownHandler</code> notifies when all streams have been closed, the
connection is not yet closed.</p> <p>It’s possible to just send a {@literal GOAWAY} frame, the main
difference with a shutdown is that it will just tell the remote side of
the connection to stop creating new streams without scheduling a
connection close:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">goAway</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Conversely, it is also possible to be notified when {@literal GOAWAY}
are received:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">goAwayHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">goAway</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a go away frame&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>shutdownHandler</code> will be called when all current streams have been
closed and the connection can be closed:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">goAway</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">shutdownHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// All streams are closed, close the connection</span>
  connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This applies also when a {@literal GOAWAY} is received.</p> <blockquote><p><strong>Note</strong></p> <p>this only applies to the HTTP/2 protocol</p></blockquote> <h3 id="connection-close"><a href="#connection-close" class="header-anchor">#</a> Connection close</h3> <p>Connection <code>close</code> closes the connection:</p> <ul><li><p>it closes the socket for HTTP/1.x</p></li> <li><p>a shutdown with no delay for HTTP/2, the {@literal GOAWAY} frame
will still be sent before the connection is closed. *</p></li></ul> <p>The <code>closeHandler</code> notifies when a connection is closed.</p> <h2 id="httpclient-usage"><a href="#httpclient-usage" class="header-anchor">#</a> HttpClient usage</h2> <p>The HttpClient can be used in a Verticle or embedded.</p> <p>When used in a Verticle, the Verticle <strong>should use its own client
instance</strong>.</p> <p>More generally a client should not be shared between different Vert.x
contexts as it can lead to unexpected behavior.</p> <p>For example a keep-alive connection will call the client handlers on the
context of the request that opened the connection, subsequent requests
will use the same context.</p> <p>When this happen Vert.x detects it and log a warn:</p> <div class="language- extra-class"><pre><code>Reusing a connection with a different context: an HttpClient is probably shared between different Verticles
</code></pre></div><p>The HttpClient can be embedded in a non Vert.x thread like a unit test
or a plain java <code>main</code>: the client handlers will be called by different
Vert.x threads and contexts, such contexts are created as needed. For
production this usage is not recommended.</p> <h2 id="server-sharing"><a href="#server-sharing" class="header-anchor">#</a> Server sharing</h2> <p>When several HTTP servers listen on the same port, vert.x orchestrates
the request handling using a round-robin strategy.</p> <p>Let’s take a verticle creating a HTTP server such as:</p> <p><strong>io.vertx.examples.http.sharing.HttpServerVerticle.</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello from server &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This service is listening on the port 8080. So, when this verticle is
instantiated multiple times as with: <code>vertx run io.vertx.examples.http.sharing.HttpServerVerticle -instances 2</code>, what’s
happening ? If both verticles would bind to the same port, you would
receive a socket exception. Fortunately, vert.x is handling this case
for you. When you deploy another server on the same host and port as an
existing server it doesn’t actually try and create a new server
listening on the same host/port. It binds only once to the socket. When
receiving a request it calls the server handlers following a round robin
strategy.</p> <p>Let’s now imagine a client such as:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">l</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Vert.x delegates the requests to one of the server sequentially:</p> <div class="language- extra-class"><pre><code>Hello from i.v.e.h.s.HttpServerVerticle@1
Hello from i.v.e.h.s.HttpServerVerticle@2
Hello from i.v.e.h.s.HttpServerVerticle@1
Hello from i.v.e.h.s.HttpServerVerticle@2
...
</code></pre></div><p>Consequently the servers can scale over available cores while each
Vert.x verticle instance remains strictly single threaded, and you don’t
have to do any special tricks like writing load-balancers in order to
scale your server on your multi-core machine.</p> <h2 id="using-https-with-vert-x"><a href="#using-https-with-vert-x" class="header-anchor">#</a> Using HTTPS with Vert.x</h2> <p>Vert.x http servers and clients can be configured to use HTTPS in
exactly the same way as net servers.</p> <p>Please see <a href="#ssl">configuring net servers to use SSL</a> for more
information.</p> <p>SSL can also be enabled/disabled per request with <code>RequestOptions</code> or
when specifying a scheme with <code>requestAbs</code> method.</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setURI</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>setSsl</code> setting acts as the default client setting.</p> <p>The <code>setSsl</code> overrides the default client setting</p> <ul><li><p>setting the value to <code>false</code> will disable SSL/TLS even if the client
is configured to use SSL/TLS</p></li> <li><p>setting the value to <code>true</code> will enable SSL/TLS even if the client
is configured to not use SSL/TLS, the actual client SSL/TLS (such as
trust, key/certificate, ciphers, ALPN, …​) will be reused</p></li></ul> <p>Likewise <code>requestAbs</code> scheme also overrides the default client setting.</p> <h3 id="server-name-indication-sni-2"><a href="#server-name-indication-sni-2" class="header-anchor">#</a> Server Name Indication (SNI)</h3> <p>Vert.x http servers can be configured to use SNI in exactly the same way
as {@linkplain io.vertx.core.net net servers}.</p> <p>Vert.x http client will present the actual hostname as <em>server name</em>
during the TLS handshake.</p> <h2 id="websockets"><a href="#websockets" class="header-anchor">#</a> WebSockets</h2> <p><a href="http://en.wikipedia.org/wiki/WebSocket" target="_blank" rel="noopener noreferrer">WebSockets<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> are a web
technology that allows a full duplex socket-like connection between HTTP
servers and HTTP clients (typically browsers).</p> <p>Vert.x supports WebSockets on both the client and server-side.</p> <h3 id="websockets-on-the-server"><a href="#websockets-on-the-server" class="header-anchor">#</a> WebSockets on the server</h3> <p>There are two ways of handling WebSockets on the server side.</p> <h4 id="websocket-handler"><a href="#websocket-handler" class="header-anchor">#</a> WebSocket handler</h4> <p>The first way involves providing a <code>webSocketHandler</code> on the server
instance.</p> <p>When a WebSocket connection is made to the server, the handler will be
called, passing in an instance of <code>ServerWebSocket</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">webSocketHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">webSocket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can choose to reject the WebSocket by calling <code>reject</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">webSocketHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">webSocket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>webSocket<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/myapi&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    webSocket<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can perform an asynchronous handshake by calling <code>setHandshake</code> with
a <code>Future</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Promise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
server<span class="token punctuation">.</span><span class="token function">webSocketHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">webSocket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  webSocket<span class="token punctuation">.</span><span class="token function">setHandshake</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">authenticate</span><span class="token punctuation">(</span>webSocket<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Terminate the handshake with the status code 101 (Switching Protocol)</span>
      <span class="token comment">// Reject the handshake with 401 (Unauthorized)</span>
      promise<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">101</span> <span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Will send a 500 error</span>
      promise<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>the WebSocket will be automatically accepted after the handler is
called unless the WebSocket’s handshake has been set</p></blockquote> <h4 id="upgrading-to-websocket"><a href="#upgrading-to-websocket" class="header-anchor">#</a> Upgrading to WebSocket</h4> <p>The second way of handling WebSockets is to handle the HTTP Upgrade
request that was sent from the client, and call <code>upgrade</code> on the server
request.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/myapi&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> webSocket <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">upgrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Do something</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Reject</span>
    request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="the-server-websocket"><a href="#the-server-websocket" class="header-anchor">#</a> The server WebSocket</h4> <p>The <code>ServerWebSocket</code> instance enables you to retrieve the <code>headers</code>,
<code>path</code>, <code>query</code> and <code>URI</code> of the HTTP request of the WebSocket
handshake.</p> <h3 id="websockets-on-the-client"><a href="#websockets-on-the-client" class="header-anchor">#</a> WebSockets on the client</h3> <p>The Vert.x <code>HttpClient</code> supports WebSockets.</p> <p>You can connect a WebSocket to a server using one of the <code>webSocket</code>
operations and providing a handler.</p> <p>The handler will be called with an instance of <code>WebSocket</code> when the
connection has been made:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">webSocket</span><span class="token punctuation">(</span><span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ws <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-messages-to-websockets"><a href="#writing-messages-to-websockets" class="header-anchor">#</a> Writing messages to WebSockets</h3> <p>If you wish to write a single WebSocket message to the WebSocket you can
do this with <code>writeBinaryMessage</code> or <code>writeTextMessage</code> :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// Write a simple binary message</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendFloat</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeBinaryMessage</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write a simple text message</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeTextMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the WebSocket message is larger than the maximum WebSocket frame size
as configured with <code>setMaxWebSocketFrameSize</code> then Vert.x will split it
into multiple WebSocket frames before sending it on the wire.</p> <h3 id="writing-frames-to-websockets"><a href="#writing-frames-to-websockets" class="header-anchor">#</a> Writing frames to WebSockets</h3> <p>A WebSocket message can be composed of multiple frames. In this case the
first frame is either a <em>binary</em> or <em>text</em> frame followed by zero or
more <em>continuation</em> frames.</p> <p>The last frame in the message is marked as <em>final</em>.</p> <p>To send a message consisting of multiple frames you create frames using
<code>WebSocketFrame.binaryFrame</code> , <code>WebSocketFrame.textFrame</code> or
<code>WebSocketFrame.continuationFrame</code> and write them to the WebSocket using
<code>writeFrame</code>.</p> <p>Here’s an example for binary frames:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketFrame <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> frame1 <span class="token operator">=</span> WebSocketFrame<span class="token punctuation">.</span><span class="token function">binaryFrame</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeFrame</span><span class="token punctuation">(</span>frame1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> frame2 <span class="token operator">=</span> WebSocketFrame<span class="token punctuation">.</span><span class="token function">continuationFrame</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeFrame</span><span class="token punctuation">(</span>frame2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write the final frame</span>
<span class="token keyword">let</span> frame3 <span class="token operator">=</span> WebSocketFrame<span class="token punctuation">.</span><span class="token function">continuationFrame</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeFrame</span><span class="token punctuation">(</span>frame3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In many cases you just want to send a WebSocket message that consists of
a single final frame, so we provide a couple of shortcut methods to do
that with <code>writeFinalBinaryFrame</code> and <code>writeFinalTextFrame</code>.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Send a WebSocket messages consisting of a single final text frame:</span>

webSocket<span class="token punctuation">.</span><span class="token function">writeFinalTextFrame</span><span class="token punctuation">(</span><span class="token string">&quot;Geronimo!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a WebSocket messages consisting of a single final binary frame:</span>

<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendString</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

webSocket<span class="token punctuation">.</span><span class="token function">writeFinalBinaryFrame</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="reading-frames-from-websockets"><a href="#reading-frames-from-websockets" class="header-anchor">#</a> Reading frames from WebSockets</h3> <p>To read frames from a WebSocket you use the <code>frameHandler</code>.</p> <p>The frame handler will be called with instances of <code>WebSocketFrame</code> when
a frame arrives, for example:</p> <div class="language-js extra-class"><pre class="language-js"><code>webSocket<span class="token punctuation">.</span><span class="token function">frameHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a frame of size!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="closing-websockets"><a href="#closing-websockets" class="header-anchor">#</a> Closing WebSockets</h3> <p>Use <code>close</code> to close the WebSocket connection when you have finished
with it.</p> <h3 id="piping-websockets"><a href="#piping-websockets" class="header-anchor">#</a> Piping WebSockets</h3> <p>The <code>WebSocket</code> instance is also a <code>ReadStream</code> and a <code>WriteStream</code> so
it can be used with pipes.</p> <p>When using a WebSocket as a write stream or a read stream it can only be
used with WebSockets connections that are used with binary frames that
are no split over multiple frames.</p> <h3 id="event-bus-handlers"><a href="#event-bus-handlers" class="header-anchor">#</a> Event bus handlers</h3> <p>Every WebSocket automatically registers two handler on the event bus,
and when any data are received in this handler, it writes them to
itself. Those are local subscriptions not routed on the cluster.</p> <p>This enables you to write data to a WebSocket which is potentially in a
completely different verticle sending data to the address of that
handler.</p> <p>The addresses of the handlers are given by <code>binaryHandlerID</code> and
<code>textHandlerID</code>.</p> <h2 id="using-a-proxy-for-http-https-connections"><a href="#using-a-proxy-for-http-https-connections" class="header-anchor">#</a> Using a proxy for HTTP/HTTPS connections</h2> <p>The http client supports accessing http/https URLs via a HTTP proxy
(e.g. Squid) or <em>SOCKS4a</em> or <em>SOCKS5</em> proxy. The CONNECT protocol uses
HTTP/1.x but can connect to HTTP/1.x and HTTP/2 servers.</p> <p>Connecting to h2c (unencrypted HTTP/2 servers) is likely not supported
by http proxies since they will support HTTP/1.1 only.</p> <p>The proxy can be configured in the <code>HttpClientOptions</code> by setting a
<code>ProxyOptions</code> object containing proxy type, hostname, port and
optionally username and password.</p> <p>Here’s an example of using an HTTP proxy:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProxyOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProxyOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3128</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When the client connects to an http URL, it connects to the proxy server
and provides the full URL in the HTTP request (&quot;GET
<a href="http://www.somehost.com/path/file.html" target="_blank" rel="noopener noreferrer">http://www.somehost.com/path/file.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> HTTP/1.1&quot;).</p> <p>When the client connects to an https URL, it asks the proxy to create a
tunnel to the remote host with the CONNECT method.</p> <p>For a SOCKS5 proxy:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProxyOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProxyOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;SOCKS5&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1080</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The DNS resolution is always done on the proxy server, to achieve the
functionality of a SOCKS4 client, it is necessary to resolve the DNS
address locally.</p> <h3 id="handling-of-other-protocols"><a href="#handling-of-other-protocols" class="header-anchor">#</a> Handling of other protocols</h3> <p>The HTTP proxy implementation supports getting ftp:// urls if the proxy
supports that, which isn’t available in non-proxy getAbs requests.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProxyOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProxyOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">getAbs</span><span class="token punctuation">(</span><span class="token string">&quot;ftp://ftp.gnu.org/gnu/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Support for other protocols is not available since java.net.URL does not
support them (gopher:// for example).</p> <h2 id="automatic-clean-up-in-verticles-4"><a href="#automatic-clean-up-in-verticles-4" class="header-anchor">#</a> Automatic clean-up in verticles</h2> <p>If you’re creating http servers and clients from inside verticles, those
servers and clients will be automatically closed when the verticle is
undeployed.</p> <h1 id="using-the-shareddata-api"><a href="#using-the-shareddata-api" class="header-anchor">#</a> Using the SharedData API</h1> <p>As its name suggests, the <code>SharedData</code> API allows you to safely share
data between:</p> <ul><li><p>different parts of your application, or</p></li> <li><p>different applications in the same Vert.x instance, or</p></li> <li><p>different applications across a cluster of Vert.x instances.</p></li></ul> <p>In practice, it provides:</p> <ul><li><p>synchronous maps (local-only)</p></li> <li><p>asynchronous maps</p></li> <li><p>asynchronous locks</p></li> <li><p>asynchronous counters</p></li></ul> <blockquote><p><strong>Important</strong></p> <p>The behavior of the distributed data structure depends on the cluster
manager you use. Backup (replication) and behavior when a network
partition is faced are defined by the cluster manager and its
configuration. Please refer to the cluster manager documentation as
well as to the underlying framework manual.</p></blockquote> <h2 id="local-maps"><a href="#local-maps" class="header-anchor">#</a> Local maps</h2> <p><code>Local maps</code> allow you to share data safely between different event
loops (e.g. different verticles) in the same Vert.x instance.</p> <p>They only allow certain data types to be used as keys and values:</p> <ul><li><p>immutable types (e.g. strings, booleans, …​ etc), or</p></li> <li><p>types implementing the <code>Shareable</code> interface (buffers, JSON arrays,
JSON objects, or your own shareable objects).</p></li></ul> <p>In the latter case the key/value will be copied before putting it into
the map.</p> <p>This way we can ensure there is no <em>shared access to mutable state</em>
between different threads in your Vert.x application. And you won’t have
to worry about protecting that state by synchronising access to it.</p> <p>Here’s an example of using a shared local map:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> sharedData <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">sharedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> map1 <span class="token operator">=</span> sharedData<span class="token punctuation">.</span><span class="token function">getLocalMap</span><span class="token punctuation">(</span><span class="token string">&quot;mymap1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> map2 <span class="token operator">=</span> sharedData<span class="token punctuation">.</span><span class="token function">getLocalMap</span><span class="token punctuation">(</span><span class="token string">&quot;mymap2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

map2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;eek&quot;</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Then... in another part of your application:</span>

map1 <span class="token operator">=</span> sharedData<span class="token punctuation">.</span><span class="token function">getLocalMap</span><span class="token punctuation">(</span><span class="token string">&quot;mymap1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> val <span class="token operator">=</span> map1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

map2 <span class="token operator">=</span> sharedData<span class="token punctuation">.</span><span class="token function">getLocalMap</span><span class="token punctuation">(</span><span class="token string">&quot;mymap2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> buff <span class="token operator">=</span> map2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;eek&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="asynchronous-shared-maps"><a href="#asynchronous-shared-maps" class="header-anchor">#</a> Asynchronous shared maps</h2> <p><code>Asynchronous shared maps</code> allow data to be put in the map and retrieved
locally or from any other node.</p> <p>This makes them really useful for things like storing session state in a
farm of servers hosting a Vert.x Web application.</p> <p>Getting the map is asynchronous and the result is returned to you in the
handler that you specify. Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sharedData <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">sharedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sharedData<span class="token punctuation">.</span><span class="token function">getAsyncMap</span><span class="token punctuation">(</span><span class="token string">&quot;mymap&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> map <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When Vert.x is clustered, data that you put into the map is accessible
locally as well as on any of the other cluster members.</p> <blockquote><p><strong>Important</strong></p> <p>In clustered mode, asynchronous shared maps rely on distributed data
structures provided by the cluster manager. Beware that the latency
relative to asynchronous shared map operations can be much higher in
clustered than in local mode.</p></blockquote> <p>If your application doesn’t need data to be shared with every other
node, you can retrieve a local-only map:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sharedData <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">sharedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sharedData<span class="token punctuation">.</span><span class="token function">getLocalAsyncMap</span><span class="token punctuation">(</span><span class="token string">&quot;mymap&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Local-only async map</span>
    <span class="token keyword">let</span> map <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="putting-data-in-a-map"><a href="#putting-data-in-a-map" class="header-anchor">#</a> Putting data in a map</h3> <p>You put data in a map with <code>put</code>.</p> <p>The actual put is asynchronous and the handler is notified once it is
complete:</p> <div class="language-js extra-class"><pre class="language-js"><code>map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">resPut</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>resPut<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Successfully put the value</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="getting-data-from-a-map"><a href="#getting-data-from-a-map" class="header-anchor">#</a> Getting data from a map</h3> <p>You get data from a map with <code>get</code>.</p> <p>The actual get is asynchronous and the handler is notified with the
result some time later:</p> <div class="language-js extra-class"><pre class="language-js"><code>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">resGet</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>resGet<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Successfully got the value</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> resGet<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="other-map-operations"><a href="#other-map-operations" class="header-anchor">#</a> Other map operations</h4> <p>You can also remove entries from an asynchronous map, clear them and get
the size.</p> <p>See the <code>API docs</code> for a detailed list of map operations.</p> <h2 id="asynchronous-locks"><a href="#asynchronous-locks" class="header-anchor">#</a> Asynchronous locks</h2> <p><code>Asynchronous locks</code> allow you to obtain exclusive locks locally or
across the cluster. This is useful when you want to do something or
access a resource on only one node of a cluster at any one time.</p> <p>Asynchronous locks have an asynchronous API unlike most lock APIs which
block the calling thread until the lock is obtained.</p> <p>To obtain a lock use <code>getLock</code>. This won’t block, but when the lock is
available, the handler will be called with an instance of <code>Lock</code>,
signalling that you now own the lock.</p> <p>While you own the lock, no other caller, locally or on the cluster, will
be able to obtain the lock.</p> <p>When you’ve finished with the lock, you call <code>release</code> to release it, so
another caller can obtain it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sharedData <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">sharedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sharedData<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;mylock&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Got the lock!</span>
    <span class="token keyword">let</span> lock <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5 seconds later we release the lock so someone else can get it</span>

    vertx<span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">tid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      lock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also get a lock with a timeout. If it fails to obtain the lock
within the timeout the handler will be called with a failure:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sharedData <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">sharedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sharedData<span class="token punctuation">.</span><span class="token function">getLockWithTimeout</span><span class="token punctuation">(</span><span class="token string">&quot;mylock&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Got the lock!</span>
    <span class="token keyword">let</span> lock <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Failed to get lock</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>See the <code>API docs</code> for a detailed list of lock operations.</p> <blockquote><p><strong>Important</strong></p> <p>In clustered mode, asynchronous locks rely on distributed data
structures provided by the cluster manager. Beware that the latency
relative to asynchronous shared lock operations can be much higher in
clustered than in local mode.</p></blockquote> <p>If your application doesn’t need the lock to be shared with every other
node, you can retrieve a local-only lock:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sharedData <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">sharedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sharedData<span class="token punctuation">.</span><span class="token function">getLocalLock</span><span class="token punctuation">(</span><span class="token string">&quot;mylock&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Local-only lock</span>
    <span class="token keyword">let</span> lock <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5 seconds later we release the lock so someone else can get it</span>

    vertx<span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">tid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      lock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="asynchronous-counters"><a href="#asynchronous-counters" class="header-anchor">#</a> Asynchronous counters</h2> <p>It’s often useful to maintain an atomic counter locally or across the
different nodes of your application.</p> <p>You can do this with <code>Counter</code>.</p> <p>You obtain an instance with <code>getCounter</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sharedData <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">sharedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sharedData<span class="token punctuation">.</span><span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token string">&quot;mycounter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> counter <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Once you have an instance you can retrieve the current count, atomically
increment it, decrement and add a value to it using the various methods.</p> <p>See the <code>API docs</code> for a detailed list of counter operations.</p> <blockquote><p><strong>Important</strong></p> <p>In clustered mode, asynchronous counters rely on distributed data
structures provided by the cluster manager. Beware that the latency
relative to asynchronous shared counter operations can be much higher
in clustered than in local mode.</p></blockquote> <p>If your application doesn’t need the counter to be shared with every
other node, you can retrieve a local-only counter:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sharedData <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">sharedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sharedData<span class="token punctuation">.</span><span class="token function">getLocalCounter</span><span class="token punctuation">(</span><span class="token string">&quot;mycounter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Local-only counter</span>
    <span class="token keyword">let</span> counter <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="using-the-file-system-with-vert-x"><a href="#using-the-file-system-with-vert-x" class="header-anchor">#</a> Using the file system with Vert.x</h1> <p>The Vert.x <code>FileSystem</code> object provides many operations for manipulating
the file system.</p> <p>There is one file system object per Vert.x instance, and you obtain it
with <code>fileSystem</code>.</p> <p>A blocking and a non blocking version of each operation is provided. The
non blocking versions take a handler which is called when the operation
completes or an error occurs.</p> <p>Here’s an example of an asynchronous copy of a file:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> fs <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Copy file from foo.txt to bar.txt</span>
fs<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token string">&quot;foo.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar.txt&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Copied ok!</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The blocking versions are named <code>xxxBlocking</code> and return the results or
throw exceptions directly. In many cases, depending on the operating
system and file system, some of the potentially blocking operations can
return quickly, which is why we provide them, but it’s highly
recommended that you test how long they take to return in your
particular application before using them from an event loop, so as not
to break the Golden Rule.</p> <p>Here’s the copy using the blocking API:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> fs <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Copy file from foo.txt to bar.txt synchronously</span>
fs<span class="token punctuation">.</span><span class="token function">copyBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;foo.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Many operations exist to copy, move, truncate, chmod and many other file
operations. We won’t list them all here, please consult the <code>API docs</code>
for the full list.</p> <p>Let’s see a couple of examples using asynchronous methods:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// Read a file</span>
vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/readme.txt&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Oh oh ...&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Copy a file</span>
vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/readme.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;target/classes/readme2.txt&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;File copied&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Oh oh ...&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write a file</span>
vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/hello.txt&quot;</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;File written&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Oh oh ...&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check existence and delete</span>
vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/junk.txt&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/junk.txt&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;File deleted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Oh oh ... - cannot delete the file: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="asynchronous-files"><a href="#asynchronous-files" class="header-anchor">#</a> Asynchronous files</h2> <p>Vert.x provides an asynchronous file abstraction that allows you to
manipulate a file on the file system.</p> <p>You open an <code>AsyncFile</code> as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileSystem<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;myfile.txt&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Something went wrong!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>AsyncFile</code> implements <code>ReadStream</code> and <code>WriteStream</code> so you can <em>pipe</em>
files to and from other stream objects such as net sockets, http
requests and responses, and WebSockets.</p> <p>They also allow you to read and write directly to them.</p> <h3 id="random-access-writes"><a href="#random-access-writes" class="header-anchor">#</a> Random access writes</h3> <p>To use an <code>AsyncFile</code> for random access writing you use the <code>write</code>
method.</p> <p>The parameters to the method are:</p> <ul><li><p><code>buffer</code>: the buffer to write.</p></li> <li><p><code>position</code>: an integer position in the file where to write the
buffer. If the position is greater or equal to the size of the file,
the file will be enlarged to accommodate the offset.</p></li> <li><p><code>handler</code>: the result handler</p></li></ul> <p>Here is an example of random access writes:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/hello.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> buff<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Written ok!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// etc</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to write: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot open file &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="random-access-reads"><a href="#random-access-reads" class="header-anchor">#</a> Random access reads</h3> <p>To use an <code>AsyncFile</code> for random access reads you use the <code>read</code> method.</p> <p>The parameters to the method are:</p> <ul><li><p><code>buffer</code>: the buffer into which the data will be read.</p></li> <li><p><code>offset</code>: an integer offset into the buffer where the read data will
be placed.</p></li> <li><p><code>position</code>: the position in the file where to read data from.</p></li> <li><p><code>length</code>: the number of bytes of data to read</p></li> <li><p><code>handler</code>: the result handler</p></li></ul> <p>Here’s an example of random access reads:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/les_miserables.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      file<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Read ok!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to write: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot open file &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="opening-options"><a href="#opening-options" class="header-anchor">#</a> Opening Options</h3> <p>When opening an <code>AsyncFile</code>, you pass an <code>OpenOptions</code> instance. These
options describe the behavior of the file access. For instance, you can
configure the file permissions with the <code>setRead</code>, <code>setWrite</code> and
<code>setPerms</code> methods.</p> <p>You can also configure the behavior if the open file already exists with
<code>setCreateNew</code> and <code>setTruncateExisting</code>.</p> <p>You can also mark the file to be deleted on close or when the JVM is
shutdown with <code>setDeleteOnClose</code>.</p> <h3 id="flushing-data-to-underlying-storage"><a href="#flushing-data-to-underlying-storage" class="header-anchor">#</a> Flushing data to underlying storage.</h3> <p>In the <code>OpenOptions</code>, you can enable/disable the automatic
synchronisation of the content on every write using <code>setDsync</code>. In that
case, you can manually flush any writes from the OS cache by calling the
<code>flush</code> method.</p> <p>This method can also be called with an handler which will be called when
the flush is complete.</p> <h3 id="using-asyncfile-as-readstream-and-writestream"><a href="#using-asyncfile-as-readstream-and-writestream" class="header-anchor">#</a> Using AsyncFile as ReadStream and WriteStream</h3> <p><code>AsyncFile</code> implements <code>ReadStream</code> and <code>WriteStream</code>. You can then use
them with a <em>pipe</em> to pipe data to and from other read and write
streams. For example, this would copy the content to another
<code>AsyncFile</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> output <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openBlocking</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/plagiary.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vertx<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes/les_miserables.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    file<span class="token punctuation">.</span><span class="token function">pipeTo</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Copy done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot open file &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also use the <em>pipe</em> to write file content into HTTP responses,
or more generally in any <code>WriteStream</code>.</p> <h3 id="accessing-files-from-the-classpath"><a href="#accessing-files-from-the-classpath" class="header-anchor">#</a> Accessing files from the classpath</h3> <p>When vert.x cannot find the file on the filesystem it tries to resolve
the file from the class path. Note that classpath resource paths never
start with a <code>/</code>.</p> <p>Due to the fact that Java does not offer async access to classpath
resources, the file is copied to the filesystem in a worker thread when
the classpath resource is accessed the very first time and served from
there asynchronously. When the same resource is accessed a second time,
the file from the filesystem is served directly from the filesystem. The
original content is served even if the classpath resource changes (e.g.
in a development system).</p> <p>This caching behaviour can be set on the <code>setFileCachingEnabled</code> option.
The default value of this option is <code>true</code> unless the system property
<code>vertx.disableFileCaching</code> is defined.</p> <p>The path where the files are cached is <code>.vertx</code> by default and can be
customized by setting the system property <code>vertx.cacheDirBase</code>.</p> <p>The whole classpath resolving feature can be disabled system-wide by
setting the system property <code>vertx.disableFileCPResolving</code> to <code>true</code>.</p> <blockquote><p><strong>Note</strong></p> <p>these system properties are evaluated once when the the
<code>io.vertx.core.file.FileSystemOptions</code> class is loaded, so these
properties should be set before loading this class or as a JVM system
property when launching it.</p></blockquote> <p>If you want to disable classpath resolving for a particular application
but keep it enabled by default system-wide, you can do so via the
<code>setClassPathResolvingEnabled</code> option.</p> <h3 id="closing-an-asyncfile"><a href="#closing-an-asyncfile" class="header-anchor">#</a> Closing an AsyncFile</h3> <p>To close an <code>AsyncFile</code> call the <code>close</code> method. Closing is asynchronous
and if you want to be notified when the close has been completed you can
specify a handler function as an argument.</p> <h1 id="datagram-sockets-udp"><a href="#datagram-sockets-udp" class="header-anchor">#</a> Datagram sockets (UDP)</h1> <p>Using User Datagram Protocol (UDP) with Vert.x is a piece of cake.</p> <p>UDP is a connection-less transport which basically means you have no
persistent connection to a remote peer.</p> <p>Instead you can send and receive packages and the remote address is
contained in each of them.</p> <p>Beside this UDP is not as safe as TCP to use, which means there are no
guarantees that a send Datagram packet will receive it’s endpoint at
all.</p> <p>The only guarantee is that it will either receive complete or not at
all.</p> <p>Also you usually can’t send data which is bigger then the MTU size of
your network interface, this is because each packet will be send as one
packet.</p> <p>But be aware even if the packet size is smaller then the MTU it may
still fail.</p> <p>At which size it will fail depends on the Operating System etc. So rule
of thumb is to try to send small packets.</p> <p>Because of the nature of UDP it is best fit for Applications where you
are allowed to drop packets (like for example a monitoring application).</p> <p>The benefits are that it has a lot less overhead compared to TCP, which
can be handled by the NetServer and NetClient (see above).</p> <h2 id="creating-a-datagramsocket"><a href="#creating-a-datagramsocket" class="header-anchor">#</a> Creating a DatagramSocket</h2> <p>To use UDP you first need t create a <code>DatagramSocket</code>. It does not
matter here if you only want to send data or send and receive.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DatagramSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The returned <code>DatagramSocket</code> will not be bound to a specific port. This
is not a problem if you only want to send data (like a client), but more
on this in the next section.</p> <h2 id="sending-datagram-packets"><a href="#sending-datagram-packets" class="header-anchor">#</a> Sending Datagram packets</h2> <p>As mentioned before, User Datagram Protocol (UDP) sends data in packets
to remote peers but is not connected to them in a persistent fashion.</p> <p>This means each packet can be sent to a different remote peer.</p> <p>Sending packets is as easy as shown here:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> socket <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DatagramSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Send a Buffer</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;10.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Send succeeded? &quot;</span> <span class="token operator">+</span> asyncResult<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Send a String</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;A string used as content&quot;</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;10.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Send succeeded? &quot;</span> <span class="token operator">+</span> asyncResult<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="receiving-datagram-packets"><a href="#receiving-datagram-packets" class="header-anchor">#</a> Receiving Datagram packets</h2> <p>If you want to receive packets you need to bind the <code>DatagramSocket</code> by
calling <code>listen(…​)}</code> on it.</p> <p>This way you will be able to receive <code>DatagramPacket`s that were sent to the address and port on which the `DatagramSocket</code> listens.</p> <p>Beside this you also want to set a <code>Handler</code> which will be called for
each received <code>DatagramPacket</code>.</p> <p>The <code>DatagramPacket</code> has the following methods:</p> <ul><li><p><code>sender</code>: The InetSocketAddress which represent the sender of the
packet</p></li> <li><p><code>data</code>: The Buffer which holds the data which was received.</p></li></ul> <p>So to listen on a specific address and port you would do something like
shown here:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DatagramSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asyncResult<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">packet</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Do something with the packet</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Listen failed&quot;</span> <span class="token operator">+</span> asyncResult<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Be aware that even if the {code AsyncResult} is successed it only means
it might be written on the network stack, but gives no guarantee that it
ever reached or will reach the remote peer at all.</p> <p>If you need such a guarantee then you want to use TCP with some
handshaking logic build on top.</p> <h2 id="multicast"><a href="#multicast" class="header-anchor">#</a> Multicast</h2> <h3 id="sending-multicast-packets"><a href="#sending-multicast-packets" class="header-anchor">#</a> Sending Multicast packets</h3> <p>Multicast allows multiple sockets to receive the same packets. This
works by having the sockets join the same multicast group to which you
can then send packets.</p> <p>We will look at how you can join a Multicast Group and receive packets
in the next section.</p> <p>Sending multicast packets is not different than sending normal Datagram
packets. The difference is that you pass in a multicast group address to
the send method.</p> <p>This is show here:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> socket <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DatagramSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Send a Buffer to a multicast address</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;230.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Send succeeded? &quot;</span> <span class="token operator">+</span> asyncResult<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>All sockets that have joined the multicast group 230.0.0.1 will receive
the packet.</p> <h4 id="receiving-multicast-packets"><a href="#receiving-multicast-packets" class="header-anchor">#</a> Receiving Multicast packets</h4> <p>If you want to receive packets for specific Multicast group you need to
bind the <code>DatagramSocket</code> by calling <code>listen(…​)</code> on it to join the
Multicast group.</p> <p>This way you will receive DatagramPackets that were sent to the address
and port on which the <code>DatagramSocket</code> listens and also to those sent to
the Multicast group.</p> <p>Beside this you also want to set a Handler which will be called for each
received DatagramPacket.</p> <p>The <code>DatagramPacket</code> has the following methods:</p> <ul><li><p><code>sender()</code>: The InetSocketAddress which represent the sender of the
packet</p></li> <li><p><code>data()</code>: The Buffer which holds the data which was received.</p></li></ul> <p>So to listen on a specific address and port and also receive packets for
the Multicast group 230.0.0.1 you would do something like shown here:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DatagramSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asyncResult<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">packet</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Do something with the packet</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// join the multicast group</span>
    socket<span class="token punctuation">.</span><span class="token function">listenMulticastGroup</span><span class="token punctuation">(</span><span class="token string">&quot;230.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Listen succeeded? &quot;</span> <span class="token operator">+</span> asyncResult2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Listen failed&quot;</span> <span class="token operator">+</span> asyncResult<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="unlisten-leave-a-multicast-group"><a href="#unlisten-leave-a-multicast-group" class="header-anchor">#</a> Unlisten / leave a Multicast group</h4> <p>There are sometimes situations where you want to receive packets for a
Multicast group for a limited time.</p> <p>In this situations you can first start to listen for them and then later
unlisten.</p> <p>This is shown here:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DatagramSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asyncResult<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">packet</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Do something with the packet</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// join the multicast group</span>
    socket<span class="token punctuation">.</span><span class="token function">listenMulticastGroup</span><span class="token punctuation">(</span><span class="token string">&quot;230.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>asyncResult2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// will now receive packets for group</span>

        <span class="token comment">// do some work</span>

        socket<span class="token punctuation">.</span><span class="token function">unlistenMulticastGroup</span><span class="token punctuation">(</span><span class="token string">&quot;230.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Unlisten succeeded? &quot;</span> <span class="token operator">+</span> asyncResult3<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Listen failed&quot;</span> <span class="token operator">+</span> asyncResult2<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Listen failed&quot;</span> <span class="token operator">+</span> asyncResult<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="blocking-multicast"><a href="#blocking-multicast" class="header-anchor">#</a> Blocking multicast</h4> <p>Beside unlisten a Multicast address it’s also possible to just block
multicast for a specific sender address.</p> <p>Be aware this only work on some Operating Systems and kernel versions.
So please check the Operating System documentation if it’s supported.</p> <p>This an expert feature.</p> <p>To block multicast from a specific address you can call
<code>blockMulticastGroup(…​)</code> on the DatagramSocket like shown here:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DatagramSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Some code</span>

<span class="token comment">// This would block packets which are send from 10.0.0.2</span>
socket<span class="token punctuation">.</span><span class="token function">blockMulticastGroup</span><span class="token punctuation">(</span><span class="token string">&quot;230.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10.0.0.2&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">asyncResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;block succeeded? &quot;</span> <span class="token operator">+</span> asyncResult<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="datagramsocket-properties"><a href="#datagramsocket-properties" class="header-anchor">#</a> DatagramSocket properties</h3> <p>When creating a <code>DatagramSocket</code> there are multiple properties you can
set to change it’s behaviour with the <code>DatagramSocketOptions</code> object.
Those are listed here:</p> <ul><li><p><code>setSendBufferSize</code> Sets the send buffer size in bytes.</p></li> <li><p><code>setReceiveBufferSize</code> Sets the TCP receive buffer size in bytes.</p></li> <li><p><code>setReuseAddress</code> If true then addresses in TIME_WAIT state can be
reused after they have been closed.</p></li> <li><p><code>setTrafficClass</code></p></li> <li><p><code>setBroadcast</code> Sets or clears the SO_BROADCAST socket option. When
this option is set, Datagram (UDP) packets may be sent to a local
interface’s broadcast address.</p></li> <li><p><code>setMulticastNetworkInterface</code> Sets or clears the
IP_MULTICAST_LOOP socket option. When this option is set,
multicast packets will also be received on the local interface.</p></li> <li><p><code>setMulticastTimeToLive</code> Sets the IP_MULTICAST_TTL socket option.
TTL stands for &quot;Time to Live,&quot; but in this context it specifies the
number of IP hops that a packet is allowed to go through,
specifically for multicast traffic. Each router or gateway that
forwards a packet decrements the TTL. If the TTL is decremented to 0
by a router, it will not be forwarded.</p></li></ul> <h3 id="datagramsocket-local-address"><a href="#datagramsocket-local-address" class="header-anchor">#</a> DatagramSocket Local Address</h3> <p>You can find out the local address of the socket (i.e. the address of
this side of the UDP Socket) by calling <code>localAddress</code>. This will only
return an <code>InetSocketAddress</code> if you bound the <code>DatagramSocket</code> with
<code>listen(…​)</code> before, otherwise it will return null.</p> <h3 id="closing-a-datagramsocket"><a href="#closing-a-datagramsocket" class="header-anchor">#</a> Closing a DatagramSocket</h3> <p>You can close a socket by invoking the <code>close</code> method. This will close
the socket and release all resources</p> <h1 id="dns-client"><a href="#dns-client" class="header-anchor">#</a> DNS client</h1> <p>Often you will find yourself in situations where you need to obtain DNS
informations in an asynchronous fashion. Unfortunally this is not
possible with the API that is shipped with the Java Virtual Machine
itself. Because of this Vert.x offers it’s own API for DNS resolution
which is fully asynchronous.</p> <p>To obtain a DnsClient instance you will create a new via the Vertx
instance.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;10.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also create the client with options and configure the query
timeout.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DnsClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;10.0.0.1&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setQueryTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Creating the client with no arguments or omitting the server address
will use the address of the server used internally for non blocking
address resolution.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client1 <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Just the same but with a different query timeout</span>
<span class="token keyword">let</span> client2 <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DnsClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setQueryTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="lookup"><a href="#lookup" class="header-anchor">#</a> lookup</h2> <p>Try to lookup the A (ipv4) or AAAA (ipv6) record for a given name. The
first which is returned will be used, so it behaves the same way as you
may be used from when using &quot;nslookup&quot; on your operation system.</p> <p>To lookup the A / AAAA record for &quot;vertx.io&quot; you would typically use it
like:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="lookup4"><a href="#lookup4" class="header-anchor">#</a> lookup4</h2> <p>Try to lookup the A (ipv4) record for a given name. The first which is
returned will be used, so it behaves the same way as you may be used
from when using &quot;nslookup&quot; on your operation system.</p> <p>To lookup the A record for &quot;vertx.io&quot; you would typically use it like:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">lookup4</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="lookup6"><a href="#lookup6" class="header-anchor">#</a> lookup6</h2> <p>Try to lookup the AAAA (ipv6) record for a given name. The first which
is returned will be used, so it behaves the same way as you may be used
from when using &quot;nslookup&quot; on your operation system.</p> <p>To lookup the A record for &quot;vertx.io&quot; you would typically use it like:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">lookup6</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resolvea"><a href="#resolvea" class="header-anchor">#</a> resolveA</h2> <p>Try to resolve all A (ipv4) records for a given name. This is quite
similar to using &quot;dig&quot; on unix like operation systems.</p> <p>To lookup all the A records for &quot;vertx.io&quot; you would typically do:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">resolveA</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> records <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    records<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resolveaaaa"><a href="#resolveaaaa" class="header-anchor">#</a> resolveAAAA</h2> <p>Try to resolve all AAAA (ipv6) records for a given name. This is quite
similar to using &quot;dig&quot; on unix like operation systems.</p> <p>To lookup all the AAAAA records for &quot;vertx.io&quot; you would typically do:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">resolveAAAA</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> records <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    records<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resolvecname"><a href="#resolvecname" class="header-anchor">#</a> resolveCNAME</h2> <p>Try to resolve all CNAME records for a given name. This is quite similar
to using &quot;dig&quot; on unix like operation systems.</p> <p>To lookup all the CNAME records for &quot;vertx.io&quot; you would typically do:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">resolveCNAME</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> records <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    records<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resolvemx"><a href="#resolvemx" class="header-anchor">#</a> resolveMX</h2> <p>Try to resolve all MX records for a given name. The MX records are used
to define which Mail-Server accepts emails for a given domain.</p> <p>To lookup all the MX records for &quot;vertx.io&quot; you would typically do:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">resolveMX</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> records <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    records<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Be aware that the List will contain the <code>MxRecord</code> sorted by the
priority of them, which means MX records with smaller priority coming
first in the List.</p> <p>The <code>MxRecord</code> allows you to access the priority and the name of the MX
record by offer methods for it like:</p> <div class="language-js extra-class"><pre class="language-js"><code>record<span class="token punctuation">.</span><span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
record<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resolvetxt"><a href="#resolvetxt" class="header-anchor">#</a> resolveTXT</h2> <p>Try to resolve all TXT records for a given name. TXT records are often
used to define extra informations for a domain.</p> <p>To resolve all the TXT records for &quot;vertx.io&quot; you could use something
along these lines:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">resolveTXT</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> records <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    records<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resolvens"><a href="#resolvens" class="header-anchor">#</a> resolveNS</h2> <p>Try to resolve all NS records for a given name. The NS records specify
which DNS Server hosts the DNS informations for a given domain.</p> <p>To resolve all the NS records for &quot;vertx.io&quot; you could use something
along these lines:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">resolveNS</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> records <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    records<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resolvesrv"><a href="#resolvesrv" class="header-anchor">#</a> resolveSRV</h2> <p>Try to resolve all SRV records for a given name. The SRV records are
used to define extra informations like port and hostname of services.
Some protocols need this extra informations.</p> <p>To lookup all the SRV records for &quot;vertx.io&quot; you would typically do:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">resolveSRV</span><span class="token punctuation">(</span><span class="token string">&quot;vertx.io&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> records <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    records<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Be aware that the List will contain the SrvRecords sorted by the
priority of them, which means SrvRecords with smaller priority coming
first in the List.</p> <p>The <code>SrvRecord</code> allows you to access all informations contained in the
SRV record itself:</p> <div class="language-js extra-class"><pre class="language-js"><code>record<span class="token punctuation">.</span><span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
record<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
record<span class="token punctuation">.</span><span class="token function">weight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
record<span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
record<span class="token punctuation">.</span><span class="token function">protocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
record<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
record<span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Please refer to the API docs for the exact details.</p> <h2 id="resolveptr"><a href="#resolveptr" class="header-anchor">#</a> resolvePTR</h2> <p>Try to resolve the PTR record for a given name. The PTR record maps an
ipaddress to a name.</p> <p>To resolve the PTR record for the ipaddress 10.0.0.1 you would use the
PTR notion of &quot;1.0.0.10.in-addr.arpa&quot;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">resolvePTR</span><span class="token punctuation">(</span><span class="token string">&quot;1.0.0.10.in-addr.arpa&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> record <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="reverselookup"><a href="#reverselookup" class="header-anchor">#</a> reverseLookup</h2> <p>Try to do a reverse lookup for an ipaddress. This is basically the same
as resolve a PTR record, but allows you to just pass in the ipaddress
and not a valid PTR query string.</p> <p>To do a reverse lookup for the ipaddress 10.0.0.1 do something similar
like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createDnsClient</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token string">&quot;9.9.9.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">reverseLookup</span><span class="token punctuation">(</span><span class="token string">&quot;10.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> record <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to resolve entry&quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error handling</h2> <p>As you saw in previous sections the DnsClient allows you to pass in a
Handler which will be notified with an AsyncResult once the query was
complete. In case of an error it will be notified with a DnsException
which will hole a {@link io.vertx.core.dns.DnsResponseCode} that
indicate why the resolution failed. This DnsResponseCode can be used to
inspect the cause in more detail.</p> <p>Possible DnsResponseCodes are:</p> <ul><li><p>{@link io.vertx.core.dns.DnsResponseCode#NOERROR} No record was
found for a given query</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#FORMERROR} Format error</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#SERVFAIL} Server failure</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#NXDOMAIN} Name error</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#NOTIMPL} Not implemented
by DNS Server</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#REFUSED} DNS Server
refused the query</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#YXDOMAIN} Domain name
should not exist</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#YXRRSET} Resource record
should not exist</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#NXRRSET} RRSET does not
exist</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#NOTZONE} Name not in zone</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#BADVERS} Bad extension
mechanism for version</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#BADSIG} Bad signature</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#BADKEY} Bad key</p></li> <li><p>{@link io.vertx.core.dns.DnsResponseCode#BADTIME} Bad timestamp</p></li></ul> <p>All of those errors are &quot;generated&quot; by the DNS Server itself.</p> <p>You can obtain the DnsResponseCode from the DnsException like:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token annotation punctuation">@link</span> docoverride<span class="token punctuation">.</span>dns<span class="token punctuation">.</span><span class="token class-name">Examples</span>#example16<span class="token punctuation">}</span>
</code></pre></div><h1 id="streams"><a href="#streams" class="header-anchor">#</a> Streams</h1> <p>There are several objects in Vert.x that allow items to be read from and
written.</p> <p>In previous versions the <code>io.vertx.core.streams</code> package was
manipulating <code>Buffer</code> objects exclusively. From now, streams are not
coupled to buffers anymore and they work with any kind of objects.</p> <p>In Vert.x, write calls return immediately, and writes are queued
internally.</p> <p>It’s not hard to see that if you write to an object faster than it can
actually write the data to its underlying resource, then the write queue
can grow unbounded - eventually resulting in memory exhaustion.</p> <p>To solve this problem a simple flow control (<em>back-pressure</em>) capability
is provided by some objects in the Vert.x API.</p> <p>Any flow control aware object that can be <em>written-to</em> implements
<code>WriteStream</code>, while any flow control object that can be <em>read-from</em> is
said to implement <code>ReadStream</code>.</p> <p>Let’s take an example where we want to read from a <code>ReadStream</code> then
write the data to a <code>WriteStream</code>.</p> <p>A very simple example would be reading from a <code>NetSocket</code> then writing
back to the same <code>NetSocket</code> - since <code>NetSocket</code> implements both
<code>ReadStream</code> and <code>WriteStream</code>. Note that this works between any
<code>ReadStream</code> and <code>WriteStream</code> compliant object, including HTTP
requests, HTTP responses, async files I/O, WebSockets, etc.</p> <p>A naive way to do this would be to directly take the data that has been
read and immediately write it to the <code>NetSocket</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sock</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  sock<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Write the data straight back</span>
    sock<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>There is a problem with the example above: if data is read from the
socket faster than it can be written back to the socket, it will build
up in the write queue of the <code>NetSocket</code>, eventually running out of RAM.
This might happen, for example if the client at the other end of the
socket wasn’t reading fast enough, effectively putting back-pressure on
the connection.</p> <p>Since <code>NetSocket</code> implements <code>WriteStream</code>, we can check if the
<code>WriteStream</code> is full before writing to it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sock</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  sock<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sock<span class="token punctuation">.</span><span class="token function">writeQueueFull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sock<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This example won’t run out of RAM but we’ll end up losing data if the
write queue gets full. What we really want to do is pause the
<code>NetSocket</code> when the write queue is full:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sock</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  sock<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    sock<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sock<span class="token punctuation">.</span><span class="token function">writeQueueFull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sock<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We’re almost there, but not quite. The <code>NetSocket</code> now gets paused when
the file is full, but we also need to unpause it when the write queue
has processed its backlog:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sock</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  sock<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    sock<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sock<span class="token punctuation">.</span><span class="token function">writeQueueFull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sock<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      sock<span class="token punctuation">.</span><span class="token function">drainHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        sock<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And there we have it. The <code>drainHandler</code> event handler will get called
when the write queue is ready to accept more data, this resumes the
<code>NetSocket</code> that allows more data to be read.</p> <p>Wanting to do this is quite common while writing Vert.x applications, so
we added the <code>pipeTo</code> method that does all of this hard work for you.
You just feed it the <code>WriteStream</code> and use it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sock</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  sock<span class="token punctuation">.</span><span class="token function">pipeTo</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This does exactly the same thing as the more verbose example, plus it
handles stream failures and termination: the destination <code>WriteStream</code>
is ended when the pipe completes with success or a failure.</p> <p>You can be notified when the operation completes:</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sock</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Pipe the socket providing an handler to be notified of the result</span>
  sock<span class="token punctuation">.</span><span class="token function">pipeTo</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Pipe succeeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Pipe failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When you deal with an asynchronous destination, you can create a <code>Pipe</code>
instance that pauses the source and resumes it when the source is piped
to the destination:</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sock</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Create a pipe to use asynchronously</span>
  <span class="token keyword">let</span> pipe <span class="token operator">=</span> sock<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Open a destination file</span>
  fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/file&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> file <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Pipe the socket to the file and close the file at the end</span>
      pipe<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      sock<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When you need to abort the transfer, you need to close it:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Create a pipe that to use asynchronously</span>
  <span class="token keyword">let</span> pipe <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Open a destination file</span>
  fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/file&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> file <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Pipe the socket to the file and close the file at the end</span>
      pipe<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Close the pipe and resume the request, the body buffers will be discarded</span>
      pipe<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Send an error response</span>
      request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When the pipe is closed, the streams handlers are unset and the
<code>ReadStream</code> resumed.</p> <p>As seen above, by default the destination is always ended when the
stream completes, you can control this behavior on the pipe object:</p> <ul><li><p><code>endOnFailure</code> controls the behavior when a failure happens</p></li> <li><p><code>endOnSuccess</code> controls the behavior when the read stream ends</p></li> <li><p><code>endOnComplete</code> controls the behavior in all cases</p></li></ul> <p>Here is a short example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
src<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endOnSuccess</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Append some text and close the file</span>
  dst<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Let’s now look at the methods on <code>ReadStream</code> and <code>WriteStream</code> in more
detail:</p> <h2 id="readstream"><a href="#readstream" class="header-anchor">#</a> ReadStream</h2> <p><code>ReadStream</code> is implemented by <code>HttpClientResponse</code>, <code>DatagramSocket</code>,
<code>HttpClientRequest</code>, <code>HttpServerFileUpload</code>, <code>HttpServerRequest</code>,
<code>MessageConsumer</code>, <code>NetSocket</code>, <code>WebSocket</code>, <code>TimeoutStream</code>,
<code>AsyncFile</code>.</p> <p>Functions:</p> <ul><li><p><code>handler</code>: set a handler which will receive items from the
ReadStream.</p></li> <li><p><code>pause</code>: pause the handler. When paused no items will be received in
the handler.</p></li> <li><p><code>resume</code>: resume the handler. The handler will be called if any item
arrives.</p></li> <li><p><code>exceptionHandler</code>: Will be called if an exception occurs on the
ReadStream.</p></li> <li><p><code>endHandler</code>: Will be called when end of stream is reached. This
might be when EOF is reached if the ReadStream represents a file, or
when end of request is reached if it’s an HTTP request, or when the
connection is closed if it’s a TCP socket.</p></li></ul> <h2 id="writestream"><a href="#writestream" class="header-anchor">#</a> WriteStream</h2> <p><code>WriteStream</code> is implemented by <code>HttpClientRequest</code>,
<code>HttpServerResponse</code> <code>WebSocket</code>, <code>NetSocket</code>, <code>AsyncFile</code>, and
<code>MessageProducer</code></p> <p>Functions:</p> <ul><li><p><code>write</code>: write an object to the WriteStream. This method will never
block. Writes are queued internally and asynchronously written to
the underlying resource.</p></li> <li><p><code>setWriteQueueMaxSize</code>: set the number of object at which the write
queue is considered <em>full</em>, and the method <code>writeQueueFull</code> returns
<code>true</code>. Note that, when the write queue is considered full, if write
is called the data will still be accepted and queued. The actual
number depends on the stream implementation, for <code>Buffer</code> the size
represents the actual number of bytes written and not the number of
buffers.</p></li> <li><p><code>writeQueueFull</code>: returns <code>true</code> if the write queue is considered
full.</p></li> <li><p><code>exceptionHandler</code>: Will be called if an exception occurs on the
<code>WriteStream</code>.</p></li> <li><p><code>drainHandler</code>: The handler will be called if the <code>WriteStream</code> is
considered no longer full.</p></li></ul> <h2 id="pump"><a href="#pump" class="header-anchor">#</a> Pump</h2> <p>The pump exposes a subset of the pipe API and only transfers the items
between streams, it does not handle the completion or failure of the
transfer operation.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Pump <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NetServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sock</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Pump<span class="token punctuation">.</span><span class="token function">pump</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> sock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Important</strong></p> <p>Before Vert.x 3.7 the <code>Pump</code> was the advocated API for transferring a
read stream to a write stream. Since 3.7 the pipe API supersedes the
pump API.</p></blockquote> <p>Instances of Pump have the following methods:</p> <ul><li><p><code>start</code>: Start the pump.</p></li> <li><p><code>stop</code>: Stops the pump. When the pump starts it is in stopped mode.</p></li> <li><p><code>setWriteQueueMaxSize</code>: This has the same meaning as
<code>setWriteQueueMaxSize</code> on the <code>WriteStream</code>.</p></li></ul> <p>A pump can be started and stopped multiple times.</p> <p>When a pump is first created it is <em>not</em> started. You need to call the
<code>start()</code> method to start it.</p> <h1 id="record-parser"><a href="#record-parser" class="header-anchor">#</a> Record Parser</h1> <p>The record parser allows you to easily parse protocols which are
delimited by a sequence of bytes, or fixed size records. It transforms a
sequence of input buffer to a sequence of buffer structured as
configured (either fixed size or separated records).</p> <p>For example, if you have a simple ASCII text protocol delimited by '\n'
and the input is the following:</p> <div class="language- extra-class"><pre><code>buffer1:HELLO\nHOW ARE Y
buffer2:OU?\nI AM
buffer3: DOING OK
buffer4:\n
</code></pre></div><p>The record parser would produce</p> <div class="language- extra-class"><pre><code>buffer1:HELLO
buffer2:HOW ARE YOU?
buffer3:I AM DOING OK
</code></pre></div><p>Let’s see the associated code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RecordParser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> parser <span class="token operator">=</span> RecordParser<span class="token punctuation">.</span><span class="token function">newDelimited</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

parser<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;HELLO\nHOW ARE Y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parser<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;OU?\nI AM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parser<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;DOING OK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parser<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also produce fixed sized chunks as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RecordParser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
RecordParser<span class="token punctuation">.</span><span class="token function">newFixed</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For more details, check out the <code>RecordParser</code> class.</p> <h1 id="json-parser"><a href="#json-parser" class="header-anchor">#</a> Json Parser</h1> <p>You can easily parse JSON structures but that requires to provide the
JSON content at once, but it may not be convenient when you need to
parse very large structures.</p> <p>The non-blocking JSON parser is an event driven parser able to deal with
very large structures. It transforms a sequence of input buffer to a
sequence of JSON parse events.</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><p>The parser is non-blocking and emitted events are driven by the input
buffers.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> JsonParser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> parser <span class="token operator">=</span> JsonParser<span class="token punctuation">.</span><span class="token function">newParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// start array event</span>
<span class="token comment">// start object event</span>
<span class="token comment">// &quot;firstName&quot;:&quot;Bob&quot; event</span>
parser<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;[{\&quot;firstName\&quot;:\&quot;Bob\&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &quot;lastName&quot;:&quot;Morane&quot; event</span>
<span class="token comment">// end object event</span>
parser<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;\&quot;lastName\&quot;:\&quot;Morane\&quot;},&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// start object event</span>
<span class="token comment">// &quot;firstName&quot;:&quot;Luke&quot; event</span>
<span class="token comment">// &quot;lastName&quot;:&quot;Lucky&quot; event</span>
<span class="token comment">// end object event</span>
parser<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;firstName\&quot;:\&quot;Luke\&quot;,\&quot;lastName\&quot;:\&quot;Lucky\&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// end array event</span>
parser<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Always call end</span>
parser<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Event driven parsing provides more control but comes at the price of
dealing with fine grained events, which can be inconvenient sometimes.
The JSON parser allows you to handle JSON structures as values when it
is desired:</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><p>The value mode can be set and unset during the parsing allowing you to
switch between fine grained events or JSON object value events.</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><p>You can do the same with arrays as well</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><p>You can also decode POJOs</p> <div class="language-js extra-class"><pre class="language-js"><code>parser<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handle each object</span>
  <span class="token comment">// Get the field in which this object was parsed</span>
  <span class="token keyword">let</span> id <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">fieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> user <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">mapTo</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;examples.ParseToolsExamples.User&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User with id &quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Whenever the parser fails to process a buffer, an exception will be
thrown unless you set an exception handler:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> JsonParser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> parser <span class="token operator">=</span> JsonParser<span class="token punctuation">.</span><span class="token function">newParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

parser<span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Catch any parsing or decoding error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The parser also parses json streams:</p> <ul><li><p>concatenated json streams: <code>{&quot;temperature&quot;:30}{&quot;temperature&quot;:50}</code></p></li> <li><p>line delimited json streams: <code>{&quot;an&quot;:&quot;object&quot;}\r\n3\r\n&quot;a string&quot;\r\nnull</code></p></li></ul> <p>For more details, check out the <code>JsonParser</code> class.</p> <h1 id="thread-safety"><a href="#thread-safety" class="header-anchor">#</a> Thread safety</h1> <p>Most Vert.x objects are safe to access from different threads. <em>However</em>
performance is optimised when they are accessed from the same context
they were created from.</p> <p>For example if you have deployed a verticle which creates a <code>NetServer</code>
which provides <code>NetSocket</code> instances in it’s handler, then it’s best to
always access that socket instance from the event loop of the verticle.</p> <p>If you stick to the standard Vert.x verticle deployment model and avoid
sharing objects between verticles then this should be the case without
you having to think about it.</p> <h1 id="metrics-spi"><a href="#metrics-spi" class="header-anchor">#</a> Metrics SPI</h1> <p>By default Vert.x does not record any metrics. Instead it provides an
SPI for others to implement which can be added to the classpath. The
metrics SPI is an advanced feature which allows implementers to capture
events from Vert.x in order to gather metrics. For more information on
this, please consult the <code>API Documentation</code>.</p> <p>You can also specify a metrics factory programmatically if embedding
Vert.x using <code>setFactory</code>.</p> <h1 id="osgi"><a href="#osgi" class="header-anchor">#</a> OSGi</h1> <p>Vert.x Core is packaged as an OSGi bundle, so can be used in any OSGi
R4.2+ environment such as Apache Felix or Eclipse Equinox. The bundle
exports <code>io.vertx.core*</code>.</p> <p>However, the bundle has some dependencies on Jackson and Netty. To get
the vert.x core bundle resolved deploy:</p> <ul><li><p>Jackson Annotation [2.6.0,3)</p></li> <li><p>Jackson Core [2.6.2,3)</p></li> <li><p>Jackson Databind [2.6.2,3)</p></li> <li><p>Netty Buffer [4.0.31,5)</p></li> <li><p>Netty Codec [4.0.31,5)</p></li> <li><p>Netty Codec/Socks [4.0.31,5)</p></li> <li><p>Netty Codec/Common [4.0.31,5)</p></li> <li><p>Netty Codec/Handler [4.0.31,5)</p></li> <li><p>Netty Codec/Transport [4.0.31,5)</p></li></ul> <p>Here is a working deployment on Apache Felix 5.2.0:</p> <div class="language- extra-class"><pre><code>14|Active     |    1|Jackson-annotations (2.6.0)
15|Active     |    1|Jackson-core (2.6.2)
16|Active     |    1|jackson-databind (2.6.2)
18|Active     |    1|Netty/Buffer (4.0.31.Final)
19|Active     |    1|Netty/Codec (4.0.31.Final)
20|Active     |    1|Netty/Codec/HTTP (4.0.31.Final)
21|Active     |    1|Netty/Codec/Socks (4.0.31.Final)
22|Active     |    1|Netty/Common (4.0.31.Final)
23|Active     |    1|Netty/Handler (4.0.31.Final)
24|Active     |    1|Netty/Transport (4.0.31.Final)
25|Active     |    1|Netty/Transport/SCTP (4.0.31.Final)
26|Active     |    1|Vert.x Core (3.1.0)
</code></pre></div><p>On Equinox, you may want to disable the <code>ContextFinder</code> with the
following framework property: <code>eclipse.bundle.setTCCL=false</code></p> <h1 id="the-vertx-command-line"><a href="#the-vertx-command-line" class="header-anchor">#</a> The 'vertx' command line</h1> <p>The <code>vertx</code> command is used to interact with Vert.x from the command
line. It’s main use is to run Vert.x verticles. To do this you need to
download and install a Vert.x distribution, and add the <code>bin</code> directory
of the installation to your <code>PATH</code> environment variable. Also make sure
you have a Java 8 JDK on your <code>PATH</code>.</p> <blockquote><p><strong>Note</strong></p> <p>The JDK is required to support on the fly compilation of Java code.</p></blockquote> <h2 id="run-verticles"><a href="#run-verticles" class="header-anchor">#</a> Run verticles</h2> <p>You can run raw Vert.x verticles directly from the command line using
<code>vertx run</code>. Here is a couple of examples of the <code>run</code> <em>command</em>:</p> <div class="language- extra-class"><pre><code>vertx run my-verticle.js                                 (1)
vertx run my-verticle.groovy                             (2)
vertx run my-verticle.rb                                 (3)

vertx run io.vertx.example.MyVerticle                    (4)
vertx run io.vertx.example.MVerticle -cp my-verticle.jar (5)

vertx run MyVerticle.java                                (6)
</code></pre></div><ol><li><p>Deploys a JavaScript verticle</p></li> <li><p>Deploys a Groovy verticle</p></li> <li><p>Deploys a Ruby verticle</p></li> <li><p>Deploys an already compiled Java verticle. Classpath root is the
current directory</p></li> <li><p>Deploys a verticle packaged in a Jar, the jar need to be in the
classpath</p></li> <li><p>Compiles the Java source and deploys it</p></li></ol> <p>As you can see in the case of Java, the name can either be the fully
qualified class name of the verticle, or you can specify the Java Source
file directly and Vert.x compiles it for you.</p> <p>You can also prefix the verticle with the name of the language
implementation to use. For example if the verticle is a compiled Groovy
class, you prefix it with <code>groovy:</code> so that Vert.x knows it’s a Groovy
class not a Java class.</p> <div class="language- extra-class"><pre><code>vertx run groovy:io.vertx.example.MyGroovyVerticle
</code></pre></div><p>The <code>vertx run</code> command can take a few optional parameters, they are:</p> <ul><li><p><code>-options &lt;options&gt;</code> - Provides the Vert.x options. <code>options</code> is the
name of a JSON file that represents the Vert.x options, or a JSON
string. This is optional.</p></li> <li><p><code>-conf &lt;config&gt;</code> - Provides some configuration to the verticle.
<code>config</code> is the name of a JSON file that represents the
configuration for the verticle, or a JSON string. This is optional.</p></li> <li><p><code>-cp &lt;path&gt;</code> - The path on which to search for the verticle and any
other resources used by the verticle. This defaults to <code>.</code> (current
directory). If your verticle references other scripts, classes or
other resources (e.g. jar files) then make sure these are on this
path. The path can contain multiple path entries separated by <code>:</code>
(colon) or <code>;</code> (semi-colon) depending on the operating system. Each
path entry can be an absolute or relative path to a directory
containing scripts, or absolute or relative filenames for jar or zip
files. An example path might be <code>-cp classes:lib/otherscripts:jars/myjar.jar:jars/otherjar.jar</code>. Always
use the path to reference any resources that your verticle requires.
Do <strong>not</strong> put them on the system classpath as this can cause
isolation issues between deployed verticles.</p></li> <li><p><code>-instances &lt;instances&gt;</code> - The number of instances of the verticle
to instantiate. Each verticle instance is strictly single threaded
so to scale your application across available cores you might want
to deploy more than one instance. If omitted a single instance will
be deployed.</p></li> <li><p><code>-worker</code> - This option determines whether the verticle is a worker
verticle or not.</p></li> <li><p><code>-cluster</code> - This option determines whether the Vert.x instance will
attempt to form a cluster with other Vert.x instances on the
network. Clustering Vert.x instances allows Vert.x to form a
distributed event bus with other nodes. Default is <code>false</code> (not
clustered).</p></li> <li><p><code>-cluster-port</code> - If the <code>cluster</code> option has also been specified
then this determines which port will be bound for cluster
communication with other Vert.x instances. Default is <code>0</code> - which
means '<em>choose a free random port</em>'. You don’t usually need to
specify this parameter unless you really need to bind to a specific
port.</p></li> <li><p><code>-cluster-host</code> - If the <code>cluster</code> option has also been specified
then this determines which host address will be bound for cluster
communication with other Vert.x instances. By default it will try
and pick one from the available interfaces. If you have more than
one interface and you want to use a specific one, specify it here.</p></li> <li><p><code>-cluster-public-port</code> - If the <code>cluster</code> option has also been
specified then this determines which port will be advertised for
cluster communication with other Vert.x instances. Default is <code>-1</code>,
which means same as <code>cluster-port</code>.</p></li> <li><p><code>-cluster-public-host</code> - If the <code>cluster</code> option has also been
specified then this determines which host address will be advertised
for cluster communication with other Vert.x instances. If not
specified, Vert.x uses the value of <code>cluster-host</code>.</p></li> <li><p><code>-ha</code> - if specified the verticle will be deployed as high
availability (HA) deployment. See related section for more details</p></li> <li><p><code>-quorum</code> - used in conjunction with <code>-ha</code>. It specifies the minimum
number of nodes in the cluster for any <em>HA deploymentIDs</em> to be
active. Defaults to 0.</p></li> <li><p><code>-hagroup</code> - used in conjunction with <code>-ha</code>. It specifies the HA
group this node will join. There can be multiple HA groups in a
cluster. Nodes will only failover to other nodes in the same group.
The default value is ` __DEFAULT__`</p></li></ul> <p>You can also set system properties using: <code>-Dkey=value</code>.</p> <p>Here are some more examples:</p> <p>Run a JavaScript verticle server.js with default settings</p> <div class="language- extra-class"><pre><code>vertx run server.js
</code></pre></div><p>Run 10 instances of a pre-compiled Java verticle specifying classpath</p> <div class="language- extra-class"><pre><code>vertx run com.acme.MyVerticle -cp &quot;classes:lib/myjar.jar&quot; -instances 10
</code></pre></div><p>Run 10 instances of a Java verticle by source <em>file</em></p> <div class="language- extra-class"><pre><code>vertx run MyVerticle.java -instances 10
</code></pre></div><p>Run 20 instances of a ruby worker verticle</p> <div class="language- extra-class"><pre><code>vertx run order_worker.rb -instances 20 -worker
</code></pre></div><p>Run two JavaScript verticles on the same machine and let them cluster
together with each other and any other servers on the network</p> <div class="language- extra-class"><pre><code>vertx run handler.js -cluster
vertx run sender.js -cluster
</code></pre></div><p>Run a Ruby verticle passing it some config</p> <div class="language- extra-class"><pre><code>vertx run my_verticle.rb -conf my_verticle.conf
</code></pre></div><p>Where <code>my_verticle.conf</code> might contain something like:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;num_widgets&quot;</span><span class="token operator">:</span> <span class="token number">46</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The config will be available inside the verticle via the core API.</p> <p>When using the high-availability feature of vert.x you may want to
create a <em>bare</em> instance of vert.x. This instance does not deploy any
verticles when launched, but will receive a verticle if another node of
the cluster dies. To create a <em>bare</em> instance, launch:</p> <div class="language- extra-class"><pre><code>vertx bare
</code></pre></div><p>Depending on your cluster configuration, you may have to append the
<code>cluster-host</code> and <code>cluster-port</code> parameters.</p> <h2 id="executing-a-vert-x-application-packaged-as-a-fat-jar"><a href="#executing-a-vert-x-application-packaged-as-a-fat-jar" class="header-anchor">#</a> Executing a Vert.x application packaged as a fat jar</h2> <p>A <em>fat jar</em> is an executable jar embedding its dependencies. This means
you don’t have to have Vert.x pre-installed on the machine on which you
execute the jar. Like any executable Java jar it can be executed with.</p> <div class="language- extra-class"><pre><code>java -jar my-application-fat.jar
</code></pre></div><p>There is nothing really Vert.x specific about this, you could do this
with any Java application</p> <p>You can either create your own main class and specify that in the
manifest, but it’s recommended that you write your code as verticles and
use the Vert.x <code>Launcher</code> class (<code>io.vertx.core.Launcher</code>) as your main
class. This is the same main class used when running Vert.x at the
command line and therefore allows you to specify command line arguments,
such as <code>-instances</code> in order to scale your application more easily.</p> <p>To deploy your verticle in a <em>fatjar</em> like this you must have a
<em>manifest</em> with:</p> <ul><li><p><code>Main-Class</code> set to <code>io.vertx.core.Launcher</code></p></li> <li><p><code>Main-Verticle</code> specifying the main verticle (fully qualified class
name or script file name)</p></li></ul> <p>You can also provide the usual command line arguments that you would
pass to <code>vertx run</code>:</p> <div class="language- extra-class"><pre><code>java -jar my-verticle-fat.jar -cluster -conf myconf.json
java -jar my-verticle-fat.jar -cluster -conf myconf.json -cp path/to/dir/conf/cluster_xml
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>Please consult the Maven/Gradle simplest and Maven/Gradle verticle
examples in the examples repository for examples of building
applications as fatjars.</p></blockquote> <p>A fat jar executes the <code>run</code> command, by default.</p> <h2 id="displaying-version-of-vert-x"><a href="#displaying-version-of-vert-x" class="header-anchor">#</a> Displaying version of Vert.x</h2> <p>To display the vert.x version, just launch:</p> <div class="language- extra-class"><pre><code>vertx version
</code></pre></div><h2 id="other-commands"><a href="#other-commands" class="header-anchor">#</a> Other commands</h2> <p>The <code>vertx</code> command line and the <code>Launcher</code> also provide other
<em>commands</em> in addition to <code>run</code> and <code>version</code>:</p> <p>You can create a <code>bare</code> instance using:</p> <div class="language- extra-class"><pre><code>vertx bare
# or
java -jar my-verticle-fat.jar bare
</code></pre></div><p>You can also start an application in background using:</p> <div class="language- extra-class"><pre><code>java -jar my-verticle-fat.jar start --vertx-id=my-app-name
</code></pre></div><p>If <code>my-app-name</code> is not set, a random id will be generated, and printed
on the command prompt. You can pass <code>run</code> options to the <code>start</code>
command:</p> <div class="language- extra-class"><pre><code>java -jar my-verticle-fat.jar start —-vertx-id=my-app-name -cluster
</code></pre></div><p>Once launched in background, you can stop it with the <code>stop</code> command:</p> <div class="language- extra-class"><pre><code>java -jar my-verticle-fat.jar stop my-app-name
</code></pre></div><p>You can also list the vert.x application launched in background using:</p> <div class="language- extra-class"><pre><code>java -jar my-verticle-fat.jar list
</code></pre></div><p>The <code>start</code>, <code>stop</code> and <code>list</code> command are also available from the
<code>vertx</code> tool. The start` command supports a couple of options:</p> <ul><li><p><code>vertx-id</code> : the application id, uses a random UUID if not set</p></li> <li><p><code>java-opts</code> : the Java Virtual Machine options, uses the <code>JAVA_OPTS</code>
environment variable if not set.</p></li> <li><p><code>redirect-output</code> : redirect the spawned process output and error
streams to the parent process streams.</p></li></ul> <p>If option values contain spaces, don’t forget to wrap the value between
<code>&quot;&quot;</code> (double-quotes).</p> <p>As the <code>start</code> command spawns a new process, the java options passed to
the JVM are not propagated, so you <strong>must</strong> use <code>java-opts</code> to configure
the JVM (<code>-X</code>, <code>-D</code>…​). If you use the <code>CLASSPATH</code> environment variable,
be sure it contains all the required jars (vertx-core, your jars and all
the dependencies).</p> <p>The set of commands is extensible, refer to the <a href="#_extending_the_vert_x_launcher">Extending the vert.x
Launcher</a> section.</p> <h2 id="live-redeploy"><a href="#live-redeploy" class="header-anchor">#</a> Live Redeploy</h2> <p>When developing it may be convenient to automatically redeploy your
application upon file changes. The <code>vertx</code> command line tool and more
generally the <code>Launcher</code> class offers this feature. Here are some
examples:</p> <div class="language- extra-class"><pre><code>vertx run MyVerticle.groovy --redeploy=&quot;**&amp;#47;*.groovy&quot; --launcher-class=io.vertx.core.Launcher
vertx run MyVerticle.groovy --redeploy=&quot;**&amp;#47;*.groovy,**&amp;#47;*.rb&quot;  --launcher-class=io.vertx.core.Launcher
java io.vertx.core.Launcher run org.acme.MyVerticle --redeploy=&quot;**&amp;#47;*.class&quot;  --launcher-class=io.vertx.core
.Launcher -cp ...
</code></pre></div><p>The redeployment process is implemented as follows. First your
application is launched as a background application (with the <code>start</code>
command). On matching file changes, the process is stopped and the
application is restarted. This avoids leaks, as the process is
restarted.</p> <p>To enable the live redeploy, pass the <code>--redeploy</code> option to the <code>run</code>
command. The <code>--redeploy</code> indicates the set of file to <em>watch</em>. This set
can use Ant-style patterns (with <code>**</code>, <code>*</code> and <code>?</code>). You can specify
several sets by separating them using a comma (<code>,</code>). Patterns are
relative to the current working directory.</p> <p>Parameters passed to the <code>run</code> command are passed to the application.
Java Virtual Machine options can be configured using <code>--java-opts</code>. For
instance, to pass the the <code>conf</code> parameter or a system property, you
need to use: <code>--java-opts=&quot;-conf=my-conf.json -Dkey=value&quot;</code></p> <p>The <code>--launcher-class</code> option determine with with <em>main</em> class the
application is launcher. It’s generally <code>Launcher</code>, but you have use you
own <em>main</em>.</p> <p>The redeploy feature can be used in your IDE:</p> <ul><li><p>Eclipse - create a <em>Run</em> configuration, using the
<code>io.vertx.core.Launcher</code> class a <em>main class</em>. In the <em>Program
arguments</em> area (in the <em>Arguments</em> tab), write <code>run your-verticle-fully-qualified-name --redeploy=**/*.java --launcher-class=io.vertx.core.Launcher</code>. You can also add other
parameters. The redeployment works smoothly as Eclipse incrementally
compiles your files on save.</p></li> <li><p>IntelliJ - create a <em>Run</em> configuration (<em>Application</em>), set the
<em>Main class</em> to <code>io.vertx.core.Launcher</code>. In the Program arguments
write: <code>run your-verticle-fully-qualified-name --redeploy=**/*.class --launcher-class=io.vertx.core.Launcher</code>. To trigger the
redeployment, you need to <em>make</em> the project or the module
explicitly (<em>Build</em> menu → <em>Make project</em>).</p></li></ul> <p>To debug your application, create your run configuration as a remote
application and configure the debugger using <code>--java-opts</code>. However,
don’t forget to re-plug the debugger after every redeployment as a new
process is created every time.</p> <p>You can also hook your build process in the redeploy cycle:</p> <div class="language- extra-class"><pre><code>java -jar target/my-fat-jar.jar --redeploy=&quot;**&amp;#47;*.java&quot; --on-redeploy=&quot;mvn package&quot;
java -jar build/libs/my-fat-jar.jar --redeploy=&quot;src&amp;#47;**&amp;#47;*.java&quot; --on-redeploy='./gradlew shadowJar'
</code></pre></div><p>The &quot;on-redeploy&quot; option specifies a command invoked after the shutdown
of the application and before the restart. So you can hook your build
tool if it updates some runtime artifacts. For instance, you can launch
<code>gulp</code> or <code>grunt</code> to update your resources. Don’t forget that passing
parameters to your application requires the <code>--java-opts</code> param:</p> <div class="language- extra-class"><pre><code>java -jar target/my-fat-jar.jar --redeploy=&quot;**&amp;#47;*.java&quot; --on-redeploy=&quot;mvn package&quot; --java-opts=&quot;-Dkey=val&quot;
java -jar build/libs/my-fat-jar.jar --redeploy=&quot;src&amp;#47;**&amp;#47;*.java&quot; --on-redeploy='./gradlew shadowJar' --java-opts=&quot;-Dkey=val&quot;
</code></pre></div><p>The redeploy feature also supports the following settings:</p> <ul><li><p><code>redeploy-scan-period</code> : the file system check period (in
milliseconds), 250ms by default</p></li> <li><p><code>redeploy-grace-period</code> : the amount of time (in milliseconds) to
wait between 2 re-deployments, 1000ms by default</p></li> <li><p><code>redeploy-termination-period</code> : the amount of time to wait after
having stopped the application (before launching user command). This
is useful on Windows, where the process is not killed immediately.
The time is given in milliseconds. 0 ms by default.</p></li></ul> <h1 id="cluster-managers"><a href="#cluster-managers" class="header-anchor">#</a> Cluster Managers</h1> <p>In Vert.x a cluster manager is used for various functions including:</p> <ul><li><p>Discovery and group membership of Vert.x nodes in a cluster</p></li> <li><p>Maintaining cluster wide topic subscriber lists (so we know which
nodes are interested in which event bus addresses)</p></li> <li><p>Distributed Map support</p></li> <li><p>Distributed Locks</p></li> <li><p>Distributed Counters</p></li></ul> <p>Cluster managers <em>do not</em> handle the event bus inter-node transport,
this is done directly by Vert.x with TCP connections.</p> <p>The default cluster manager used in the Vert.x distributions is one that
uses <a href="http://hazelcast.com" target="_blank" rel="noopener noreferrer">Hazelcast<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> but this can be easily replaced
by a different implementation as Vert.x cluster managers are pluggable.</p> <p>A cluster manager must implement the interface <code>ClusterManager</code>. Vert.x
locates cluster managers at run-time by using the Java <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html" target="_blank" rel="noopener noreferrer">Service
Loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
functionality to locate instances of <code>ClusterManager</code> on the classpath.</p> <p>If you are using Vert.x at the command line and you want to use
clustering you should make sure the <code>lib</code> directory of the Vert.x
installation contains your cluster manager jar.</p> <p>If you are using Vert.x from a Maven or Gradle project just add the
cluster manager jar as a dependency of your project.</p> <p>You can also specify cluster managers programmatically if embedding
Vert.x using <code>setClusterManager</code>.</p> <h1 id="logging"><a href="#logging" class="header-anchor">#</a> Logging</h1> <p>Vert.x logs using it’s in-built logging API. The default implementation
uses the JDK (JUL) logging so no extra logging dependencies are needed.</p> <h2 id="configuring-jul-logging"><a href="#configuring-jul-logging" class="header-anchor">#</a> Configuring JUL logging</h2> <p>A JUL logging configuration file can be specified in the normal JUL way
by providing a system property called: <code>java.util.logging.config.file</code>
with the value being your configuration file. For more information on
this and the structure of a JUL config file please consult the JUL
logging documentation.</p> <p>Vert.x also provides a slightly more convenient way to specify a
configuration file without having to set a system property. Just provide
a JUL config file with the name <code>vertx-default-jul-logging.properties</code>
on your classpath (e.g. inside your fatjar) and Vert.x will use that to
configure JUL.</p> <h2 id="using-another-logging-framework"><a href="#using-another-logging-framework" class="header-anchor">#</a> Using another logging framework</h2> <p>If you don’t want Vert.x to use JUL for it’s own logging you can
configure it to use another logging framework, e.g. Log4J or SLF4J.</p> <p>To do this you should set a system property called
<code>vertx.logger-delegate-factory-class-name</code> with the name of a Java class
which implements the interface <code>LogDelegateFactory</code>. We provide
pre-built implementations for Log4J (version 1), Log4J 2 and SLF4J with
the class names <code>io.vertx.core.logging.Log4jLogDelegateFactory</code>,
<code>io.vertx.core.logging.Log4j2LogDelegateFactory</code> and
<code>io.vertx.core.logging.SLF4JLogDelegateFactory</code> respectively. If you
want to use these implementations you should also make sure the relevant
Log4J or SLF4J jars are on your classpath.</p> <p>Notice that, the provided delegate for Log4J 1 does not support
parameterized message. The delegate for Log4J 2 uses the <code>{}</code> syntax
like the SLF4J delegate. JUL delegate uses the <code>{x}</code> syntax.</p> <h2 id="netty-logging"><a href="#netty-logging" class="header-anchor">#</a> Netty logging</h2> <p>When configuring logging, you should care about configuring Netty
logging as well.</p> <p>Netty does not rely on external logging configuration (e.g system
properties) and instead implements a logging configuration based on the
logging libraries visible from the Netty classes:</p> <ul><li><p>use <code>SLF4J</code> library if it is visible</p></li> <li><p>otherwise use <code>Log4j</code> if it is visible</p></li> <li><p>otherwise fallback <code>java.util.logging</code></p></li></ul> <p>The logger implementation can be forced to a specific implementation by
setting Netty’s internal logger implementation directly on
<code>io.netty.util.internal.logging.InternalLoggerFactory</code>:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Force logging to Log4j</span>
<span class="token class-name">InternalLoggerFactory</span><span class="token punctuation">.</span><span class="token function">setDefaultFactory</span><span class="token punctuation">(</span><span class="token class-name">Log4JLoggerFactory</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="troubleshooting"><a href="#troubleshooting" class="header-anchor">#</a> Troubleshooting</h2> <h3 id="slf4j-warning-at-startup"><a href="#slf4j-warning-at-startup" class="header-anchor">#</a> SLF4J warning at startup</h3> <p>If, when you start your application, you see the following message:</p> <div class="language- extra-class"><pre><code>SLF4J: Failed to load class &quot;org.slf4j.impl.StaticLoggerBinder&quot;.
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
</code></pre></div><p>It means that you have SLF4J-API in your classpath but no actual
binding. Messages logged with SLF4J will be dropped. You should add a
binding to your classpath. Check
<a href="https://www.slf4j.org/manual.html#swapping" target="_blank" rel="noopener noreferrer">https://www.slf4j.org/manual.html#swapping<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to pick a binding and
configure it.</p> <p>Be aware that Netty looks for the SLF4-API jar and uses it by default.</p> <h3 id="connection-reset-by-peer"><a href="#connection-reset-by-peer" class="header-anchor">#</a> Connection reset by peer</h3> <p>If your logs show a bunch of:</p> <div class="language- extra-class"><pre><code>io.vertx.core.net.impl.ConnectionBase
SEVERE: java.io.IOException: Connection reset by peer
</code></pre></div><p>It means that the client is resetting the HTTP connection instead of
closing it. This message also indicates that you may have not consumed
the complete payload (the connection was cut before you were able to).</p> <h1 id="host-name-resolution"><a href="#host-name-resolution" class="header-anchor">#</a> Host name resolution</h1> <p>Vert.x uses an an address resolver for resolving host name into IP
addresses instead of the JVM built-in blocking resolver.</p> <p>An host name resolves to an IP address using:</p> <ul><li><p>the <em>hosts</em> file of the operating system</p></li> <li><p>otherwise DNS queries against a list of servers</p></li></ul> <p>By default it will use the list of the system DNS server addresses from
the environment, if that list cannot be retrieved it will use Google’s
public DNS servers <code>&quot;8.8.8.8&quot;</code> and <code>&quot;8.8.4.4&quot;</code>.</p> <p>DNS servers can be also configured when creating a {@link
io.vertx.core.Vertx} instance:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.CoreExamples#configureDNSServers}
</code></pre></div><p>The default port of a DNS server is <code>53</code>, when a server uses a different
port, this port can be set using a colon delimiter: <code>192.168.0.2:40000</code>.</p> <blockquote><p><strong>Note</strong></p> <p>sometimes it can be desirable to use the JVM built-in resolver, the
JVM system property <em>-Dvertx.disableDnsResolver=true</em> activates this
behavior</p></blockquote> <h2 id="failover"><a href="#failover" class="header-anchor">#</a> Failover</h2> <p>When a server does not reply in a timely manner, the resolver will try
the next one from the list, the search is limited by {@link
io.vertx.core.dns.AddressResolverOptions#setMaxQueries(int)} (the
default value is <code>4</code> queries).</p> <p>A DNS query is considered as failed when the resolver has not received a
correct answer within {@link
io.vertx.core.dns.AddressResolverOptions#getQueryTimeout()}
milliseconds (the default value is <code>5</code> seconds).</p> <h2 id="server-list-rotation"><a href="#server-list-rotation" class="header-anchor">#</a> Server list rotation</h2> <p>By default the dns server selection uses the first one, the remaining
servers are used for failover.</p> <p>You can configure {@link
io.vertx.core.dns.AddressResolverOptions#setRotateServers(boolean)} to
<code>true</code> to let the resolver perform a round-robin selection instead. It
spreads the query load among the servers and avoids all lookup to hit
the first server of the list.</p> <p>Failover still applies and will use the next server in the list.</p> <h2 id="hosts-mapping"><a href="#hosts-mapping" class="header-anchor">#</a> Hosts mapping</h2> <p>The <em>hosts</em> file of the operating system is used to perform an hostname
lookup for an ipaddress.</p> <p>An alternative <em>hosts</em> file can be used instead:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.CoreExamples#configureHosts}
</code></pre></div><h2 id="search-domains"><a href="#search-domains" class="header-anchor">#</a> Search domains</h2> <p>By default the resolver will use the system DNS search domains from the
environment. Alternatively an explicit search domain list can be
provided:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.CoreExamples#configureSearchDomains()}
</code></pre></div><p>When a search domain list is used, the threshold for the number of dots
is <code>1</code> or loaded from <code>/etc/resolv.conf</code> on Linux, it can be configured
to a specific value with {@link
io.vertx.core.dns.AddressResolverOptions#setNdots(int)}.</p> <h1 id="high-availability-and-fail-over"><a href="#high-availability-and-fail-over" class="header-anchor">#</a> High Availability and Fail-Over</h1> <p>Vert.x allows you to run your verticles with high availability (HA)
support. In that case, when a vert.x instance running a verticle dies
abruptly, the verticle is migrated to another vertx instance. The vert.x
instances must be in the same cluster.</p> <h2 id="automatic-failover"><a href="#automatic-failover" class="header-anchor">#</a> Automatic failover</h2> <p>When vert.x runs with <em>HA</em> enabled, if a vert.x instance where a
verticle runs fails or dies, the verticle is redeployed automatically on
another vert.x instance of the cluster. We call this <em>verticle
fail-over</em>.</p> <p>To run vert.x with the <em>HA</em> enabled, just add the <code>-ha</code> flag to the
command line:</p> <div class="language- extra-class"><pre><code>vertx run my-verticle.js -ha
</code></pre></div><p>Now for HA to work, you need more than one Vert.x instances in the
cluster, so let’s say you have another Vert.x instance that you have
already started, for example:</p> <div class="language- extra-class"><pre><code>vertx run my-other-verticle.js -ha
</code></pre></div><p>If the Vert.x instance that is running <code>my-verticle.js</code> now dies (you
can test this by killing the process with <code>kill -9</code>), the Vert.x
instance that is running <code>my-other-verticle.js</code> will automatic deploy
<code>my-verticle .js</code> so now that Vert.x instance is running both verticles.</p> <blockquote><p><strong>Note</strong></p> <p>the migration is only possible if the second vert.x instance has
access to the verticle file (here <code>my-verticle.js</code>).</p></blockquote> <blockquote><p><strong>Important</strong></p> <p>Please note that cleanly closing a Vert.x instance will not cause
failover to occur, e.g. <code>CTRL-C</code> or <code>kill -SIGINT</code></p></blockquote> <p>You can also start <em>bare</em> Vert.x instances - i.e. instances that are not
initially running any verticles, they will also failover for nodes in
the cluster. To start a bare instance you simply do:</p> <div class="language- extra-class"><pre><code>vertx run -ha
</code></pre></div><p>When using the <code>-ha</code> switch you do not need to provide the <code>-cluster</code>
switch, as a cluster is assumed if you want HA.</p> <blockquote><p><strong>Note</strong></p> <p>depending on your cluster configuration, you may need to customize the
cluster manager configuration (Hazelcast by default), and/or add the
<code>cluster-host</code> and <code>cluster-port</code> parameters.</p></blockquote> <h2 id="ha-groups"><a href="#ha-groups" class="header-anchor">#</a> HA groups</h2> <p>When running a Vert.x instance with HA you can also optional specify a
<em>HA group</em>. A HA group denotes a logical group of nodes in the cluster.
Only nodes with the same HA group will failover onto one another. If you
don’t specify a HA group the default group <code>__DEFAULT__</code> is used.</p> <p>To specify an HA group you use the <code>-hagroup</code> switch when running the
verticle, e.g.</p> <div class="language- extra-class"><pre><code>vertx run my-verticle.js -ha -hagroup my-group
</code></pre></div><p>Let’s look at an example:</p> <p>In a first terminal:</p> <div class="language- extra-class"><pre><code>vertx run my-verticle.js -ha -hagroup g1
</code></pre></div><p>In a second terminal, let’s run another verticle using the same group:</p> <div class="language- extra-class"><pre><code>vertx run my-other-verticle.js -ha -hagroup g1
</code></pre></div><p>Finally, in a third terminal, launch another verticle using a different
group:</p> <div class="language- extra-class"><pre><code>vertx run yet-another-verticle.js -ha -hagroup g2
</code></pre></div><p>If we kill the instance in terminal 1, it will fail over to the instance
in terminal 2, not the instance in terminal 3 as that has a different
group.</p> <p>If we kill the instance in terminal 3, it won’t get failed over as there
is no other vert.x instance in that group.</p> <h2 id="dealing-with-network-partitions-quora"><a href="#dealing-with-network-partitions-quora" class="header-anchor">#</a> Dealing with network partitions - Quora</h2> <p>The HA implementation also supports quora. A quorum is the minimum
number of votes that a distributed transaction has to obtain in order to
be allowed to perform an operation in a distributed system.</p> <p>When starting a Vert.x instance you can instruct it that it requires a
<code>quorum</code> before any HA deployments will be deployed. In this context, a
quorum is a minimum number of nodes for a particular group in the
cluster. Typically you chose your quorum size to <code>Q = 1 + N/2</code> where <code>N</code>
is the number of nodes in the group. If there are less than <code>Q</code> nodes in
the cluster the HA deployments will undeploy. They will redeploy again
if/when a quorum is re-attained. By doing this you can prevent against
network partitions, a.k.a. <em>split brain</em>.</p> <p>There is more information on quora
<a href="http://en.wikipedia.org/wiki/Quorum_(distributed_computing)" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>To run vert.x instances with a quorum you specify <code>-quorum</code> on the
command line, e.g.</p> <p>In a first terminal:</p> <div class="language- extra-class"><pre><code>vertx run my-verticle.js -ha -quorum 3
</code></pre></div><p>At this point the Vert.x instance will start but not deploy the module
(yet) because there is only one node in the cluster, not 3.</p> <p>In a second terminal:</p> <div class="language- extra-class"><pre><code>vertx run my-other-verticle.js -ha -quorum 3
</code></pre></div><p>At this point the Vert.x instance will start but not deploy the module
(yet) because there are only two nodes in the cluster, not 3.</p> <p>In a third console, you can start another instance of vert.x:</p> <div class="language- extra-class"><pre><code>vertx run yet-another-verticle.js -ha -quorum 3
</code></pre></div><p>Yay! - we have three nodes, that’s a quorum. At this point the modules
will automatically deploy on all instances.</p> <p>If we now close or kill one of the nodes the modules will automatically
undeploy on the other nodes, as there is no longer a quorum.</p> <p>Quora can also be used in conjunction with ha groups. In that case,
quora are resolved for each particular group.</p> <h1 id="native-transports"><a href="#native-transports" class="header-anchor">#</a> Native transports</h1> <p>Vert.x can run with <a href="http://netty.io/wiki/native-transports.html" target="_blank" rel="noopener noreferrer">native
transports<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (when
available) on BSD (OSX) and Linux:</p> <div class="language-$lang extra-class"><pre class="language-text"><code>{@link examples.CoreExamples#configureNative()}
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>preferring native transport will not prevent the application to
execute (for example if a JAR is missing). If your application
requires native transport, you need to check {@link
io.vertx.core.Vertx#isNativeTransportEnabled()}.</p></blockquote> <h2 id="native-linux-transport"><a href="#native-linux-transport" class="header-anchor">#</a> Native Linux Transport</h2> <p>You need to add the following dependency in your classpath:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>netty-transport-native-epoll<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.15.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classifier</span><span class="token punctuation">&gt;</span></span>linux-x86_64<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classifier</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Native on Linux gives you extra networking options:</p> <ul><li><p><code>SO_REUSEPORT</code></p></li> <li><p><code>TCP_QUICKACK</code></p></li> <li><p><code>TCP_CORK</code></p></li> <li><p><code>TCP_FASTOPEN</code></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Available on Linux</span>
vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTcpFastOpen</span><span class="token punctuation">(</span>fastOpen<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTcpCork</span><span class="token punctuation">(</span>cork<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTcpQuickAck</span><span class="token punctuation">(</span>quickAck<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setReusePort</span><span class="token punctuation">(</span>reusePort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="native-bsd-transport"><a href="#native-bsd-transport" class="header-anchor">#</a> Native BSD Transport</h2> <p>You need to add the following dependency in your classpath:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>netty-transport-native-kqueue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.15.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classifier</span><span class="token punctuation">&gt;</span></span>osx-x86_64<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classifier</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>MacOS Sierra and above are supported.</p> <p>Native on BSD gives you extra networking options:</p> <ul><li><code>SO_REUSEPORT</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Available on BSD</span>
vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setReusePort</span><span class="token punctuation">(</span>reusePort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="domain-sockets"><a href="#domain-sockets" class="header-anchor">#</a> Domain sockets</h2> <p>Natives provide domain sockets support for servers:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> SocketAddress <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// Only available on BSD and Linux</span>
vertx<span class="token punctuation">.</span><span class="token function">createNetServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">so</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handle application</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>SocketAddress<span class="token punctuation">.</span><span class="token function">domainSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;/var/tmp/myservice.sock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>or for http:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> SocketAddress <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handle application</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>SocketAddress<span class="token punctuation">.</span><span class="token function">domainSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;/var/tmp/myservice.sock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Bound to socket</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As well as clients:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> SocketAddress <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> netClient <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createNetClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Only available on BSD and Linux</span>
<span class="token keyword">let</span> addr <span class="token operator">=</span> SocketAddress<span class="token punctuation">.</span><span class="token function">domainSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;/var/tmp/myservice.sock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Connect to the server</span>
netClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Connected</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>or for http:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> SocketAddress <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> httpClient <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Only available on BSD and Linux</span>
<span class="token keyword">let</span> addr <span class="token operator">=</span> SocketAddress<span class="token punctuation">.</span><span class="token function">domainSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;/var/tmp/myservice.sock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send request to the server</span>
httpClient<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>HttpMethod<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Process response</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="security-notes"><a href="#security-notes" class="header-anchor">#</a> Security notes</h1> <p>Vert.x is a toolkit, not an opinionated framework where we force you to
do things in a certain way. This gives you great power as a developer
but with that comes great responsibility.</p> <p>As with any toolkit, it’s possible to write insecure applications, so
you should always be careful when developing your application especially
if it’s exposed to the public (e.g. over the internet).</p> <h2 id="web-applications"><a href="#web-applications" class="header-anchor">#</a> Web applications</h2> <p>If writing a web application it’s highly recommended that you use
Vert.x-Web instead of Vert.x core directly for serving resources and
handling file uploads.</p> <p>Vert.x-Web normalises the path in requests to prevent malicious clients
from crafting URLs to access resources outside of the web root.</p> <p>Similarly for file uploads Vert.x-Web provides functionality for
uploading to a known place on disk and does not rely on the filename
provided by the client in the upload which could be crafted to upload to
a different place on disk.</p> <p>Vert.x core itself does not provide such checks so it would be up to you
as a developer to implement them yourself.</p> <h2 id="clustered-event-bus-traffic"><a href="#clustered-event-bus-traffic" class="header-anchor">#</a> Clustered event bus traffic</h2> <p>When clustering the event bus between different Vert.x nodes on a
network, the traffic is sent un-encrypted across the wire, so do not use
this if you have confidential data to send and your Vert.x nodes are not
on a trusted network.</p> <h2 id="standard-security-best-practices"><a href="#standard-security-best-practices" class="header-anchor">#</a> Standard security best practices</h2> <p>Any service can have potentially vulnerabilities whether it’s written
using Vert.x or any other toolkit so always follow security best
practice, especially if your service is public facing.</p> <p>For example you should always run them in a DMZ and with an user account
that has limited rights in order to limit the extent of damage in case
the service was compromised.</p> <h1 id="vert-x-command-line-interface-api"><a href="#vert-x-command-line-interface-api" class="header-anchor">#</a> Vert.x Command Line Interface API</h1> <p>Vert.x Core provides an API for parsing command line arguments passed to
programs. It’s also able to print help messages detailing the options
available for a command line tool. Even if such features are far from
the Vert.x core topics, this API is used in the <code>Launcher</code> class that
you can use in <em>fat-jar</em> and in the <code>vertx</code> command line tools. In
addition, it’s polyglot (can be used from any supported language) and is
used in Vert.x Shell.</p> <p>Vert.x CLI provides a model to describe your command line interface, but
also a parser. This parser supports different types of syntax:</p> <ul><li><p>POSIX like options (ie. <code>tar -zxvf foo.tar.gz</code>)</p></li> <li><p>GNU like long options (ie. <code>du --human-readable --max-depth=1</code>)</p></li> <li><p>Java like properties (ie. <code>java -Djava.awt.headless=true -Djava.net.useSystemProxies=true Foo</code>)</p></li> <li><p>Short options with value attached (ie. <code>gcc -O2 foo.c</code>)</p></li> <li><p>Long options with single hyphen (ie. <code>ant -projecthelp</code>)</p></li></ul> <p>Using the CLI api is a 3-steps process:</p> <ol><li><p>The definition of the command line interface</p></li> <li><p>The parsing of the user command line</p></li> <li><p>The query / interrogation</p></li></ol> <h2 id="definition-stage"><a href="#definition-stage" class="header-anchor">#</a> Definition Stage</h2> <p>Each command line interface must define the set of options and arguments
that will be used. It also requires a name. The CLI API uses the
<code>Option</code> and <code>Argument</code> classes to describe options and arguments:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;copy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSummary</span><span class="token punctuation">(</span><span class="token string">&quot;A command line interface to copy files.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;directory&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setShortName</span><span class="token punctuation">(</span><span class="token string">&quot;R&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;enables directory support&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Argument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;The source&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setArgName</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Argument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;The destination&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setArgName</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As you can see, you can create a new <code>CLI</code> using <code>CLI.create</code>. The
passed string is the name of the CLI. Once created you can set the
summary and description. The summary is intended to be short (one line),
while the description can contain more details. Each option and argument
are also added on the <code>CLI</code> object using the <code>addArgument</code> and
<code>addOption</code> methods.</p> <h3 id="options"><a href="#options" class="header-anchor">#</a> Options</h3> <p>An <code>Option</code> is a command line parameter identified by a <em>key</em> present in
the user command line. Options must have at least a long name or a short
name. Long name are generally used using a <code>--</code> prefix, while short
names are used with a single <code>-</code>. Options can get a description
displayed in the usage (see below). Options can receive 0, 1 or several
values. An option receiving 0 values is a <code>flag</code>, and must be declared
using <code>setFlag</code>. By default, options receive a single value, however,
you can configure the option to receive several values using
<code>setMultiValued</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;some-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSummary</span><span class="token punctuation">(</span><span class="token string">&quot;A command line interface illustrating the options valuation.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;flag&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setShortName</span><span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;a flag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;single&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setShortName</span><span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;a single-valued option&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;multiple&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setShortName</span><span class="token punctuation">(</span><span class="token string">&quot;m&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMultiValued</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;a multi-valued option&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Options can be marked as mandatory. A mandatory option not set in the
user command line throws an exception during the parsing:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;some-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;mandatory&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;a mandatory option&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Non-mandatory options can have a <em>default value</em>. This value would be
used if the user does not set the option in the command line:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;some-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;optional&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;an optional option with a default value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>An option can be <em>hidden</em> using the <code>setHidden</code> method. Hidden option
are not listed in the usage, but can still be used in the user command
line (for power-users).</p> <p>If the option value is contrained to a fixed set, you can set the
different acceptable choices:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;some-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;green&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setChoices</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;a color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Options can also be instantiated from their JSON form.</p> <h3 id="arguments"><a href="#arguments" class="header-anchor">#</a> Arguments</h3> <p>Unlike options, arguments do not have a <em>key</em> and are identified by
their <em>index</em>. For example, in <code>java com.acme.Foo</code>, <code>com.acme.Foo</code> is an
argument.</p> <p>Arguments do not have a name, there are identified using a 0-based
index. The first parameter has the index <code>0</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;some-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Argument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;the first argument&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setArgName</span><span class="token punctuation">(</span><span class="token string">&quot;arg1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Argument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;the second argument&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setArgName</span><span class="token punctuation">(</span><span class="token string">&quot;arg2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you don’t set the argument indexes, it computes it automatically by
using the declaration order.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;some-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Argument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;the first argument&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setArgName</span><span class="token punctuation">(</span><span class="token string">&quot;arg1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Argument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;the second argument&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setArgName</span><span class="token punctuation">(</span><span class="token string">&quot;arg2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>argName</code> is optional and used in the usage message.</p> <p>As options, <code>Argument</code> can:</p> <ul><li><p>be hidden using <code>setHidden</code></p></li> <li><p>be mandatory using <code>setRequired</code></p></li> <li><p>have a default value using <code>setDefaultValue</code></p></li> <li><p>receive several values using <code>setMultiValued</code> - only the last
argument can be multi-valued.</p></li></ul> <p>Arguments can also be instantiated from their JSON form.</p> <h3 id="usage-generation"><a href="#usage-generation" class="header-anchor">#</a> Usage generation</h3> <p>Once your <code>CLI</code> instance is configured, you can generate the <em>usage</em>
message:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;copy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSummary</span><span class="token punctuation">(</span><span class="token string">&quot;A command line interface to copy files.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;directory&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setShortName</span><span class="token punctuation">(</span><span class="token string">&quot;R&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;enables directory support&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Argument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;The source&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setArgName</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Argument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;The destination&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setArgName</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.StringBuilder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cli<span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It generates an usage message like this one:</p> <div class="language- extra-class"><pre><code>Usage: copy [-R] source target

A command line interface to copy files.

 -R,--directory   enables directory support
</code></pre></div><p>If you need to tune the usage message, check the <code>UsageMessageFormatter</code>
class.</p> <h2 id="parsing-stage"><a href="#parsing-stage" class="header-anchor">#</a> Parsing Stage</h2> <p>Once your <code>CLI</code> instance is configured, you can parse the user command
line to evaluate each option and argument:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> commandLine <span class="token operator">=</span> cli<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>userCommandLineArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>parse</code> method returns a <code>CommandLine</code> object containing the values.
By default, it validates the user command line and checks that each
mandatory options and arguments have been set as well as the number of
values received by each option. You can disable the validation by
passing <code>false</code> as second parameter of <code>parse</code>. This is useful if you
want to check an argument or option is present even if the parsed
command line is invalid.</p> <p>You can check whether or not the <code>CommandLine</code> is valid using <code>isValid</code>.</p> <h2 id="query-interrogation-stage"><a href="#query-interrogation-stage" class="header-anchor">#</a> Query / Interrogation Stage</h2> <p>Once parsed, you can retrieve the values of the options and arguments
from the <code>CommandLine</code> object returned by the <code>parse</code> method:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> commandLine <span class="token operator">=</span> cli<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>userCommandLineArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> opt <span class="token operator">=</span> commandLine<span class="token punctuation">.</span><span class="token function">getOptionValue</span><span class="token punctuation">(</span><span class="token string">&quot;my-option&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> flag <span class="token operator">=</span> commandLine<span class="token punctuation">.</span><span class="token function">isFlagEnabled</span><span class="token punctuation">(</span><span class="token string">&quot;my-flag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arg0 <span class="token operator">=</span> commandLine<span class="token punctuation">.</span><span class="token function">getArgumentValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>One of your option can have been marked as &quot;help&quot;. If a user command
line enabled a &quot;help&quot; option, the validation won’t failed, but give you
the opportunity to check if the user asks for help:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CLI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> cli <span class="token operator">=</span> <span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setShortName</span><span class="token punctuation">(</span><span class="token string">&quot;h&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHelp</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addOption</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLongName</span><span class="token punctuation">(</span><span class="token string">&quot;mandatory&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> line <span class="token operator">=</span> cli<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.Collections&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">&quot;-h&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The parsing does not fail and let you do:</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>line<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> line<span class="token punctuation">.</span><span class="token function">isAskingForHelp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.StringBuilder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cli<span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
  stream<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="the-vert-x-launcher"><a href="#the-vert-x-launcher" class="header-anchor">#</a> The vert.x Launcher</h1> <p>The vert.x <code>Launcher</code> is used in <em>fat jar</em> as main class, and by the
<code>vertx</code> command line utility. It executes a set of <em>commands</em> such as
<em>run</em>, <em>bare</em>, <em>start</em>…​</p> <h2 id="extending-the-vert-x-launcher"><a href="#extending-the-vert-x-launcher" class="header-anchor">#</a> Extending the vert.x Launcher</h2> <p>You can extend the set of command by implementing your own <code>Command</code> (in
Java only):</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&amp;</span>#<span class="token number">64</span><span class="token punctuation">;</span><span class="token class-name">Name</span><span class="token punctuation">(</span><span class="token string">&quot;my-command&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">64</span><span class="token punctuation">;</span><span class="token class-name">Summary</span><span class="token punctuation">(</span><span class="token string">&quot;A simple hello command.&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCommand</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultCommand</span> <span class="token punctuation">{</span>

 <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

 <span class="token operator">&amp;</span>#<span class="token number">64</span><span class="token punctuation">;</span><span class="token class-name">Option</span><span class="token punctuation">(</span>longName <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> n<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token operator">&amp;</span>#<span class="token number">64</span><span class="token punctuation">;</span><span class="token class-name">Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CLIException</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You also need an implementation of <code>CommandFactory</code>:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloCommandFactory</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultCommandFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HelloCommand</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token class-name">HelloCommandFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">HelloCommand</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then, create the
<code>src/main/resources/META-INF/services/io.vertx.core.spi.launcher.CommandFactory</code>
and add a line indicating the fully qualified name of the factory:</p> <div class="language- extra-class"><pre><code>io.vertx.core.launcher.example.HelloCommandFactory
</code></pre></div><p>Builds the jar containing the command. Be sure to includes the SPI file
(<code>META-INF/services/io.vertx.core.spi.launcher.CommandFactory</code>).</p> <p>Then, place the jar containing the command into the classpath of your
fat-jar (or include it inside) or in the <code>lib</code> directory of your vert.x
distribution, and you would be able to execute:</p> <div class="language- extra-class"><pre><code>vertx hello vert.x
java -jar my-fat-jar.jar hello vert.x
</code></pre></div><h2 id="using-the-launcher-in-fat-jars"><a href="#using-the-launcher-in-fat-jars" class="header-anchor">#</a> Using the Launcher in fat jars</h2> <p>To use the <code>Launcher</code> class in a <em>fat-jar</em> just set the <code>Main-Class</code> of
the <em>MANIFEST</em> to <code>io.vertx.core.Launcher</code>. In addition, set the
<code>Main-Verticle</code> <em>MANIFEST</em> entry to the name of your main verticle.</p> <p>By default, it executed the <code>run</code> command. However, you can configure
the default command by setting the <code>Main-Command</code> <em>MANIFEST</em> entry. The
default command is used if the <em>fat jar</em> is launched without a command.</p> <h2 id="sub-classing-the-launcher"><a href="#sub-classing-the-launcher" class="header-anchor">#</a> Sub-classing the Launcher</h2> <p>You can also create a sub-class of <code>Launcher</code> to start your application.
The class has been designed to be easily extensible.</p> <p>A <code>Launcher</code> sub-class can:</p> <ul><li><p>customize the vert.x configuration in <code>beforeStartingVertx</code></p></li> <li><p>retrieve the vert.x instance created by the &quot;run&quot; or &quot;bare&quot; command
by overriding <code>afterStartingVertx</code></p></li> <li><p>configure the default verticle and command with <code>getMainVerticle</code>
and <code>getDefaultCommand</code></p></li> <li><p>add / remove commands using <code>register</code> and <code>unregister</code></p></li></ul> <h2 id="launcher-and-exit-code"><a href="#launcher-and-exit-code" class="header-anchor">#</a> Launcher and exit code</h2> <p>When you use the <code>Launcher</code> class as main class, it uses the following
exit code:</p> <ul><li><p><code>0</code> if the process ends smoothly, or if an uncaught error is thrown</p></li> <li><p><code>1</code> for general purpose error</p></li> <li><p><code>11</code> if Vert.x cannot be initialized</p></li> <li><p><code>12</code> if a spawn process cannot be started, found or stopped. This
error code is used by the <code>start</code> and <code>stop</code> command</p></li> <li><p><code>14</code> if the system configuration is not meeting the system
requirement (shc as java not found)</p></li> <li><p><code>15</code> if the main verticle cannot be deployed</p></li></ul> <h1 id="configuring-vert-x-cache"><a href="#configuring-vert-x-cache" class="header-anchor">#</a> Configuring Vert.x cache</h1> <p>When Vert.x needs to read a file from the classpath (embedded in a fat
jar, in a jar form the classpath or a file that is on the classpath), it
copies it to a cache directory. The reason behind this is simple:
reading a file from a jar or from an input stream is blocking. So to
avoid to pay the price every time, Vert.x copies the file to its cache
directory and reads it from there every subsequent read. This behavior
can be configured.</p> <p>First, by default, Vert.x uses <code>$CWD/.vertx</code> as cache directory. It
creates a unique directory inside this one to avoid conflicts. This
location can be configured by using the <code>vertx.cacheDirBase</code> system
property. For instance if the current working directory is not writable
(such as in an immutable container context), launch your application
with:</p> <div class="language- extra-class"><pre><code>vertx run my.Verticle -Dvertx.cacheDirBase=/tmp/vertx-cache
# or
java -jar my-fat.jar vertx.cacheDirBase=/tmp/vertx-cache
</code></pre></div><blockquote><p><strong>Important</strong></p> <p>the directory must be <strong>writable</strong>.</p></blockquote> <p>When you are editing resources such as HTML, CSS or JavaScript, this
cache mechanism can be annoying as it serves only the first version of
the file (and so you won’t see your edits if you reload your page). To
avoid this behavior, launch your application with
<code>-Dvertx.disableFileCaching=true</code>. With this setting, Vert.x still uses
the cache, but always refresh the version stored in the cache with the
original source. So if you edit a file served from the classpath and
refresh your browser, Vert.x reads it from the classpath, copies it to
the cache directory and serves it from there. Do not use this setting in
production, it can kill your performances.</p> <p>Finally, you can disable completely the cache by using
<code>-Dvertx.disableFileCPResolving=true</code>. This setting is not without
consequences. Vert.x would be unable to read any files from the
classpath (only from the file system). Be very careful when using this
settings.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/core/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/30/2020, 11:09:36 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.cfb14a02.js" defer></script><script src="/es4x/assets/js/2.96613d0f.js" defer></script><script src="/es4x/assets/js/75.96ffdfe8.js" defer></script>
  </body>
</html>
