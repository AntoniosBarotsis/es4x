(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{306:function(e,a,t){"use strict";t.r(a);var s=t(38),n=Object(s.a)({},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"package"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#package","aria-hidden":"true"}},[e._v("#")]),e._v(" Package")]),e._v(" "),t("p",[e._v("Packaging applications should follow the "),t("code",[e._v("NPM")]),e._v(" style:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" pack\n")])])]),t("p",[t("a",{attrs:{href:"https://docs.npmjs.com/cli/pack",target:"_blank",rel:"noopener noreferrer"}},[e._v("npm pack"),t("OutboundLink")],1),e._v(" will produce a "),t("code",[e._v("TGZ")]),e._v(" with your application which you can move to other\nlocation. However applications can also be "),t("a",{attrs:{href:"https://docs.npmjs.com/cli/publish",target:"_blank",rel:"noopener noreferrer"}},[e._v("published"),t("OutboundLink")],1),e._v(" to a NPM registry.")]),e._v(" "),t("p",[e._v("It is important to notice that in order to work with "),t("code",[e._v("published/packed")]),e._v(" the target environment needs to have access to\nthe package "),t("a",{attrs:{href:"https://www.npmjs.com/package/es4x-pm",target:"_blank",rel:"noopener noreferrer"}},[e._v("es4x-pm"),t("OutboundLink")],1),e._v(" as it will be required to install the "),t("code",[e._v("java")]),e._v(" bits.")]),e._v(" "),t("h2",{attrs:{id:"docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker","aria-hidden":"true"}},[e._v("#")]),e._v(" Docker")]),e._v(" "),t("p",[e._v("Docker images can also be created for you for.")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("es4x dockerfile\n")])])]),t("p",[e._v("This will produce a simple "),t("code",[e._v("dockerfile")]),e._v(" that you can customize to your needs, by default the file will be a 3 stage\nbuild.")]),e._v(" "),t("ol",[t("li",[e._v("On the first stage "),t("code",[e._v("node")]),e._v(" is used to install all "),t("code",[e._v("NPM")]),e._v(" dependencies")]),e._v(" "),t("li",[e._v("On the second stage "),t("code",[e._v("java")]),e._v(" is used to install the "),t("code",[e._v("Maven")]),e._v(" dependencies")]),e._v(" "),t("li",[e._v("On the final stage the GraalVM image is used to run the application")])]),e._v(" "),t("p",[e._v("By default "),t("a",{attrs:{href:"https://hub.docker.com/r/oracle/graalvm-ce",target:"_blank",rel:"noopener noreferrer"}},[e._v("oracle/graalvm-ce"),t("OutboundLink")],1),e._v(" docker image is used, but it can be replace\nwith any other JDK image (please prefer versions 11 or above) with support for JVMCI.")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("docker build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" -arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BASEIMAGE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("openjdk:11\n")])])]),t("h2",{attrs:{id:"jlink"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jlink","aria-hidden":"true"}},[e._v("#")]),e._v(" JLink")]),e._v(" "),t("p",[e._v("Java 11 supports "),t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jlink.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("jlink"),t("OutboundLink")],1),e._v(". You can use the jlink tool to\nassemble and optimize a set of modules and their dependencies into a custom runtime image.")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("es4x jlink\n")])])]),t("p",[e._v("This will produce a "),t("strong",[e._v("optimized")]),e._v(" runtime, which means it can be used instead of relying on a full JDK installation.\nAs comparision, a hello world application will produce a runtime weighting about "),t("strong",[e._v("80Mb")]),e._v(", while a full JDK installation\nrequires around "),t("strong",[e._v("200Mb")]),e._v(".")]),e._v(" "),t("p",[e._v("This feature can be using in colaboration with "),t("code",[e._v("Dockerfile")]),e._v(". Instead of using the graal base image, use the "),t("code",[e._v("OpenJDK")]),e._v("\nbase image. Then on the second stage, run jlink:")]),e._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# Second stage (build the JVM related code)\nFROM openjdk:11 AS JVM\nARG ES4X_VERSION=${project.version}\n# force es4x maven resolution only to consider production dependencies\nENV ES4X_ENV=production\n# Copy the previous build step\nCOPY --from=NPM /usr/src/app /usr/src/app\n# use the copied workspace\nWORKDIR /usr/src/app\n# Download the ES4X runtime tool\nRUN curl -sL https://github.com/reactiverse/es4x/releases/download/${ES4X_VERSION}/es4x-pm-${ES4X_VERSION}-bin.tar.gz | \\\n    tar zx --strip-components=1 -C /usr/local\n# Install the Java Dependencies\nRUN es4x install -f\n# Create the optimized runtime\nRUN es4x jlink -t /usr/local\n")])])]),t("p",[e._v("This will produce the optimized runtime to jre, which can be used with a small base image for the final stage:")]),e._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('FROM debian:slim\n# Collect the jars from the previous step\nCOPY --from=JVM /usr/local /usr/local\nCOPY --from=JVM /usr/src/app /usr/src/app\n# use the copied workspace\nWORKDIR /usr/src/app\n# Bundle app source\nCOPY . .\n# Define custom java options for containers\nENV JAVA_OPTS="-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:+UseContainerSupport"\n# define the entrypoint\nENTRYPOINT [ "./node_modules/.bin/es4x-launcher" ]\n')])])]),t("p",[e._v("This will produce a small final image but a larger layer as you're packaging the optimized runtime too.")])])},[],!1,null,null,null);a.default=n.exports}}]);