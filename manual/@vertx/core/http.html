<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Writing HTTP servers and clients | ES for Eclipse Vert.x</title>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
  <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
  <script src="/es4x/player/asciinema-player.js"></script>
    
    <link rel="preload" href="/es4x/assets/css/0.styles.93ea0277.css" as="style"><link rel="preload" href="/es4x/assets/js/app.45f626e2.js" as="script"><link rel="preload" href="/es4x/assets/js/2.9528bf06.js" as="script"><link rel="preload" href="/es4x/assets/js/74.63ba0b89.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.4e356b44.js"><link rel="prefetch" href="/es4x/assets/js/100.cf2ccba6.js"><link rel="prefetch" href="/es4x/assets/js/101.8c6eded7.js"><link rel="prefetch" href="/es4x/assets/js/102.8f2e6411.js"><link rel="prefetch" href="/es4x/assets/js/103.d72d2546.js"><link rel="prefetch" href="/es4x/assets/js/104.03ea6f93.js"><link rel="prefetch" href="/es4x/assets/js/105.97bae8c0.js"><link rel="prefetch" href="/es4x/assets/js/106.9a2e2ca0.js"><link rel="prefetch" href="/es4x/assets/js/107.aeb22b58.js"><link rel="prefetch" href="/es4x/assets/js/108.bae986db.js"><link rel="prefetch" href="/es4x/assets/js/109.2b947af9.js"><link rel="prefetch" href="/es4x/assets/js/11.6cb08ab3.js"><link rel="prefetch" href="/es4x/assets/js/110.c71e71a1.js"><link rel="prefetch" href="/es4x/assets/js/111.593de263.js"><link rel="prefetch" href="/es4x/assets/js/112.0670c01a.js"><link rel="prefetch" href="/es4x/assets/js/113.53d46a58.js"><link rel="prefetch" href="/es4x/assets/js/114.c5556463.js"><link rel="prefetch" href="/es4x/assets/js/115.5743b73f.js"><link rel="prefetch" href="/es4x/assets/js/116.b7169463.js"><link rel="prefetch" href="/es4x/assets/js/117.94d01670.js"><link rel="prefetch" href="/es4x/assets/js/118.19a97283.js"><link rel="prefetch" href="/es4x/assets/js/119.d3fd593f.js"><link rel="prefetch" href="/es4x/assets/js/12.462e9a0b.js"><link rel="prefetch" href="/es4x/assets/js/120.ff97e661.js"><link rel="prefetch" href="/es4x/assets/js/121.1f1ea408.js"><link rel="prefetch" href="/es4x/assets/js/122.efa391c4.js"><link rel="prefetch" href="/es4x/assets/js/123.8176ba1b.js"><link rel="prefetch" href="/es4x/assets/js/124.f3b0f209.js"><link rel="prefetch" href="/es4x/assets/js/125.b11510bd.js"><link rel="prefetch" href="/es4x/assets/js/126.220618b5.js"><link rel="prefetch" href="/es4x/assets/js/127.1cd7573a.js"><link rel="prefetch" href="/es4x/assets/js/128.25319ee3.js"><link rel="prefetch" href="/es4x/assets/js/129.dc2cd690.js"><link rel="prefetch" href="/es4x/assets/js/13.86534a95.js"><link rel="prefetch" href="/es4x/assets/js/130.c8eab2ac.js"><link rel="prefetch" href="/es4x/assets/js/131.38e243ce.js"><link rel="prefetch" href="/es4x/assets/js/132.7b5be48d.js"><link rel="prefetch" href="/es4x/assets/js/133.c4a3d298.js"><link rel="prefetch" href="/es4x/assets/js/134.0a4d935c.js"><link rel="prefetch" href="/es4x/assets/js/135.366362b3.js"><link rel="prefetch" href="/es4x/assets/js/136.08fa614d.js"><link rel="prefetch" href="/es4x/assets/js/137.0cb036fd.js"><link rel="prefetch" href="/es4x/assets/js/138.467d7d28.js"><link rel="prefetch" href="/es4x/assets/js/139.cb378fe8.js"><link rel="prefetch" href="/es4x/assets/js/14.1906865f.js"><link rel="prefetch" href="/es4x/assets/js/140.36143b91.js"><link rel="prefetch" href="/es4x/assets/js/141.ed806584.js"><link rel="prefetch" href="/es4x/assets/js/142.13516e41.js"><link rel="prefetch" href="/es4x/assets/js/143.28297a8b.js"><link rel="prefetch" href="/es4x/assets/js/144.66f8db50.js"><link rel="prefetch" href="/es4x/assets/js/145.6da12fa8.js"><link rel="prefetch" href="/es4x/assets/js/146.d112bce8.js"><link rel="prefetch" href="/es4x/assets/js/147.7d52db6c.js"><link rel="prefetch" href="/es4x/assets/js/148.0fca2378.js"><link rel="prefetch" href="/es4x/assets/js/149.978c6cc9.js"><link rel="prefetch" href="/es4x/assets/js/15.7354219e.js"><link rel="prefetch" href="/es4x/assets/js/150.ca96a809.js"><link rel="prefetch" href="/es4x/assets/js/151.d272996f.js"><link rel="prefetch" href="/es4x/assets/js/152.9dbcc7b6.js"><link rel="prefetch" href="/es4x/assets/js/153.cf8da14b.js"><link rel="prefetch" href="/es4x/assets/js/154.ed046717.js"><link rel="prefetch" href="/es4x/assets/js/155.2b58da6a.js"><link rel="prefetch" href="/es4x/assets/js/156.fbc8b7da.js"><link rel="prefetch" href="/es4x/assets/js/157.0b67f2b3.js"><link rel="prefetch" href="/es4x/assets/js/158.dfe2036c.js"><link rel="prefetch" href="/es4x/assets/js/159.3e734a3c.js"><link rel="prefetch" href="/es4x/assets/js/16.e1582919.js"><link rel="prefetch" href="/es4x/assets/js/160.22aec581.js"><link rel="prefetch" href="/es4x/assets/js/161.83304a96.js"><link rel="prefetch" href="/es4x/assets/js/162.2e66100b.js"><link rel="prefetch" href="/es4x/assets/js/163.b623a314.js"><link rel="prefetch" href="/es4x/assets/js/164.c60e6322.js"><link rel="prefetch" href="/es4x/assets/js/165.9f3eb69b.js"><link rel="prefetch" href="/es4x/assets/js/17.54bde0b4.js"><link rel="prefetch" href="/es4x/assets/js/18.b5c20f2c.js"><link rel="prefetch" href="/es4x/assets/js/19.055d91ed.js"><link rel="prefetch" href="/es4x/assets/js/20.2a1467f5.js"><link rel="prefetch" href="/es4x/assets/js/21.351d0112.js"><link rel="prefetch" href="/es4x/assets/js/22.d7f7da51.js"><link rel="prefetch" href="/es4x/assets/js/23.8c7fdb15.js"><link rel="prefetch" href="/es4x/assets/js/24.e10c3043.js"><link rel="prefetch" href="/es4x/assets/js/25.c430d31f.js"><link rel="prefetch" href="/es4x/assets/js/26.16bd25ee.js"><link rel="prefetch" href="/es4x/assets/js/27.9eae56e3.js"><link rel="prefetch" href="/es4x/assets/js/28.7328b6a0.js"><link rel="prefetch" href="/es4x/assets/js/29.acbccb35.js"><link rel="prefetch" href="/es4x/assets/js/3.ea01a935.js"><link rel="prefetch" href="/es4x/assets/js/30.54c5acd8.js"><link rel="prefetch" href="/es4x/assets/js/31.be66d5df.js"><link rel="prefetch" href="/es4x/assets/js/32.65ce4eb7.js"><link rel="prefetch" href="/es4x/assets/js/33.ae2a52a4.js"><link rel="prefetch" href="/es4x/assets/js/34.0ad20f26.js"><link rel="prefetch" href="/es4x/assets/js/35.bb3728a5.js"><link rel="prefetch" href="/es4x/assets/js/36.0d06c159.js"><link rel="prefetch" href="/es4x/assets/js/37.b5eb90bc.js"><link rel="prefetch" href="/es4x/assets/js/38.96c660f9.js"><link rel="prefetch" href="/es4x/assets/js/39.41e1b587.js"><link rel="prefetch" href="/es4x/assets/js/4.fc776d3f.js"><link rel="prefetch" href="/es4x/assets/js/40.d0a26be1.js"><link rel="prefetch" href="/es4x/assets/js/41.59d59cd8.js"><link rel="prefetch" href="/es4x/assets/js/42.b78cae14.js"><link rel="prefetch" href="/es4x/assets/js/43.912b9356.js"><link rel="prefetch" href="/es4x/assets/js/44.e13ccccc.js"><link rel="prefetch" href="/es4x/assets/js/45.3ef02006.js"><link rel="prefetch" href="/es4x/assets/js/46.faa0287b.js"><link rel="prefetch" href="/es4x/assets/js/47.b487ba0e.js"><link rel="prefetch" href="/es4x/assets/js/48.ae8f3a89.js"><link rel="prefetch" href="/es4x/assets/js/49.83e2beca.js"><link rel="prefetch" href="/es4x/assets/js/5.2d4d3e75.js"><link rel="prefetch" href="/es4x/assets/js/50.5e1d5ffb.js"><link rel="prefetch" href="/es4x/assets/js/51.ff2c55ca.js"><link rel="prefetch" href="/es4x/assets/js/52.2ab6b963.js"><link rel="prefetch" href="/es4x/assets/js/53.003dce91.js"><link rel="prefetch" href="/es4x/assets/js/54.2f1ec2ff.js"><link rel="prefetch" href="/es4x/assets/js/55.27fcc794.js"><link rel="prefetch" href="/es4x/assets/js/56.f1494ba7.js"><link rel="prefetch" href="/es4x/assets/js/57.3dc75b31.js"><link rel="prefetch" href="/es4x/assets/js/58.ad7c5835.js"><link rel="prefetch" href="/es4x/assets/js/59.15c22822.js"><link rel="prefetch" href="/es4x/assets/js/6.08d23168.js"><link rel="prefetch" href="/es4x/assets/js/60.d88cd9dd.js"><link rel="prefetch" href="/es4x/assets/js/61.7f160678.js"><link rel="prefetch" href="/es4x/assets/js/62.a37de390.js"><link rel="prefetch" href="/es4x/assets/js/63.5d41db03.js"><link rel="prefetch" href="/es4x/assets/js/64.ef0f557b.js"><link rel="prefetch" href="/es4x/assets/js/65.82c56c7b.js"><link rel="prefetch" href="/es4x/assets/js/66.5db98484.js"><link rel="prefetch" href="/es4x/assets/js/67.1908aa6a.js"><link rel="prefetch" href="/es4x/assets/js/68.d7f74580.js"><link rel="prefetch" href="/es4x/assets/js/69.0d374e99.js"><link rel="prefetch" href="/es4x/assets/js/7.39a683cb.js"><link rel="prefetch" href="/es4x/assets/js/70.73111967.js"><link rel="prefetch" href="/es4x/assets/js/71.962e5b0d.js"><link rel="prefetch" href="/es4x/assets/js/72.e26b7b02.js"><link rel="prefetch" href="/es4x/assets/js/73.f9e5cfa0.js"><link rel="prefetch" href="/es4x/assets/js/75.fa4a1977.js"><link rel="prefetch" href="/es4x/assets/js/76.3917601b.js"><link rel="prefetch" href="/es4x/assets/js/77.955be584.js"><link rel="prefetch" href="/es4x/assets/js/78.889ea1de.js"><link rel="prefetch" href="/es4x/assets/js/79.571498d4.js"><link rel="prefetch" href="/es4x/assets/js/8.3fc576d4.js"><link rel="prefetch" href="/es4x/assets/js/80.6adfce5e.js"><link rel="prefetch" href="/es4x/assets/js/81.d6ddc5b3.js"><link rel="prefetch" href="/es4x/assets/js/82.13fefac4.js"><link rel="prefetch" href="/es4x/assets/js/83.dfe401bf.js"><link rel="prefetch" href="/es4x/assets/js/84.cfff53fa.js"><link rel="prefetch" href="/es4x/assets/js/85.0f669957.js"><link rel="prefetch" href="/es4x/assets/js/86.1ea59e44.js"><link rel="prefetch" href="/es4x/assets/js/87.505880b7.js"><link rel="prefetch" href="/es4x/assets/js/88.b3b56624.js"><link rel="prefetch" href="/es4x/assets/js/89.7d996ac0.js"><link rel="prefetch" href="/es4x/assets/js/9.c659cef0.js"><link rel="prefetch" href="/es4x/assets/js/90.17d5c851.js"><link rel="prefetch" href="/es4x/assets/js/91.09fa57b1.js"><link rel="prefetch" href="/es4x/assets/js/92.9a5f5d37.js"><link rel="prefetch" href="/es4x/assets/js/93.9d0cf327.js"><link rel="prefetch" href="/es4x/assets/js/94.87202bb5.js"><link rel="prefetch" href="/es4x/assets/js/95.d8625634.js"><link rel="prefetch" href="/es4x/assets/js/96.c761c159.js"><link rel="prefetch" href="/es4x/assets/js/97.e8755c70.js"><link rel="prefetch" href="/es4x/assets/js/98.49262cb9.js"><link rel="prefetch" href="/es4x/assets/js/99.d62e0c5e.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.93ea0277.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/core/http.html" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/core/http.html" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="writing-http-servers-and-clients"><a href="#writing-http-servers-and-clients" class="header-anchor">#</a> Writing HTTP servers and clients</h1> <p>Vert.x allows you to easily write non blocking HTTP clients and servers.</p> <p>Vert.x supports the HTTP/1.0, HTTP/1.1 and HTTP/2 protocols.</p> <p>The base API for HTTP is the same for HTTP/1.x and HTTP/2, specific API
features are available for dealing with the HTTP/2 protocol.</p> <h2 id="creating-an-http-server"><a href="#creating-an-http-server" class="header-anchor">#</a> Creating an HTTP Server</h2> <p>The simplest way to create an HTTP server, using all default options is
as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-an-http-server"><a href="#configuring-an-http-server" class="header-anchor">#</a> Configuring an HTTP server</h2> <p>If you don’t want the default, a server can be configured by passing in
a <code>HttpServerOptions</code> instance when creating it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxWebSocketFrameSize</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="configuring-an-http-2-server"><a href="#configuring-an-http-2-server" class="header-anchor">#</a> Configuring an HTTP/2 server</h2> <p>Vert.x supports HTTP/2 over TLS <code>h2</code> and over TCP <code>h2c</code>.</p> <ul><li><p><code>h2</code> identifies the HTTP/2 protocol when used over TLS negotiated by
<a href="https://en.wikipedia.org/wiki/Application-Layer_Protocol_Negotiation" target="_blank" rel="noopener noreferrer">Application-Layer Protocol
Negotiation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
(ALPN)</p></li> <li><p><code>h2c</code> identifies the HTTP/2 protocol when using in clear text over
TCP, such connections are established either with an HTTP/1.1
upgraded request or directly</p></li></ul> <p>To handle <code>h2</code> requests, TLS must be enabled along with <code>setUseAlpn</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyStoreOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JksOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/my/keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ALPN is a TLS extension that negotiates the protocol before the client
and the server start to exchange data.</p> <p>Clients that don’t support ALPN will still be able to do a <em>classic</em> SSL
handshake.</p> <p>ALPN will usually agree on the <code>h2</code> protocol, although <code>http/1.1</code> can be
used if the server or the client decides so.</p> <p>To handle <code>h2c</code> requests, TLS must be disabled, the server will upgrade
to HTTP/2 any request HTTP/1.1 that wants to upgrade to HTTP/2. It will
also accept a direct <code>h2c</code> connection beginning with the <code>PRI * HTTP/2.0\r\nSM\r\n</code> preface.</p> <blockquote><p><strong>Warning</strong></p> <p>most browsers won’t support <code>h2c</code>, so for serving web sites you should
use <code>h2</code> and not <code>h2c</code>.</p></blockquote> <p>When a server accepts an HTTP/2 connection, it sends to the client its
<code>initial settings</code>. The settings define how the client can use the
connection, the default initial settings for a server are:</p> <ul><li><p><code>getMaxConcurrentStreams</code>: <code>100</code> as recommended by the HTTP/2 RFC</p></li> <li><p>the default HTTP/2 settings values for the others</p></li></ul> <blockquote><p><strong>Note</strong></p> <p>Worker Verticles are not compatible with HTTP/2</p></blockquote> <h2 id="logging-network-server-activity"><a href="#logging-network-server-activity" class="header-anchor">#</a> Logging network server activity</h2> <p>For debugging purposes, network activity can be logged.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLogActivity</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>See the chapter on <a href="#logging_network_activity">logging network activity</a>
for a detailed explanation.</p> <h2 id="start-the-server-listening"><a href="#start-the-server-listening" class="header-anchor">#</a> Start the Server Listening</h2> <p>To tell the server to listen for incoming requests you use one of the
<code>listen</code> alternatives.</p> <p>To tell the server to listen at the host and port as specified in the
options:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or to specify the host and port in the call to listen, ignoring what is
configured in the options:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;myhost.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The default host is <code>0.0.0.0</code> which means 'listen on all available
addresses' and the default port is <code>80</code>.</p> <p>The actual bind is asynchronous so the server might not actually be
listening until some time <strong>after</strong> the call to listen has returned.</p> <p>If you want to be notified when the server is actually listening you can
provide a handler to the <code>listen</code> call. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;myhost.com&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server is now listening!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to bind!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="getting-notified-of-incoming-requests"><a href="#getting-notified-of-incoming-requests" class="header-anchor">#</a> Getting notified of incoming requests</h2> <p>To be notified when a request arrives you need to set a
<code>requestHandler</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handle the request in here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-requests"><a href="#handling-requests" class="header-anchor">#</a> Handling requests</h2> <p>When a request arrives, the request handler is called passing in an
instance of <code>HttpServerRequest</code>. This object represents the server side
HTTP request.</p> <p>The handler is called when the headers of the request have been fully
read.</p> <p>If the request contains a body, that body will arrive at the server some
time after the request handler has been called.</p> <p>The server request object allows you to retrieve the <code>uri</code>, <code>path</code>,
<code>params</code> and <code>headers</code>, amongst other things.</p> <p>Each server request object is associated with one server response
object. You use <code>response</code> to get a reference to the
<code>HttpServerResponse</code> object.</p> <p>Here’s a simple example of a server handling a request and replying with
&quot;hello world&quot; to it.</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="request-version"><a href="#request-version" class="header-anchor">#</a> Request version</h3> <p>The version of HTTP specified in the request can be retrieved with
<code>version</code></p> <h3 id="request-method"><a href="#request-method" class="header-anchor">#</a> Request method</h3> <p>Use <code>method</code> to retrieve the HTTP method of the request. (i.e. whether
it’s GET, POST, PUT, DELETE, HEAD, OPTIONS, etc).</p> <h3 id="request-uri"><a href="#request-uri" class="header-anchor">#</a> Request URI</h3> <p>Use <code>uri</code> to retrieve the URI of the request.</p> <p>Note that this is the actual URI as passed in the HTTP request, and it’s
almost always a relative URI.</p> <p>The URI is as defined in <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html" target="_blank" rel="noopener noreferrer">Section 5.1.2 of the HTTP specification -
Request-URI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="request-path"><a href="#request-path" class="header-anchor">#</a> Request path</h3> <p>Use <code>path</code> to return the path part of the URI</p> <p>For example, if the request URI was:</p> <p>a/b/c/page.html?param1=abc&amp;param2=xyz</p> <p>Then the path would be</p> <p>/a/b/c/page.html</p> <h3 id="request-query"><a href="#request-query" class="header-anchor">#</a> Request query</h3> <p>Use <code>query</code> to return the query part of the URI</p> <p>For example, if the request URI was:</p> <p>a/b/c/page.html?param1=abc&amp;param2=xyz</p> <p>Then the query would be</p> <p>param1=abc&amp;param2=xyz</p> <h3 id="request-headers"><a href="#request-headers" class="header-anchor">#</a> Request headers</h3> <p>Use <code>headers</code> to return the headers of the HTTP request.</p> <p>This returns an instance of <code>MultiMap</code> - which is like a normal Map or
Hash but allows multiple values for the same key - this is because HTTP
allows multiple header values with the same key.</p> <p>It also has case-insensitive keys, that means you can do the following:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> headers <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the User-Agent:</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User agent is &quot;</span> <span class="token operator">+</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;user-agent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// You can also do this and get the same result:</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User agent is &quot;</span> <span class="token operator">+</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="request-host"><a href="#request-host" class="header-anchor">#</a> Request host</h3> <p>Use <code>host</code> to return the host of the HTTP request.</p> <p>For HTTP/1.x requests the <code>host</code> header is returned, for HTTP/1 requests
the <code>:authority</code> pseudo header is returned.</p> <h3 id="request-parameters"><a href="#request-parameters" class="header-anchor">#</a> Request parameters</h3> <p>Use <code>params</code> to return the parameters of the HTTP request.</p> <p>Just like <code>headers</code> this returns an instance of <code>MultiMap</code> as there can
be more than one parameter with the same name.</p> <p>Request parameters are sent on the request URI, after the path. For
example if the URI was:</p> <p>/page.html?param1=abc&amp;param2=xyz</p> <p>Then the parameters would contain the following:</p> <div class="language- extra-class"><pre><code>param1: 'abc'
param2: 'xyz
</code></pre></div><p>Note that these request parameters are retrieved from the URL of the
request. If you have form attributes that have been sent as part of the
submission of an HTML form submitted in the body of a
<code>multi-part/form-data</code> request then they will not appear in the params
here.</p> <h3 id="remote-address"><a href="#remote-address" class="header-anchor">#</a> Remote address</h3> <p>The address of the sender of the request can be retrieved with
<code>remoteAddress</code>.</p> <h3 id="absolute-uri"><a href="#absolute-uri" class="header-anchor">#</a> Absolute URI</h3> <p>The URI passed in an HTTP request is usually relative. If you wish to
retrieve the absolute URI corresponding to the request, you can get it
with <code>absoluteURI</code></p> <h3 id="end-handler"><a href="#end-handler" class="header-anchor">#</a> End handler</h3> <p>The <code>endHandler</code> of the request is invoked when the entire request,
including any body has been fully read.</p> <h3 id="reading-data-from-the-request-body"><a href="#reading-data-from-the-request-body" class="header-anchor">#</a> Reading Data from the Request Body</h3> <p>Often an HTTP request contains a body that we want to read. As
previously mentioned the request handler is called when just the headers
of the request have arrived so the request object does not have a body
at that point.</p> <p>This is because the body may be very large (e.g. a file upload) and we
don’t generally want to buffer the entire body in memory before handing
it to you, as that could cause the server to exhaust available memory.</p> <p>To receive the body, you can use the <code>handler</code> on the request, this will
get called every time a chunk of the request body arrives. Here’s an
example:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I have received a chunk of the body of length &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The object passed into the handler is a <code>Buffer</code>, and the handler can be
called multiple times as data arrives from the network, depending on the
size of the body.</p> <p>In some cases (e.g. if the body is small) you will want to aggregate the
entire body in memory, so you could do the aggregation yourself as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Create an empty buffer</span>
<span class="token keyword">let</span> totalBuffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I have received a chunk of the body of length &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  totalBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Full body received, length = &quot;</span> <span class="token operator">+</span> totalBuffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This is such a common case, that Vert.x provides a <code>bodyHandler</code> to do
this for you. The body handler is called once when all the body has been
received:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">totalBuffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Full body received, length = &quot;</span> <span class="token operator">+</span> totalBuffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="streaming-requests"><a href="#streaming-requests" class="header-anchor">#</a> Streaming requests</h3> <p>The request object is a <code>ReadStream</code> so you can pipe the request body to
any <code>WriteStream</code> instance.</p> <p>See the chapter on <a href="#streams">streams</a> for a detailed explanation.</p> <h3 id="handling-html-forms"><a href="#handling-html-forms" class="header-anchor">#</a> Handling HTML forms</h3> <p>HTML forms can be submitted with either a content type of
<code>application/x-www-form-urlencoded</code> or <code>multipart/form-data</code>.</p> <p>For url encoded forms, the form attributes are encoded in the url, just
like normal query parameters.</p> <p>For multi-part forms they are encoded in the request body, and as such
are not available until the entire body has been read from the wire.</p> <p>Multi-part forms can also contain file uploads.</p> <p>If you want to retrieve the attributes of a multi-part form you should
tell Vert.x that you expect to receive such a form <strong>before</strong> any of the
body is read by calling <code>setExpectMultipart</code> with true, and then you
should retrieve the actual attributes using <code>formAttributes</code> once the
entire body has been read:</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">setExpectMultipart</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The body has now been fully read, so retrieve the form attributes</span>
    <span class="token keyword">let</span> formAttributes <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">formAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-form-file-uploads"><a href="#handling-form-file-uploads" class="header-anchor">#</a> Handling form file uploads</h3> <p>Vert.x can also handle file uploads which are encoded in a multi-part
request body.</p> <p>To receive file uploads you tell Vert.x to expect a multi-part form and
set an <code>uploadHandler</code> on the request.</p> <p>This handler will be called once for every upload that arrives on the
server.</p> <p>The object passed into the handler is a <code>HttpServerFileUpload</code> instance.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">setExpectMultipart</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">uploadHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">upload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got a file upload &quot;</span> <span class="token operator">+</span> upload<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>File uploads can be large we don’t provide the entire upload in a single
buffer as that might result in memory exhaustion, instead, the upload
data is received in chunks:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">uploadHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">upload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  upload<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a chunk of the upload of length &quot;</span> <span class="token operator">+</span> chunk<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The upload object is a <code>ReadStream</code> so you can pipe the request body to
any <code>WriteStream</code> instance. See the chapter on <a href="#streams">streams</a> for a
detailed explanation.</p> <p>If you just want to upload the file to disk somewhere you can use
<code>streamToFileSystem</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">uploadHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">upload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  upload<span class="token punctuation">.</span><span class="token function">streamToFileSystem</span><span class="token punctuation">(</span><span class="token string">&quot;myuploads_directory/&quot;</span> <span class="token operator">+</span> upload<span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Warning</strong></p> <p>Make sure you check the filename in a production system to avoid
malicious clients uploading files to arbitrary places on your
filesystem. See <a href="#Security%20notes">security notes</a> for more
information.</p></blockquote> <h3 id="handling-cookies"><a href="#handling-cookies" class="header-anchor">#</a> Handling cookies</h3> <p>You use <code>getCookie</code> to retrieve a cookie by name, or use <code>cookieMap</code> to
retrieve all the cookies.</p> <p>To remove a cookie, use <code>removeCookie</code>.</p> <p>To add a cookie use <code>addCookie</code>.</p> <p>The set of cookies will be written back in the response automatically
when the response headers are written so the browser can store them.</p> <p>Cookies are described by instances of <code>Cookie</code>. This allows you to
retrieve the name, value, domain, path and other normal cookie
properties.</p> <p>Same Site Cookies let servers require that a cookie shouldn’t be sent
with cross-site (where Site is defined by the registrable domain)
requests, which provides some protection against cross-site request
forgery attacks. This kind of cookies are enabled using the setter:
<code>setSameSite</code>.</p> <p>Same site cookies can have one of 3 values:</p> <ul><li><p>None - The browser will send cookies with both cross-site requests
and same-site requests.</p></li> <li><p>Strict - he browser will only send cookies for same-site requests
(requests originating from the site that set the cookie). If the
request originated from a different URL than the URL of the current
location, none of the cookies tagged with the Strict attribute will
be included.</p></li> <li><p>Lax - Same-site cookies are withheld on cross-site subrequests, such
as calls to load images or frames, but will be sent when a user
navigates to the URL from an external site; for example, by
following a link.</p></li></ul> <p>Here’s an example of querying and adding cookies:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Cookie <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> someCookie <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">&quot;mycookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cookieValue <span class="token operator">=</span> someCookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Do something with cookie...</span>

<span class="token comment">// Add a cookie - this will get written back in the response automatically</span>
request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>Cookie<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&quot;othercookie&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;somevalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-compressed-body"><a href="#handling-compressed-body" class="header-anchor">#</a> Handling compressed body</h3> <p>Vert.x can handle compressed body payloads which are encoded by the
client with the <em>deflate</em> or <em>gzip</em> algorithms.</p> <p>To enable decompression set <code>setDecompressionSupported</code> on the options
when creating the server.</p> <p>By default decompression is disabled.</p> <h3 id="receiving-custom-http-2-frames"><a href="#receiving-custom-http-2-frames" class="header-anchor">#</a> Receiving custom HTTP/2 frames</h3> <p>HTTP/2 is a framed protocol with various frames for the HTTP
request/response model. The protocol allows other kind of frames to be
sent and received.</p> <p>To receive custom frames, you can use the <code>customFrameHandler</code> on the
request, this will get called every time a custom frame arrives. Here’s
an example:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">customFrameHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a frame type=&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; payload&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>HTTP/2 frames are not subject to flow control - the frame handler will
be called immediatly when a custom frame is received whether the request
is paused or is not</p> <h3 id="non-standard-http-methods"><a href="#non-standard-http-methods" class="header-anchor">#</a> Non standard HTTP methods</h3> <p>The <code>OTHER</code> HTTP method is used for non standard methods, in this case
<code>rawMethod</code> returns the HTTP method as sent by the client.</p> <h2 id="sending-back-responses"><a href="#sending-back-responses" class="header-anchor">#</a> Sending back responses</h2> <p>The server response object is an instance of <code>HttpServerResponse</code> and is
obtained from the request with <code>response</code>.</p> <p>You use the response object to write a response back to the HTTP client.</p> <h3 id="setting-status-code-and-message"><a href="#setting-status-code-and-message" class="header-anchor">#</a> Setting status code and message</h3> <p>The default HTTP status code for a response is <code>200</code>, representing <code>OK</code>.</p> <p>Use <code>setStatusCode</code> to set a different code.</p> <p>You can also specify a custom status message with <code>setStatusMessage</code>.</p> <p>If you don’t specify a status message, the default one corresponding to
the status code will be used.</p> <blockquote><p><strong>Note</strong></p> <p>for HTTP/2 the status won’t be present in the response since the
protocol won’t transmit the message to the client</p></blockquote> <h3 id="writing-http-responses"><a href="#writing-http-responses" class="header-anchor">#</a> Writing HTTP responses</h3> <p>To write data to an HTTP response, you use one of the <code>write</code>
operations.</p> <p>These can be invoked multiple times before the response is ended. They
can be invoked in a few ways:</p> <p>With a single buffer:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With a string. In this case the string will encoded using UTF-8 and the
result written to the wire.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With a string and an encoding. In this case the string will encoded
using the specified encoding and the result written to the wire.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Writing to a response is asynchronous and always returns immediately
after the write has been queued.</p> <p>If you are just writing a single string or buffer to the HTTP response
you can write it and end the response in a single call to the <code>end</code></p> <p>The first call to write results in the response header being written to
the response. Consequently, if you are not using HTTP chunking then you
must set the <code>Content-Length</code> header before writing to the response,
since it will be too late otherwise. If you are using HTTP chunking you
do not have to worry.</p> <h3 id="ending-http-responses"><a href="#ending-http-responses" class="header-anchor">#</a> Ending HTTP responses</h3> <p>Once you have finished with the HTTP response you should <code>end</code> it.</p> <p>This can be done in several ways:</p> <p>With no arguments, the response is simply ended.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It can also be called with a string or buffer in the same way <code>write</code> is
called. In this case it’s just the same as calling write with a string
or buffer followed by calling end with no arguments. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="closing-the-underlying-connection"><a href="#closing-the-underlying-connection" class="header-anchor">#</a> Closing the underlying connection</h3> <p>You can close the underlying TCP connection with <code>close</code>.</p> <p>Non keep-alive connections will be automatically closed by Vert.x when
the response is ended.</p> <p>Keep-alive connections are not automatically closed by Vert.x by
default. If you want keep-alive connections to be closed after an idle
time, then you configure <code>setIdleTimeout</code>.</p> <p>HTTP/2 connections send a {@literal GOAWAY} frame before closing the
response.</p> <h3 id="setting-response-headers"><a href="#setting-response-headers" class="header-anchor">#</a> Setting response headers</h3> <p>HTTP response headers can be added to the response by adding them
directly to the <code>headers</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> headers <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;other-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wibble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or you can use <code>putHeader</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;other-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wibble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Headers must all be added before any parts of the response body are
written.</p> <h3 id="chunked-http-responses-and-trailers"><a href="#chunked-http-responses-and-trailers" class="header-anchor">#</a> Chunked HTTP responses and trailers</h3> <p>Vert.x supports <a href="http://en.wikipedia.org/wiki/Chunked_transfer_encoding" target="_blank" rel="noopener noreferrer">HTTP Chunked Transfer
Encoding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>This allows the HTTP response body to be written in chunks, and is
normally used when a large response body is being streamed to a client
and the total size is not known in advance.</p> <p>You put the HTTP response into chunked mode as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Default is non-chunked. When in chunked mode, each call to one of the
<code>write</code> methods will result in a new HTTP chunk being written out.</p> <p>When in chunked mode you can also write HTTP response trailers to the
response. These are actually written in the final chunk of the response.</p> <blockquote><p><strong>Note</strong></p> <p>chunked response has no effect for an HTTP/2 stream</p></blockquote> <p>To add trailers to the response, add them directly to the <code>trailers</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> trailers <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">trailers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
trailers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-wibble&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;woobble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-quux&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;flooble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or use <code>putTrailer</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">putTrailer</span><span class="token punctuation">(</span><span class="token string">&quot;X-wibble&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;woobble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTrailer</span><span class="token punctuation">(</span><span class="token string">&quot;X-quux&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;flooble&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="serving-files-directly-from-disk-or-the-classpath"><a href="#serving-files-directly-from-disk-or-the-classpath" class="header-anchor">#</a> Serving files directly from disk or the classpath</h3> <p>If you were writing a web server, one way to serve a file from disk
would be to open it as an <code>AsyncFile</code> and pipe it to the HTTP response.</p> <p>Or you could load it it one go using <code>readFile</code> and write it straight to
the response.</p> <p>Alternatively, Vert.x provides a method which allows you to serve a file
from disk or the filesystem to an HTTP response in one operation. Where
supported by the underlying operating system this may result in the OS
directly transferring bytes from the file to the socket without being
copied through user-space at all.</p> <p>This is done by using <code>sendFile</code>, and is usually more efficient for
large files, but may be slower for small files.</p> <p>Here’s a very simple web server that serves files from the file system
using sendFile:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file <span class="token operator">=</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;web/&quot;</span> <span class="token operator">+</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sending a file is asynchronous and may not complete until some time
after the call has returned. If you want to be notified when the file
has been writen you can use <code>sendFile</code></p> <p>Please see the chapter about <a href="#classpath">serving files from the
classpath</a> for restrictions about the classpath resolution
or disabling it.</p> <blockquote><p><strong>Note</strong></p> <p>If you use <code>sendFile</code> while using HTTPS it will copy through
user-space, since if the kernel is copying data directly from disk to
socket it doesn’t give us an opportunity to apply any encryption.</p></blockquote> <blockquote><p><strong>Warning</strong></p> <p>If you’re going to write web servers directly using Vert.x be careful
that users cannot exploit the path to access files outside the
directory from which you want to serve them or the classpath It may be
safer instead to use Vert.x Web.</p></blockquote> <p>When there is a need to serve just a segment of a file, say starting
from a given byte, you can achieve this by doing:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    offset <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling...</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">let</span> end <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    end <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling...</span>
  <span class="token punctuation">}</span>


  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;web/mybigfile.txt&quot;</span><span class="token punctuation">,</span> offset<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You are not required to supply the length if you want to send a file
starting from an offset until the end, in this case you can just do:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    offset <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling...</span>
  <span class="token punctuation">}</span>


  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;web/mybigfile.txt&quot;</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="piping-responses"><a href="#piping-responses" class="header-anchor">#</a> Piping responses</h3> <p>The server response is a <code>WriteStream</code> instance so you can pipe to it
from any <code>ReadStream</code>, e.g. <code>AsyncFile</code>, <code>NetSocket</code>, <code>WebSocket</code> or
<code>HttpServerRequest</code>.</p> <p>Here’s an example which echoes the request body back in the response for
any PUT methods. It uses a pipe for the body, so it will work even if
the HTTP request body is much larger than can fit in memory at any one
time:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'PUT'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">pipeTo</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-http-2-frames"><a href="#writing-http-2-frames" class="header-anchor">#</a> Writing HTTP/2 frames</h3> <p>HTTP/2 is a framed protocol with various frames for the HTTP
request/response model. The protocol allows other kind of frames to be
sent and received.</p> <p>To send such frames, you can use the <code>writeCustomFrame</code> on the response.
Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> frameType <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> frameStatus <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> payload <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sending a frame to the client</span>
response<span class="token punctuation">.</span><span class="token function">writeCustomFrame</span><span class="token punctuation">(</span>frameType<span class="token punctuation">,</span> frameStatus<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>These frames are sent immediately and are not subject to flow control -
when such frame is sent there it may be done before other {@literal
DATA} frames.</p> <h3 id="stream-reset"><a href="#stream-reset" class="header-anchor">#</a> Stream reset</h3> <p>HTTP/1.x does not allow a clean reset of a request or a response stream,
for example when a client uploads a resource already present on the
server, the server needs to accept the entire response.</p> <p>HTTP/2 supports stream reset at any time during the request/response:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Reset the stream</span>
request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default the <code>NO_ERROR</code> (0) error code is sent, another code can sent
instead:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Cancel the stream</span>
request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The HTTP/2 specification defines the list of <a href="http://httpwg.org/specs/rfc7540.html#ErrorCodes" target="_blank" rel="noopener noreferrer">error
codes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> one can use.</p> <p>The request handler are notified of stream reset events with the
<code>request handler</code> and <code>response handler</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">StreamResetException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> reset <span class="token operator">=</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Stream reset &quot;</span> <span class="token operator">+</span> reset<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="server-push"><a href="#server-push" class="header-anchor">#</a> Server push</h3> <p>Server push is a new feature of HTTP/2 that enables sending multiple
responses in parallel for a single client request.</p> <p>When a server process a request, it can push a request/response to the
client:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Push main.js to the client</span>
response<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">&quot;/main.js&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// The server is ready to push the response</span>
    <span class="token keyword">let</span> pushedResponse <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Send main.js response</span>
    pushedResponse<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;alert(\&quot;Push response hello\&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Could not push client resource &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send the requested resource</span>
response<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;html&gt;&lt;head&gt;&lt;script src=\&quot;/main.js\&quot;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When the server is ready to push the response, the push response handler
is called and the handler can send the response.</p> <p>The push response handler may receive a failure, for instance the client
may cancel the push because it already has <code>main.js</code> in its cache and
does not want it anymore.</p> <p>The <code>push</code> method must be called before the initiating response ends,
however the pushed response can be written after.</p> <h3 id="handling-exceptions"><a href="#handling-exceptions" class="header-anchor">#</a> Handling exceptions</h3> <p>You can set an <code>exceptionHandler</code> to receive any exceptions that happens
before the connection is passed to the <code>requestHandler</code> or to the
<code>webSocketHandler</code>, e.g during the TLS handshake.</p> <h2 id="http-compression"><a href="#http-compression" class="header-anchor">#</a> HTTP Compression</h2> <p>Vert.x comes with support for HTTP Compression out of the box.</p> <p>This means you are able to automatically compress the body of the
responses before they are sent back to the client.</p> <p>If the client does not support HTTP compression the responses are sent
back without compressing the body.</p> <p>This allows to handle Client that support HTTP Compression and those
that not support it at the same time.</p> <p>To enable compression use can configure it with
<code>setCompressionSupported</code>.</p> <p>By default compression is not enabled.</p> <p>When HTTP compression is enabled the server will check if the client
includes an <code>Accept-Encoding</code> header which includes the supported
compressions. Commonly used are deflate and gzip. Both are supported by
Vert.x.</p> <p>If such a header is found the server will automatically compress the
body of the response with one of the supported compressions and send it
back to the client.</p> <p>Whenever the response needs to be sent without compression you can set
the header <code>content-encoding</code> to <code>identity</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Disable compression and send an image</span>
request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;io.vertx.core.http.HttpHeaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ENCODING</span><span class="token punctuation">,</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;io.vertx.core.http.HttpHeaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&quot;/path/to/image.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Be aware that compression may be able to reduce network traffic but is
more CPU-intensive.</p> <p>To address this latter issue Vert.x allows you to tune the 'compression
level' parameter that is native of the gzip/deflate compression
algorithms.</p> <p>Compression level allows to configure gizp/deflate algorithms in terms
of the compression ratio of the resulting data and the computational
cost of the compress/decompress operation.</p> <p>The compression level is an integer value ranged from '1' to '9', where
'1' means lower compression ratio but fastest algorithm and '9' means
maximum compression ratio available but a slower algorithm.</p> <p>Using compression levels higher that 1-2 usually allows to save just
some bytes in size - the gain is not linear, and depends on the specific
data to be compressed - but it comports a non-trascurable cost in term
of CPU cycles required to the server while generating the compressed
response data ( Note that at moment Vert.x doesn’t support any form
caching of compressed response data, even for static files, so the
compression is done on-the-fly at every request body generation ) and in
the same way it affects client(s) while decoding (inflating) received
responses, operation that becomes more CPU-intensive the more the level
increases.</p> <p>By default - if compression is enabled via <code>setCompressionSupported</code> -
Vert.x will use '6' as compression level, but the parameter can be
configured to address any case with <code>setCompressionLevel</code>.</p> <h2 id="creating-an-http-client"><a href="#creating-an-http-client" class="header-anchor">#</a> Creating an HTTP client</h2> <p>You create an <code>HttpClient</code> instance with default options as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you want to configure options for the client, you create it as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeepAlive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Vert.x supports HTTP/2 over TLS <code>h2</code> and over TCP <code>h2c</code>.</p> <p>By default the http client performs HTTP/1.1 requests, to perform HTTP/2
requests the <code>setProtocolVersion</code> must be set to <code>HTTP_2</code>.</p> <p>For <code>h2</code> requests, TLS must be enabled with <em>Application-Layer Protocol
Negotiation</em>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProtocolVersion</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_2&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUseAlpn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTrustAll</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For <code>h2c</code> requests, TLS must be disabled, the client will do an HTTP/1.1
requests and try an upgrade to HTTP/2:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProtocolVersion</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP_2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>h2c</code> connections can also be established directly, i.e connection
started with a prior knowledge, when <code>setHttp2ClearTextUpgrade</code> options
is set to false: after the connection is established, the client will
send the HTTP/2 connection preface and expect to receive the same
preface from the server.</p> <p>The http server may not support HTTP/2, the actual version can be
checked with <code>version</code> when the response arrives.</p> <p>When a clients connects to an HTTP/2 server, it sends to the server its
<code>initial settings</code>. The settings define how the server can use the
connection, the default initial settings for a client are the default
values defined by the HTTP/2 RFC.</p> <h2 id="logging-network-client-activity"><a href="#logging-network-client-activity" class="header-anchor">#</a> Logging network client activity</h2> <p>For debugging purposes, network activity can be logged.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLogActivity</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>See the chapter on <a href="#logging_network_activity">logging network activity</a>
for a detailed explanation.</p> <h2 id="making-requests"><a href="#making-requests" class="header-anchor">#</a> Making requests</h2> <p>The http client is very flexible and there are various ways you can make
requests with it.</p> <p>Often you want to make many requests to the same host/port with an http
client. To avoid you repeating the host/port every time you make a
request you can configure the client with a default host/port:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Set the default host</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDefaultHost</span><span class="token punctuation">(</span><span class="token string">&quot;wibble.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Can also set default port if you want...</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternatively if you find yourself making lots of requests to different
host/ports with the same client you can simply specify the host/port
when doing the request.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Specify both port and host name</span>
client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;myserver.mycompany.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This time use the default port 80 but specify the host name</span>
client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;foo.othercompany.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/other-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Both methods of specifying host/port are supported for all the different
ways of making requests with the client.</p> <h3 id="simple-requests-with-no-request-body"><a href="#simple-requests-with-no-request-body" class="header-anchor">#</a> Simple requests with no request body</h3> <p>Often, you’ll want to make HTTP requests with no request body. This is
usually the case with HTTP GET, OPTIONS and HEAD requests.</p> <p>The simplest way to do this with the Vert.x http client is using the
methods suffixed with <code>Now</code>. For example <code>getNow</code>.</p> <p>These methods create the http request and send it in a single method
call and allow you to provide a handler that will be called with the
http response when it comes back.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a GET request</span>
client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a GET request</span>
client<span class="token punctuation">.</span><span class="token function">headNow</span><span class="token punctuation">(</span><span class="token string">&quot;/other-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-general-requests"><a href="#writing-general-requests" class="header-anchor">#</a> Writing general requests</h3> <p>At other times you don’t know the request method you want to send until
run-time. For that use case we provide general purpose request methods
such as <code>request</code> which allow you to specify the HTTP method at
run-time:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">&quot;foo-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;some-data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-request-bodies"><a href="#writing-request-bodies" class="header-anchor">#</a> Writing request bodies</h3> <p>Sometimes you’ll want to write requests which have a body, or perhaps
you want to write headers to a request before sending it.</p> <p>To do this you can call one of the specific request methods such as
<code>post</code> or one of the general purpose request methods such as <code>request</code>.</p> <p>These methods don’t send the request immediately, but instead return an
instance of <code>HttpClientRequest</code> which can be used to write to the
request body or write headers.</p> <p>Here are some examples of writing a POST request with a body: m</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Now do stuff with the request</span>
request<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-length&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make sure the request is ended when you're done with it</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Or fluently:</span>

client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-length&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Or event more simply:</span>

client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Methods exist to write strings in UTF-8 encoding and in any specific
encoding and to write buffers:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Write string encoded in UTF-8</span>
request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write string encoded in specific encoding</span>
request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some other data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write a buffer</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buffer<span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendLong</span><span class="token punctuation">(</span><span class="token number">245</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you are just writing a single string or buffer to the HTTP request
you can write it and end the request in a single call to the <code>end</code>
function.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Write string and end the request (send it) in a single call</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;some simple data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write buffer and end the request (send it) in a single call</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendDouble</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendLong</span><span class="token punctuation">(</span><span class="token number">432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When you’re writing to a request, the first call to <code>write</code> will result
in the request headers being written out to the wire.</p> <p>The actual write is asynchronous and might not occur until some time
after the call has returned.</p> <p>Non-chunked HTTP requests with a request body require a <code>Content-Length</code>
header to be provided.</p> <p>Consequently, if you are not using chunked HTTP then you must set the
<code>Content-Length</code> header before writing to the request, as it will be too
late otherwise.</p> <p>If you are calling one of the <code>end</code> methods that take a string or buffer
then Vert.x will automatically calculate and set the <code>Content-Length</code>
header before writing the request body.</p> <p>If you are using HTTP chunking a a <code>Content-Length</code> header is not
required, so you do not have to calculate the size up-front.</p> <h3 id="writing-request-headers"><a href="#writing-request-headers" class="header-anchor">#</a> Writing request headers</h3> <p>You can write headers to a request using the <code>headers</code> multi-map as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Write some headers using the headers() multimap</span>

<span class="token keyword">let</span> headers <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;other-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The headers are an instance of <code>MultiMap</code> which provides operations for
adding, setting and removing entries. Http headers allow more than one
value for a specific key.</p> <p>You can also write headers using <code>putHeader</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Write some headers using the putHeader method</span>

request<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;other-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you wish to write headers to the request you must do so before any
part of the request body is written.</p> <h3 id="non-standard-http-methods-2"><a href="#non-standard-http-methods-2" class="header-anchor">#</a> Non standard HTTP methods</h3> <p>The <code>OTHER</code> HTTP method is used for non standard methods, when this
method is used, <code>setRawMethod</code> must be used to set the raw method to
send to the server.</p> <h3 id="ending-http-requests"><a href="#ending-http-requests" class="header-anchor">#</a> Ending HTTP requests</h3> <p>Once you have finished with the HTTP request you must end it with one of
the <code>end</code> operations.</p> <p>Ending a request causes any headers to be written, if they have not
already been written and the request to be marked as complete.</p> <p>Requests can be ended in several ways. With no arguments the request is
simply ended:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or a string or buffer can be provided in the call to <code>end</code>. This is like
calling <code>write</code> with the string or buffer before calling <code>end</code> with no
arguments</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// End the request with a string</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;some-data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// End it with a buffer</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendFloat</span><span class="token punctuation">(</span><span class="token number">12.3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">321</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="chunked-http-requests"><a href="#chunked-http-requests" class="header-anchor">#</a> Chunked HTTP requests</h3> <p>Vert.x supports <a href="http://en.wikipedia.org/wiki/Chunked_transfer_encoding" target="_blank" rel="noopener noreferrer">HTTP Chunked Transfer
Encoding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for
requests.</p> <p>This allows the HTTP request body to be written in chunks, and is
normally used when a large request body is being streamed to the server,
whose size is not known in advance.</p> <p>You put the HTTP request into chunked mode using <code>setChunked</code>.</p> <p>In chunked mode each call to write will cause a new chunk to be written
to the wire. In chunked mode there is no need to set the
<code>Content-Length</code> of the request up-front.</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write some chunks</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;this-is-chunk-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="request-timeouts"><a href="#request-timeouts" class="header-anchor">#</a> Request timeouts</h3> <p>You can set a timeout for a specific http request using <code>setTimeout</code>.</p> <p>If the request does not return any data within the timeout period an
exception will be passed to the exception handler (if provided) and the
request will be closed.</p> <h3 id="handling-exceptions-2"><a href="#handling-exceptions-2" class="header-anchor">#</a> Handling exceptions</h3> <p>You can handle exceptions corresponding to a request by setting an
exception handler on the <code>HttpClientRequest</code> instance:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received exception: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This does not handle non <em>2xx</em> response that need to be handled in the
<code>HttpClientResponse</code> code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Everything fine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected behavior on the server side&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Important</strong></p> <p><code>XXXNow</code> methods cannot receive an exception handler.</p></blockquote> <h3 id="specifying-a-handler-on-the-client-request"><a href="#specifying-a-handler-on-the-client-request" class="header-anchor">#</a> Specifying a handler on the client request</h3> <p>Instead of providing a response handler in the call to create the client
request object, alternatively, you can not provide a handler when the
request is created and set it later on the request object itself, using
<code>handler</code>, for example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="using-the-request-as-a-stream"><a href="#using-the-request-as-a-stream" class="header-anchor">#</a> Using the request as a stream</h3> <p>The <code>HttpClientRequest</code> instance is also a <code>WriteStream</code> which means you
can pump to it from any <code>ReadStream</code> instance.</p> <p>For, example, you could pump a file on disk to a http request body as
follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Pump <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

request<span class="token punctuation">.</span><span class="token function">setChunked</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pump <span class="token operator">=</span> Pump<span class="token punctuation">.</span><span class="token function">pump</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
file<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pump<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-http-2-frames-2"><a href="#writing-http-2-frames-2" class="header-anchor">#</a> Writing HTTP/2 frames</h3> <p>HTTP/2 is a framed protocol with various frames for the HTTP
request/response model. The protocol allows other kind of frames to be
sent and received.</p> <p>To send such frames, you can use the <code>write</code> on the request. Here’s an
example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> frameType <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> frameStatus <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> payload <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sending a frame to the server</span>
request<span class="token punctuation">.</span><span class="token function">writeCustomFrame</span><span class="token punctuation">(</span>frameType<span class="token punctuation">,</span> frameStatus<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="stream-reset-2"><a href="#stream-reset-2" class="header-anchor">#</a> Stream reset</h3> <p>HTTP/1.x does not allow a clean reset of a request or a response stream,
for example when a client uploads a resource already present on the
server, the server needs to accept the entire response.</p> <p>HTTP/2 supports stream reset at any time during the request/response:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default the NO_ERROR (0) error code is sent, another code can sent
instead:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The HTTP/2 specification defines the list of <a href="http://httpwg.org/specs/rfc7540.html#ErrorCodes" target="_blank" rel="noopener noreferrer">error
codes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> one can use.</p> <p>The request handler are notified of stream reset events with the
<code>request handler</code> and <code>response handler</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">StreamResetException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> reset <span class="token operator">=</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Stream reset &quot;</span> <span class="token operator">+</span> reset<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-http-responses"><a href="#handling-http-responses" class="header-anchor">#</a> Handling HTTP responses</h2> <p>You receive an instance of <code>HttpClientResponse</code> into the handler that
you specify in of the request methods or by setting a handler directly
on the <code>HttpClientRequest</code> object.</p> <p>You can query the status code and the status message of the response
with <code>statusCode</code> and <code>statusMessage</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// the status code - e.g. 200 or 404</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Status code is &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// the status message e.g. &quot;OK&quot; or &quot;Not Found&quot;.</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Status message is &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="using-the-response-as-a-stream"><a href="#using-the-response-as-a-stream" class="header-anchor">#</a> Using the response as a stream</h3> <p>The <code>HttpClientResponse</code> instance is also a <code>ReadStream</code> which means you
can pipe it to any <code>WriteStream</code> instance.</p> <h3 id="response-headers-and-trailers"><a href="#response-headers-and-trailers" class="header-anchor">#</a> Response headers and trailers</h3> <p>Http responses can contain headers. Use <code>headers</code> to get the headers.</p> <p>The object returned is a <code>MultiMap</code> as HTTP headers can contain multiple
values for single keys.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> contentType <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> contentLength <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content-lengh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Chunked HTTP responses can also contain trailers - these are sent in the
last chunk of the response body.</p> <p>You use <code>trailers</code> to get the trailers. Trailers are also a <code>MultiMap</code>.</p> <h3 id="reading-the-request-body"><a href="#reading-the-request-body" class="header-anchor">#</a> Reading the request body</h3> <p>The response handler is called when the headers of the response have
been read from the wire.</p> <p>If the response has a body this might arrive in several pieces some time
after the headers have been read. We don’t wait for all the body to
arrive before calling the response handler as the response could be very
large and we might be waiting a long time, or run out of memory for
large responses.</p> <p>As parts of the response body arrive, the <code>handler</code> is called with a
<code>Buffer</code> representing the piece of the body:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  response<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a part of the response body: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you know the response body is not very large and want to aggregate it
all in memory before handling it, you can either aggregate it yourself:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Create an empty buffer</span>
  <span class="token keyword">let</span> totalBuffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a part of the response body: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    totalBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  response<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Now all the body has been read</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Total response body length is &quot;</span> <span class="token operator">+</span> totalBuffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or you can use the convenience <code>bodyHandler</code> which is called with the
entire body when the response has been fully read:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  response<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">totalBuffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Now all the body has been read</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Total response body length is &quot;</span> <span class="token operator">+</span> totalBuffer<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="response-end-handler"><a href="#response-end-handler" class="header-anchor">#</a> Response end handler</h3> <p>The response <code>endHandler</code> is called when the entire response body has
been read or immediately after the headers have been read and the
response handler has been called if there is no body.</p> <h3 id="reading-cookies-from-the-response"><a href="#reading-cookies-from-the-response" class="header-anchor">#</a> Reading cookies from the response</h3> <p>You can retrieve the list of cookies from a response using <code>cookies</code>.</p> <p>Alternatively you can just parse the <code>Set-Cookie</code> headers yourself in
the response.</p> <h3 id="_30x-redirection-handling"><a href="#_30x-redirection-handling" class="header-anchor">#</a> 30x redirection handling</h3> <p>The client can be configured to follow HTTP redirections provided by the
<code>Location</code> response header when the client receives:</p> <ul><li><p>a <code>301</code>, <code>302</code>, <code>307</code> or <code>308</code> status code along with a HTTP GET or
HEAD method</p></li> <li><p>a <code>303</code> status code, in addition the directed request perform an
HTTP GET methodn</p></li></ul> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFollowRedirects</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The maximum redirects is <code>16</code> by default and can be changed with
<code>setMaxRedirects</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxRedirects</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFollowRedirects</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>One size does not fit all and the default redirection policy may not be
adapted to your needs.</p> <p>The default redirection policy can changed with a custom implementation:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Future <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

client<span class="token punctuation">.</span><span class="token function">redirectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// Only follow 301 code</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">301</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Compute the redirect URI</span>
    <span class="token keyword">let</span> absoluteURI <span class="token operator">=</span> <span class="token function">resolveURI</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">absoluteURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create a new ready to use request that the client will use</span>
    <span class="token keyword">return</span> Future<span class="token punctuation">.</span><span class="token function">succeededFuture</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getAbs</span><span class="token punctuation">(</span>absoluteURI<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// We don't redirect</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The policy handles the original <code>HttpClientResponse</code> received and
returns either <code>null</code> or a <code>Future&lt;HttpClientRequest&gt;</code>.</p> <ul><li><p>when <code>null</code> is returned, the original response is processed</p></li> <li><p>when a future is returned, the request will be sent on its
successful completion</p></li> <li><p>when a future is returned, the exception handler set on the request
is called on its failure</p></li></ul> <p>The returned request must be unsent so the original request handlers can
be sent and the client can send it after.</p> <p>Most of the original request settings will be propagated to the new
request:</p> <ul><li><p>request headers, unless if you have set some headers (including
<code>setHost</code>)</p></li> <li><p>request body unless the returned request uses a <code>GET</code> method</p></li> <li><p>response handler</p></li> <li><p>request exception handler</p></li> <li><p>request timeout</p></li></ul> <h3 id="_100-continue-handling"><a href="#_100-continue-handling" class="header-anchor">#</a> 100-Continue handling</h3> <p>According to the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html" target="_blank" rel="noopener noreferrer">HTTP 1.1
specification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> a
client can set a header <code>Expect: 100-Continue</code> and send the request
header before sending the rest of the request body.</p> <p>The server can then respond with an interim response status <code>Status: 100 (Continue)</code> to signify to the client that it is ok to send the rest of
the body.</p> <p>The idea here is it allows the server to authorise and accept/reject the
request before large amounts of data are sent. Sending large amounts of
data if the request might not be accepted is a waste of bandwidth and
ties up the server in reading data that it will just discard.</p> <p>Vert.x allows you to set a <code>continueHandler</code> on the client request
object</p> <p>This will be called if the server sends back a <code>Status: 100 (Continue)</code>
response to signify that it is ok to send the rest of the request.</p> <p>This is used in conjunction with
`<a href="/es4x/es4x/@vertx/core/classes/httpclientrequest.html#sendhead">sendHead</a>`to
send the head of the request.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Expect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;100-Continue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">continueHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// OK to send rest of body</span>
  request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Some data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Some more data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>On the server side a Vert.x http server can be configured to
automatically send back 100 Continue interim responses when it receives
an <code>Expect: 100-Continue</code> header.</p> <p>This is done by setting the option <code>setHandle100ContinueAutomatically</code>.</p> <p>If you’d prefer to decide whether to send back continue responses
manually, then this property should be set to <code>false</code> (the default),
then you can inspect the headers and call <code>writeContinue</code> to have the
client continue sending the body:</p> <div class="language-js extra-class"><pre class="language-js"><code>httpServer<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Expect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;100-Continue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Send a 100 continue response</span>
    request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeContinue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// The client should send the body when it receives the 100 response</span>
    request<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Do something with body</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also reject the request by sending back a failure status code
directly: in this case the body should either be ignored or the
connection should be closed (100-Continue is a performance hint and
cannot be a logical protocol constraint):</p> <div class="language-js extra-class"><pre class="language-js"><code>httpServer<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Expect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;100-Continue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//</span>
    <span class="token keyword">let</span> rejectAndClose <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rejectAndClose<span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// Reject with a failure code and close the connection</span>
      <span class="token comment">// this is probably best with persistent connection</span>
      request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Connection&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

      <span class="token comment">// Reject with a failure code and ignore the body</span>
      <span class="token comment">// this may be appropriate if the body is small</span>
      request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="client-push"><a href="#client-push" class="header-anchor">#</a> Client push</h3> <p>Server push is a new feature of HTTP/2 that enables sending multiple
responses in parallel for a single client request.</p> <p>A push handler can be set on a request to receive the request/response
pushed by the server:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Process index.html response</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set a push handler to be aware of any resource pushed by the server</span>
request<span class="token punctuation">.</span><span class="token function">pushHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pushedRequest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// A resource is pushed for this request</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server pushed &quot;</span> <span class="token operator">+</span> pushedRequest<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Set an handler for the response</span>
  pushedRequest<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pushedResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The response for the pushed request&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// End the request</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the client does not want to receive a pushed request, it can reset
the stream:</p> <div class="language-js extra-class"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function">pushHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pushedRequest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pushedRequest<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/main.js&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pushedRequest<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle it</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When no handler is set, any stream pushed will be automatically
cancelled by the client with a stream reset (<code>8</code> error code).</p> <h3 id="receiving-custom-http-2-frames-2"><a href="#receiving-custom-http-2-frames-2" class="header-anchor">#</a> Receiving custom HTTP/2 frames</h3> <p>HTTP/2 is a framed protocol with various frames for the HTTP
request/response model. The protocol allows other kind of frames to be
sent and received.</p> <p>To receive custom frames, you can use the customFrameHandler on the
request, this will get called every time a custom frame arrives. Here’s
an example:</p> <div class="language-js extra-class"><pre class="language-js"><code>response<span class="token punctuation">.</span><span class="token function">customFrameHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a frame type=&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; payload&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="enabling-compression-on-the-client"><a href="#enabling-compression-on-the-client" class="header-anchor">#</a> Enabling compression on the client</h2> <p>The http client comes with support for HTTP Compression out of the box.</p> <p>This means the client can let the remote http server know that it
supports compression, and will be able to handle compressed response
bodies.</p> <p>An http server is free to either compress with one of the supported
compression algorithms or to send the body back without compressing it
at all. So this is only a hint for the Http server which it may ignore
at will.</p> <p>To tell the http server which compression is supported by the client it
will include an <code>Accept-Encoding</code> header with the supported compression
algorithm as value. Multiple compression algorithms are supported. In
case of Vert.x this will result in the following header added:</p> <p>Accept-Encoding: gzip, deflate</p> <p>The server will choose then from one of these. You can detect if a
server ompressed the body by checking for the <code>Content-Encoding</code> header
in the response sent back from it.</p> <p>If the body of the response was compressed via gzip it will include for
example the following header:</p> <p>Content-Encoding: gzip</p> <p>To enable compression set <code>setTryUseCompression</code> on the options used
when creating the client.</p> <p>By default compression is disabled.</p> <h2 id="http-1-x-pooling-and-keep-alive"><a href="#http-1-x-pooling-and-keep-alive" class="header-anchor">#</a> HTTP/1.x pooling and keep alive</h2> <p>Http keep alive allows http connections to be used for more than one
request. This can be a more efficient use of connections when you’re
making multiple requests to the same server.</p> <p>For HTTP/1.x versions, the http client supports pooling of connections,
allowing you to reuse connections between requests.</p> <p>For pooling to work, keep alive must be true using <code>setKeepAlive</code> on the
options used when configuring the client. The default value is true.</p> <p>When keep alive is enabled. Vert.x will add a <code>Connection: Keep-Alive</code>
header to each HTTP/1.0 request sent. When keep alive is disabled.
Vert.x will add a <code>Connection: Close</code> header to each HTTP/1.1 request
sent to signal that the connection will be closed after completion of
the response.</p> <p>The maximum number of connections to pool <strong>for each server</strong> is
configured using <code>setMaxPoolSize</code></p> <p>When making a request with pooling enabled, Vert.x will create a new
connection if there are less than the maximum number of connections
already created for that server, otherwise it will add the request to a
queue.</p> <p>Keep alive connections will be closed by the client automatically after
a timeout. The timeout can be specified by the server using the
<code>keep-alive</code> header:</p> <div class="language- extra-class"><pre><code>keep-alive: timeout=30
</code></pre></div><p>You can set the default timeout using <code>setKeepAliveTimeout</code> - any
connections not used within this timeout will be closed. Please note the
timeout value is in seconds not milliseconds.</p> <h2 id="http-1-1-pipe-lining"><a href="#http-1-1-pipe-lining" class="header-anchor">#</a> HTTP/1.1 pipe-lining</h2> <p>The client also supports pipe-lining of requests on a connection.</p> <p>Pipe-lining means another request is sent on the same connection before
the response from the preceding one has returned. Pipe-lining is not
appropriate for all requests.</p> <p>To enable pipe-lining, it must be enabled using <code>setPipelining</code>. By
default pipe-lining is disabled.</p> <p>When pipe-lining is enabled requests will be written to connections
without waiting for previous responses to return.</p> <p>The number of pipe-lined requests over a single connection is limited by
<code>setPipeliningLimit</code>. This option defines the maximum number of http
requests sent to the server awaiting for a response. This limit ensures
the fairness of the distribution of the client requests over the
connections to the same server.</p> <h2 id="http-2-multiplexing"><a href="#http-2-multiplexing" class="header-anchor">#</a> HTTP/2 multiplexing</h2> <p>HTTP/2 advocates to use a single connection to a server, by default the
http client uses a single connection for each server, all the streams to
the same server are multiplexed over the same connection.</p> <p>When the clients needs to use more than a single connection and use
pooling, the <code>setHttp2MaxPoolSize</code> shall be used.</p> <p>When it is desirable to limit the number of multiplexed streams per
connection and use a connection pool instead of a single connection,
<code>setHttp2MultiplexingLimit</code> can be used.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> clientOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHttp2MultiplexingLimit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHttp2MaxPoolSize</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Uses up to 3 connections and up to 10 streams per connection</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>clientOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The multiplexing limit for a connection is a setting set on the client
that limits the number of streams of a single connection. The effective
value can be even lower if the server sets a lower limit with the
<code>SETTINGS_MAX_CONCURRENT_STREAMS</code> setting.</p> <p>HTTP/2 connections will not be closed by the client automatically. To
close them you can call <code>close</code> or close the client instance.</p> <p>Alternatively you can set idle timeout using <code>setIdleTimeout</code> - any
connections not used within this timeout will be closed. Please note the
idle timeout value is in seconds not milliseconds.</p> <h2 id="http-connections"><a href="#http-connections" class="header-anchor">#</a> HTTP connections</h2> <p>The <code>HttpConnection</code> offers the API for dealing with HTTP connection
events, lifecycle and settings.</p> <p>HTTP/2 implements fully the <code>HttpConnection</code> API.</p> <p>HTTP/1.x implements partially the <code>HttpConnection</code> API: only the close
operation, the close handler and exception handler are implemented. This
protocol does not provide semantics for the other operations.</p> <h3 id="server-connections"><a href="#server-connections" class="header-anchor">#</a> Server connections</h3> <p>The <code>connection</code> method returns the request connection on the server:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> connection <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A connection handler can be set on the server to be notified of any
incoming connection:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> server <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span>http2Options<span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">connectionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">connection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A client connected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="client-connections"><a href="#client-connections" class="header-anchor">#</a> Client connections</h3> <p>The <code>connection</code> method returns the request connection on the client:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> connection <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A connection handler can be set on the client to be notified when a
connection has been established happens:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">connectionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">connection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected to the server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="connection-settings"><a href="#connection-settings" class="header-anchor">#</a> Connection settings</h3> <p>The configuration of an HTTP/2 is configured by the <code>Http2Settings</code> data
object.</p> <p>Each endpoint must respect the settings sent by the other side of the
connection.</p> <p>When a connection is established, the client and the server exchange
initial settings. Initial settings are configured by
<code>setInitialSettings</code> on the client and <code>setInitialSettings</code> on the
server.</p> <p>The settings can be changed at any time after the connection is
established:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">updateSettings</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Http2Settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxConcurrentStreams</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As the remote side should acknowledge on reception of the settings
update, it’s possible to give a callback to be notified of the
acknowledgment:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">updateSettings</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Http2Settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxConcurrentStreams</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The settings update has been acknowledged &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Conversely the <code>remoteSettingsHandler</code> is notified when the new remote
settings are received:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">remoteSettingsHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">settings</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received new settings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>this only applies to the HTTP/2 protocol</p></blockquote> <h3 id="connection-ping"><a href="#connection-ping" class="header-anchor">#</a> Connection ping</h3> <p>HTTP/2 connection ping is useful for determining the connection
round-trip time or check the connection validity: <code>ping</code> sends a
{@literal PING} frame to the remote endpoint:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">.</span><span class="token function">appendByte</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
connection<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">pong</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Remote side replied&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Vert.x will send automatically an acknowledgement when a {@literal PING}
frame is received, an handler can be set to be notified for each ping
received:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">pingHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ping</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got pinged by remote side&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The handler is just notified, the acknowledgement is sent whatsoever.
Such feature is aimed for implementing protocols on top of HTTP/2.</p> <blockquote><p><strong>Note</strong></p> <p>this only applies to the HTTP/2 protocol</p></blockquote> <h3 id="connection-shutdown-and-go-away"><a href="#connection-shutdown-and-go-away" class="header-anchor">#</a> Connection shutdown and go away</h3> <p>Calling <code>shutdown</code> will send a {@literal GOAWAY} frame to the remote
side of the connection, asking it to stop creating streams: a client
will stop doing new requests and a server will stop pushing responses.
After the {@literal GOAWAY} frame is sent, the connection waits some
time (30 seconds by default) until all current streams closed and close
the connection:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>shutdownHandler</code> notifies when all streams have been closed, the
connection is not yet closed.</p> <p>It’s possible to just send a {@literal GOAWAY} frame, the main
difference with a shutdown is that it will just tell the remote side of
the connection to stop creating new streams without scheduling a
connection close:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">goAway</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Conversely, it is also possible to be notified when {@literal GOAWAY}
are received:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">goAwayHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">goAway</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a go away frame&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>shutdownHandler</code> will be called when all current streams have been
closed and the connection can be closed:</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">goAway</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">shutdownHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// All streams are closed, close the connection</span>
  connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This applies also when a {@literal GOAWAY} is received.</p> <blockquote><p><strong>Note</strong></p> <p>this only applies to the HTTP/2 protocol</p></blockquote> <h3 id="connection-close"><a href="#connection-close" class="header-anchor">#</a> Connection close</h3> <p>Connection <code>close</code> closes the connection:</p> <ul><li><p>it closes the socket for HTTP/1.x</p></li> <li><p>a shutdown with no delay for HTTP/2, the {@literal GOAWAY} frame
will still be sent before the connection is closed. *</p></li></ul> <p>The <code>closeHandler</code> notifies when a connection is closed.</p> <h2 id="httpclient-usage"><a href="#httpclient-usage" class="header-anchor">#</a> HttpClient usage</h2> <p>The HttpClient can be used in a Verticle or embedded.</p> <p>When used in a Verticle, the Verticle <strong>should use its own client
instance</strong>.</p> <p>More generally a client should not be shared between different Vert.x
contexts as it can lead to unexpected behavior.</p> <p>For example a keep-alive connection will call the client handlers on the
context of the request that opened the connection, subsequent requests
will use the same context.</p> <p>When this happen Vert.x detects it and log a warn:</p> <div class="language- extra-class"><pre><code>Reusing a connection with a different context: an HttpClient is probably shared between different Verticles
</code></pre></div><p>The HttpClient can be embedded in a non Vert.x thread like a unit test
or a plain java <code>main</code>: the client handlers will be called by different
Vert.x threads and contexts, such contexts are created as needed. For
production this usage is not recommended.</p> <h2 id="server-sharing"><a href="#server-sharing" class="header-anchor">#</a> Server sharing</h2> <p>When several HTTP servers listen on the same port, vert.x orchestrates
the request handling using a round-robin strategy.</p> <p>Let’s take a verticle creating a HTTP server such as:</p> <p><strong>io.vertx.examples.http.sharing.HttpServerVerticle.</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">createHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello from server &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This service is listening on the port 8080. So, when this verticle is
instantiated multiple times as with: <code>vertx run io.vertx.examples.http.sharing.HttpServerVerticle -instances 2</code>, what’s
happening ? If both verticles would bind to the same port, you would
receive a socket exception. Fortunately, vert.x is handling this case
for you. When you deploy another server on the same host and port as an
existing server it doesn’t actually try and create a new server
listening on the same host/port. It binds only once to the socket. When
receiving a request it calls the server handlers following a round robin
strategy.</p> <p>Let’s now imagine a client such as:</p> <div class="language-js extra-class"><pre class="language-js"><code>vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">l</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    resp<span class="token punctuation">.</span><span class="token function">bodyHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Vert.x delegates the requests to one of the server sequentially:</p> <div class="language- extra-class"><pre><code>Hello from i.v.e.h.s.HttpServerVerticle@1
Hello from i.v.e.h.s.HttpServerVerticle@2
Hello from i.v.e.h.s.HttpServerVerticle@1
Hello from i.v.e.h.s.HttpServerVerticle@2
...
</code></pre></div><p>Consequently the servers can scale over available cores while each
Vert.x verticle instance remains strictly single threaded, and you don’t
have to do any special tricks like writing load-balancers in order to
scale your server on your multi-core machine.</p> <h2 id="using-https-with-vert-x"><a href="#using-https-with-vert-x" class="header-anchor">#</a> Using HTTPS with Vert.x</h2> <p>Vert.x http servers and clients can be configured to use HTTPS in
exactly the same way as net servers.</p> <p>Please see <a href="#ssl">configuring net servers to use SSL</a> for more
information.</p> <p>SSL can also be enabled/disabled per request with <code>RequestOptions</code> or
when specifying a scheme with <code>requestAbs</code> method.</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setURI</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>setSsl</code> setting acts as the default client setting.</p> <p>The <code>setSsl</code> overrides the default client setting</p> <ul><li><p>setting the value to <code>false</code> will disable SSL/TLS even if the client
is configured to use SSL/TLS</p></li> <li><p>setting the value to <code>true</code> will enable SSL/TLS even if the client
is configured to not use SSL/TLS, the actual client SSL/TLS (such as
trust, key/certificate, ciphers, ALPN, …​) will be reused</p></li></ul> <p>Likewise <code>requestAbs</code> scheme also overrides the default client setting.</p> <h3 id="server-name-indication-sni"><a href="#server-name-indication-sni" class="header-anchor">#</a> Server Name Indication (SNI)</h3> <p>Vert.x http servers can be configured to use SNI in exactly the same way
as {@linkplain io.vertx.core.net net servers}.</p> <p>Vert.x http client will present the actual hostname as <em>server name</em>
during the TLS handshake.</p> <h2 id="websockets"><a href="#websockets" class="header-anchor">#</a> WebSockets</h2> <p><a href="http://en.wikipedia.org/wiki/WebSocket" target="_blank" rel="noopener noreferrer">WebSockets<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> are a web
technology that allows a full duplex socket-like connection between HTTP
servers and HTTP clients (typically browsers).</p> <p>Vert.x supports WebSockets on both the client and server-side.</p> <h3 id="websockets-on-the-server"><a href="#websockets-on-the-server" class="header-anchor">#</a> WebSockets on the server</h3> <p>There are two ways of handling WebSockets on the server side.</p> <h4 id="websocket-handler"><a href="#websocket-handler" class="header-anchor">#</a> WebSocket handler</h4> <p>The first way involves providing a <code>webSocketHandler</code> on the server
instance.</p> <p>When a WebSocket connection is made to the server, the handler will be
called, passing in an instance of <code>ServerWebSocket</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">webSocketHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">webSocket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can choose to reject the WebSocket by calling <code>reject</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">webSocketHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">webSocket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>webSocket<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/myapi&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    webSocket<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can perform an asynchronous handshake by calling <code>setHandshake</code> with
a <code>Future</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Promise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
server<span class="token punctuation">.</span><span class="token function">webSocketHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">webSocket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  webSocket<span class="token punctuation">.</span><span class="token function">setHandshake</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">future</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">authenticate</span><span class="token punctuation">(</span>webSocket<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Terminate the handshake with the status code 101 (Switching Protocol)</span>
      <span class="token comment">// Reject the handshake with 401 (Unauthorized)</span>
      promise<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">101</span> <span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Will send a 500 error</span>
      promise<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>the WebSocket will be automatically accepted after the handler is
called unless the WebSocket’s handshake has been set</p></blockquote> <h4 id="upgrading-to-websocket"><a href="#upgrading-to-websocket" class="header-anchor">#</a> Upgrading to WebSocket</h4> <p>The second way of handling WebSockets is to handle the HTTP Upgrade
request that was sent from the client, and call <code>upgrade</code> on the server
request.</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">requestHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;/myapi&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> webSocket <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">upgrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Do something</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Reject</span>
    request<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="the-server-websocket"><a href="#the-server-websocket" class="header-anchor">#</a> The server WebSocket</h4> <p>The <code>ServerWebSocket</code> instance enables you to retrieve the <code>headers</code>,
<code>path</code>, <code>query</code> and <code>URI</code> of the HTTP request of the WebSocket
handshake.</p> <h3 id="websockets-on-the-client"><a href="#websockets-on-the-client" class="header-anchor">#</a> WebSockets on the client</h3> <p>The Vert.x <code>HttpClient</code> supports WebSockets.</p> <p>You can connect a WebSocket to a server using one of the <code>webSocket</code>
operations and providing a handler.</p> <p>The handler will be called with an instance of <code>WebSocket</code> when the
connection has been made:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">webSocket</span><span class="token punctuation">(</span><span class="token string">&quot;/some-uri&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ws <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="writing-messages-to-websockets"><a href="#writing-messages-to-websockets" class="header-anchor">#</a> Writing messages to WebSockets</h3> <p>If you wish to write a single WebSocket message to the WebSocket you can
do this with <code>writeBinaryMessage</code> or <code>writeTextMessage</code> :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// Write a simple binary message</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendFloat</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeBinaryMessage</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write a simple text message</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeTextMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the WebSocket message is larger than the maximum WebSocket frame size
as configured with <code>setMaxWebSocketFrameSize</code> then Vert.x will split it
into multiple WebSocket frames before sending it on the wire.</p> <h3 id="writing-frames-to-websockets"><a href="#writing-frames-to-websockets" class="header-anchor">#</a> Writing frames to WebSockets</h3> <p>A WebSocket message can be composed of multiple frames. In this case the
first frame is either a <em>binary</em> or <em>text</em> frame followed by zero or
more <em>continuation</em> frames.</p> <p>The last frame in the message is marked as <em>final</em>.</p> <p>To send a message consisting of multiple frames you create frames using
<code>WebSocketFrame.binaryFrame</code> , <code>WebSocketFrame.textFrame</code> or
<code>WebSocketFrame.continuationFrame</code> and write them to the WebSocket using
<code>writeFrame</code>.</p> <p>Here’s an example for binary frames:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketFrame <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> frame1 <span class="token operator">=</span> WebSocketFrame<span class="token punctuation">.</span><span class="token function">binaryFrame</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeFrame</span><span class="token punctuation">(</span>frame1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> frame2 <span class="token operator">=</span> WebSocketFrame<span class="token punctuation">.</span><span class="token function">continuationFrame</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeFrame</span><span class="token punctuation">(</span>frame2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write the final frame</span>
<span class="token keyword">let</span> frame3 <span class="token operator">=</span> WebSocketFrame<span class="token punctuation">.</span><span class="token function">continuationFrame</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
webSocket<span class="token punctuation">.</span><span class="token function">writeFrame</span><span class="token punctuation">(</span>frame3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In many cases you just want to send a WebSocket message that consists of
a single final frame, so we provide a couple of shortcut methods to do
that with <code>writeFinalBinaryFrame</code> and <code>writeFinalTextFrame</code>.</p> <p>Here’s an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// Send a WebSocket messages consisting of a single final text frame:</span>

webSocket<span class="token punctuation">.</span><span class="token function">writeFinalTextFrame</span><span class="token punctuation">(</span><span class="token string">&quot;Geronimo!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a WebSocket messages consisting of a single final binary frame:</span>

<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendString</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

webSocket<span class="token punctuation">.</span><span class="token function">writeFinalBinaryFrame</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="reading-frames-from-websockets"><a href="#reading-frames-from-websockets" class="header-anchor">#</a> Reading frames from WebSockets</h3> <p>To read frames from a WebSocket you use the <code>frameHandler</code>.</p> <p>The frame handler will be called with instances of <code>WebSocketFrame</code> when
a frame arrives, for example:</p> <div class="language-js extra-class"><pre class="language-js"><code>webSocket<span class="token punctuation">.</span><span class="token function">frameHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received a frame of size!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="closing-websockets"><a href="#closing-websockets" class="header-anchor">#</a> Closing WebSockets</h3> <p>Use <code>close</code> to close the WebSocket connection when you have finished
with it.</p> <h3 id="piping-websockets"><a href="#piping-websockets" class="header-anchor">#</a> Piping WebSockets</h3> <p>The <code>WebSocket</code> instance is also a <code>ReadStream</code> and a <code>WriteStream</code> so
it can be used with pipes.</p> <p>When using a WebSocket as a write stream or a read stream it can only be
used with WebSockets connections that are used with binary frames that
are no split over multiple frames.</p> <h3 id="event-bus-handlers"><a href="#event-bus-handlers" class="header-anchor">#</a> Event bus handlers</h3> <p>Every WebSocket automatically registers two handler on the event bus,
and when any data are received in this handler, it writes them to
itself. Those are local subscriptions not routed on the cluster.</p> <p>This enables you to write data to a WebSocket which is potentially in a
completely different verticle sending data to the address of that
handler.</p> <p>The addresses of the handlers are given by <code>binaryHandlerID</code> and
<code>textHandlerID</code>.</p> <h2 id="using-a-proxy-for-http-https-connections"><a href="#using-a-proxy-for-http-https-connections" class="header-anchor">#</a> Using a proxy for HTTP/HTTPS connections</h2> <p>The http client supports accessing http/https URLs via a HTTP proxy
(e.g. Squid) or <em>SOCKS4a</em> or <em>SOCKS5</em> proxy. The CONNECT protocol uses
HTTP/1.x but can connect to HTTP/1.x and HTTP/2 servers.</p> <p>Connecting to h2c (unencrypted HTTP/2 servers) is likely not supported
by http proxies since they will support HTTP/1.1 only.</p> <p>The proxy can be configured in the <code>HttpClientOptions</code> by setting a
<code>ProxyOptions</code> object containing proxy type, hostname, port and
optionally username and password.</p> <p>Here’s an example of using an HTTP proxy:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProxyOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProxyOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3128</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When the client connects to an http URL, it connects to the proxy server
and provides the full URL in the HTTP request (&quot;GET
<a href="http://www.somehost.com/path/file.html" target="_blank" rel="noopener noreferrer">http://www.somehost.com/path/file.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> HTTP/1.1&quot;).</p> <p>When the client connects to an https URL, it asks the proxy to create a
tunnel to the remote host with the CONNECT method.</p> <p>For a SOCKS5 proxy:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProxyOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProxyOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;SOCKS5&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">1080</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The DNS resolution is always done on the proxy server, to achieve the
functionality of a SOCKS4 client, it is necessary to resolve the DNS
address locally.</p> <h3 id="handling-of-other-protocols"><a href="#handling-of-other-protocols" class="header-anchor">#</a> Handling of other protocols</h3> <p>The HTTP proxy implementation supports getting ftp:// urls if the proxy
supports that, which isn’t available in non-proxy getAbs requests.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setProxyOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProxyOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> vertx<span class="token punctuation">.</span><span class="token function">createHttpClient</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">getAbs</span><span class="token punctuation">(</span><span class="token string">&quot;ftp://ftp.gnu.org/gnu/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received response with status code &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Support for other protocols is not available since java.net.URL does not
support them (gopher:// for example).</p> <h2 id="automatic-clean-up-in-verticles"><a href="#automatic-clean-up-in-verticles" class="header-anchor">#</a> Automatic clean-up in verticles</h2> <p>If you’re creating http servers and clients from inside verticles, those
servers and clients will be automatically closed when the verticle is
undeployed.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/core/http.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/12/2020, 11:19:42 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.45f626e2.js" defer></script><script src="/es4x/assets/js/2.9528bf06.js" defer></script><script src="/es4x/assets/js/74.63ba0b89.js" defer></script>
  </body>
</html>
