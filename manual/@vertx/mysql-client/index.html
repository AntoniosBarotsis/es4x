<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES for Eclipse Vert.x</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
    <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
    <script src="/es4x/player/asciinema-player.js"></script>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <link rel="preload" href="/es4x/assets/css/0.styles.57be2129.css" as="style"><link rel="preload" href="/es4x/assets/js/app.837a6700.js" as="script"><link rel="preload" href="/es4x/assets/js/2.96613d0f.js" as="script"><link rel="preload" href="/es4x/assets/js/102.11159607.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.25f493b2.js"><link rel="prefetch" href="/es4x/assets/js/100.cfb483ce.js"><link rel="prefetch" href="/es4x/assets/js/101.41f0f345.js"><link rel="prefetch" href="/es4x/assets/js/103.26a38f31.js"><link rel="prefetch" href="/es4x/assets/js/104.5d636807.js"><link rel="prefetch" href="/es4x/assets/js/105.ef333a30.js"><link rel="prefetch" href="/es4x/assets/js/106.9a8e6256.js"><link rel="prefetch" href="/es4x/assets/js/107.29eb69ad.js"><link rel="prefetch" href="/es4x/assets/js/108.98fcfd9a.js"><link rel="prefetch" href="/es4x/assets/js/109.d6080ff5.js"><link rel="prefetch" href="/es4x/assets/js/11.6250afa8.js"><link rel="prefetch" href="/es4x/assets/js/110.3dd0cba3.js"><link rel="prefetch" href="/es4x/assets/js/111.4090be57.js"><link rel="prefetch" href="/es4x/assets/js/112.9c319411.js"><link rel="prefetch" href="/es4x/assets/js/113.84433759.js"><link rel="prefetch" href="/es4x/assets/js/114.68cb87cc.js"><link rel="prefetch" href="/es4x/assets/js/115.65241419.js"><link rel="prefetch" href="/es4x/assets/js/116.72987dea.js"><link rel="prefetch" href="/es4x/assets/js/117.03106a2c.js"><link rel="prefetch" href="/es4x/assets/js/118.0ad98106.js"><link rel="prefetch" href="/es4x/assets/js/119.cb303101.js"><link rel="prefetch" href="/es4x/assets/js/12.31be7a28.js"><link rel="prefetch" href="/es4x/assets/js/120.e2ffbd45.js"><link rel="prefetch" href="/es4x/assets/js/121.197dd995.js"><link rel="prefetch" href="/es4x/assets/js/122.8b966b22.js"><link rel="prefetch" href="/es4x/assets/js/123.4586e425.js"><link rel="prefetch" href="/es4x/assets/js/124.8377618c.js"><link rel="prefetch" href="/es4x/assets/js/125.da368490.js"><link rel="prefetch" href="/es4x/assets/js/126.e0bbd98d.js"><link rel="prefetch" href="/es4x/assets/js/127.fc93d280.js"><link rel="prefetch" href="/es4x/assets/js/128.98e5a4cc.js"><link rel="prefetch" href="/es4x/assets/js/129.c7621804.js"><link rel="prefetch" href="/es4x/assets/js/13.3ba77560.js"><link rel="prefetch" href="/es4x/assets/js/130.5cd4d89d.js"><link rel="prefetch" href="/es4x/assets/js/131.ae0d85c1.js"><link rel="prefetch" href="/es4x/assets/js/132.e08c4610.js"><link rel="prefetch" href="/es4x/assets/js/133.c0606af1.js"><link rel="prefetch" href="/es4x/assets/js/134.6426c832.js"><link rel="prefetch" href="/es4x/assets/js/135.cfc1f0ec.js"><link rel="prefetch" href="/es4x/assets/js/136.a8b15a1b.js"><link rel="prefetch" href="/es4x/assets/js/137.35e8cd32.js"><link rel="prefetch" href="/es4x/assets/js/138.312a152f.js"><link rel="prefetch" href="/es4x/assets/js/139.e437bff1.js"><link rel="prefetch" href="/es4x/assets/js/14.72f2b0c1.js"><link rel="prefetch" href="/es4x/assets/js/140.8d09b641.js"><link rel="prefetch" href="/es4x/assets/js/141.52848e3f.js"><link rel="prefetch" href="/es4x/assets/js/142.39cf7674.js"><link rel="prefetch" href="/es4x/assets/js/143.7d902150.js"><link rel="prefetch" href="/es4x/assets/js/144.3e74a206.js"><link rel="prefetch" href="/es4x/assets/js/145.6a2886f8.js"><link rel="prefetch" href="/es4x/assets/js/146.244849e4.js"><link rel="prefetch" href="/es4x/assets/js/147.7f0c9791.js"><link rel="prefetch" href="/es4x/assets/js/148.ab94dede.js"><link rel="prefetch" href="/es4x/assets/js/149.a49458da.js"><link rel="prefetch" href="/es4x/assets/js/15.bd087613.js"><link rel="prefetch" href="/es4x/assets/js/150.eabb62e5.js"><link rel="prefetch" href="/es4x/assets/js/151.a6f046ed.js"><link rel="prefetch" href="/es4x/assets/js/152.78e21db3.js"><link rel="prefetch" href="/es4x/assets/js/153.eef01fd9.js"><link rel="prefetch" href="/es4x/assets/js/154.68000f3a.js"><link rel="prefetch" href="/es4x/assets/js/155.51583889.js"><link rel="prefetch" href="/es4x/assets/js/156.b598ecad.js"><link rel="prefetch" href="/es4x/assets/js/157.37bfe59b.js"><link rel="prefetch" href="/es4x/assets/js/158.14f16fe6.js"><link rel="prefetch" href="/es4x/assets/js/159.5019694d.js"><link rel="prefetch" href="/es4x/assets/js/16.a392a655.js"><link rel="prefetch" href="/es4x/assets/js/160.dfe7924a.js"><link rel="prefetch" href="/es4x/assets/js/161.acc5cf27.js"><link rel="prefetch" href="/es4x/assets/js/162.5c855be0.js"><link rel="prefetch" href="/es4x/assets/js/163.841834be.js"><link rel="prefetch" href="/es4x/assets/js/164.368aca3b.js"><link rel="prefetch" href="/es4x/assets/js/165.0c08e67b.js"><link rel="prefetch" href="/es4x/assets/js/166.361b2ec9.js"><link rel="prefetch" href="/es4x/assets/js/167.a45d61db.js"><link rel="prefetch" href="/es4x/assets/js/168.2f440f57.js"><link rel="prefetch" href="/es4x/assets/js/169.40f71d05.js"><link rel="prefetch" href="/es4x/assets/js/17.f58ddc3f.js"><link rel="prefetch" href="/es4x/assets/js/170.bfd53069.js"><link rel="prefetch" href="/es4x/assets/js/171.73de0958.js"><link rel="prefetch" href="/es4x/assets/js/172.c0640f4c.js"><link rel="prefetch" href="/es4x/assets/js/18.e2866c20.js"><link rel="prefetch" href="/es4x/assets/js/19.5895c9c4.js"><link rel="prefetch" href="/es4x/assets/js/20.bbfce85e.js"><link rel="prefetch" href="/es4x/assets/js/21.bfb22c95.js"><link rel="prefetch" href="/es4x/assets/js/22.bfe5d665.js"><link rel="prefetch" href="/es4x/assets/js/23.7db73d21.js"><link rel="prefetch" href="/es4x/assets/js/24.1e68764d.js"><link rel="prefetch" href="/es4x/assets/js/25.80677ca8.js"><link rel="prefetch" href="/es4x/assets/js/26.05452c59.js"><link rel="prefetch" href="/es4x/assets/js/27.9cb32590.js"><link rel="prefetch" href="/es4x/assets/js/28.08149c08.js"><link rel="prefetch" href="/es4x/assets/js/29.147441c7.js"><link rel="prefetch" href="/es4x/assets/js/3.4d2250de.js"><link rel="prefetch" href="/es4x/assets/js/30.5f95f2c8.js"><link rel="prefetch" href="/es4x/assets/js/31.7000a792.js"><link rel="prefetch" href="/es4x/assets/js/32.a454f02e.js"><link rel="prefetch" href="/es4x/assets/js/33.9072e3dc.js"><link rel="prefetch" href="/es4x/assets/js/34.2cd817f7.js"><link rel="prefetch" href="/es4x/assets/js/35.1499c4b4.js"><link rel="prefetch" href="/es4x/assets/js/36.53b6ddf9.js"><link rel="prefetch" href="/es4x/assets/js/37.1b440312.js"><link rel="prefetch" href="/es4x/assets/js/38.1caa3e15.js"><link rel="prefetch" href="/es4x/assets/js/39.ab25bad3.js"><link rel="prefetch" href="/es4x/assets/js/4.2410671b.js"><link rel="prefetch" href="/es4x/assets/js/40.13850330.js"><link rel="prefetch" href="/es4x/assets/js/41.1f30e160.js"><link rel="prefetch" href="/es4x/assets/js/42.f65b46db.js"><link rel="prefetch" href="/es4x/assets/js/43.86bd3898.js"><link rel="prefetch" href="/es4x/assets/js/44.25aede52.js"><link rel="prefetch" href="/es4x/assets/js/45.cee33b90.js"><link rel="prefetch" href="/es4x/assets/js/46.08c82be4.js"><link rel="prefetch" href="/es4x/assets/js/47.9263c242.js"><link rel="prefetch" href="/es4x/assets/js/48.4ef5e818.js"><link rel="prefetch" href="/es4x/assets/js/49.51ca886c.js"><link rel="prefetch" href="/es4x/assets/js/5.0b93e503.js"><link rel="prefetch" href="/es4x/assets/js/50.54a8010f.js"><link rel="prefetch" href="/es4x/assets/js/51.26142f55.js"><link rel="prefetch" href="/es4x/assets/js/52.b132a309.js"><link rel="prefetch" href="/es4x/assets/js/53.edc43f5a.js"><link rel="prefetch" href="/es4x/assets/js/54.6794cce1.js"><link rel="prefetch" href="/es4x/assets/js/55.dfdebce6.js"><link rel="prefetch" href="/es4x/assets/js/56.2b9f4603.js"><link rel="prefetch" href="/es4x/assets/js/57.c707ed5a.js"><link rel="prefetch" href="/es4x/assets/js/58.925a6f1c.js"><link rel="prefetch" href="/es4x/assets/js/59.de86b06d.js"><link rel="prefetch" href="/es4x/assets/js/6.bee7d20c.js"><link rel="prefetch" href="/es4x/assets/js/60.e74847c7.js"><link rel="prefetch" href="/es4x/assets/js/61.f45f1d70.js"><link rel="prefetch" href="/es4x/assets/js/62.c7245534.js"><link rel="prefetch" href="/es4x/assets/js/63.91dfc6d8.js"><link rel="prefetch" href="/es4x/assets/js/64.a9a5d5d7.js"><link rel="prefetch" href="/es4x/assets/js/65.82e7c7b1.js"><link rel="prefetch" href="/es4x/assets/js/66.9b26aed8.js"><link rel="prefetch" href="/es4x/assets/js/67.b882907b.js"><link rel="prefetch" href="/es4x/assets/js/68.6a6dc2a2.js"><link rel="prefetch" href="/es4x/assets/js/69.8e1e834e.js"><link rel="prefetch" href="/es4x/assets/js/7.408ffc95.js"><link rel="prefetch" href="/es4x/assets/js/70.f213078f.js"><link rel="prefetch" href="/es4x/assets/js/71.228413c9.js"><link rel="prefetch" href="/es4x/assets/js/72.d6ff0902.js"><link rel="prefetch" href="/es4x/assets/js/73.dbc371ba.js"><link rel="prefetch" href="/es4x/assets/js/74.13ff27d1.js"><link rel="prefetch" href="/es4x/assets/js/75.db024b7e.js"><link rel="prefetch" href="/es4x/assets/js/76.ef6180eb.js"><link rel="prefetch" href="/es4x/assets/js/77.7c3517c1.js"><link rel="prefetch" href="/es4x/assets/js/78.10e54671.js"><link rel="prefetch" href="/es4x/assets/js/79.b254f9ec.js"><link rel="prefetch" href="/es4x/assets/js/8.3d81d937.js"><link rel="prefetch" href="/es4x/assets/js/80.80c9d719.js"><link rel="prefetch" href="/es4x/assets/js/81.7be9486c.js"><link rel="prefetch" href="/es4x/assets/js/82.554dda8f.js"><link rel="prefetch" href="/es4x/assets/js/83.9d052d44.js"><link rel="prefetch" href="/es4x/assets/js/84.60798b2c.js"><link rel="prefetch" href="/es4x/assets/js/85.e4ce5e87.js"><link rel="prefetch" href="/es4x/assets/js/86.179d24c1.js"><link rel="prefetch" href="/es4x/assets/js/87.6d60cd83.js"><link rel="prefetch" href="/es4x/assets/js/88.6bfd1577.js"><link rel="prefetch" href="/es4x/assets/js/89.ddac2119.js"><link rel="prefetch" href="/es4x/assets/js/9.a0345499.js"><link rel="prefetch" href="/es4x/assets/js/90.4a4fd3dc.js"><link rel="prefetch" href="/es4x/assets/js/91.065cc9a5.js"><link rel="prefetch" href="/es4x/assets/js/92.80435a8d.js"><link rel="prefetch" href="/es4x/assets/js/93.b7af2039.js"><link rel="prefetch" href="/es4x/assets/js/94.b096f725.js"><link rel="prefetch" href="/es4x/assets/js/95.af24f6b1.js"><link rel="prefetch" href="/es4x/assets/js/96.38f15cba.js"><link rel="prefetch" href="/es4x/assets/js/97.c53fc06f.js"><link rel="prefetch" href="/es4x/assets/js/98.3426a32c.js"><link rel="prefetch" href="/es4x/assets/js/99.a568bb05.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.57be2129.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/mysql-client/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/mysql-client/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" aria-current="page" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>The Reactive MySQL Client is a client for MySQL with a straightforward
API focusing on scalability and low overhead.</p> <p><strong>Features</strong></p> <ul><li><p>Event driven</p></li> <li><p>Lightweight</p></li> <li><p>Built-in connection pooling</p></li> <li><p>Prepared queries caching</p></li> <li><p>Cursor support</p></li> <li><p>Row streaming</p></li> <li><p>RxJava 1 and RxJava 2</p></li> <li><p>Direct memory to object without unnecessary copies</p></li> <li><p>Java 8 Date and Time</p></li> <li><p>Stored Procedures support</p></li> <li><p>TLS/SSL support</p></li> <li><p>MySQL utilities commands support</p></li> <li><p>Working with MySQL and MariaDB</p></li> <li><p>Rich collation and charset support</p></li> <li><p>Unix domain socket</p></li></ul> <h1 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h1> <p>To use the Reactive MySQL Client add the following dependency to the
<em>dependencies</em> section of your build descriptor:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>${maven.groupId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>${maven.artifactId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
 compile <span class="token string">'${maven.groupId}:${maven.artifactId}:${maven.version}'</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting started</h1> <p>Here is the simplest way to connect, query and disconnect</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLPool <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>

<span class="token comment">// Connect options</span>
<span class="token keyword">let</span> connectOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;the-host&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Pool options</span>
<span class="token keyword">let</span> poolOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PoolOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the client pool</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MySQLPool<span class="token punctuation">.</span><span class="token function">pool</span><span class="token punctuation">(</span>connectOptions<span class="token punctuation">,</span> poolOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// A simple query</span>
client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id='julien'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; rows &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Now close the pool</span>
  client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="connecting-to-mysql"><a href="#connecting-to-mysql" class="header-anchor">#</a> Connecting to MySQL</h1> <p>Most of the time you will use a pool to connect to MySQL:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLPool <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>

<span class="token comment">// Connect options</span>
<span class="token keyword">let</span> connectOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;the-host&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Pool options</span>
<span class="token keyword">let</span> poolOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PoolOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the pooled client</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MySQLPool<span class="token punctuation">.</span><span class="token function">pool</span><span class="token punctuation">(</span>connectOptions<span class="token punctuation">,</span> poolOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The pooled client uses a connection pool and any operation will borrow a
connection from the pool to execute the operation and release it to the
pool.</p> <p>If you are running with Vert.x you can pass it your Vertx instance:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLPool <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>

<span class="token comment">// Connect options</span>
<span class="token keyword">let</span> connectOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;the-host&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Pool options</span>
<span class="token keyword">let</span> poolOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PoolOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Create the pooled client</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MySQLPool<span class="token punctuation">.</span><span class="token function">pool</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> connectOptions<span class="token punctuation">,</span> poolOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You need to release the pool when you don’t need it anymore:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Close the pool and all the associated resources</span>
pool<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When you need to execute several operations on the same connection, you
need to use a client <code>connection</code>.</p> <p>You can easily get one from the pool:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLPool <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>

<span class="token comment">// Connect options</span>
<span class="token keyword">let</span> connectOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;the-host&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Pool options</span>
<span class="token keyword">let</span> poolOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PoolOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the pooled client</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MySQLPool<span class="token punctuation">.</span><span class="token function">pool</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> connectOptions<span class="token punctuation">,</span> poolOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get a connection from the pool</span>
client<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Obtain our connection</span>
    <span class="token keyword">let</span> conn <span class="token operator">=</span> ar1<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// All operations execute on the same connection</span>
    conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id='julien'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id='emad'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// Release the connection to the pool</span>
          conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Release the connection to the pool</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Could not connect: &quot;</span> <span class="token operator">+</span> ar1<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Once you are done with the connection you must close it to release it to
the pool, so it can be reused.</p> <h2 id="unix-domain-socket"><a href="#unix-domain-socket" class="header-anchor">#</a> Unix Domain Socket</h2> <p>Sometimes for simplicity, security or performance reasons, it is
required to connect via a <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_socket" target="_blank" rel="noopener noreferrer">Unix Domain
Socket<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Since the JVM does not support domain sockets, first you must add native
transport extensions to your project.</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>netty-transport-native-epoll<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${netty.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classifier</span><span class="token punctuation">&gt;</span></span>linux-x86_64<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classifier</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
 compile <span class="token string">'io.netty:netty-transport-native-epoll:${netty.version}:linux-x86_64'</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>The native <code>epoll</code> support for ARM64 can also be added with the
classifier <code>linux-aarch64</code>.</p></blockquote> <blockquote><p><strong>Note</strong></p> <p>If there are Mac users in your team, add
<code>netty-transport-native-kqueue</code> with the classifier <code>osx-x86_64</code>.</p></blockquote> <p>Then set the path to the domain socket in <code>MySQLConnectOptions#setHost</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLPool <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>
<span class="token comment">// Connect Options</span>
<span class="token comment">// Socket file name /var/run/mysqld/mysqld.sock</span>
<span class="token keyword">let</span> connectOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;/var/run/mysqld/mysqld.sock&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Pool options</span>
<span class="token keyword">let</span> poolOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PoolOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the pooled client</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MySQLPool<span class="token punctuation">.</span><span class="token function">pool</span><span class="token punctuation">(</span>connectOptions<span class="token punctuation">,</span> poolOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the pooled client with a vertx instance</span>
<span class="token comment">// Make sure the vertx instance has enabled native transports</span>
<span class="token comment">// vertxOptions.setPreferNativeTransport(true);</span>
<span class="token keyword">let</span> client2 <span class="token operator">=</span> MySQLPool<span class="token punctuation">.</span><span class="token function">pool</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> connectOptions<span class="token punctuation">,</span> poolOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>More information about native transports can be found in the [Vert.x
documentation](<a href="https://vertx.io/docs/vertx-core/java/#_native_transports" target="_blank" rel="noopener noreferrer">https://vertx.io/docs/vertx-core/java/#_native_transports<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</p> <h1 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h1> <p>There are several alternatives for you to configure the client.</p> <h2 id="data-object"><a href="#data-object" class="header-anchor">#</a> Data Object</h2> <p>A simple way to configure the client is to specify a
<code>MySQLConnectOptions</code> data object.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLPool <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>

<span class="token comment">// Data object</span>
<span class="token keyword">let</span> connectOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;the-host&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Pool Options</span>
<span class="token keyword">let</span> poolOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PoolOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMaxSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the pool from the data object</span>
<span class="token keyword">let</span> pool <span class="token operator">=</span> MySQLPool<span class="token punctuation">.</span><span class="token function">pool</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> connectOptions<span class="token punctuation">,</span> poolOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

pool<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handling your connection</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="collations-and-character-sets"><a href="#collations-and-character-sets" class="header-anchor">#</a> collations and character sets</h3> <p>The Reactive MySQL client supports configuring collations or character
sets and map them to a correlative <code>java.nio.charset.Charset</code>. For
example, you can specify charset for a connection like</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> connectOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set connection character set to utf8 instead of the default charset utf8mb4</span>
connectOptions<span class="token punctuation">.</span>charset <span class="token operator">=</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>The Reactive MySQL Client will take <code>utf8mb4</code> as the default charset.
String values like password and error messages are always decoded in
<code>UTF-8</code> charset.</p> <p><code>characterEncoding</code> option is used to determine which Java charset will
be used to encode String values such as query string and parameter
values, the charset is <code>UTF-8</code> by default and if it’s set to <code>null</code> then
the client will use the default Java charset instead.</p> <p>You can also specify collation for a connection like</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> connectOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set connection collation to utf8_general_ci instead of the default collation utf8mb4_general_ci</span>
<span class="token comment">// setting a collation will override the charset option</span>
connectOptions<span class="token punctuation">.</span>charset <span class="token operator">=</span> <span class="token string">&quot;gbk&quot;</span><span class="token punctuation">;</span>
connectOptions<span class="token punctuation">.</span>collation <span class="token operator">=</span> <span class="token string">&quot;utf8_general_ci&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>Note setting a collation on the data object will override the
<strong>charset</strong> and <strong>characterEncoding</strong> option.</p> <p>You can execute SQL <code>SHOW COLLATION;</code> or <code>SHOW CHARACTER SET;</code> to get
the supported collations and charsets by the server.</p> <p>More information about MySQL charsets and collations can be found in the
<a href="https://dev.mysql.com/doc/refman/8.0/en/charset.html" target="_blank" rel="noopener noreferrer">MySQL Reference
Manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="connection-attributes"><a href="#connection-attributes" class="header-anchor">#</a> connection attributes</h3> <p>You can also configure the connection attributes with the
<code>setProperties</code> or <code>addProperty</code> methods. Note <code>setProperties</code> will
override the default client properties.</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><p>More information about client connection attributes can be found in the
<a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-connection-attribute-tables.html" target="_blank" rel="noopener noreferrer">MySQL Reference
Manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="useaffectedrows"><a href="#useaffectedrows" class="header-anchor">#</a> useAffectedRows</h3> <p>You can configure the <code>useAffectedRows</code> option to decide whether to set
<code>CLIENT_FOUND_ROWS</code> flag when connecting to the server. If the
<code>CLIENT_FOUND_ROWS</code> flag is specified then the affected rows count is
the numeric value of rows found rather than affected.</p> <p>More information about this can be found in the <a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-affected-rows.html" target="_blank" rel="noopener noreferrer">MySQL Reference
Manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="connection-uri"><a href="#connection-uri" class="header-anchor">#</a> connection URI</h2> <p>Apart from configuring with a <code>MySQLConnectOptions</code> data object, We also
provide you an alternative way to connect when you want to configure
with a connection URI:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLPool <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>

<span class="token comment">// Connection URI</span>
<span class="token keyword">let</span> connectionUri <span class="token operator">=</span> <span class="token string">&quot;mysql://dbuser:secretpassword@database.server.com:3211/mydb&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Create the pool from the connection URI</span>
<span class="token keyword">let</span> pool <span class="token operator">=</span> MySQLPool<span class="token punctuation">.</span><span class="token function">pool</span><span class="token punctuation">(</span>connectionUri<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the connection from the connection URI</span>
MySQLConnection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> connectionUri<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handling your connection</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>More information about connection string formats can be found in the
<a href="https://dev.mysql.com/doc/refman/8.0/en/connecting-using-uri-or-key-value-pairs.html#connecting-using-uri" target="_blank" rel="noopener noreferrer">MySQL Reference
Manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Currently, the client supports the following parameter keywords in
connection uri (keys are case-insensitive):</p> <ul><li><p>host</p></li> <li><p>port</p></li> <li><p>user</p></li> <li><p>password</p></li> <li><p>schema</p></li> <li><p>socket</p></li> <li><p>useAffectedRows</p></li></ul> <h1 id="running-queries"><a href="#running-queries" class="header-anchor">#</a> Running queries</h1> <p>When you don’t need a transaction or run single queries, you can run
queries directly on the pool; the pool will use one of its connection to
run the query and return the result to you.</p> <p>Here is how to run simple queries:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id='julien'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; rows &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="prepared-queries"><a href="#prepared-queries" class="header-anchor">#</a> Prepared queries</h2> <p>You can do the same with prepared queries.</p> <p>The SQL string can refer to parameters by position, using the database
syntax `?`</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>
client<span class="token punctuation">.</span><span class="token function">preparedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id=?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;julien&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rows <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got &quot;</span> <span class="token operator">+</span> rows<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; rows &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Query methods provides an asynchronous <code>RowSet</code> instance that works for
<em>SELECT</em> queries</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">preparedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT first_name, last_name FROM users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rows <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rows<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User &quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>or <em>UPDATE</em>/<em>INSERT</em> queries:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>
client<span class="token punctuation">.</span><span class="token function">preparedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO users (first_name, last_name) VALUES (?, ?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Julien&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Viet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rows <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rows<span class="token punctuation">.</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>Row</code> gives you access to your data by index</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User &quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>or by name</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User &quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;first_name&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;last_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The client will not do any magic here and the column name is identified
with the name in the table regardless of how your SQL text is.</p> <p>You can access a wide variety of of types</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> firstName <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;first_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> male <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;male&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> age <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
</code></pre></div><p>You can use cached prepared statements to execute one-shot prepared
queries:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>

<span class="token comment">// Enable prepare statements caching</span>
connectOptions<span class="token punctuation">.</span>cachePreparedStatements <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">preparedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;julien&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rows <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got &quot;</span> <span class="token operator">+</span> rows<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; rows &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can create a <code>PreparedStatement</code> and manage the lifecycle by
yourself.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>
sqlConnection<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> preparedStatement <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    preparedStatement<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;julien&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> rows <span class="token operator">=</span> ar2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got &quot;</span> <span class="token operator">+</span> rows<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; rows &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar2<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="batches"><a href="#batches" class="header-anchor">#</a> Batches</h2> <p>You can execute prepared batch</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>

<span class="token comment">// Add commands to the batch</span>
<span class="token keyword">let</span> batch <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
batch<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;julien&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Julien Viet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
batch<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;emad&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Emad Alblueshi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute the prepared batch</span>
client<span class="token punctuation">.</span><span class="token function">preparedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO USERS (id, name) VALUES (?, ?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeBatch</span><span class="token punctuation">(</span>batch<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Process rows</span>
    <span class="token keyword">let</span> rows <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Batch failed &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="mysql-last-insert-id"><a href="#mysql-last-insert-id" class="header-anchor">#</a> MySQL LAST_INSERT_ID</h1> <p>You can get the auto incremented value if you insert a record into the
table.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>
client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO test(val) VALUES ('v1')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rows <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> lastInsertId <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span>MySQLClient<span class="token punctuation">.</span><span class="token constant">LAST_INSERTED_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Last inserted id is: &quot;</span> <span class="token operator">+</span> lastInsertId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>More information can be found in <a href="https://dev.mysql.com/doc/refman/8.0/en/getting-unique-id.html" target="_blank" rel="noopener noreferrer">How to Get the Unique ID for the Last
Inserted
Row<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h1 id="using-connections"><a href="#using-connections" class="header-anchor">#</a> Using connections</h1> <p>When you need to execute sequential queries (without a transaction), you
can create a new connection or borrow one from the pool:</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><p>Prepared queries can be created:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>
connection<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE first_name LIKE ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> prepared <span class="token operator">=</span> ar1<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prepared<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;julien&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// All rows</span>
        <span class="token keyword">let</span> rows <span class="token operator">=</span> ar2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="using-transactions"><a href="#using-transactions" class="header-anchor">#</a> Using transactions</h1> <h2 id="transactions-with-connections"><a href="#transactions-with-connections" class="header-anchor">#</a> Transactions with connections</h2> <p>You can execute transaction using SQL <code>BEGIN</code>/<code>COMMIT</code>/<code>ROLLBACK</code>, if
you do so you must use a <code>SqlConnection</code> and manage it yourself.</p> <p>Or you can use the transaction API of <code>SqlConnection</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>pool<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Transaction must use a connection</span>
    <span class="token keyword">let</span> conn <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Begin the transaction</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Various statements</span>
    conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>ar2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Commit the transaction</span>
            tx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>ar3<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction succeeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction failed &quot;</span> <span class="token operator">+</span> ar3<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token comment">// Return the connection to the pool</span>
              conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Return the connection to the pool</span>
            conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Return the connection to the pool</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When the database server reports the current transaction is failed (e.g
the infamous <em>current transaction is aborted, commands ignored until end
of transaction block</em>), the transaction is rollbacked and the
<code>abortHandler</code> is called:</p> <div class="language-js extra-class"><pre class="language-js"><code>tx<span class="token punctuation">.</span><span class="token function">abortHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction failed =&gt; rollbacked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="simplified-transaction-api"><a href="#simplified-transaction-api" class="header-anchor">#</a> Simplified transaction API</h2> <p>When you use a pool, you can start a transaction directly on the pool.</p> <p>It borrows a connection from the pool, begins the transaction and
releases the connection to the pool when the transaction ends.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Acquire a transaction and begin the transaction</span>
pool<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Get the transaction</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Various statements</span>
    tx<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tx<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>ar2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Commit the transaction</span>
            <span class="token comment">// the connection will automatically return to the pool</span>
            tx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>ar3<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction succeeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction failed &quot;</span> <span class="token operator">+</span> ar3<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// No need to close connection as transaction will abort and be returned to the pool</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>this code will not close the connection because it will always be
released back to the pool when the transaction</p></blockquote> <h1 id="cursors-and-streaming"><a href="#cursors-and-streaming" class="header-anchor">#</a> Cursors and streaming</h1> <p>By default prepared query execution fetches all rows, you can use a
<code>Cursor</code> to control the amount of rows you want to read:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>
connection<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pq <span class="token operator">=</span> ar1<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create a cursor</span>
    <span class="token keyword">let</span> cursor <span class="token operator">=</span> pq<span class="token punctuation">.</span><span class="token function">cursor</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Read 50 rows</span>
    cursor<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> rows <span class="token operator">=</span> ar2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Check for more ?</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">hasMore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// Repeat the process...</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// No more rows - close the cursor</span>
          cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Cursors shall be closed when they are released prematurely:</p> <div class="language-js extra-class"><pre class="language-js"><code>cursor<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Close the cursor</span>
    cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A stream API is also available for cursors, which can be more
convenient, specially with the Rxified version.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>
connection<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pq <span class="token operator">=</span> ar1<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Fetch 50 rows at a time</span>
    <span class="token keyword">let</span> stream <span class="token operator">=</span> pq<span class="token punctuation">.</span><span class="token function">createStream</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Use the stream</span>
    stream<span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error: &quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;End of stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User: &quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;last_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The stream read the rows by batch of <code>50</code> and stream them, when the rows
have been passed to the handler, a new batch of <code>50</code> is read and so on.</p> <p>The stream can be resumed or paused, the loaded rows will remain in
memory until they are delivered and the cursor will stop iterating.</p> <h1 id="mysql-type-mapping"><a href="#mysql-type-mapping" class="header-anchor">#</a> MySQL type mapping</h1> <p>Currently the client supports the following MySQL types</p> <ul><li><p>BOOL,BOOLEAN (<code>java.lang.Byte</code>)</p></li> <li><p>TINYINT (<code>java.lang.Byte</code>)</p></li> <li><p>TINYINT UNSIGNED(<code>java.lang.Short</code>)</p></li> <li><p>SMALLINT (<code>java.lang.Short</code>)</p></li> <li><p>SMALLINT UNSIGNED(<code>java.lang.Integer</code>)</p></li> <li><p>MEDIUMINT (<code>java.lang.Integer</code>)</p></li> <li><p>MEDIUMINT UNSIGNED(<code>java.lang.Integer</code>)</p></li> <li><p>INT,INTEGER (<code>java.lang.Integer</code>)</p></li> <li><p>INTEGER UNSIGNED(<code>java.lang.Long</code>)</p></li> <li><p>BIGINT (<code>java.lang.Long</code>)</p></li> <li><p>BIGINT UNSIGNED(<code>io.vertx.sqlclient.data.Numeric</code>)</p></li> <li><p>FLOAT (<code>java.lang.Float</code>)</p></li> <li><p>FLOAT UNSIGNED(<code>java.lang.Float</code>)</p></li> <li><p>DOUBLE (<code>java.lang.Double</code>)</p></li> <li><p>DOUBLE UNSIGNED(<code>java.lang.Double</code>)</p></li> <li><p>BIT (<code>java.lang.Long</code>)</p></li> <li><p>NUMERIC (<code>io.vertx.sqlclient.data.Numeric</code>)</p></li> <li><p>NUMERIC UNSIGNED(<code>io.vertx.sqlclient.data.Numeric</code>)</p></li> <li><p>DATE (<code>java.time.LocalDate</code>)</p></li> <li><p>DATETIME (<code>java.time.LocalDateTime</code>)</p></li> <li><p>TIME (<code>java.time.Duration</code>)</p></li> <li><p>TIMESTAMP (<code>java.time.LocalDateTime</code>)</p></li> <li><p>YEAR (<code>java.lang.Short</code>)</p></li> <li><p>CHAR (<code>java.lang.String</code>)</p></li> <li><p>VARCHAR (<code>java.lang.String</code>)</p></li> <li><p>BINARY (<code>io.vertx.core.buffer.Buffer</code>)</p></li> <li><p>VARBINARY (<code>io.vertx.core.buffer.Buffer</code>)</p></li> <li><p>TINYBLOB (<code>io.vertx.core.buffer.Buffer</code>)</p></li> <li><p>TINYTEXT (<code>java.lang.String</code>)</p></li> <li><p>BLOB (<code>io.vertx.core.buffer.Buffer</code>)</p></li> <li><p>TEXT (<code>java.lang.String</code>)</p></li> <li><p>MEDIUMBLOB (<code>io.vertx.core.buffer.Buffer</code>)</p></li> <li><p>MEDIUMTEXT (<code>java.lang.String</code>)</p></li> <li><p>LONGBLOB (<code>io.vertx.core.buffer.Buffer</code>)</p></li> <li><p>LONGTEXT (<code>java.lang.String</code>)</p></li> <li><p>ENUM (<code>java.lang.String</code>)</p></li> <li><p>SET (<code>java.lang.String</code>)</p></li> <li><p>JSON (<code>io.vertx.core.json.JsonObject</code>,
<code>io.vertx.core.json.JsonArray</code>, <code>Number</code>, <code>Boolean</code>, <code>String</code>,
<code>io.vertx.sqlclient.Tuple#JSON_NULL</code>)</p></li></ul> <p>Tuple decoding uses the above types when storing values</p> <p>Note: In Java there is no specific representations for unsigned numeric
values, so this client will convert an unsigned value to the correlated
Java type.</p> <h2 id="implicit-type-conversion"><a href="#implicit-type-conversion" class="header-anchor">#</a> Implicit type conversion</h2> <p>The Reactive MySQL Client supports implicit type conversions when
executing a prepared statement. Suppose you have a <code>TIME</code> column in your
table, the two examples below will both work here.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>
client<span class="token punctuation">.</span><span class="token function">preparedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM students WHERE updated_time = ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.time.LocalTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle the results</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// this will also work with implicit type conversion</span>
client<span class="token punctuation">.</span><span class="token function">preparedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM students WHERE updated_time = ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;19:10:25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle the results</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The MySQL data type for encoding will be inferred from the parameter
values and here is the type mapping</p> <table><thead><tr><th>Parameter value type</th> <th>encoding MySQL type</th></tr></thead> <tbody><tr><td>null</td> <td>MYSQL_TYPE_NULL</td></tr> <tr><td>java.lang.Byte</td> <td>MYSQL_TYPE_TINY</td></tr> <tr><td>java.lang.Boolean</td> <td>MYSQL_TYPE_TINY</td></tr> <tr><td>java.lang.Short</td> <td>MYSQL_TYPE_SHORT</td></tr> <tr><td>java.lang.Integer</td> <td>MYSQL_TYPE_LONG</td></tr> <tr><td>java.lang.Long</td> <td>MYSQL_TYPE_LONGLONG</td></tr> <tr><td>java.lang.Double</td> <td>MYSQL_TYPE_DOUBLE</td></tr> <tr><td>java.lang.Float</td> <td>MYSQL_TYPE_FLOAT</td></tr> <tr><td>java.time.LocalDate</td> <td>MYSQL_TYPE_DATE</td></tr> <tr><td>java.time.Duration</td> <td>MYSQL_TYPE_TIME</td></tr> <tr><td>java.time.LocalTime</td> <td>MYSQL_TYPE_TIME</td></tr> <tr><td>io.vertx.core.buffer.Buffer</td> <td>MYSQL_TYPE_BLOB</td></tr> <tr><td>java.time.LocalDateTime</td> <td>MYSQL_TYPE_DATETIME</td></tr> <tr><td>default</td> <td>MYSQL_TYPE_STRING</td></tr></tbody></table> <h2 id="handling-boolean"><a href="#handling-boolean" class="header-anchor">#</a> Handling BOOLEAN</h2> <p>In MySQL <code>BOOLEAN</code> and <code>BOOL</code> data types are synonyms for <code>TINYINT(1)</code>.
A value of zero is considered false, non-zero values are considered
true. A <code>BOOLEAN</code> data type value is stored in <code>Row</code> or <code>Tuple</code> as
<code>java.lang.Byte</code> type, you can call <code>Row#getValue</code> to retrieve it as a
<code>java.lang.Byte</code> value, or you can call <code>Row#getBoolean</code> to retrieve it
as <code>java.lang.Boolean</code> value.</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT graduated FROM students WHERE id = 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rowSet <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rowSet<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> pos <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span><span class="token string">&quot;graduated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Byte&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>class<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> graduated <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;graduated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When you want to execute a prepared statement with a param of a
<code>BOOLEAN</code> value, you can simply add the <code>java.lang.Boolean</code> value to the
params list.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Tuple <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/sql-client&quot;</span>
client<span class="token punctuation">.</span><span class="token function">preparedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;UPDATE students SET graduated = ? WHERE id = 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Updated with the boolean value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="handling-json"><a href="#handling-json" class="header-anchor">#</a> Handling JSON</h2> <p>MySQL <code>JSON</code> data type is represented by the following Java types:</p> <ul><li><p><code>String</code></p></li> <li><p><code>Number</code></p></li> <li><p><code>Boolean</code></p></li> <li><p><code>io.vertx.core.json.JsonObject</code></p></li> <li><p><code>io.vertx.core.json.JsonArray</code></p></li> <li><p><code>io.vertx.sqlclient.Tuple#JSON_NULL</code> for representing the JSON null
literal</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><h2 id="handling-bit"><a href="#handling-bit" class="header-anchor">#</a> Handling BIT</h2> <p>The <code>BIT</code> data type is mapped to <code>java.lang.Long</code> type, but Java has no
notion of unsigned numeric values, so if you want to insert or update a
record with the max value of <code>BIT(64)</code>, you can do some tricks setting
the parameter to <code>-1L</code>.</p> <h2 id="handling-time"><a href="#handling-time" class="header-anchor">#</a> Handling TIME</h2> <p>MySQL <code>TIME</code> data type can be used to represent either time of a day or
a time interval which ranges from <code>-838:59:59</code> to <code>838:59:59</code>. In
Reactive MySQL client the <code>TIME</code> data type is mapped to
<code>java.time.Duration</code> natively, but you can also retrieve it as a
<code>java.time.LocalTime</code> via <code>Row#getLocalTime</code> accessor.</p> <h2 id="handling-numeric"><a href="#handling-numeric" class="header-anchor">#</a> Handling NUMERIC</h2> <p>The <code>Numeric</code> Java type is used to represent the MySQL <code>NUMERIC</code> type.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> numeric <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;io.vertx.sqlclient.data.Numeric&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>class<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>numeric<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handle NaN</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> numeric<span class="token punctuation">.</span><span class="token function">bigDecimalValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="collector-queries"><a href="#collector-queries" class="header-anchor">#</a> Collector queries</h1> <p>You can use Java collectors with the query API:</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><p>The collector processing must not keep a reference on the <code>Row</code> as there
is a single row used for processing the entire set.</p> <p>The Java <code>Collectors</code> provides many interesting predefined collectors,
for example you can create easily create a string directly from the row
set:</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><h1 id="mysql-stored-procedure"><a href="#mysql-stored-procedure" class="header-anchor">#</a> MySQL Stored Procedure</h1> <p>You can run stored procedures in queries. The result will be retrieved
from the server following the <a href="https://dev.mysql.com/doc/dev/mysql-server/8.0.12/page_protocol_command_phase_sp.html" target="_blank" rel="noopener noreferrer">MySQL
protocol<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
without any magic here.</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;CREATE PROCEDURE multi() BEGIN\n  SELECT 1;\n  SELECT 1;\n  INSERT INTO ins VALUES (1);\n  INSERT INTO ins VALUES (2);\nEND;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// create stored procedure success</span>
    client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;CALL multi();&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle the result</span>
        <span class="token keyword">let</span> result1 <span class="token operator">=</span> ar2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> row1 <span class="token operator">=</span> result1<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;First result: &quot;</span> <span class="token operator">+</span> row1<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> result2 <span class="token operator">=</span> result1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> row2 <span class="token operator">=</span> result2<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Second result: &quot;</span> <span class="token operator">+</span> row2<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> result3 <span class="token operator">=</span> result2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Affected rows: &quot;</span> <span class="token operator">+</span> result3<span class="token punctuation">.</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar2<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar1<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Note: Prepared statements binding OUT parameters is not supported for
now.</p> <h1 id="mysql-local-infile"><a href="#mysql-local-infile" class="header-anchor">#</a> MySQL LOCAL INFILE</h1> <p>This client supports for handling the LOCAL INFILE Request, if you want
to load data from a local file into the server, you can use query <code>LOAD DATA LOCAL INFILE '&lt;filename&gt;' INTO TABLE &lt;table&gt;;</code>. More information
can be found in the <a href="https://dev.mysql.com/doc/refman/8.0/en/load-data.html" target="_blank" rel="noopener noreferrer">MySQL Reference
Manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h1 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h1> <p>MySQL 8.0 introduces a new authentication method named
<code>caching_sha2_password</code> and it’s the default one to authenticate. In
order to connect to the server using this new authentication method, you
need either use a secure connection(i.e. enable TLS/SSL) or exchange the
encrypted password using an RSA key pair to avoid leaks of password. The
RSA key pair is automatically exchanged during the communication, but
the server RSA public key may be hacked during the process since it’s
transferred on a insecure connection. So if you’re on a insecure
connection and want to avoid the risk of exposing the server RSA public
key, you can set the server RSA public key like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token keyword">let</span> options1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;the-host&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setServerRsaPublicKeyPath</span><span class="token punctuation">(</span><span class="token string">&quot;tls/files/public_key.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> options2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;the-host&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setServerRsaPublicKeyValue</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3yvG5s0qrV7jxVlp0sMj\nxP0a6BuLKCMjb0o88hDsJ3xz7PpHNKazuEAfPxiRFVAV3edqfSiXoQw+lJf4haEG\nHQe12Nfhs+UhcAeTKXRlZP/JNmI+BGoBduQ1rCId9bKYbXn4pvyS/a1ft7SwFkhx\naogCur7iIB0WUWvwkQ0fEj/Mlhw93lLVyx7hcGFq4FOAKFYr3A0xrHP1IdgnD8QZ\n0fUbgGLWWLOossKrbUP5HWko1ghLPIbfmU6o890oj1ZWQewj1Rs9Er92/UDj/JXx\n7ha1P+ZOgPBlV037KDQMS6cUh9vTablEHsMLhDZanymXzzjBkL+wH/b9cdL16LkQ\n5QIDAQAB\n-----END PUBLIC KEY-----\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>More information about the <code>caching_sha2_password</code> authentication method
can be found in the <a href="https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html" target="_blank" rel="noopener noreferrer">MySQL Reference
Manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h1 id="using-ssl-tls"><a href="#using-ssl-tls" class="header-anchor">#</a> Using SSL/TLS</h1> <p>To configure the client to use SSL connection, you can configure the
<code>MySQLConnectOptions</code> like a Vert.x <code>NetClient</code>. All <a href="https://dev.mysql.com/doc/refman/8.0/en/connection-options.html#option_general_ssl-mode" target="_blank" rel="noopener noreferrer">SSL
modes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
are supported and you are able to configure <code>sslmode</code>. The client is in
<code>DISABLED</code> SSL mode by default. <code>ssl</code> parameter is kept as a mere
shortcut for setting <code>sslmode</code>. <code>setSsl(true)</code> is equivalent to
<code>setSslMode(VERIFY_CA)</code> and <code>setSsl(false)</code> is equivalent to
<code>setSslMode(DISABLED)</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MySQLConnection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mysql-client&quot;</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLConnectOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;the-host&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;the-db&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSslMode</span><span class="token punctuation">(</span><span class="token string">&quot;VERIFY_CA&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPemTrustOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PemTrustOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setCertPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;/path/to/cert.pem&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

MySQLConnection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Connected with SSL</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Could not connect &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>More information can be found in the <a href="http://vertx.io/docs/vertx-core/java/#ssl" target="_blank" rel="noopener noreferrer">Vert.x
documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h1 id="mysql-utility-command"><a href="#mysql-utility-command" class="header-anchor">#</a> MySQL utility command</h1> <p>Sometimes you want to use MySQL utility commands and we provide support
for this. More information can be found in the <a href="https://dev.mysql.com/doc/dev/mysql-server/8.0.12/page_protocol_command_phase_utility.html" target="_blank" rel="noopener noreferrer">MySQL utility
commands<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="com-ping"><a href="#com-ping" class="header-anchor">#</a> COM_PING</h2> <p>You can use <code>COM_PING</code> command to check if the server is alive. The
handler will be notified if the server responds to the PING, otherwise
the handler will never be called.</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The server has responded to the PING&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="com-reset-connection"><a href="#com-reset-connection" class="header-anchor">#</a> COM_RESET_CONNECTION</h2> <p>You can reset the session state with <code>COM_RESET_CONNECTION</code> command,
this will reset the connection state like: - user variables - temporary
tables - prepared statements</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">resetConnection</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connection has been reset now&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="com-change-user"><a href="#com-change-user" class="header-anchor">#</a> COM_CHANGE_USER</h2> <p>You can change the user of the current connection, this will perform a
re-authentication and reset the connection state like
<code>COM_RESET_CONNECTION</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> authenticationOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLAuthOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">&quot;newuser&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;newpassword&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;newdatabase&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">changeUser</span><span class="token punctuation">(</span>authenticationOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User of current connection has been changed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="com-init-db"><a href="#com-init-db" class="header-anchor">#</a> COM_INIT_DB</h2> <p>You can use <code>COM_INIT_DB</code> command to change the default schema of the
connection.</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">specifySchema</span><span class="token punctuation">(</span><span class="token string">&quot;newschema&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Default schema changed to newschema&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="com-statistics"><a href="#com-statistics" class="header-anchor">#</a> COM_STATISTICS</h2> <p>You can use <code>COM_STATISTICS</code> command to get a human readable string of
some internal status variables in MySQL server.</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">getInternalStatistics</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Statistics: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="com-debug"><a href="#com-debug" class="header-anchor">#</a> COM_DEBUG</h2> <p>You can use <code>COM_DEBUG</code> command to dump debug info to the MySQL server’s
STDOUT.</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Debug info dumped to server's STDOUT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="com-set-option"><a href="#com-set-option" class="header-anchor">#</a> COM_SET_OPTION</h2> <p>You can use <code>COM_SET_OPTION</code> command to set options for the current
connection. Currently only <code>CLIENT_MULTI_STATEMENTS</code> can be set.</p> <p>For example, you can disable <code>CLIENT_MULTI_STATEMENTS</code> with this
command.</p> <div class="language-js extra-class"><pre class="language-js"><code>connection<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>MySQLSetOption<span class="token punctuation">.</span><span class="token constant">MYSQL_OPTION_MULTI_STATEMENTS_OFF</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;CLIENT_MULTI_STATEMENTS is off now&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure: &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="mysql-and-mariadb-version-support-matrix"><a href="#mysql-and-mariadb-version-support-matrix" class="header-anchor">#</a> MySQL and MariaDB version support matrix</h1> <table><thead><tr><th>MySQL</th> <th>MariaDB</th> <th></th> <th></th></tr></thead> <tbody><tr><td>Version</td> <td>Supported</td> <td>Version</td> <td>Supported</td></tr> <tr><td><code>5.5</code></td> <td>✔</td> <td><code>10.1</code></td> <td>✔</td></tr> <tr><td><code>5.6</code></td> <td>✔</td> <td><code>10.2</code></td> <td>✔</td></tr> <tr><td><code>5.7</code></td> <td>✔</td> <td><code>10.3</code></td> <td>✔</td></tr> <tr><td><code>8.0</code></td> <td>✔</td> <td><code>10.4</code></td> <td>✔</td></tr></tbody></table> <p>Known issues:</p> <ul><li><p>Reset connection utility command does not work in MySQL 5.5, 5.6 and
MariaDB 10.1</p></li> <li><p>Change user utility command is not supported with MariaDB 10.2 and
10.3</p></li></ul> <h1 id="pitfalls-good-practices"><a href="#pitfalls-good-practices" class="header-anchor">#</a> Pitfalls &amp; Good Practices</h1> <p>Here are some good practices for you to avoid common pitfalls when using
the Reactive MySQL Client.</p> <h2 id="prepared-statement-count-limit"><a href="#prepared-statement-count-limit" class="header-anchor">#</a> prepared statement count limit</h2> <p>Sometimes you might meet the notorious error <code>Can’t create more than max_prepared_stmt_count statements (current value: 16382)</code>, this is
because the server has reached the limit of total number of prepared
statement.</p> <p>You can adjust the server system variable <code>max_prepared_stmt_count</code> but
it has an upper bound value so you can’t get rid of the error in this
way.</p> <p>The best way to alleviate this is enabling prepared statement caching,
so the prepared statements with the same SQL string could be reused and
the client does not have to create a brand new prepared statement for
every request. The prepared statement will be automatically closed after
the statement is executed. In this way the chances of reaching the limit
could be greatly reduced though it could not be totally eliminated.</p> <p>You can also manage the lifecycle of prepared statements manually by
creating a <code>PreparedStatement</code> object via <code>SqlConnection#prepare</code>
interface so that you can choose when to deallocate the statement
handle, or even use the <a href="https://dev.mysql.com/doc/refman/8.0/en/sql-prepared-statements.html" target="_blank" rel="noopener noreferrer">SQL syntax prepared
statement<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="demystifying-prepared-batch"><a href="#demystifying-prepared-batch" class="header-anchor">#</a> demystifying prepared batch</h2> <p>There is time when you want to batch insert data into the database, you
can use <code>PreparedQuery#executeBatch</code> which provides a simple API to
handle this. Keep in mind that MySQL does not natively support batching
protocol so the API is only a sugar by executing the prepared statement
one after another, which means more network round trips are required
comparing to inserting multiple rows by executing one prepared statement
with a list of values.</p> <h2 id="tricky-date-time-data-types"><a href="#tricky-date-time-data-types" class="header-anchor">#</a> tricky DATE &amp; TIME data types</h2> <p>Handling MYSQL DATE and TIME data types especially with time zones is
tricky therefore the Reactive MySQL Client does no magic transformation
for those values.</p> <ul><li><p>MySQL DATETIME data type does not contain time zone info, so what
you get is identical to what you set no matter what time zone is in
the current session.</p></li> <li><p>MySQL TIMESTAMP data type contains time zone info, so when you set
or get the value it’s always transformed by the server with the
timezone set in the current session.</p></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/mysql-client/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/22/2020, 10:49:01 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.837a6700.js" defer></script><script src="/es4x/assets/js/2.96613d0f.js" defer></script><script src="/es4x/assets/js/102.11159607.js" defer></script>
  </body>
</html>
