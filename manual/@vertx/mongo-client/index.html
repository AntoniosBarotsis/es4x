<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES for Eclipse Vert.x</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
    <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
    <script src="/es4x/player/asciinema-player.js"></script>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <link rel="preload" href="/es4x/assets/css/0.styles.57be2129.css" as="style"><link rel="preload" href="/es4x/assets/js/app.837a6700.js" as="script"><link rel="preload" href="/es4x/assets/js/2.96613d0f.js" as="script"><link rel="preload" href="/es4x/assets/js/97.c53fc06f.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.25f493b2.js"><link rel="prefetch" href="/es4x/assets/js/100.cfb483ce.js"><link rel="prefetch" href="/es4x/assets/js/101.41f0f345.js"><link rel="prefetch" href="/es4x/assets/js/102.11159607.js"><link rel="prefetch" href="/es4x/assets/js/103.26a38f31.js"><link rel="prefetch" href="/es4x/assets/js/104.5d636807.js"><link rel="prefetch" href="/es4x/assets/js/105.ef333a30.js"><link rel="prefetch" href="/es4x/assets/js/106.9a8e6256.js"><link rel="prefetch" href="/es4x/assets/js/107.29eb69ad.js"><link rel="prefetch" href="/es4x/assets/js/108.98fcfd9a.js"><link rel="prefetch" href="/es4x/assets/js/109.d6080ff5.js"><link rel="prefetch" href="/es4x/assets/js/11.6250afa8.js"><link rel="prefetch" href="/es4x/assets/js/110.3dd0cba3.js"><link rel="prefetch" href="/es4x/assets/js/111.4090be57.js"><link rel="prefetch" href="/es4x/assets/js/112.9c319411.js"><link rel="prefetch" href="/es4x/assets/js/113.84433759.js"><link rel="prefetch" href="/es4x/assets/js/114.68cb87cc.js"><link rel="prefetch" href="/es4x/assets/js/115.65241419.js"><link rel="prefetch" href="/es4x/assets/js/116.72987dea.js"><link rel="prefetch" href="/es4x/assets/js/117.03106a2c.js"><link rel="prefetch" href="/es4x/assets/js/118.0ad98106.js"><link rel="prefetch" href="/es4x/assets/js/119.cb303101.js"><link rel="prefetch" href="/es4x/assets/js/12.31be7a28.js"><link rel="prefetch" href="/es4x/assets/js/120.e2ffbd45.js"><link rel="prefetch" href="/es4x/assets/js/121.197dd995.js"><link rel="prefetch" href="/es4x/assets/js/122.8b966b22.js"><link rel="prefetch" href="/es4x/assets/js/123.4586e425.js"><link rel="prefetch" href="/es4x/assets/js/124.8377618c.js"><link rel="prefetch" href="/es4x/assets/js/125.da368490.js"><link rel="prefetch" href="/es4x/assets/js/126.e0bbd98d.js"><link rel="prefetch" href="/es4x/assets/js/127.fc93d280.js"><link rel="prefetch" href="/es4x/assets/js/128.98e5a4cc.js"><link rel="prefetch" href="/es4x/assets/js/129.c7621804.js"><link rel="prefetch" href="/es4x/assets/js/13.3ba77560.js"><link rel="prefetch" href="/es4x/assets/js/130.5cd4d89d.js"><link rel="prefetch" href="/es4x/assets/js/131.ae0d85c1.js"><link rel="prefetch" href="/es4x/assets/js/132.e08c4610.js"><link rel="prefetch" href="/es4x/assets/js/133.c0606af1.js"><link rel="prefetch" href="/es4x/assets/js/134.6426c832.js"><link rel="prefetch" href="/es4x/assets/js/135.cfc1f0ec.js"><link rel="prefetch" href="/es4x/assets/js/136.a8b15a1b.js"><link rel="prefetch" href="/es4x/assets/js/137.35e8cd32.js"><link rel="prefetch" href="/es4x/assets/js/138.312a152f.js"><link rel="prefetch" href="/es4x/assets/js/139.e437bff1.js"><link rel="prefetch" href="/es4x/assets/js/14.72f2b0c1.js"><link rel="prefetch" href="/es4x/assets/js/140.8d09b641.js"><link rel="prefetch" href="/es4x/assets/js/141.52848e3f.js"><link rel="prefetch" href="/es4x/assets/js/142.39cf7674.js"><link rel="prefetch" href="/es4x/assets/js/143.7d902150.js"><link rel="prefetch" href="/es4x/assets/js/144.3e74a206.js"><link rel="prefetch" href="/es4x/assets/js/145.6a2886f8.js"><link rel="prefetch" href="/es4x/assets/js/146.244849e4.js"><link rel="prefetch" href="/es4x/assets/js/147.7f0c9791.js"><link rel="prefetch" href="/es4x/assets/js/148.ab94dede.js"><link rel="prefetch" href="/es4x/assets/js/149.a49458da.js"><link rel="prefetch" href="/es4x/assets/js/15.bd087613.js"><link rel="prefetch" href="/es4x/assets/js/150.eabb62e5.js"><link rel="prefetch" href="/es4x/assets/js/151.a6f046ed.js"><link rel="prefetch" href="/es4x/assets/js/152.78e21db3.js"><link rel="prefetch" href="/es4x/assets/js/153.eef01fd9.js"><link rel="prefetch" href="/es4x/assets/js/154.68000f3a.js"><link rel="prefetch" href="/es4x/assets/js/155.51583889.js"><link rel="prefetch" href="/es4x/assets/js/156.b598ecad.js"><link rel="prefetch" href="/es4x/assets/js/157.37bfe59b.js"><link rel="prefetch" href="/es4x/assets/js/158.14f16fe6.js"><link rel="prefetch" href="/es4x/assets/js/159.5019694d.js"><link rel="prefetch" href="/es4x/assets/js/16.a392a655.js"><link rel="prefetch" href="/es4x/assets/js/160.dfe7924a.js"><link rel="prefetch" href="/es4x/assets/js/161.acc5cf27.js"><link rel="prefetch" href="/es4x/assets/js/162.5c855be0.js"><link rel="prefetch" href="/es4x/assets/js/163.841834be.js"><link rel="prefetch" href="/es4x/assets/js/164.368aca3b.js"><link rel="prefetch" href="/es4x/assets/js/165.0c08e67b.js"><link rel="prefetch" href="/es4x/assets/js/166.361b2ec9.js"><link rel="prefetch" href="/es4x/assets/js/167.a45d61db.js"><link rel="prefetch" href="/es4x/assets/js/168.2f440f57.js"><link rel="prefetch" href="/es4x/assets/js/169.40f71d05.js"><link rel="prefetch" href="/es4x/assets/js/17.f58ddc3f.js"><link rel="prefetch" href="/es4x/assets/js/170.bfd53069.js"><link rel="prefetch" href="/es4x/assets/js/171.73de0958.js"><link rel="prefetch" href="/es4x/assets/js/172.c0640f4c.js"><link rel="prefetch" href="/es4x/assets/js/18.e2866c20.js"><link rel="prefetch" href="/es4x/assets/js/19.5895c9c4.js"><link rel="prefetch" href="/es4x/assets/js/20.bbfce85e.js"><link rel="prefetch" href="/es4x/assets/js/21.bfb22c95.js"><link rel="prefetch" href="/es4x/assets/js/22.bfe5d665.js"><link rel="prefetch" href="/es4x/assets/js/23.7db73d21.js"><link rel="prefetch" href="/es4x/assets/js/24.1e68764d.js"><link rel="prefetch" href="/es4x/assets/js/25.80677ca8.js"><link rel="prefetch" href="/es4x/assets/js/26.05452c59.js"><link rel="prefetch" href="/es4x/assets/js/27.9cb32590.js"><link rel="prefetch" href="/es4x/assets/js/28.08149c08.js"><link rel="prefetch" href="/es4x/assets/js/29.147441c7.js"><link rel="prefetch" href="/es4x/assets/js/3.4d2250de.js"><link rel="prefetch" href="/es4x/assets/js/30.5f95f2c8.js"><link rel="prefetch" href="/es4x/assets/js/31.7000a792.js"><link rel="prefetch" href="/es4x/assets/js/32.a454f02e.js"><link rel="prefetch" href="/es4x/assets/js/33.9072e3dc.js"><link rel="prefetch" href="/es4x/assets/js/34.2cd817f7.js"><link rel="prefetch" href="/es4x/assets/js/35.1499c4b4.js"><link rel="prefetch" href="/es4x/assets/js/36.53b6ddf9.js"><link rel="prefetch" href="/es4x/assets/js/37.1b440312.js"><link rel="prefetch" href="/es4x/assets/js/38.1caa3e15.js"><link rel="prefetch" href="/es4x/assets/js/39.ab25bad3.js"><link rel="prefetch" href="/es4x/assets/js/4.2410671b.js"><link rel="prefetch" href="/es4x/assets/js/40.13850330.js"><link rel="prefetch" href="/es4x/assets/js/41.1f30e160.js"><link rel="prefetch" href="/es4x/assets/js/42.f65b46db.js"><link rel="prefetch" href="/es4x/assets/js/43.86bd3898.js"><link rel="prefetch" href="/es4x/assets/js/44.25aede52.js"><link rel="prefetch" href="/es4x/assets/js/45.cee33b90.js"><link rel="prefetch" href="/es4x/assets/js/46.08c82be4.js"><link rel="prefetch" href="/es4x/assets/js/47.9263c242.js"><link rel="prefetch" href="/es4x/assets/js/48.4ef5e818.js"><link rel="prefetch" href="/es4x/assets/js/49.51ca886c.js"><link rel="prefetch" href="/es4x/assets/js/5.0b93e503.js"><link rel="prefetch" href="/es4x/assets/js/50.54a8010f.js"><link rel="prefetch" href="/es4x/assets/js/51.26142f55.js"><link rel="prefetch" href="/es4x/assets/js/52.b132a309.js"><link rel="prefetch" href="/es4x/assets/js/53.edc43f5a.js"><link rel="prefetch" href="/es4x/assets/js/54.6794cce1.js"><link rel="prefetch" href="/es4x/assets/js/55.dfdebce6.js"><link rel="prefetch" href="/es4x/assets/js/56.2b9f4603.js"><link rel="prefetch" href="/es4x/assets/js/57.c707ed5a.js"><link rel="prefetch" href="/es4x/assets/js/58.925a6f1c.js"><link rel="prefetch" href="/es4x/assets/js/59.de86b06d.js"><link rel="prefetch" href="/es4x/assets/js/6.bee7d20c.js"><link rel="prefetch" href="/es4x/assets/js/60.e74847c7.js"><link rel="prefetch" href="/es4x/assets/js/61.f45f1d70.js"><link rel="prefetch" href="/es4x/assets/js/62.c7245534.js"><link rel="prefetch" href="/es4x/assets/js/63.91dfc6d8.js"><link rel="prefetch" href="/es4x/assets/js/64.a9a5d5d7.js"><link rel="prefetch" href="/es4x/assets/js/65.82e7c7b1.js"><link rel="prefetch" href="/es4x/assets/js/66.9b26aed8.js"><link rel="prefetch" href="/es4x/assets/js/67.b882907b.js"><link rel="prefetch" href="/es4x/assets/js/68.6a6dc2a2.js"><link rel="prefetch" href="/es4x/assets/js/69.8e1e834e.js"><link rel="prefetch" href="/es4x/assets/js/7.408ffc95.js"><link rel="prefetch" href="/es4x/assets/js/70.f213078f.js"><link rel="prefetch" href="/es4x/assets/js/71.228413c9.js"><link rel="prefetch" href="/es4x/assets/js/72.d6ff0902.js"><link rel="prefetch" href="/es4x/assets/js/73.dbc371ba.js"><link rel="prefetch" href="/es4x/assets/js/74.13ff27d1.js"><link rel="prefetch" href="/es4x/assets/js/75.db024b7e.js"><link rel="prefetch" href="/es4x/assets/js/76.ef6180eb.js"><link rel="prefetch" href="/es4x/assets/js/77.7c3517c1.js"><link rel="prefetch" href="/es4x/assets/js/78.10e54671.js"><link rel="prefetch" href="/es4x/assets/js/79.b254f9ec.js"><link rel="prefetch" href="/es4x/assets/js/8.3d81d937.js"><link rel="prefetch" href="/es4x/assets/js/80.80c9d719.js"><link rel="prefetch" href="/es4x/assets/js/81.7be9486c.js"><link rel="prefetch" href="/es4x/assets/js/82.554dda8f.js"><link rel="prefetch" href="/es4x/assets/js/83.9d052d44.js"><link rel="prefetch" href="/es4x/assets/js/84.60798b2c.js"><link rel="prefetch" href="/es4x/assets/js/85.e4ce5e87.js"><link rel="prefetch" href="/es4x/assets/js/86.179d24c1.js"><link rel="prefetch" href="/es4x/assets/js/87.6d60cd83.js"><link rel="prefetch" href="/es4x/assets/js/88.6bfd1577.js"><link rel="prefetch" href="/es4x/assets/js/89.ddac2119.js"><link rel="prefetch" href="/es4x/assets/js/9.a0345499.js"><link rel="prefetch" href="/es4x/assets/js/90.4a4fd3dc.js"><link rel="prefetch" href="/es4x/assets/js/91.065cc9a5.js"><link rel="prefetch" href="/es4x/assets/js/92.80435a8d.js"><link rel="prefetch" href="/es4x/assets/js/93.b7af2039.js"><link rel="prefetch" href="/es4x/assets/js/94.b096f725.js"><link rel="prefetch" href="/es4x/assets/js/95.af24f6b1.js"><link rel="prefetch" href="/es4x/assets/js/96.38f15cba.js"><link rel="prefetch" href="/es4x/assets/js/98.3426a32c.js"><link rel="prefetch" href="/es4x/assets/js/99.a568bb05.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.57be2129.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/mongo-client/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/mongo-client/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" aria-current="page" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>A Vert.x client allowing applications to interact with a MongoDB
instance, whether that’s saving, retrieving, searching, or deleting
documents. Mongo is a great match for persisting data in a Vert.x
application as it natively handles JSON (BSON) documents.</p> <p><strong>Features</strong></p> <ul><li><p>Completely non-blocking</p></li> <li><p>Custom codec to support fast serialization to/from Vert.x JSON</p></li> <li><p>Supports a majority of the configuration options from the MongoDB
Java Driver</p></li></ul> <p>This client is based on the <a href="http://mongodb.github.io/mongo-java-driver/3.2/driver-async/getting-started" target="_blank" rel="noopener noreferrer">MongoDB Async
Driver<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h1 id="using-vert-x-mongodb-client"><a href="#using-vert-x-mongodb-client" class="header-anchor">#</a> Using Vert.x MongoDB Client</h1> <p>To use this project, add the following dependency to the <em>dependencies</em>
section of your build descriptor:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.vertx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>vertx-mongo-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>compile <span class="token string">'io.vertx:vertx-mongo-client:${maven.version}'</span>
</code></pre></div><h1 id="creating-a-client"><a href="#creating-a-client" class="header-anchor">#</a> Creating a client</h1> <p>You can create a client in several ways:</p> <h2 id="using-the-default-shared-pool"><a href="#using-the-default-shared-pool" class="header-anchor">#</a> Using the default shared pool</h2> <p>In most cases you will want to share a pool between different client
instances.</p> <p>E.g. you scale your application by deploying multiple instances of your
verticle and you want each verticle instance to share the same pool so
you don’t end up with multiple pools</p> <p>The simplest way to do this is as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MongoClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mongo-client&quot;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MongoClient<span class="token punctuation">.</span><span class="token function">createShared</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The first call to <code>MongoClient.createShared</code> will actually create the
pool, and the specified config will be used.</p> <p>Subsequent calls will return a new client instance that uses the same
pool, so the configuration won’t be used.</p> <h2 id="specifying-a-pool-source-name"><a href="#specifying-a-pool-source-name" class="header-anchor">#</a> Specifying a pool source name</h2> <p>You can create a client specifying a pool source name as follows</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MongoClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mongo-client&quot;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MongoClient<span class="token punctuation">.</span><span class="token function">createShared</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token string">&quot;MyPoolName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If different clients are created using the same Vert.x instance and
specifying the same pool name, they will share the same pool.</p> <p>The first call to <code>MongoClient.createShared</code> will actually create the
pool, and the specified config will be used.</p> <p>Subsequent calls will return a new client instance that uses the same
pool, so the configuration won’t be used.</p> <p>Use this way of creating if you wish different groups of clients to have
different pools, e.g. they’re interacting with different databases.</p> <h2 id="creating-a-client-with-a-non-shared-data-pool"><a href="#creating-a-client-with-a-non-shared-data-pool" class="header-anchor">#</a> Creating a client with a non shared data pool</h2> <p>In most cases you will want to share a pool between different client
instances. However, it’s possible you want to create a client instance
that doesn’t share its pool with any other client.</p> <p>In that case you can use <code>MongoClient.create</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MongoClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mongo-client&quot;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MongoClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This is equivalent to calling <code>MongoClient.createShared</code> with a unique
pool name each time.</p> <h1 id="using-the-api"><a href="#using-the-api" class="header-anchor">#</a> Using the API</h1> <p>The client API is represented by <code>MongoClient</code>.</p> <h2 id="saving-documents"><a href="#saving-documents" class="header-anchor">#</a> Saving documents</h2> <p>To save a document you use <code>save</code>.</p> <p>If the document has no <code>\_id</code> field, it is inserted, otherwise, it is
<em>upserted</em>. Upserted means it is inserted if it doesn’t already exist,
otherwise it is updated.</p> <p>If the document is inserted and has no id, then the id field generated
will be returned to the result handler.</p> <p>Here’s an example of saving a document and getting the id back</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Document has no id</span>
<span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Saved book with id &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And here’s an example of saving a document which already has an id.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Document has an id already</span>
<span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;123244&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="inserting-documents"><a href="#inserting-documents" class="header-anchor">#</a> Inserting documents</h2> <p>To insert a document you use <code>insert</code>.</p> <p>If the document is inserted and has no id, then the id field generated
will be returned to the result handler.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Document has an id already</span>
<span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Inserted book with id &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If a document is inserted with an id, and a document with that id
already exists, the insert will fail:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Document has an id already</span>
<span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;123244&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Will fail if the book with that id already exists.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="updating-documents"><a href="#updating-documents" class="header-anchor">#</a> Updating documents</h2> <p>To update a documents you use <code>updateCollection</code>.</p> <p>This updates one or multiple documents in a collection. The json object
that is passed in the <code>updateCollection</code> parameter must contain <a href="http://docs.mongodb.org/manual/reference/operator/update-field/" target="_blank" rel="noopener noreferrer">Update
Operators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
and determines how the object is updated.</p> <p>The json object specified in the query parameter determines which
documents in the collection will be updated.</p> <p>Here’s an example of updating a document in the books collection:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Match any documents with title=The Hobbit</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Set the author field</span>
<span class="token keyword">let</span> update <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;$set&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;J. R. R. Tolkien&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">updateCollection</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Book updated !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To specify if the update should upsert or update multiple documents, use
<code>updateCollectionWithOptions</code> and pass in an instance of
<code>UpdateOptions</code>.</p> <p>This has the following fields:</p> <ul><li><p><code>multi</code><br>
set to true to update multiple documents</p></li> <li><p><code>upsert</code><br>
set to true to insert the document if the query doesn’t match</p></li> <li><p><code>writeConcern</code><br>
the write concern for this operation</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Match any documents with title=The Hobbit</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Set the author field</span>
<span class="token keyword">let</span> update <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;$set&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;J. R. R. Tolkien&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpdateOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMulti</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">updateCollectionWithOptions</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Book updated !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="replacing-documents"><a href="#replacing-documents" class="header-anchor">#</a> Replacing documents</h2> <p>To replace documents you use <code>replaceDocuments</code>.</p> <p>This is similar to the update operation, however it does not take any
operator. Instead it replaces the entire document with the one provided.</p> <p>Here’s an example of replacing a document in the books collection</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> replace <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Lord of the Rings&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;J. R. R. Tolkien&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">replaceDocuments</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> replace<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Book replaced !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="bulk-operations"><a href="#bulk-operations" class="header-anchor">#</a> Bulk operations</h2> <p>To execute multiple insert, update, replace, or delete operations at
once, use <code>bulkWrite</code>.</p> <p>You can pass a list of <code>BulkOperations</code>, with each working similar to
the matching single operation. You can pass as many operations, even of
the same type, as you wish.</p> <p>To specify if the bulk operation should be executed in order, and with
what write option, use <code>bulkWriteWithOptions</code> and pass an instance of
<code>BulkWriteOptions</code>. For more explanation what ordered means, see
<a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#execution-of-operations" target="_blank" rel="noopener noreferrer">Execution of
Operations<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="finding-documents"><a href="#finding-documents" class="header-anchor">#</a> Finding documents</h2> <p>To find documents you use <code>find</code>.</p> <p>The <code>query</code> parameter is used to match the documents in the collection.</p> <p>Here’s a simple example with an empty query that will match all books:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// empty query = match any</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here’s another example that will match all books by Tolkien:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// will match all Tolkien books</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;J. R. R. Tolkien&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The matching documents are returned as a list of json objects in the
result handler.</p> <p>To specify things like what fields to return, how many results to
return, etc use <code>findWithOptions</code> and pass in the an instance of
<code>FindOptions</code>.</p> <p>This has the following fields:</p> <ul><li><p><code>fields</code><br>
The fields to return in the results. Defaults to <code>null</code>, meaning all
fields will be returned</p></li> <li><p><code>sort</code><br>
The fields to sort by. Defaults to <code>null</code>.</p></li> <li><p><code>limit</code><br>
The limit of the number of results to return. Default to <code>-1</code>,
meaning all results will be returned.</p></li> <li><p><code>skip</code><br>
The number of documents to skip before returning the results.
Defaults to <code>0</code>.</p></li></ul> <h2 id="finding-documents-in-batches"><a href="#finding-documents-in-batches" class="header-anchor">#</a> Finding documents in batches</h2> <p>When dealing with large data sets, it is not advised to use the <code>find</code>
and <code>findWithOptions</code> methods. In order to avoid inflating the whole
response into memory, use <code>findBatch</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// will match all Tolkien books</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;J. R. R. Tolkien&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">findBatch</span><span class="token punctuation">(</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">throwable</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  throwable<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;End of research&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Found doc: &quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The matching documents are emitted one by one by the <code>ReadStream</code>
handler.</p> <p><code>FindOptions</code> has an extra parameter <code>batchSize</code> which you can use to
set the number of documents to load at once:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// will match all Tolkien books</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;J. R. R. Tolkien&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FindOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setBatchSize</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">findBatchWithOptions</span><span class="token punctuation">(</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">throwable</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  throwable<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;End of research&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Found doc: &quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default, <code>batchSize</code> is set to 20.</p> <h2 id="finding-a-single-document"><a href="#finding-a-single-document" class="header-anchor">#</a> Finding a single document</h2> <p>To find a single document you use <code>findOne</code>.</p> <p>This works just like <code>find</code> but it returns just the first matching
document.</p> <h2 id="removing-documents"><a href="#removing-documents" class="header-anchor">#</a> Removing documents</h2> <p>To remove documents use <code>removeDocuments</code>.</p> <p>The <code>query</code> parameter is used to match the documents in the collection
to determine which ones to remove.</p> <p>Here’s an example of removing all Tolkien books:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;J. R. R. Tolkien&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">removeDocuments</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Never much liked Tolkien stuff!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="removing-a-single-document"><a href="#removing-a-single-document" class="header-anchor">#</a> Removing a single document</h2> <p>To remove a single document you use <code>removeDocument</code>.</p> <p>This works just like <code>removeDocuments</code> but it removes just the first
matching document.</p> <h2 id="counting-documents"><a href="#counting-documents" class="header-anchor">#</a> Counting documents</h2> <p>To count documents use <code>count</code>.</p> <p>Here’s an example that counts the number of Tolkien books. The number is
passed to the result handler.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;J. R. R. Tolkien&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> num <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="managing-mongodb-collections"><a href="#managing-mongodb-collections" class="header-anchor">#</a> Managing MongoDB collections</h2> <p>All MongoDB documents are stored in collections.</p> <p>To get a list of all collections you can use <code>getCollections</code></p> <div class="language-js extra-class"><pre class="language-js"><code>mongoClient<span class="token punctuation">.</span><span class="token function">getCollections</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> collections <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To create a new collection you can use <code>createCollection</code></p> <div class="language-js extra-class"><pre class="language-js"><code>mongoClient<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string">&quot;mynewcollectionr&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Created ok!</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To drop a collection you can use <code>dropCollection</code></p> <blockquote><p><strong>Note</strong></p> <p>Dropping a collection will delete all documents within it!</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>mongoClient<span class="token punctuation">.</span><span class="token function">dropCollection</span><span class="token punctuation">(</span><span class="token string">&quot;mynewcollectionr&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Dropped ok!</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="running-other-mongodb-commands"><a href="#running-other-mongodb-commands" class="header-anchor">#</a> Running other MongoDB commands</h2> <p>You can run arbitrary MongoDB commands with <code>runCommand</code>.</p> <p>Commands can be used to run more advanced MongoDB features, such as
using MapReduce. For more information see the mongo docs for supported
<a href="http://docs.mongodb.org/manual/reference/command" target="_blank" rel="noopener noreferrer">Commands<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Here’s an example of running an aggregate command. Note that the command
name must be specified as a parameter and also be contained in the JSON
that represents the command. This is because JSON is not ordered but
BSON is ordered and MongoDB expects the first BSON entry to be the name
of the command. In order for us to know which of the entries in the JSON
is the command name it must be specified as a parameter.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> command <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;aggregate&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;collection_name&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;pipeline&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">runCommand</span><span class="token punctuation">(</span><span class="token string">&quot;aggregate&quot;</span><span class="token punctuation">,</span> command<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> resArr <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token comment">// etc</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mongodb-extended-json-support"><a href="#mongodb-extended-json-support" class="header-anchor">#</a> MongoDB Extended JSON support</h2> <p>For now, only <code>date</code>, <code>oid</code> and <code>binary</code> types are supported (see
<a href="http://docs.mongodb.org/manual/reference/mongodb-extended-json" target="_blank" rel="noopener noreferrer">MongoDB Extended
JSON<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</p> <p>Here’s an example of inserting a document with a <code>date</code> field:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;publicationDate&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;$date&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1937-09-21T00:00:00+00:00&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;publishedBooks&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token string">&quot;publishedBooks&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> id
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;To retrieve ISO-8601 date : &quot;</span> <span class="token operator">+</span> res2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>publicationDate<span class="token punctuation">.</span>$date<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res2<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here’s an example (in Java) of inserting a document with a binary field
and reading it back</p> <div class="language-js extra-class"><pre class="language-js"><code>byte<span class="token punctuation">[</span><span class="token punctuation">]</span> binaryObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
JsonObject document <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Alan Turing&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;binaryStuff&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$binary&quot;</span><span class="token punctuation">,</span> binaryObject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;smartPeople&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> res <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    String id <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token string">&quot;smartPeople&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> res2 <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        byte<span class="token punctuation">[</span><span class="token punctuation">]</span> reconstitutedBinaryObject <span class="token operator">=</span> res2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJsonObject</span><span class="token punctuation">(</span><span class="token string">&quot;binaryStuff&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBinary</span><span class="token punctuation">(</span><span class="token string">&quot;$binary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//This could now be de-serialized into an object in real life</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res2<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here’s an example of inserting a base 64 encoded string, typing it as
binary a binary field, and reading it back</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//This could be a the byte contents of a pdf file, etc converted to base 64</span>
<span class="token keyword">let</span> base64EncodedString <span class="token operator">=</span> <span class="token string">&quot;a2FpbHVhIGlzIHRoZSAjMSBiZWFjaCBpbiB0aGUgd29ybGQ=&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Alan Turing&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;binaryStuff&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;$binary&quot;</span> <span class="token operator">:</span> base64EncodedString
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;smartPeople&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token string">&quot;smartPeople&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> id
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> reconstitutedBase64EncodedString <span class="token operator">=</span> res2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>binaryStuff<span class="token punctuation">.</span>$binary<span class="token punctuation">;</span>
        <span class="token comment">//This could now converted back to bytes from the base 64 string</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res2<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here’s an example of inserting an object ID and reading it back</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> individualId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;org.bson.types.ObjectId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Stephen Hawking&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;individualId&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;$oid&quot;</span> <span class="token operator">:</span> individualId
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;smartPeople&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> id
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    mongoService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token string">&quot;smartPeople&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res2<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> reconstitutedIndividualId <span class="token operator">=</span> res2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>individualId<span class="token punctuation">.</span>$oid<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res2<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="getting-distinct-values"><a href="#getting-distinct-values" class="header-anchor">#</a> Getting distinct values</h2> <p>Here’s an example of getting distinct value</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mongoClient<span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>class<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Title is : &quot;</span> <span class="token operator">+</span> res2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here’s an example of getting distinct value in batch mode</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mongoClient<span class="token punctuation">.</span><span class="token function">distinctBatch</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>class<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">book</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Title is : &quot;</span> <span class="token operator">+</span> book<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Here’s an example of getting distinct value with query</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;publicationDate&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;$date&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1937-09-21T00:00:00+00:00&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;publicationDate&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;$gte&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;$date&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1937-09-21T00:00:00+00:00&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mongoClient<span class="token punctuation">.</span><span class="token function">distinctWithQuery</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>class<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Title is : &quot;</span> <span class="token operator">+</span> res2<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here’s an example of getting distinct value in batch mode with query</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;The Hobbit&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;publicationDate&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;$date&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1937-09-21T00:00:00+00:00&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;publicationDate&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;$gte&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;$date&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1937-09-21T00:00:00+00:00&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoClient<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> document<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mongoClient<span class="token punctuation">.</span><span class="token function">distinctBatchWithQuery</span><span class="token punctuation">(</span><span class="token string">&quot;books&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>class<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">book</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Title is : &quot;</span> <span class="token operator">+</span> book<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="configuring-the-client"><a href="#configuring-the-client" class="header-anchor">#</a> Configuring the client</h1> <p>The client is configured with a json object.</p> <p>The following configuration is supported by the mongo client:</p> <ul><li><p><code>db_name</code><br>
Name of the database in the MongoDB instance to use. Defaults to
<code>default_db</code></p></li> <li><p><code>useObjectId</code><br>
Toggle this option to support persisting and retrieving ObjectId’s
as strings. If <code>true</code>, hex-strings will be saved as native Mongodb
ObjectId types in the document collection. This will allow the
sorting of documents based on creation time. You can also derive the
creation time from the hex-string using ObjectId::getDate(). Set to
<code>false</code> for other types of your choosing. If set to false, or left
to default, hex strings will be generated as the document _id if
the _id is omitted from the document. Defaults to <code>false</code>.</p></li></ul> <p>The mongo client tries to support most options that are allowed by the
driver. There are two ways to configure mongo for use by the driver,
either by a connection string or by separate configuration options.</p> <blockquote><p><strong>Note</strong></p> <p>If the connection string is used the mongo client will ignore any
driver configuration options.</p></blockquote> <ul><li><code>connection_string</code><br>
The connection string the driver uses to create the client. E.g.
<code>mongodb://localhost:27017</code>. For more information on the format of
the connection string please consult the driver documentation.</li></ul> <p><strong>Specific driver configuration options</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
 <span class="token comment">// Single Cluster Settings</span>
 <span class="token string">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// string</span>
 <span class="token string">&quot;port&quot;</span> <span class="token operator">:</span> <span class="token number">27017</span><span class="token punctuation">,</span>      <span class="token comment">// int</span>

 <span class="token comment">// Multiple Cluster Settings</span>
 <span class="token string">&quot;hosts&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     <span class="token string">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;cluster1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// string</span>
     <span class="token string">&quot;port&quot;</span> <span class="token operator">:</span> <span class="token number">27000</span>       <span class="token comment">// int</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span>
     <span class="token string">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;cluster2&quot;</span><span class="token punctuation">,</span> <span class="token comment">// string</span>
     <span class="token string">&quot;port&quot;</span> <span class="token operator">:</span> <span class="token number">28000</span>       <span class="token comment">// int</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token operator">...</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token string">&quot;replicaSet&quot;</span> <span class="token operator">:</span>  <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>    <span class="token comment">// string</span>
 <span class="token string">&quot;serverSelectionTimeoutMS&quot;</span> <span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// long</span>

 <span class="token comment">// Connection Pool Settings</span>
 <span class="token string">&quot;maxPoolSize&quot;</span> <span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>                <span class="token comment">// int</span>
 <span class="token string">&quot;minPoolSize&quot;</span> <span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>                <span class="token comment">// int</span>
 <span class="token string">&quot;maxIdleTimeMS&quot;</span> <span class="token operator">:</span> <span class="token number">300000</span><span class="token punctuation">,</span>          <span class="token comment">// long</span>
 <span class="token string">&quot;maxLifeTimeMS&quot;</span> <span class="token operator">:</span> <span class="token number">3600000</span><span class="token punctuation">,</span>         <span class="token comment">// long</span>
 <span class="token string">&quot;waitQueueMultiple&quot;</span>  <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>         <span class="token comment">// int</span>
 <span class="token string">&quot;waitQueueTimeoutMS&quot;</span> <span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>      <span class="token comment">// long</span>
 <span class="token string">&quot;maintenanceFrequencyMS&quot;</span> <span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>   <span class="token comment">// long</span>
 <span class="token string">&quot;maintenanceInitialDelayMS&quot;</span> <span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token comment">// long</span>

 <span class="token comment">// Credentials / Auth</span>
 <span class="token string">&quot;username&quot;</span>   <span class="token operator">:</span> <span class="token string">&quot;john&quot;</span><span class="token punctuation">,</span>     <span class="token comment">// string</span>
 <span class="token string">&quot;password&quot;</span>   <span class="token operator">:</span> <span class="token string">&quot;passw0rd&quot;</span><span class="token punctuation">,</span> <span class="token comment">// string</span>
 <span class="token string">&quot;authSource&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some.db&quot;</span>   <span class="token comment">// string</span>
 <span class="token comment">// Auth mechanism</span>
 <span class="token string">&quot;authMechanism&quot;</span>     <span class="token operator">:</span> <span class="token string">&quot;GSSAPI&quot;</span><span class="token punctuation">,</span>        <span class="token comment">// string</span>
 <span class="token string">&quot;gssapiServiceName&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;myservicename&quot;</span><span class="token punctuation">,</span> <span class="token comment">// string</span>

 <span class="token comment">// Socket Settings</span>
 <span class="token string">&quot;connectTimeoutMS&quot;</span> <span class="token operator">:</span> <span class="token number">300000</span><span class="token punctuation">,</span> <span class="token comment">// int</span>
 <span class="token string">&quot;socketTimeoutMS&quot;</span>  <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span> <span class="token comment">// int</span>
 <span class="token string">&quot;sendBufferSize&quot;</span>    <span class="token operator">:</span> <span class="token number">8192</span><span class="token punctuation">,</span>  <span class="token comment">// int</span>
 <span class="token string">&quot;receiveBufferSize&quot;</span> <span class="token operator">:</span> <span class="token number">8192</span><span class="token punctuation">,</span>  <span class="token comment">// int</span>
 <span class="token string">&quot;keepAlive&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span>           <span class="token comment">// boolean</span>

 <span class="token comment">// Heartbeat socket settings</span>
 <span class="token string">&quot;heartbeat.socket&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
 <span class="token string">&quot;connectTimeoutMS&quot;</span> <span class="token operator">:</span> <span class="token number">300000</span><span class="token punctuation">,</span> <span class="token comment">// int</span>
 <span class="token string">&quot;socketTimeoutMS&quot;</span>  <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span> <span class="token comment">// int</span>
 <span class="token string">&quot;sendBufferSize&quot;</span>    <span class="token operator">:</span> <span class="token number">8192</span><span class="token punctuation">,</span>  <span class="token comment">// int</span>
 <span class="token string">&quot;receiveBufferSize&quot;</span> <span class="token operator">:</span> <span class="token number">8192</span><span class="token punctuation">,</span>  <span class="token comment">// int</span>
 <span class="token string">&quot;keepAlive&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span>           <span class="token comment">// boolean</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// Server Settings</span>
 <span class="token string">&quot;heartbeatFrequencyMS&quot;</span> <span class="token operator">:</span>    <span class="token number">1000</span> <span class="token comment">// long</span>
 <span class="token string">&quot;minHeartbeatFrequencyMS&quot;</span> <span class="token operator">:</span> <span class="token number">500</span> <span class="token comment">// long</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Driver option descriptions</strong></p> <ul><li><p><code>host</code><br>
The host the MongoDB instance is running. Defaults to <code>127.0.0.1</code>.
This is ignored if <code>hosts</code> is specified</p></li> <li><p><code>port</code><br>
The port the MongoDB instance is listening on. Defaults to <code>27017</code>.
This is ignored if <code>hosts</code> is specified</p></li> <li><p><code>hosts</code><br>
An array representing the hosts and ports to support a MongoDB
cluster (sharding / replication)</p></li> <li><p><code>host</code><br>
A host in the cluster</p></li> <li><p><code>port</code><br>
The port a host in the cluster is listening on</p></li> <li><p><code>replicaSet</code><br>
The name of the replica set, if the MongoDB instance is a member of
a replica set</p></li> <li><p><code>serverSelectionTimeoutMS</code><br>
The time in milliseconds that the mongo driver will wait to select a
server for an operation before raising an error.</p></li> <li><p><code>maxPoolSize</code><br>
The maximum number of connections in the connection pool. The
default value is <code>100</code></p></li> <li><p><code>minPoolSize</code><br>
The minimum number of connections in the connection pool. The
default value is <code>0</code></p></li> <li><p><code>maxIdleTimeMS</code><br>
The maximum idle time of a pooled connection. The default value is
<code>0</code> which means there is no limit</p></li> <li><p><code>maxLifeTimeMS</code><br>
The maximum time a pooled connection can live for. The default value
is <code>0</code> which means there is no limit</p></li> <li><p><code>waitQueueMultiple</code><br>
The maximum number of waiters for a connection to become available
from the pool. Default value is <code>500</code></p></li> <li><p><code>waitQueueTimeoutMS</code><br>
The maximum time that a thread may wait for a connection to become
available. Default value is <code>120000</code> (2 minutes)</p></li> <li><p><code>maintenanceFrequencyMS</code><br>
The time period between runs of the maintenance job. Default is <code>0</code>.</p></li> <li><p><code>maintenanceInitialDelayMS</code><br>
The period of time to wait before running the first maintenance job
on the connection pool. Default is <code>0</code>.</p></li> <li><p><code>username</code><br>
The username to authenticate. Default is <code>null</code> (meaning no
authentication required)</p></li> <li><p><code>password</code><br>
The password to use to authenticate.</p></li> <li><p><code>authSource</code><br>
The database name associated with the user’s credentials. Default
value is the <code>db_name</code> value.</p></li> <li><p><code>authMechanism</code><br>
The authentication mechanism to use. See
[Authentication](<a href="http://docs.mongodb.org/manual/core/authentication/" target="_blank" rel="noopener noreferrer">http://docs.mongodb.org/manual/core/authentication/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)
for more details.</p></li> <li><p><code>gssapiServiceName</code><br>
The Kerberos service name if <code>GSSAPI</code> is specified as the
<code>authMechanism</code>.</p></li> <li><p><code>connectTimeoutMS</code><br>
The time in milliseconds to attempt a connection before timing out.
Default is <code>10000</code> (10 seconds)</p></li> <li><p><code>socketTimeoutMS</code><br>
The time in milliseconds to attempt a send or receive on a socket
before the attempt times out. Default is <code>0</code> meaning there is no
timeout</p></li> <li><p><code>sendBufferSize</code><br>
Sets the send buffer size (SO_SNDBUF) for the socket. Default is
<code>0</code>, meaning it will use the OS default for this option.</p></li> <li><p><code>receiveBufferSize</code><br>
Sets the receive buffer size (SO_RCVBUF) for the socket. Default is
<code>0</code>, meaning it will use the OS default for this option.</p></li> <li><p><code>keepAlive</code><br>
Sets the keep alive (SO_KEEPALIVE) for the socket. Default is
<code>false</code></p></li> <li><p><code>heartbeat.socket</code><br>
Configures the socket settings for the cluster monitor of the
MongoDB java driver.</p></li> <li><p><code>heartbeatFrequencyMS</code><br>
The frequency that the cluster monitor attempts to reach each
server. Default is <code>5000</code> (5 seconds)</p></li> <li><p><code>minHeartbeatFrequencyMS</code><br>
The minimum heartbeat frequency. The default value is <code>1000</code> (1
second)</p></li> <li><p><code>ssl</code><br>
Enable ssl between the vertx-mongo-client and mongo</p></li> <li><p><code>trustAll</code><br>
When using ssl, trust <em>ALL</em> certificates. <strong>WARNING</strong> - Trusting
<em>ALL</em> certificates will open you up to potential security issues
such as MITM attacks.</p></li> <li><p><code>caPath</code><br>
Set a path to a file that contains a certificate that will be used
as a source of trust when making SSL connections to mongo.</p></li></ul> <blockquote><p><strong>Note</strong></p> <p>Most of the default values listed above use the default values of the
MongoDB Java Driver. Please consult the driver documentation for up to
date information.</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/mongo-client/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/30/2020, 11:09:36 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.837a6700.js" defer></script><script src="/es4x/assets/js/2.96613d0f.js" defer></script><script src="/es4x/assets/js/97.c53fc06f.js" defer></script>
  </body>
</html>
