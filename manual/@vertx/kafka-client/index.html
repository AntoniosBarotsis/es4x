<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES for Eclipse Vert.x</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
    <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
    <script src="/es4x/player/asciinema-player.js"></script>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <link rel="preload" href="/es4x/assets/css/0.styles.57be2129.css" as="style"><link rel="preload" href="/es4x/assets/js/app.cfb14a02.js" as="script"><link rel="preload" href="/es4x/assets/js/2.96613d0f.js" as="script"><link rel="preload" href="/es4x/assets/js/89.aac46f66.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.25f493b2.js"><link rel="prefetch" href="/es4x/assets/js/100.cfb483ce.js"><link rel="prefetch" href="/es4x/assets/js/101.e546445b.js"><link rel="prefetch" href="/es4x/assets/js/102.9c678484.js"><link rel="prefetch" href="/es4x/assets/js/103.58ddcfc8.js"><link rel="prefetch" href="/es4x/assets/js/104.5d636807.js"><link rel="prefetch" href="/es4x/assets/js/105.9c9f8986.js"><link rel="prefetch" href="/es4x/assets/js/106.fb797c19.js"><link rel="prefetch" href="/es4x/assets/js/107.29eb69ad.js"><link rel="prefetch" href="/es4x/assets/js/108.d97e0b4e.js"><link rel="prefetch" href="/es4x/assets/js/109.28629ef4.js"><link rel="prefetch" href="/es4x/assets/js/11.6250afa8.js"><link rel="prefetch" href="/es4x/assets/js/110.3dd0cba3.js"><link rel="prefetch" href="/es4x/assets/js/111.601b115c.js"><link rel="prefetch" href="/es4x/assets/js/112.a49c45ac.js"><link rel="prefetch" href="/es4x/assets/js/113.ea0e864c.js"><link rel="prefetch" href="/es4x/assets/js/114.24c46597.js"><link rel="prefetch" href="/es4x/assets/js/115.65241419.js"><link rel="prefetch" href="/es4x/assets/js/116.a69493f0.js"><link rel="prefetch" href="/es4x/assets/js/117.03106a2c.js"><link rel="prefetch" href="/es4x/assets/js/118.50ed2245.js"><link rel="prefetch" href="/es4x/assets/js/119.beb4913a.js"><link rel="prefetch" href="/es4x/assets/js/12.1f7f2bd3.js"><link rel="prefetch" href="/es4x/assets/js/120.f13c267c.js"><link rel="prefetch" href="/es4x/assets/js/121.197dd995.js"><link rel="prefetch" href="/es4x/assets/js/122.b44c98b3.js"><link rel="prefetch" href="/es4x/assets/js/123.4586e425.js"><link rel="prefetch" href="/es4x/assets/js/124.d00a049e.js"><link rel="prefetch" href="/es4x/assets/js/125.1f32b7a7.js"><link rel="prefetch" href="/es4x/assets/js/126.e0bbd98d.js"><link rel="prefetch" href="/es4x/assets/js/127.fc93d280.js"><link rel="prefetch" href="/es4x/assets/js/128.98e5a4cc.js"><link rel="prefetch" href="/es4x/assets/js/129.fb3a3f88.js"><link rel="prefetch" href="/es4x/assets/js/13.1a7b9986.js"><link rel="prefetch" href="/es4x/assets/js/130.5cd4d89d.js"><link rel="prefetch" href="/es4x/assets/js/131.6ac7fa33.js"><link rel="prefetch" href="/es4x/assets/js/132.c8ad9a79.js"><link rel="prefetch" href="/es4x/assets/js/133.90881bb4.js"><link rel="prefetch" href="/es4x/assets/js/134.f7596c11.js"><link rel="prefetch" href="/es4x/assets/js/135.f8db6a39.js"><link rel="prefetch" href="/es4x/assets/js/136.bd2de92d.js"><link rel="prefetch" href="/es4x/assets/js/137.eabfa5f6.js"><link rel="prefetch" href="/es4x/assets/js/138.c19e308b.js"><link rel="prefetch" href="/es4x/assets/js/139.e437bff1.js"><link rel="prefetch" href="/es4x/assets/js/14.b66836b1.js"><link rel="prefetch" href="/es4x/assets/js/140.8d09b641.js"><link rel="prefetch" href="/es4x/assets/js/141.4d46fb84.js"><link rel="prefetch" href="/es4x/assets/js/142.99040345.js"><link rel="prefetch" href="/es4x/assets/js/143.7d902150.js"><link rel="prefetch" href="/es4x/assets/js/144.0543ff8f.js"><link rel="prefetch" href="/es4x/assets/js/145.6a2886f8.js"><link rel="prefetch" href="/es4x/assets/js/146.01466845.js"><link rel="prefetch" href="/es4x/assets/js/147.42e445c8.js"><link rel="prefetch" href="/es4x/assets/js/148.e677edea.js"><link rel="prefetch" href="/es4x/assets/js/149.50959280.js"><link rel="prefetch" href="/es4x/assets/js/15.bd087613.js"><link rel="prefetch" href="/es4x/assets/js/150.eabb62e5.js"><link rel="prefetch" href="/es4x/assets/js/151.a6f046ed.js"><link rel="prefetch" href="/es4x/assets/js/152.78e21db3.js"><link rel="prefetch" href="/es4x/assets/js/153.eef01fd9.js"><link rel="prefetch" href="/es4x/assets/js/154.f5b66c27.js"><link rel="prefetch" href="/es4x/assets/js/155.f5cbe3be.js"><link rel="prefetch" href="/es4x/assets/js/156.3fdf30f1.js"><link rel="prefetch" href="/es4x/assets/js/157.aeebd96f.js"><link rel="prefetch" href="/es4x/assets/js/158.bec405e9.js"><link rel="prefetch" href="/es4x/assets/js/159.f81bc2fa.js"><link rel="prefetch" href="/es4x/assets/js/16.a392a655.js"><link rel="prefetch" href="/es4x/assets/js/160.611a570e.js"><link rel="prefetch" href="/es4x/assets/js/161.400aed1c.js"><link rel="prefetch" href="/es4x/assets/js/162.60fdd908.js"><link rel="prefetch" href="/es4x/assets/js/163.841834be.js"><link rel="prefetch" href="/es4x/assets/js/164.368aca3b.js"><link rel="prefetch" href="/es4x/assets/js/165.6ed202c4.js"><link rel="prefetch" href="/es4x/assets/js/166.cd243b01.js"><link rel="prefetch" href="/es4x/assets/js/167.74493e23.js"><link rel="prefetch" href="/es4x/assets/js/168.26ae4c80.js"><link rel="prefetch" href="/es4x/assets/js/169.adffbf41.js"><link rel="prefetch" href="/es4x/assets/js/17.f58ddc3f.js"><link rel="prefetch" href="/es4x/assets/js/170.ec119bad.js"><link rel="prefetch" href="/es4x/assets/js/171.8ce41d74.js"><link rel="prefetch" href="/es4x/assets/js/172.c0640f4c.js"><link rel="prefetch" href="/es4x/assets/js/18.d0e693e8.js"><link rel="prefetch" href="/es4x/assets/js/19.2cfa07bf.js"><link rel="prefetch" href="/es4x/assets/js/20.83c2c4e9.js"><link rel="prefetch" href="/es4x/assets/js/21.bfb22c95.js"><link rel="prefetch" href="/es4x/assets/js/22.80259bfc.js"><link rel="prefetch" href="/es4x/assets/js/23.d3df90af.js"><link rel="prefetch" href="/es4x/assets/js/24.47cf75e1.js"><link rel="prefetch" href="/es4x/assets/js/25.af00dd42.js"><link rel="prefetch" href="/es4x/assets/js/26.2c5dd1f3.js"><link rel="prefetch" href="/es4x/assets/js/27.313c4d9d.js"><link rel="prefetch" href="/es4x/assets/js/28.c3fa5296.js"><link rel="prefetch" href="/es4x/assets/js/29.bc391437.js"><link rel="prefetch" href="/es4x/assets/js/3.4d2250de.js"><link rel="prefetch" href="/es4x/assets/js/30.ab72b827.js"><link rel="prefetch" href="/es4x/assets/js/31.360cf0c4.js"><link rel="prefetch" href="/es4x/assets/js/32.a454f02e.js"><link rel="prefetch" href="/es4x/assets/js/33.9072e3dc.js"><link rel="prefetch" href="/es4x/assets/js/34.2cd817f7.js"><link rel="prefetch" href="/es4x/assets/js/35.1499c4b4.js"><link rel="prefetch" href="/es4x/assets/js/36.b24867f2.js"><link rel="prefetch" href="/es4x/assets/js/37.8a1d9476.js"><link rel="prefetch" href="/es4x/assets/js/38.1caa3e15.js"><link rel="prefetch" href="/es4x/assets/js/39.ab25bad3.js"><link rel="prefetch" href="/es4x/assets/js/4.2410671b.js"><link rel="prefetch" href="/es4x/assets/js/40.13850330.js"><link rel="prefetch" href="/es4x/assets/js/41.1f30e160.js"><link rel="prefetch" href="/es4x/assets/js/42.f65b46db.js"><link rel="prefetch" href="/es4x/assets/js/43.86bd3898.js"><link rel="prefetch" href="/es4x/assets/js/44.25aede52.js"><link rel="prefetch" href="/es4x/assets/js/45.fbb6033a.js"><link rel="prefetch" href="/es4x/assets/js/46.13bb4f87.js"><link rel="prefetch" href="/es4x/assets/js/47.01a4d32b.js"><link rel="prefetch" href="/es4x/assets/js/48.4ef5e818.js"><link rel="prefetch" href="/es4x/assets/js/49.896ad60c.js"><link rel="prefetch" href="/es4x/assets/js/5.f2fd7a11.js"><link rel="prefetch" href="/es4x/assets/js/50.54a8010f.js"><link rel="prefetch" href="/es4x/assets/js/51.26142f55.js"><link rel="prefetch" href="/es4x/assets/js/52.b132a309.js"><link rel="prefetch" href="/es4x/assets/js/53.dc983026.js"><link rel="prefetch" href="/es4x/assets/js/54.3ae4a5b7.js"><link rel="prefetch" href="/es4x/assets/js/55.4b3e9675.js"><link rel="prefetch" href="/es4x/assets/js/56.2cc05aac.js"><link rel="prefetch" href="/es4x/assets/js/57.f8c33e2c.js"><link rel="prefetch" href="/es4x/assets/js/58.7b7e6201.js"><link rel="prefetch" href="/es4x/assets/js/59.beab06b9.js"><link rel="prefetch" href="/es4x/assets/js/6.7eb69711.js"><link rel="prefetch" href="/es4x/assets/js/60.ad528007.js"><link rel="prefetch" href="/es4x/assets/js/61.7462fe68.js"><link rel="prefetch" href="/es4x/assets/js/62.c7245534.js"><link rel="prefetch" href="/es4x/assets/js/63.91dfc6d8.js"><link rel="prefetch" href="/es4x/assets/js/64.a9a5d5d7.js"><link rel="prefetch" href="/es4x/assets/js/65.bd897469.js"><link rel="prefetch" href="/es4x/assets/js/66.b6b4afbd.js"><link rel="prefetch" href="/es4x/assets/js/67.b882907b.js"><link rel="prefetch" href="/es4x/assets/js/68.32bb2628.js"><link rel="prefetch" href="/es4x/assets/js/69.6e7fa7f2.js"><link rel="prefetch" href="/es4x/assets/js/7.e56c8e30.js"><link rel="prefetch" href="/es4x/assets/js/70.9fa2afb4.js"><link rel="prefetch" href="/es4x/assets/js/71.228413c9.js"><link rel="prefetch" href="/es4x/assets/js/72.4a3f3614.js"><link rel="prefetch" href="/es4x/assets/js/73.abf3fc90.js"><link rel="prefetch" href="/es4x/assets/js/74.13ff27d1.js"><link rel="prefetch" href="/es4x/assets/js/75.96ffdfe8.js"><link rel="prefetch" href="/es4x/assets/js/76.ef6180eb.js"><link rel="prefetch" href="/es4x/assets/js/77.7c3517c1.js"><link rel="prefetch" href="/es4x/assets/js/78.a4cb55ca.js"><link rel="prefetch" href="/es4x/assets/js/79.2a3d8a2f.js"><link rel="prefetch" href="/es4x/assets/js/8.3d81d937.js"><link rel="prefetch" href="/es4x/assets/js/80.80c9d719.js"><link rel="prefetch" href="/es4x/assets/js/81.7be9486c.js"><link rel="prefetch" href="/es4x/assets/js/82.f30975e2.js"><link rel="prefetch" href="/es4x/assets/js/83.2e22eebd.js"><link rel="prefetch" href="/es4x/assets/js/84.60798b2c.js"><link rel="prefetch" href="/es4x/assets/js/85.a6928290.js"><link rel="prefetch" href="/es4x/assets/js/86.0be2ea51.js"><link rel="prefetch" href="/es4x/assets/js/87.ad51e710.js"><link rel="prefetch" href="/es4x/assets/js/88.81d5d220.js"><link rel="prefetch" href="/es4x/assets/js/9.2edb4e2b.js"><link rel="prefetch" href="/es4x/assets/js/90.4a4fd3dc.js"><link rel="prefetch" href="/es4x/assets/js/91.065cc9a5.js"><link rel="prefetch" href="/es4x/assets/js/92.055a4ecc.js"><link rel="prefetch" href="/es4x/assets/js/93.71b53f02.js"><link rel="prefetch" href="/es4x/assets/js/94.b096f725.js"><link rel="prefetch" href="/es4x/assets/js/95.af24f6b1.js"><link rel="prefetch" href="/es4x/assets/js/96.38f15cba.js"><link rel="prefetch" href="/es4x/assets/js/97.c53fc06f.js"><link rel="prefetch" href="/es4x/assets/js/98.3426a32c.js"><link rel="prefetch" href="/es4x/assets/js/99.fa951d15.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.57be2129.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/kafka-client/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/kafka-client/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" aria-current="page" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>This component provides a Kafka client for reading and sending messages
from/to an <a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">Apache Kafka<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> cluster.</p> <p>As consumer, the API provides methods for subscribing to a topic
partition receiving messages asynchronously or reading them as a stream
(even with the possibility to pause/resume the stream).</p> <p>As producer, the API provides methods for sending message to a topic
partition like writing on a stream.</p> <h1 id="using-the-vert-x-kafka-client"><a href="#using-the-vert-x-kafka-client" class="header-anchor">#</a> Using the Vert.x Kafka client</h1> <p>To use this component, add the following dependency to the dependencies
section of your build descriptor:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.vertx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>vertx-kafka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>compile io<span class="token punctuation">.</span>vertx<span class="token punctuation">:</span>vertx<span class="token operator">-</span>kafka<span class="token operator">-</span>client<span class="token punctuation">:</span><span class="token punctuation">$</span><span class="token punctuation">{</span>maven<span class="token punctuation">.</span>version<span class="token punctuation">}</span>
</code></pre></div><h1 id="creating-kafka-clients"><a href="#creating-kafka-clients" class="header-anchor">#</a> Creating Kafka clients</h1> <p>Creating consumers and producers is quite similar and on how it works
using the native Kafka client library.</p> <p>They need to be configured with a bunch of properties as described in
the official Apache Kafka documentation, for the
<a href="https://kafka.apache.org/documentation/#newconsumerconfigs" target="_blank" rel="noopener noreferrer">consumer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
and for the
<a href="https://kafka.apache.org/documentation/#producerconfigs" target="_blank" rel="noopener noreferrer">producer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>To achieve that, a map can be configured with such properties passing it
to one of the static creation methods exposed by <code>KafkaConsumer</code> and
<code>KafkaProducer</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KafkaConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/kafka-client&quot;</span>

<span class="token comment">// creating the consumer using map config</span>
<span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;key.deserializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;value.deserializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;group.id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;my_group&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;auto.offset.reset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;earliest&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;enable.auto.commit&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// use consumer for interacting with Apache Kafka</span>
<span class="token keyword">let</span> consumer <span class="token operator">=</span> KafkaConsumer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the above example, a <code>KafkaConsumer</code> instance is created using a map
instance in order to specify the Kafka nodes list to connect (just one)
and the deserializers to use for getting key and value from each
received message.</p> <p>Likewise a producer can be created</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KafkaProducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/kafka-client&quot;</span>

<span class="token comment">// creating the producer using map and class types for key and value serializers/deserializers</span>
<span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// use producer for interacting with Apache Kafka</span>
<span class="token keyword">let</span> producer <span class="token operator">=</span> KafkaProducer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="receiving-messages-from-a-topic-joining-a-consumer-group"><a href="#receiving-messages-from-a-topic-joining-a-consumer-group" class="header-anchor">#</a> Receiving messages from a topic joining a consumer group</h1> <p>In order to start receiving messages from Kafka topics, the consumer can
use the <code>subscribe</code> method for subscribing to a set of topics being part
of a consumer group (specified by the properties on creation).</p> <p>It’s also possible to use the <code>subscribe</code> method for subscribing to more
topics specifying a Java regex.</p> <p>You also need to register a handler for handling incoming messages using
the <code>handler</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// register the handler for incoming messages</span>
consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Processing key=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,value=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,partition=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,offset=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// subscribe to several topics with list</span>
<span class="token keyword">let</span> topics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.HashSet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topics<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;topic1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topics<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;topic2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topics<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;topic3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topics<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or using a Java regex</span>
<span class="token keyword">let</span> pattern <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.regex.Pattern&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;topic\\d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or just subscribe to a single topic</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;a-single-topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The handler can be registered before or after the call to <code>subscribe()</code>;
messages won’t be consumed until both methods have been called. This
allows you to call <code>subscribe()</code>, then <code>seek()</code> and finally <code>handler()</code>
in order to only consume messages starting from a particular offset, for
example.</p> <p>A handler can also be passed during subscription to be aware of the
subscription result and being notified when the operation is completed.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// register the handler for incoming messages</span>
consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Processing key=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,value=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,partition=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,offset=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// subscribe to several topics</span>
<span class="token keyword">let</span> topics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.HashSet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topics<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;topic1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topics<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;topic2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topics<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;topic3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topics<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;subscribed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Could not subscribe &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or just subscribe to a single topic</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;a-single-topic&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;subscribed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Could not subscribe &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Using the consumer group way, the Kafka cluster assigns partitions to
the consumer taking into account other connected consumers in the same
consumer group, so that partitions can be spread across them.</p> <p>The Kafka cluster handles partitions re-balancing when a consumer leaves
the group (so assigned partitions are free to be assigned to other
consumers) or a new consumer joins the group (so it wants partitions to
read from).</p> <p>You can register handlers on a <code>KafkaConsumer</code> to be notified of the
partitions revocations and assignments by the Kafka cluster using
<code>partitionsRevokedHandler</code> and <code>partitionsAssignedHandler</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// register the handler for incoming messages</span>
consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Processing key=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,value=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,partition=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,offset=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// registering handlers for assigned and revoked partitions</span>
consumer<span class="token punctuation">.</span><span class="token function">partitionsAssignedHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">topicPartitions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Partitions assigned&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  topicPartitions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">topicPartition</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">.</span>topic <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> topicPartition<span class="token punctuation">.</span>partition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

consumer<span class="token punctuation">.</span><span class="token function">partitionsRevokedHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">topicPartitions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Partitions revoked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  topicPartitions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">topicPartition</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">.</span>topic <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> topicPartition<span class="token punctuation">.</span>partition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// subscribes to the topic</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer subscribed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>After joining a consumer group for receiving messages, a consumer can
decide to leave the consumer group in order to not get messages anymore
using <code>unsubscribe</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// consumer is already member of a consumer group</span>

<span class="token comment">// unsubscribing request</span>
consumer<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can add an handler to be notified of the result</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// consumer is already member of a consumer group</span>

<span class="token comment">// unsubscribing request</span>
consumer<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer unsubscribed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="receiving-messages-from-a-topic-requesting-specific-partitions"><a href="#receiving-messages-from-a-topic-requesting-specific-partitions" class="header-anchor">#</a> Receiving messages from a topic requesting specific partitions</h1> <p>Besides being part of a consumer group for receiving messages from a
topic, a consumer can ask for a specific topic partition. When the
consumer is not part part of a consumer group the overall application
cannot rely on the re-balancing feature.</p> <p>You can use <code>assign</code> in order to ask for specific partitions.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// register the handler for incoming messages</span>
consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;key=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,value=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,partition=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,offset=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token keyword">let</span> topicPartitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.HashSet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topicPartitions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPartition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// requesting to be assigned the specific partition</span>
consumer<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>topicPartitions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Partition assigned&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// requesting the assigned partitions</span>
    consumer<span class="token punctuation">.</span><span class="token function">assignment</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">done1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>done1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        done1<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">topicPartition</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">.</span>topic <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> topicPartition<span class="token punctuation">.</span>partition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As with <code>subscribe()</code>, the handler can be registered before or after the
call to <code>assign()</code>; messages won’t be consumed until both methods have
been called. This allows you to call <code>assign()</code>, then <code>seek()</code> and
finally <code>handler()</code> in order to only consume messages starting from a
particular offset, for example.</p> <p>Calling <code>assignment</code> provides the list of the current assigned
partitions.</p> <h1 id="receiving-messages-with-explicit-polling"><a href="#receiving-messages-with-explicit-polling" class="header-anchor">#</a> Receiving messages with explicit polling</h1> <p>Other than using the internal polling mechanism in order to receive
messages from Kafka, the client can subscribe to a topic, avoiding to
register the handler for getting the messages and then using the <code>poll</code>
method.</p> <p>In this way, the user application is in charge to execute the poll for
getting messages when it needs, for example after processing the
previous ones.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// subscribes to the topic</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer subscribed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    vertx<span class="token punctuation">.</span><span class="token function">setPeriodic</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">timerId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>ar1<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

          <span class="token keyword">let</span> records <span class="token operator">=</span> ar1<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> records<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> record <span class="token operator">=</span> records<span class="token punctuation">.</span><span class="token function">recordAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;key=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,value=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,partition=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,offset=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>After subscribing successfully, the application start a periodic timer
in order to execute the poll and getting messages from Kafka
periodically.</p> <h1 id="changing-the-subscription-or-assignment"><a href="#changing-the-subscription-or-assignment" class="header-anchor">#</a> Changing the subscription or assignment</h1> <p>You can change the subscribed topics, or assigned partitions after you
have started to consume messages, simply by calling <code>subscribe()</code> or
<code>assign()</code> again.</p> <p>Note that due to internal buffering of messages it is possible that the
record handler will continue to observe messages from the old
subscription or assignment <em>after</em> the <code>subscribe()</code> or <code>assign()</code>
method’s completion handler has been called. This is not the case for
messages observed by the batch handler: Once the completion handler has
been called it will only observe messages read from the subscription or
assignment.</p> <h1 id="getting-topic-partition-information"><a href="#getting-topic-partition-information" class="header-anchor">#</a> Getting topic partition information</h1> <p>You can call the <code>partitionsFor</code> to get information about partitions for
a specified topic</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// asking partitions information about specific topic</span>
consumer<span class="token punctuation">.</span><span class="token function">partitionsFor</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">partitionInfo</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>partitionInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In addition <code>listTopics</code> provides all available topics with related
partitions</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// asking information about available topics and related partitions</span>
consumer<span class="token punctuation">.</span><span class="token function">listTopics</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> map <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">partitions<span class="token punctuation">,</span> topic</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;topic = &quot;</span> <span class="token operator">+</span> topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;partitions = &quot;</span> <span class="token operator">+</span> map<span class="token punctuation">[</span>topic<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="manual-offset-commit"><a href="#manual-offset-commit" class="header-anchor">#</a> Manual offset commit</h1> <p>In Apache Kafka the consumer is in charge to handle the offset of the
last read message.</p> <p>This is executed by the commit operation executed automatically every
time a bunch of messages are read from a topic partition. The
configuration parameter <code>enable.auto.commit</code> must be set to <code>true</code> when
the consumer is created.</p> <p>Manual offset commit, can be achieved with <code>commit</code>. It can be used to
achieve <em>at least once</em> delivery to be sure that the read messages are
processed before committing the offset.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// consumer is processing read messages</span>

<span class="token comment">// committing offset of the last read message</span>
consumer<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Last read message offset committed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="seeking-in-a-topic-partition"><a href="#seeking-in-a-topic-partition" class="header-anchor">#</a> Seeking in a topic partition</h1> <p>Apache Kafka can retain messages for a long period of time and the
consumer can seek inside a topic partition and obtain arbitrary access
to the messages.</p> <p>You can use <code>seek</code> to change the offset for reading at a specific
position</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> topicPartition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPartition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// seek to a specific offset</span>
consumer<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Seeking done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When the consumer needs to re-read the stream from the beginning, it can
use <code>seekToBeginning</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> topicPartition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPartition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// seek to the beginning of the partition</span>
consumer<span class="token punctuation">.</span><span class="token function">seekToBeginning</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.Collections&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Seeking done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Finally <code>seekToEnd</code> can be used to come back at the end of the partition</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> topicPartition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPartition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// seek to the end of the partition</span>
consumer<span class="token punctuation">.</span><span class="token function">seekToEnd</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.Collections&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Seeking done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Note that due to internal buffering of messages it is possible that the
record handler will continue to observe messages read from the original
offset for a time <em>after</em> the <code>seek*()</code> method’s completion handler has
been called. This is not the case for messages observed by the batch
handler: Once the <code>seek*()</code> completion handler has been called it will
only observe messages read from the new offset.</p> <h1 id="offset-lookup"><a href="#offset-lookup" class="header-anchor">#</a> Offset lookup</h1> <p>You can use the beginningOffsets API introduced in Kafka 0.10.1.1 to get
the first offset for a given partition. In contrast to
<code>seekToBeginning</code>, it does not change the consumer’s offset.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> topicPartitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.HashSet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> topicPartition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPartition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topicPartitions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>

consumer<span class="token punctuation">.</span><span class="token function">beginningOffsets</span><span class="token punctuation">(</span>topicPartitions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> done<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">beginningOffset<span class="token punctuation">,</span> topic</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Beginning offset for topic=&quot;</span> <span class="token operator">+</span> topic<span class="token punctuation">.</span>topic <span class="token operator">+</span> <span class="token string">&quot;, partition=&quot;</span> <span class="token operator">+</span> topic<span class="token punctuation">.</span>partition <span class="token operator">+</span> <span class="token string">&quot;, beginningOffset=&quot;</span> <span class="token operator">+</span> beginningOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Convenience method for single-partition lookup</span>
consumer<span class="token punctuation">.</span><span class="token function">beginningOffsets</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> beginningOffset <span class="token operator">=</span> done<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Beginning offset for topic=&quot;</span> <span class="token operator">+</span> topicPartition<span class="token punctuation">.</span>topic <span class="token operator">+</span> <span class="token string">&quot;, partition=&quot;</span> <span class="token operator">+</span> topicPartition<span class="token punctuation">.</span>partition <span class="token operator">+</span> <span class="token string">&quot;, beginningOffset=&quot;</span> <span class="token operator">+</span> beginningOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can use the endOffsets API introduced in Kafka 0.10.1.1 to get the
last offset for a given partition. In contrast to <code>seekToEnd</code>, it does
not change the consumer’s offset.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> topicPartitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.util.HashSet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> topicPartition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPartition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
topicPartitions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>

consumer<span class="token punctuation">.</span><span class="token function">endOffsets</span><span class="token punctuation">(</span>topicPartitions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> done<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">endOffset<span class="token punctuation">,</span> topic</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;End offset for topic=&quot;</span> <span class="token operator">+</span> topic<span class="token punctuation">.</span>topic <span class="token operator">+</span> <span class="token string">&quot;, partition=&quot;</span> <span class="token operator">+</span> topic<span class="token punctuation">.</span>partition <span class="token operator">+</span> <span class="token string">&quot;, endOffset=&quot;</span> <span class="token operator">+</span> endOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Convenience method for single-partition lookup</span>
consumer<span class="token punctuation">.</span><span class="token function">endOffsets</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> endOffset <span class="token operator">=</span> done<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;End offset for topic=&quot;</span> <span class="token operator">+</span> topicPartition<span class="token punctuation">.</span>topic <span class="token operator">+</span> <span class="token string">&quot;, partition=&quot;</span> <span class="token operator">+</span> topicPartition<span class="token punctuation">.</span>partition <span class="token operator">+</span> <span class="token string">&quot;, endOffset=&quot;</span> <span class="token operator">+</span> endOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can use the offsetsForTimes API introduced in Kafka 0.10.1.1 to look
up an offset by timestamp, i.e. search parameter is an epoch timestamp
and the call returns the lowest offset with ingestion timestamp &gt;=
given timestamp.</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div><h1 id="message-flow-control"><a href="#message-flow-control" class="header-anchor">#</a> Message flow control</h1> <p>A consumer can control the incoming message flow and pause/resume the
read operation from a topic, e.g it can pause the message flow when it
needs more time to process the actual messages and then resume to
continue message processing.</p> <p>To achieve that you can use <code>pause</code> and <code>resume</code>.</p> <p>In the case of the partition-specific pause and resume it is possible
that the record handler will continue to observe messages from a paused
partition for a time <em>after</em> the <code>pause()</code> method’s completion handler
has been called. This is not the case for messages observed by the batch
handler: Once the <code>pause()</code> completion handler has been called it will
only observe messages from those partitions which are not paused.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> topicPartition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TopicPartition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPartition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// registering the handler for incoming messages</span>
consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;key=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,value=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,partition=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,offset=&quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// i.e. pause/resume on partition 0, after reading message up to offset 5</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// pause the read operations</span>
    consumer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Paused&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// resume read operation after a specific time</span>
        vertx<span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">timeId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

          <span class="token comment">// resume read operations</span>
          consumer<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="closing-a-consumer"><a href="#closing-a-consumer" class="header-anchor">#</a> Closing a consumer</h1> <p>Call close to close the consumer. Closing the consumer closes any open
connections and releases all consumer resources.</p> <p>The close is actually asynchronous and might not complete until some
time after the call has returned. If you want to be notified when the
actual close has completed then you can pass in a handler.</p> <p>This handler will then be called when the close has fully completed.</p> <div class="language-js extra-class"><pre class="language-js"><code>consumer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer is now closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;close failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="sending-messages-to-a-topic"><a href="#sending-messages-to-a-topic" class="header-anchor">#</a> Sending messages to a topic</h1> <p>You can use <code>write</code> to send messages (records) to a topic.</p> <p>The simplest way to send a message is to specify only the destination
topic and the related value, omitting its key or partition, in this case
the messages are sent in a round robin fashion across all the partitions
of the topic.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KafkaProducerRecord <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/kafka-client&quot;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// only topic and message value are specified, round robin on destination partitions</span>
  <span class="token keyword">let</span> record <span class="token operator">=</span> KafkaProducerRecord<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;message_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>

  producer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can receive message sent metadata like its topic, its destination
partition and its assigned offset.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KafkaProducerRecord <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/kafka-client&quot;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// only topic and message value are specified, round robin on destination partitions</span>
  <span class="token keyword">let</span> record <span class="token operator">=</span> KafkaProducerRecord<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;message_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>

  producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token keyword">let</span> recordMetadata <span class="token operator">=</span> done<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Message &quot;</span> <span class="token operator">+</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; written on topic=&quot;</span> <span class="token operator">+</span> recordMetadata<span class="token punctuation">.</span>topic <span class="token operator">+</span> <span class="token string">&quot;, partition=&quot;</span> <span class="token operator">+</span> recordMetadata<span class="token punctuation">.</span>partition <span class="token operator">+</span> <span class="token string">&quot;, offset=&quot;</span> <span class="token operator">+</span> recordMetadata<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When you need to assign a partition to a message, you can specify its
partition identifier or its key</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KafkaProducerRecord <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/kafka-client&quot;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// a destination partition is specified</span>
  <span class="token keyword">let</span> record <span class="token operator">=</span> KafkaProducerRecord<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;message_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  producer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Since the producers identifies the destination using key hashing, you
can use that to guarantee that all messages with the same key are sent
to the same partition and retain the order.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KafkaProducerRecord <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/kafka-client&quot;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// i.e. defining different keys for odd and even messages</span>
  <span class="token keyword">let</span> key <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token comment">// a key is specified, all messages with same key will be sent to the same partition</span>
  <span class="token keyword">let</span> record <span class="token operator">=</span> KafkaProducerRecord<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;message_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>

  producer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>the shared producer is created on the first <code>createShared</code> call and
its configuration is defined at this moment, shared producer usage
must use the same configuration.</p></blockquote> <h1 id="sharing-a-producer"><a href="#sharing-a-producer" class="header-anchor">#</a> Sharing a producer</h1> <p>Sometimes you want to share the same producer from within several
verticles or contexts.</p> <p>Calling <code>KafkaProducer.createShared</code> returns a producer that can be
shared safely.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KafkaProducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/kafka-client&quot;</span>

<span class="token comment">// Create a shared producer identified by 'the-producer'</span>
<span class="token keyword">let</span> producer1 <span class="token operator">=</span> KafkaProducer<span class="token punctuation">.</span><span class="token function">createShared</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token string">&quot;the-producer&quot;</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sometimes later you can close it</span>
producer1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The same resources (thread, connection) will be shared between the
producer returned by this method.</p> <p>When you are done with the producer, just close it, when all shared
producers are closed, the resources will be released for you.</p> <h1 id="closing-a-producer"><a href="#closing-a-producer" class="header-anchor">#</a> Closing a producer</h1> <p>Call close to close the producer. Closing the producer closes any open
connections and releases all producer resources.</p> <p>The close is actually asynchronous and might not complete until some
time after the call has returned. If you want to be notified when the
actual close has completed then you can pass in a handler.</p> <p>This handler will then be called when the close has fully completed.</p> <div class="language-js extra-class"><pre class="language-js"><code>producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Producer is now closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;close failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="getting-topic-partition-information-2"><a href="#getting-topic-partition-information-2" class="header-anchor">#</a> Getting topic partition information</h1> <p>You can call the <code>partitionsFor</code> to get information about partitions for
a specified topic:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// asking partitions information about specific topic</span>
producer<span class="token punctuation">.</span><span class="token function">partitionsFor</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">partitionInfo</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>partitionInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="handling-errors"><a href="#handling-errors" class="header-anchor">#</a> Handling errors</h1> <p>Errors handling (e.g timeout) between a Kafka client (consumer or
producer) and the Kafka cluster is done using <code>exceptionHandler</code> or
<code>exceptionHandler</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// setting handler for errors</span>
consumer<span class="token punctuation">.</span><span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error = &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="automatic-clean-up-in-verticles"><a href="#automatic-clean-up-in-verticles" class="header-anchor">#</a> Automatic clean-up in verticles</h1> <p>If you’re creating consumers and producer from inside verticles, those
consumers and producers will be automatically closed when the verticle
is undeployed.</p> <h1 id="using-vert-x-serializers-deserializers"><a href="#using-vert-x-serializers-deserializers" class="header-anchor">#</a> Using Vert.x serializers/deserializers</h1> <p>Vert.x Kafka client comes out of the box with serializers and
deserializers for buffers, json object and json array.</p> <p>In a consumer you can use buffers</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Creating a consumer able to deserialize to buffers</span>
<span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;key.deserializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.BufferDeserializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;value.deserializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.BufferDeserializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;group.id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;my_group&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;auto.offset.reset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;earliest&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;enable.auto.commit&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Creating a consumer able to deserialize to json object</span>
config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;key.deserializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.JsonObjectDeserializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;value.deserializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.JsonObjectDeserializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;group.id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;my_group&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;auto.offset.reset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;earliest&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;enable.auto.commit&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Creating a consumer able to deserialize to json array</span>
config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;key.deserializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.JsonArrayDeserializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;value.deserializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.JsonArrayDeserializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;group.id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;my_group&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;auto.offset.reset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;earliest&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;enable.auto.commit&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>Or in a producer</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Creating a producer able to serialize to buffers</span>
<span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.BufferSerializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.BufferSerializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Creating a producer able to serialize to json object</span>
config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.JsonObjectSerializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.JsonObjectSerializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Creating a producer able to serialize to json array</span>
config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;key.serializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.JsonArraySerializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;value.serializer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;io.vertx.kafka.client.serialization.JsonArraySerializer&quot;</span><span class="token punctuation">;</span>
config<span class="token punctuation">[</span><span class="token string">&quot;acks&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>Unresolved directive in index.adoc - include::admin.adoc[]</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/kafka-client/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/30/2020, 11:09:36 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.cfb14a02.js" defer></script><script src="/es4x/assets/js/2.96613d0f.js" defer></script><script src="/es4x/assets/js/89.aac46f66.js" defer></script>
  </body>
</html>
