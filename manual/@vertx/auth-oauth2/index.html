<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The OAuth2 auth provider | ES for Eclipse Vert.x</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
    <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
    <script src="/es4x/player/asciinema-player.js"></script>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <link rel="preload" href="/es4x/assets/css/0.styles.57be2129.css" as="style"><link rel="preload" href="/es4x/assets/js/app.837a6700.js" as="script"><link rel="preload" href="/es4x/assets/js/2.96613d0f.js" as="script"><link rel="preload" href="/es4x/assets/js/41.1f30e160.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.25f493b2.js"><link rel="prefetch" href="/es4x/assets/js/100.cfb483ce.js"><link rel="prefetch" href="/es4x/assets/js/101.41f0f345.js"><link rel="prefetch" href="/es4x/assets/js/102.11159607.js"><link rel="prefetch" href="/es4x/assets/js/103.26a38f31.js"><link rel="prefetch" href="/es4x/assets/js/104.5d636807.js"><link rel="prefetch" href="/es4x/assets/js/105.ef333a30.js"><link rel="prefetch" href="/es4x/assets/js/106.9a8e6256.js"><link rel="prefetch" href="/es4x/assets/js/107.29eb69ad.js"><link rel="prefetch" href="/es4x/assets/js/108.98fcfd9a.js"><link rel="prefetch" href="/es4x/assets/js/109.d6080ff5.js"><link rel="prefetch" href="/es4x/assets/js/11.6250afa8.js"><link rel="prefetch" href="/es4x/assets/js/110.3dd0cba3.js"><link rel="prefetch" href="/es4x/assets/js/111.4090be57.js"><link rel="prefetch" href="/es4x/assets/js/112.9c319411.js"><link rel="prefetch" href="/es4x/assets/js/113.84433759.js"><link rel="prefetch" href="/es4x/assets/js/114.68cb87cc.js"><link rel="prefetch" href="/es4x/assets/js/115.65241419.js"><link rel="prefetch" href="/es4x/assets/js/116.72987dea.js"><link rel="prefetch" href="/es4x/assets/js/117.03106a2c.js"><link rel="prefetch" href="/es4x/assets/js/118.0ad98106.js"><link rel="prefetch" href="/es4x/assets/js/119.cb303101.js"><link rel="prefetch" href="/es4x/assets/js/12.31be7a28.js"><link rel="prefetch" href="/es4x/assets/js/120.e2ffbd45.js"><link rel="prefetch" href="/es4x/assets/js/121.197dd995.js"><link rel="prefetch" href="/es4x/assets/js/122.8b966b22.js"><link rel="prefetch" href="/es4x/assets/js/123.4586e425.js"><link rel="prefetch" href="/es4x/assets/js/124.8377618c.js"><link rel="prefetch" href="/es4x/assets/js/125.da368490.js"><link rel="prefetch" href="/es4x/assets/js/126.e0bbd98d.js"><link rel="prefetch" href="/es4x/assets/js/127.fc93d280.js"><link rel="prefetch" href="/es4x/assets/js/128.98e5a4cc.js"><link rel="prefetch" href="/es4x/assets/js/129.c7621804.js"><link rel="prefetch" href="/es4x/assets/js/13.3ba77560.js"><link rel="prefetch" href="/es4x/assets/js/130.5cd4d89d.js"><link rel="prefetch" href="/es4x/assets/js/131.ae0d85c1.js"><link rel="prefetch" href="/es4x/assets/js/132.e08c4610.js"><link rel="prefetch" href="/es4x/assets/js/133.c0606af1.js"><link rel="prefetch" href="/es4x/assets/js/134.6426c832.js"><link rel="prefetch" href="/es4x/assets/js/135.cfc1f0ec.js"><link rel="prefetch" href="/es4x/assets/js/136.a8b15a1b.js"><link rel="prefetch" href="/es4x/assets/js/137.35e8cd32.js"><link rel="prefetch" href="/es4x/assets/js/138.312a152f.js"><link rel="prefetch" href="/es4x/assets/js/139.e437bff1.js"><link rel="prefetch" href="/es4x/assets/js/14.72f2b0c1.js"><link rel="prefetch" href="/es4x/assets/js/140.8d09b641.js"><link rel="prefetch" href="/es4x/assets/js/141.52848e3f.js"><link rel="prefetch" href="/es4x/assets/js/142.39cf7674.js"><link rel="prefetch" href="/es4x/assets/js/143.7d902150.js"><link rel="prefetch" href="/es4x/assets/js/144.3e74a206.js"><link rel="prefetch" href="/es4x/assets/js/145.6a2886f8.js"><link rel="prefetch" href="/es4x/assets/js/146.244849e4.js"><link rel="prefetch" href="/es4x/assets/js/147.7f0c9791.js"><link rel="prefetch" href="/es4x/assets/js/148.ab94dede.js"><link rel="prefetch" href="/es4x/assets/js/149.a49458da.js"><link rel="prefetch" href="/es4x/assets/js/15.bd087613.js"><link rel="prefetch" href="/es4x/assets/js/150.eabb62e5.js"><link rel="prefetch" href="/es4x/assets/js/151.a6f046ed.js"><link rel="prefetch" href="/es4x/assets/js/152.78e21db3.js"><link rel="prefetch" href="/es4x/assets/js/153.eef01fd9.js"><link rel="prefetch" href="/es4x/assets/js/154.68000f3a.js"><link rel="prefetch" href="/es4x/assets/js/155.51583889.js"><link rel="prefetch" href="/es4x/assets/js/156.b598ecad.js"><link rel="prefetch" href="/es4x/assets/js/157.37bfe59b.js"><link rel="prefetch" href="/es4x/assets/js/158.14f16fe6.js"><link rel="prefetch" href="/es4x/assets/js/159.5019694d.js"><link rel="prefetch" href="/es4x/assets/js/16.a392a655.js"><link rel="prefetch" href="/es4x/assets/js/160.dfe7924a.js"><link rel="prefetch" href="/es4x/assets/js/161.acc5cf27.js"><link rel="prefetch" href="/es4x/assets/js/162.5c855be0.js"><link rel="prefetch" href="/es4x/assets/js/163.841834be.js"><link rel="prefetch" href="/es4x/assets/js/164.368aca3b.js"><link rel="prefetch" href="/es4x/assets/js/165.0c08e67b.js"><link rel="prefetch" href="/es4x/assets/js/166.361b2ec9.js"><link rel="prefetch" href="/es4x/assets/js/167.a45d61db.js"><link rel="prefetch" href="/es4x/assets/js/168.2f440f57.js"><link rel="prefetch" href="/es4x/assets/js/169.40f71d05.js"><link rel="prefetch" href="/es4x/assets/js/17.f58ddc3f.js"><link rel="prefetch" href="/es4x/assets/js/170.bfd53069.js"><link rel="prefetch" href="/es4x/assets/js/171.73de0958.js"><link rel="prefetch" href="/es4x/assets/js/172.c0640f4c.js"><link rel="prefetch" href="/es4x/assets/js/18.e2866c20.js"><link rel="prefetch" href="/es4x/assets/js/19.5895c9c4.js"><link rel="prefetch" href="/es4x/assets/js/20.bbfce85e.js"><link rel="prefetch" href="/es4x/assets/js/21.bfb22c95.js"><link rel="prefetch" href="/es4x/assets/js/22.bfe5d665.js"><link rel="prefetch" href="/es4x/assets/js/23.7db73d21.js"><link rel="prefetch" href="/es4x/assets/js/24.1e68764d.js"><link rel="prefetch" href="/es4x/assets/js/25.80677ca8.js"><link rel="prefetch" href="/es4x/assets/js/26.05452c59.js"><link rel="prefetch" href="/es4x/assets/js/27.9cb32590.js"><link rel="prefetch" href="/es4x/assets/js/28.08149c08.js"><link rel="prefetch" href="/es4x/assets/js/29.147441c7.js"><link rel="prefetch" href="/es4x/assets/js/3.4d2250de.js"><link rel="prefetch" href="/es4x/assets/js/30.5f95f2c8.js"><link rel="prefetch" href="/es4x/assets/js/31.7000a792.js"><link rel="prefetch" href="/es4x/assets/js/32.a454f02e.js"><link rel="prefetch" href="/es4x/assets/js/33.9072e3dc.js"><link rel="prefetch" href="/es4x/assets/js/34.2cd817f7.js"><link rel="prefetch" href="/es4x/assets/js/35.1499c4b4.js"><link rel="prefetch" href="/es4x/assets/js/36.53b6ddf9.js"><link rel="prefetch" href="/es4x/assets/js/37.1b440312.js"><link rel="prefetch" href="/es4x/assets/js/38.1caa3e15.js"><link rel="prefetch" href="/es4x/assets/js/39.ab25bad3.js"><link rel="prefetch" href="/es4x/assets/js/4.2410671b.js"><link rel="prefetch" href="/es4x/assets/js/40.13850330.js"><link rel="prefetch" href="/es4x/assets/js/42.f65b46db.js"><link rel="prefetch" href="/es4x/assets/js/43.86bd3898.js"><link rel="prefetch" href="/es4x/assets/js/44.25aede52.js"><link rel="prefetch" href="/es4x/assets/js/45.cee33b90.js"><link rel="prefetch" href="/es4x/assets/js/46.08c82be4.js"><link rel="prefetch" href="/es4x/assets/js/47.9263c242.js"><link rel="prefetch" href="/es4x/assets/js/48.4ef5e818.js"><link rel="prefetch" href="/es4x/assets/js/49.51ca886c.js"><link rel="prefetch" href="/es4x/assets/js/5.0b93e503.js"><link rel="prefetch" href="/es4x/assets/js/50.54a8010f.js"><link rel="prefetch" href="/es4x/assets/js/51.26142f55.js"><link rel="prefetch" href="/es4x/assets/js/52.b132a309.js"><link rel="prefetch" href="/es4x/assets/js/53.edc43f5a.js"><link rel="prefetch" href="/es4x/assets/js/54.6794cce1.js"><link rel="prefetch" href="/es4x/assets/js/55.dfdebce6.js"><link rel="prefetch" href="/es4x/assets/js/56.2b9f4603.js"><link rel="prefetch" href="/es4x/assets/js/57.c707ed5a.js"><link rel="prefetch" href="/es4x/assets/js/58.925a6f1c.js"><link rel="prefetch" href="/es4x/assets/js/59.de86b06d.js"><link rel="prefetch" href="/es4x/assets/js/6.bee7d20c.js"><link rel="prefetch" href="/es4x/assets/js/60.e74847c7.js"><link rel="prefetch" href="/es4x/assets/js/61.f45f1d70.js"><link rel="prefetch" href="/es4x/assets/js/62.c7245534.js"><link rel="prefetch" href="/es4x/assets/js/63.91dfc6d8.js"><link rel="prefetch" href="/es4x/assets/js/64.a9a5d5d7.js"><link rel="prefetch" href="/es4x/assets/js/65.82e7c7b1.js"><link rel="prefetch" href="/es4x/assets/js/66.9b26aed8.js"><link rel="prefetch" href="/es4x/assets/js/67.b882907b.js"><link rel="prefetch" href="/es4x/assets/js/68.6a6dc2a2.js"><link rel="prefetch" href="/es4x/assets/js/69.8e1e834e.js"><link rel="prefetch" href="/es4x/assets/js/7.408ffc95.js"><link rel="prefetch" href="/es4x/assets/js/70.f213078f.js"><link rel="prefetch" href="/es4x/assets/js/71.228413c9.js"><link rel="prefetch" href="/es4x/assets/js/72.d6ff0902.js"><link rel="prefetch" href="/es4x/assets/js/73.dbc371ba.js"><link rel="prefetch" href="/es4x/assets/js/74.13ff27d1.js"><link rel="prefetch" href="/es4x/assets/js/75.db024b7e.js"><link rel="prefetch" href="/es4x/assets/js/76.ef6180eb.js"><link rel="prefetch" href="/es4x/assets/js/77.7c3517c1.js"><link rel="prefetch" href="/es4x/assets/js/78.10e54671.js"><link rel="prefetch" href="/es4x/assets/js/79.b254f9ec.js"><link rel="prefetch" href="/es4x/assets/js/8.3d81d937.js"><link rel="prefetch" href="/es4x/assets/js/80.80c9d719.js"><link rel="prefetch" href="/es4x/assets/js/81.7be9486c.js"><link rel="prefetch" href="/es4x/assets/js/82.554dda8f.js"><link rel="prefetch" href="/es4x/assets/js/83.9d052d44.js"><link rel="prefetch" href="/es4x/assets/js/84.60798b2c.js"><link rel="prefetch" href="/es4x/assets/js/85.e4ce5e87.js"><link rel="prefetch" href="/es4x/assets/js/86.179d24c1.js"><link rel="prefetch" href="/es4x/assets/js/87.6d60cd83.js"><link rel="prefetch" href="/es4x/assets/js/88.6bfd1577.js"><link rel="prefetch" href="/es4x/assets/js/89.ddac2119.js"><link rel="prefetch" href="/es4x/assets/js/9.a0345499.js"><link rel="prefetch" href="/es4x/assets/js/90.4a4fd3dc.js"><link rel="prefetch" href="/es4x/assets/js/91.065cc9a5.js"><link rel="prefetch" href="/es4x/assets/js/92.80435a8d.js"><link rel="prefetch" href="/es4x/assets/js/93.b7af2039.js"><link rel="prefetch" href="/es4x/assets/js/94.b096f725.js"><link rel="prefetch" href="/es4x/assets/js/95.af24f6b1.js"><link rel="prefetch" href="/es4x/assets/js/96.38f15cba.js"><link rel="prefetch" href="/es4x/assets/js/97.c53fc06f.js"><link rel="prefetch" href="/es4x/assets/js/98.3426a32c.js"><link rel="prefetch" href="/es4x/assets/js/99.a568bb05.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.57be2129.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/auth-oauth2/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/auth-oauth2/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" aria-current="page" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="the-oauth2-auth-provider"><a href="#the-oauth2-auth-provider" class="header-anchor">#</a> The OAuth2 auth provider</h1> <p>This component contains an out of the box OAuth2 (and to some extent
OpenID Connect) relying party implementation. To use this project, add
the following dependency to the <em>dependencies</em> section of your build
descriptor:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.vertx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>vertx-auth-oauth2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>compile <span class="token string">'io.vertx:vertx-auth-oauth2:${maven.version}'</span>
</code></pre></div><p>OAuth2 lets users grant the access to the desired resources to third
party applications, giving them the possibility to enable and disable
those accesses whenever they want.</p> <p>Vert.x OAuth2 supports the following flows.</p> <ul><li><p>Authorization Code Flow (for apps with servers that can store
persistent information).</p></li> <li><p>Password Credentials Flow (when previous flow can’t be used or
during development).</p></li> <li><p>Client Credentials Flow (the client can request an access token
using only its client credentials)</p></li></ul> <p>The same code will work with OpenID Connect
<a href="https://openid.net/connect/" target="_blank" rel="noopener noreferrer">https://openid.net/connect/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> servers and supports the Discovery
protocol as specified in
<a href="http://openid.net/specs/openid-connect-discovery-1_0.html" target="_blank" rel="noopener noreferrer">http://openid.net/specs/openid-connect-discovery-1_0.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> .</p> <h2 id="authorization-code-flow"><a href="#authorization-code-flow" class="header-anchor">#</a> Authorization Code Flow</h2> <p>The authorization code grant type is used to obtain both access tokens
and refresh tokens and is optimized for confidential clients. As a
redirection-based flow, the client must be capable of interacting with
the resource owner’s user-agent (typically a web browser) and capable of
receiving incoming requests (via redirection) from the authorization
server.</p> <p>For more details see <a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.1" target="_blank" rel="noopener noreferrer">Oauth2 specification,
section 4.1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="password-credentials-flow"><a href="#password-credentials-flow" class="header-anchor">#</a> Password Credentials Flow</h2> <p>The resource owner password credentials grant type is suitable in cases
where the resource owner has a trust relationship with the client, such
as the device operating system or a highly privileged application. The
authorization server should take special care when enabling this grant
type, and only allow it when other flows are not viable.</p> <p>The grant type is suitable for clients capable of obtaining the resource
owner’s credentials (username and password, typically using an
interactive form). It is also used to migrate existing clients using
direct authentication schemes such as HTTP Basic or Digest
authentication to OAuth by converting the stored credentials to an
access token.</p> <p>For more details see <a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.3" target="_blank" rel="noopener noreferrer">Oauth2 specification,
section 4.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="client-credentials-flow"><a href="#client-credentials-flow" class="header-anchor">#</a> Client Credentials Flow</h2> <p>The client can request an access token using only its client credentials
(or other supported means of authentication) when the client is
requesting access to the protected resources under its control, or those
of another resource owner that have been previously arranged with the
authorization server (the method of which is beyond the scope of this
specification).</p> <p>The client credentials grant type MUST only be used by confidential
clients.</p> <p>For more details see <a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.4" target="_blank" rel="noopener noreferrer">Oauth2 specification,
section 4.4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="extensions"><a href="#extensions" class="header-anchor">#</a> Extensions</h2> <p>The provider supports RFC7523 an extension to allow server to server
authorization based on JWT.</p> <h2 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting Started</h2> <p>An example on how to use this provider and authenticate with GitHub can
be implemented as:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2Auth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>

<span class="token keyword">let</span> oauth2 <span class="token operator">=</span> OAuth2Auth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> OAuth2FlowType<span class="token punctuation">.</span><span class="token constant">AUTH_CODE</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2ClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientID</span><span class="token punctuation">(</span><span class="token string">&quot;YOUR_CLIENT_ID&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientSecret</span><span class="token punctuation">(</span><span class="token string">&quot;YOUR_CLIENT_SECRET&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSite</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTokenPath</span><span class="token punctuation">(</span><span class="token string">&quot;/oauth/access_token&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAuthorizationPath</span><span class="token punctuation">(</span><span class="token string">&quot;/oauth/authorize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// when there is a need to access a protected resource or call a protected method,</span>
<span class="token comment">// call the authZ url for a challenge</span>

<span class="token keyword">let</span> authorization_uri <span class="token operator">=</span> oauth2<span class="token punctuation">.</span><span class="token function">authorizeURL</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;redirect_uri&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/callback&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scope&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;notifications&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;state&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;3(#0/!~&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// when working with web application use the above string as a redirect url</span>

<span class="token comment">// in this case GitHub will call you back in the callback uri one should now complete the handshake as:</span>


<span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token string">&quot;xxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="token punctuation">;</span>

oauth2<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;code&quot;</span> <span class="token operator">:</span> code<span class="token punctuation">,</span>
  <span class="token string">&quot;redirect_uri&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/callback&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error, the code provided is not valid</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// save the token and continue...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="authorization-code-flow-2"><a href="#authorization-code-flow-2" class="header-anchor">#</a> Authorization Code flow</h3> <p>The Authorization Code flow is made up from two parts. At first your
application asks to the user the permission to access their data. If the
user approves the OAuth2 server sends to the client an authorization
code. In the second part, the client POST the authorization code along
with its client secret to the authority server in order to get the
access token.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2Auth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>

<span class="token comment">// Set the client credentials and the OAuth2 server</span>
<span class="token keyword">let</span> credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2ClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientID</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;client-id&gt;&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientSecret</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;client-secret&gt;&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSite</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.oauth.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// Initialize the OAuth2 Library</span>
<span class="token keyword">let</span> oauth2 <span class="token operator">=</span> OAuth2Auth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> OAuth2FlowType<span class="token punctuation">.</span><span class="token constant">AUTH_CODE</span><span class="token punctuation">,</span> credentials<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Authorization oauth2 URI</span>
<span class="token keyword">let</span> authorization_uri <span class="token operator">=</span> oauth2<span class="token punctuation">.</span><span class="token function">authorizeURL</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;redirect_uri&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/callback&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scope&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&lt;scope&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;state&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&lt;state&gt;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Redirect example using Vert.x</span>
response<span class="token punctuation">.</span><span class="token function">putHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">,</span> authorization_uri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> tokenConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;code&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&lt;code&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;redirect_uri&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://localhost:3000/callback&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Callbacks</span>
<span class="token comment">// Save the access token</span>
oauth2<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>tokenConfig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Access Token Error: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the access token object (the authorization code is given from the previous step).</span>
    <span class="token keyword">let</span> token <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="password-credentials-flow-2"><a href="#password-credentials-flow-2" class="header-anchor">#</a> Password Credentials Flow</h3> <p>This flow is suitable when the resource owner has a trust relationship
with the client, such as its computer operating system or a highly
privileged application. Use this flow only when other flows are not
viable or when you need a fast way to test your application.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2Auth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AccessToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>

<span class="token comment">// Initialize the OAuth2 Library</span>
<span class="token keyword">let</span> oauth2 <span class="token operator">=</span> OAuth2Auth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> OAuth2FlowType<span class="token punctuation">.</span><span class="token constant">PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> tokenConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;password&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Callbacks</span>
<span class="token comment">// Save the access token</span>
oauth2<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>tokenConfig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Access Token Error: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the access token object (the authorization code is given from the previous step).</span>
    <span class="token keyword">let</span> token <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    token<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// the user object should be returned here...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="client-credentials-flow-2"><a href="#client-credentials-flow-2" class="header-anchor">#</a> Client Credentials Flow</h3> <p>This flow is suitable when client is requesting access to the protected
resources under its control.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2Auth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>

<span class="token comment">// Set the client credentials and the OAuth2 server</span>
<span class="token keyword">let</span> credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2ClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientID</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;client-id&gt;&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientSecret</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;client-secret&gt;&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSite</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.oauth.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// Initialize the OAuth2 Library</span>
<span class="token keyword">let</span> oauth2 <span class="token operator">=</span> OAuth2Auth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> OAuth2FlowType<span class="token punctuation">.</span><span class="token constant">CLIENT</span><span class="token punctuation">,</span> credentials<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> tokenConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Callbacks</span>
<span class="token comment">// Save the access token</span>
oauth2<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>tokenConfig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Access Token Error: &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the access token object (the authorization code is given from the previous step).</span>
    <span class="token keyword">let</span> token <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="openid-connect-discovery"><a href="#openid-connect-discovery" class="header-anchor">#</a> OpenID Connect Discovery</h2> <p>There is limited support for OpenID Discovery servers. Using OIDC
Discovery will simplify the configuration of your auth module into a
single line of code, for example, consider setting up your auth using
Google:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> OpenIDConnectAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>

OpenIDConnectAuth<span class="token punctuation">.</span><span class="token function">discover</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2ClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSite</span><span class="token punctuation">(</span><span class="token string">&quot;https://accounts.google.com&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientID</span><span class="token punctuation">(</span><span class="token string">&quot;clientId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the setup call succeeded.</span>
    <span class="token comment">// at this moment your auth is ready to use and</span>
    <span class="token comment">// google signature keys are loaded so tokens can be decoded and verified.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// the setup failed.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Behind the scenes a couple of actions are performed:</p> <ol><li><p>HTTP get request to the <code>.well-known/openid-configuration</code> resource</p></li> <li><p>Validation of the response <code>issuer</code> field as mandated by the spec
(the issuer value must match the request one)</p></li> <li><p>If the JWK uri is present, keys are loaded from the server and added
to the auth keychain</p></li> <li><p>the auth module is configure and returned to the user.</p></li></ol> <p>A couple of well known OpenID Connect Discovery providers are:</p> <ul><li><p>Keycloak: <code>http://keycloakhost:keycloakport/auth/realms/{realm}</code></p></li> <li><p>Google: <code>https://accounts.google.com</code></p></li> <li><p>SalesForce: <code>https://login.salesforce.com</code></p></li> <li><p>Microsoft: <code>https://login.windows.net/common</code></p></li></ul> <p>This and the given <code>client id</code> is enough to configure your auth provider
object.</p> <h2 id="accesstoken-object"><a href="#accesstoken-object" class="header-anchor">#</a> AccessToken object</h2> <p>When a token expires we need to refresh it. OAuth2 offers the
AccessToken class that add a couple of useful methods to refresh the
access token when it is expired.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Check if the token is expired. If expired it is refreshed.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">expired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Callbacks</span>
  token<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// success</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// error handling...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When you’ve done with the token or you want to log out, you can revoke
the access token and refresh token.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Revoke only the access token</span>
token<span class="token punctuation">.</span><span class="token function">revoke</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Session ended. But the refresh_token is still valid.</span>

  <span class="token comment">// Revoke the refresh_token</span>
  token<span class="token punctuation">.</span><span class="token function">revoke</span><span class="token punctuation">(</span><span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;token revoked.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="example-configuration-for-common-oauth2-providers"><a href="#example-configuration-for-common-oauth2-providers" class="header-anchor">#</a> Example configuration for common OAuth2 providers</h2> <p>For convenience there are several helpers to assist your with your
configuration. Currently we provide:</p> <ul><li><p>Azure Active Directory <code>AzureADAuth</code></p></li> <li><p>Box.com <code>BoxAuth</code></p></li> <li><p>Dropbox <code>DropboxAuth</code></p></li> <li><p>Facebook <code>FacebookAuth</code></p></li> <li><p>Foursquare <code>FoursquareAuth</code></p></li> <li><p>Github <code>GithubAuth</code></p></li> <li><p>Google <code>GoogleAuth</code></p></li> <li><p>Instagram <code>InstagramAuth</code></p></li> <li><p>Keycloak <code>KeycloakAuth</code></p></li> <li><p>LinkedIn <code>LinkedInAuth</code></p></li> <li><p>Mailchimp <code>MailchimpAuth</code></p></li> <li><p>Salesforce <code>SalesforceAuth</code></p></li> <li><p>Shopify <code>ShopifyAuth</code></p></li> <li><p>Soundcloud <code>SoundcloudAuth</code></p></li> <li><p>Stripe <code>StripeAuth</code></p></li> <li><p>Twitter <code>TwitterAuth</code></p></li></ul> <h3 id="jboss-keycloak"><a href="#jboss-keycloak" class="header-anchor">#</a> JBoss Keycloak</h3> <p>When using this Keycloak the provider has knowledge on how to parse
access tokens and extract grants from inside. This information is quite
valuable since it allows to do authorization at the API level, for
example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KeycloakAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AccessToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token comment">// you would get this config from the keycloak admin console</span>
<span class="token keyword">let</span> keycloakJson <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;realm&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;master&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;realm-public-key&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;MIIBIjANBgkqhk...wIDAQAB&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;auth-server-url&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://localhost:9000/auth&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;ssl-required&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;external&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;resource&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;frontend&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;credentials&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;secret&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2fbf5e18-b923-4a83-9657-b4ebd5317f60&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Initialize the OAuth2 Library</span>
<span class="token keyword">let</span> oauth2 <span class="token operator">=</span> KeycloakAuth<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> OAuth2FlowType<span class="token punctuation">.</span><span class="token constant">PASSWORD</span><span class="token punctuation">,</span> keycloakJson<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// first get a token (authenticate)</span>
oauth2<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;secret&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> token <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// now check for permissions</span>
    token<span class="token punctuation">.</span><span class="token function">isAuthorized</span><span class="token punctuation">(</span><span class="token string">&quot;account:manage-account&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// this user is authorized to manage its account</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We also provide a helper class for Keycloak so that we can we can easily
retrieve decoded token and some necessary data (e.g.
<code>preferred_username</code>) from the Keycloak principal. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> KeycloakHelper <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token comment">// you can get the decoded `id_token` from the Keycloak principal</span>
<span class="token keyword">let</span> idToken <span class="token operator">=</span> KeycloakHelper<span class="token punctuation">.</span><span class="token function">idToken</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// you can also retrieve some properties directly from the Keycloak principal</span>
<span class="token comment">// e.g. `preferred_username`</span>
<span class="token keyword">let</span> username <span class="token operator">=</span> KeycloakHelper<span class="token punctuation">.</span><span class="token function">preferredUsername</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Please remember that Keycloak <strong>does</strong> implement OpenID Connect, so you
can configure it just by using it’s discovery url:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> OpenIDConnectAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>

OpenIDConnectAuth<span class="token punctuation">.</span><span class="token function">discover</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2ClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSite</span><span class="token punctuation">(</span><span class="token string">&quot;http://server:port/auth/realms/your_realm&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setClientID</span><span class="token punctuation">(</span><span class="token string">&quot;clientId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the setup call succeeded.</span>
    <span class="token comment">// at this moment your auth is ready to use and</span>
    <span class="token comment">// google signature keys are loaded so tokens can be decoded and verified.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// the setup failed.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Since you can deploy your Keycloak server anywhere, just replace
<code>server:port</code> with the correct value and the <code>your_realm</code> value with
your application realm.</p> <h3 id="google-server-to-server"><a href="#google-server-to-server" class="header-anchor">#</a> Google Server to Server</h3> <p>The provider also supports Server to Server or the RFC7523 extension.
This is a feature present on Google with their service account.</p> <h2 id="token-introspection"><a href="#token-introspection" class="header-anchor">#</a> Token Introspection</h2> <p>Tokens can be introspected in order to assert that they are still valid.
Although there is RFC7662 for this purpose not many providers implement
it. Instead there are variations also known as <code>TokenInfo</code> end points.
The OAuth2 provider will accept both end points as a configuration.
Currently we are known to work with <code>Google</code> and <code>Keycloak</code>.</p> <p>Token introspection assumes that tokens are opaque, so they need to be
validated on the provider server. Every time a token is validated it
requires a round trip to the provider. Introspection can be performed at
the OAuth2 level or at the User level:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// OAuth2Auth level</span>
oauth2<span class="token punctuation">.</span><span class="token function">introspectToken</span><span class="token punctuation">(</span><span class="token string">&quot;opaque string&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// token is valid!</span>
    <span class="token keyword">let</span> accessToken <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// User level</span>
token<span class="token punctuation">.</span><span class="token function">introspect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Token is valid!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="verifying-jwt-tokens"><a href="#verifying-jwt-tokens" class="header-anchor">#</a> Verifying JWT tokens</h2> <p>We’ve just covered how to introspect a token however when dealing with
JWT tokens one can reduce the amount of trips to the provider server
thus enhancing your overall response times. In this case tokens will be
verified using the JWT protocol at your application side only. Verifying
JWT tokens is cheaper and offers better performance, however due to the
stateless nature of JWTs it is not possible to know if a user is logged
out and a token is invalid. For this specific case one needs to use the
token introspection if the provider supports it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// OAuth2Auth level</span>
oauth2<span class="token punctuation">.</span><span class="token function">decodeToken</span><span class="token punctuation">(</span><span class="token string">&quot;jwt-token&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// token is valid!</span>
    <span class="token keyword">let</span> accessToken <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Until now we covered mostly authentication, although the implementation
is relying party (that means that the real authentication happens
somewhere else), there is more you can do with the handler. For example
you can also do authorization if the provider is known to support JSON
web tokens. This is a common feature if your provider is a OpenId
Connect provider or if the provider does support `access_token`s as
JWTs.</p> <p>Such provider is Keycloak that is a OpenId Connect implementation. In
that case you will be able to perform authorization in a very easy way.</p> <h1 id="role-based-access-control"><a href="#role-based-access-control" class="header-anchor">#</a> Role Based Access Control</h1> <p>OAuth2 is an AuthN protocol, however OpenId Connect adds JWTs to the
token format which means that AuthZ can be encoded at the token level.
Currently there are 2 known JWT AuthZ known formats:</p> <ul><li><p>Keycloak</p></li> <li><p>MicroProfile JWT 1.1 spec</p></li></ul> <h2 id="keycloak-jwt"><a href="#keycloak-jwt" class="header-anchor">#</a> Keycloak JWT</h2> <p>Given that Keycloak does provide <code>JWT</code> `access_token`s one can
authorize at two distinct levels:</p> <ul><li><p>role</p></li> <li><p>authority</p></li></ul> <p>To distinct the two, the auth provider follows the same recommendations
from the base user class, i.e.: use the`:` as a separator for the two.
It should be noted that both role and authorities do not need to be
together, in the most simple case an authority is enough.</p> <p>In order to map to keycloak’s token format the following checks are
performed:</p> <ol><li><p>If no role is provided, it is assumed to the the provider realm name</p></li> <li><p>If the role is <code>realm</code> then the lookup happens in <code>realm_access</code>
list</p></li> <li><p>If a role is provided then the lookup happends in the
<code>resource_access</code> list under the role name</p></li></ol> <h3 id="check-for-a-specific-authorities"><a href="#check-for-a-specific-authorities" class="header-anchor">#</a> Check for a specific authorities</h3> <p>Here is one example how you can perform authorization after the user has
been loaded from the oauth2 handshake, for example you want to see if
the user can <code>print</code> in the current application:</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">isAuthorized</span><span class="token punctuation">(</span><span class="token string">&quot;print&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// in this case it is assumed that the role is the current application</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Yes the user can print</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>However this is quite specific, you might want to verify if the user can
<code>add-user</code> to the whole system (the realm):</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">isAuthorized</span><span class="token punctuation">(</span><span class="token string">&quot;realm:add-user&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// the role is &quot;realm&quot;</span>
  <span class="token comment">// the authority is &quot;add-user&quot;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Yes the user can add users to the application</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or if the user can access the <code>year-report</code> in the <code>finance</code> department:</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">isAuthorized</span><span class="token punctuation">(</span><span class="token string">&quot;finance:year-report&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// the role is &quot;finance&quot;</span>
  <span class="token comment">// the authority is &quot;year-report&quot;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Yes the user can access the year report from the finance department</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="microprofile-jwt-1-1-spec"><a href="#microprofile-jwt-1-1-spec" class="header-anchor">#</a> MicroProfile JWT 1.1 spec</h2> <p>Another format in the form of a spec is the MP-JWT 1.1. This spec
defines a JSON array of strings under the property name <code>groups</code> that
define the &quot;groups&quot; the token has an authority over.</p> <p>In order to use this spec to assert AuthZ the right handler must be set:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MicroProfileRBAC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/auth-oauth2&quot;</span>
<span class="token comment">// use the MP-JWT 1.1 spec handler to</span>
<span class="token comment">// handle Role-Based Access Control (AuthZ)</span>
oauth2Auth<span class="token punctuation">.</span><span class="token function">rbacHandler</span><span class="token punctuation">(</span>MicroProfileRBAC<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="token-management"><a href="#token-management" class="header-anchor">#</a> Token Management</h1> <h2 id="check-if-it-is-expired"><a href="#check-if-it-is-expired" class="header-anchor">#</a> Check if it is expired</h2> <p>Tokens are usually fetched from the server and cached, in this case when
used later they might have already expired and be invalid, you can
verify if the token is still valid like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// internal validation against, expiration date</span>
<span class="token keyword">let</span> isExpired <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">expired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This call is totally offline, it could still happen that the Oauth2
server invalidated your token but you get a non expired token result.
The reason behind this is that the expiration is checked against the
token expiration dates, not before date and such values.</p> <h2 id="refresh-token"><a href="#refresh-token" class="header-anchor">#</a> Refresh token</h2> <p>There are times you know the token is about to expire and would like to
avoid to redirect the user again to the login screen. In this case you
can refresh the token. To refresh a token you need to have already a
user and call:</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the refresh call succeeded</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// the token was not refreshed, a best practise would be</span>
    <span class="token comment">// to forcefully logout the user since this could be a</span>
    <span class="token comment">// symptom that you're logged out by the server and this</span>
    <span class="token comment">// token is not valid anymore.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="revoke-token"><a href="#revoke-token" class="header-anchor">#</a> Revoke token</h2> <p>Since tokens can be shared across various applications you might want to
disallow the usage of the current token by any application. In order to
do this one needs to revoke the token against the Oauth2 server:</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">revoke</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the refresh call succeeded</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// the token was not refreshed, a best practise would be</span>
    <span class="token comment">// to forcefully logout the user since this could be a</span>
    <span class="token comment">// symptom that you're logged out by the server and this</span>
    <span class="token comment">// token is not valid anymore.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It is important to note that this call requires a token type. The reason
is because some providers will return more than one token e.g.:</p> <ul><li><p>id_token</p></li> <li><p>refresh_token</p></li> <li><p>access_token</p></li></ul> <p>So one needs to know what token to invalidate. It should be obvious that
if you invalidate the <code>refresh_token</code> you’re still logged in but you
won’t be able to refresh anymore, which means that once the token
expires you need to redirect the user again to the login page.</p> <h2 id="introspect"><a href="#introspect" class="header-anchor">#</a> Introspect</h2> <p>Introspect a token is similar to a expiration check, however one needs
to note that this check is fully online. This means that the check
happens on the OAuth2 server.</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">introspect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the introspection call succeeded</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// the token failed the introspection. You should proceed</span>
    <span class="token comment">// to logout the user since this means that this token is</span>
    <span class="token comment">// not valid anymore.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Important note is that even if the <code>expired()</code> call is <code>true</code> the return
from the <code>introspect</code> call can still be an error. This is because the
OAuth2 might have received a request to invalidate the token or a
loggout in between.</p> <h2 id="logging-out"><a href="#logging-out" class="header-anchor">#</a> Logging out</h2> <p>Logging out is not a <code>Oauth2</code> feature but it is present on <code>OpenID Connect</code> and most providers do support some sort of logging out. This
provider also covers this area if the configuration is enough to let it
make the call. For the user this is as simple as:</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the logout call succeeded</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// the user might not have been logged out</span>
    <span class="token comment">// to know why:</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/auth-oauth2/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/22/2020, 10:49:01 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.837a6700.js" defer></script><script src="/es4x/assets/js/2.96613d0f.js" defer></script><script src="/es4x/assets/js/41.1f30e160.js" defer></script>
  </body>
</html>
