<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using Vert.x MQTT | ES for Eclipse Vert.x</title>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
  <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
  <script src="/es4x/player/asciinema-player.js"></script>
    
    <link rel="preload" href="/es4x/assets/css/0.styles.93ea0277.css" as="style"><link rel="preload" href="/es4x/assets/js/app.45f626e2.js" as="script"><link rel="preload" href="/es4x/assets/js/2.9528bf06.js" as="script"><link rel="preload" href="/es4x/assets/js/137.0cb036fd.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.4e356b44.js"><link rel="prefetch" href="/es4x/assets/js/100.cf2ccba6.js"><link rel="prefetch" href="/es4x/assets/js/101.8c6eded7.js"><link rel="prefetch" href="/es4x/assets/js/102.8f2e6411.js"><link rel="prefetch" href="/es4x/assets/js/103.d72d2546.js"><link rel="prefetch" href="/es4x/assets/js/104.03ea6f93.js"><link rel="prefetch" href="/es4x/assets/js/105.97bae8c0.js"><link rel="prefetch" href="/es4x/assets/js/106.9a2e2ca0.js"><link rel="prefetch" href="/es4x/assets/js/107.aeb22b58.js"><link rel="prefetch" href="/es4x/assets/js/108.bae986db.js"><link rel="prefetch" href="/es4x/assets/js/109.2b947af9.js"><link rel="prefetch" href="/es4x/assets/js/11.6cb08ab3.js"><link rel="prefetch" href="/es4x/assets/js/110.c71e71a1.js"><link rel="prefetch" href="/es4x/assets/js/111.593de263.js"><link rel="prefetch" href="/es4x/assets/js/112.0670c01a.js"><link rel="prefetch" href="/es4x/assets/js/113.53d46a58.js"><link rel="prefetch" href="/es4x/assets/js/114.c5556463.js"><link rel="prefetch" href="/es4x/assets/js/115.5743b73f.js"><link rel="prefetch" href="/es4x/assets/js/116.b7169463.js"><link rel="prefetch" href="/es4x/assets/js/117.94d01670.js"><link rel="prefetch" href="/es4x/assets/js/118.19a97283.js"><link rel="prefetch" href="/es4x/assets/js/119.d3fd593f.js"><link rel="prefetch" href="/es4x/assets/js/12.462e9a0b.js"><link rel="prefetch" href="/es4x/assets/js/120.ff97e661.js"><link rel="prefetch" href="/es4x/assets/js/121.1f1ea408.js"><link rel="prefetch" href="/es4x/assets/js/122.efa391c4.js"><link rel="prefetch" href="/es4x/assets/js/123.8176ba1b.js"><link rel="prefetch" href="/es4x/assets/js/124.f3b0f209.js"><link rel="prefetch" href="/es4x/assets/js/125.b11510bd.js"><link rel="prefetch" href="/es4x/assets/js/126.220618b5.js"><link rel="prefetch" href="/es4x/assets/js/127.1cd7573a.js"><link rel="prefetch" href="/es4x/assets/js/128.25319ee3.js"><link rel="prefetch" href="/es4x/assets/js/129.dc2cd690.js"><link rel="prefetch" href="/es4x/assets/js/13.86534a95.js"><link rel="prefetch" href="/es4x/assets/js/130.c8eab2ac.js"><link rel="prefetch" href="/es4x/assets/js/131.38e243ce.js"><link rel="prefetch" href="/es4x/assets/js/132.7b5be48d.js"><link rel="prefetch" href="/es4x/assets/js/133.c4a3d298.js"><link rel="prefetch" href="/es4x/assets/js/134.0a4d935c.js"><link rel="prefetch" href="/es4x/assets/js/135.366362b3.js"><link rel="prefetch" href="/es4x/assets/js/136.08fa614d.js"><link rel="prefetch" href="/es4x/assets/js/138.467d7d28.js"><link rel="prefetch" href="/es4x/assets/js/139.cb378fe8.js"><link rel="prefetch" href="/es4x/assets/js/14.1906865f.js"><link rel="prefetch" href="/es4x/assets/js/140.36143b91.js"><link rel="prefetch" href="/es4x/assets/js/141.ed806584.js"><link rel="prefetch" href="/es4x/assets/js/142.13516e41.js"><link rel="prefetch" href="/es4x/assets/js/143.28297a8b.js"><link rel="prefetch" href="/es4x/assets/js/144.66f8db50.js"><link rel="prefetch" href="/es4x/assets/js/145.6da12fa8.js"><link rel="prefetch" href="/es4x/assets/js/146.d112bce8.js"><link rel="prefetch" href="/es4x/assets/js/147.7d52db6c.js"><link rel="prefetch" href="/es4x/assets/js/148.0fca2378.js"><link rel="prefetch" href="/es4x/assets/js/149.978c6cc9.js"><link rel="prefetch" href="/es4x/assets/js/15.7354219e.js"><link rel="prefetch" href="/es4x/assets/js/150.ca96a809.js"><link rel="prefetch" href="/es4x/assets/js/151.d272996f.js"><link rel="prefetch" href="/es4x/assets/js/152.9dbcc7b6.js"><link rel="prefetch" href="/es4x/assets/js/153.cf8da14b.js"><link rel="prefetch" href="/es4x/assets/js/154.ed046717.js"><link rel="prefetch" href="/es4x/assets/js/155.2b58da6a.js"><link rel="prefetch" href="/es4x/assets/js/156.fbc8b7da.js"><link rel="prefetch" href="/es4x/assets/js/157.0b67f2b3.js"><link rel="prefetch" href="/es4x/assets/js/158.dfe2036c.js"><link rel="prefetch" href="/es4x/assets/js/159.3e734a3c.js"><link rel="prefetch" href="/es4x/assets/js/16.e1582919.js"><link rel="prefetch" href="/es4x/assets/js/160.22aec581.js"><link rel="prefetch" href="/es4x/assets/js/161.83304a96.js"><link rel="prefetch" href="/es4x/assets/js/162.2e66100b.js"><link rel="prefetch" href="/es4x/assets/js/163.b623a314.js"><link rel="prefetch" href="/es4x/assets/js/164.c60e6322.js"><link rel="prefetch" href="/es4x/assets/js/165.9f3eb69b.js"><link rel="prefetch" href="/es4x/assets/js/17.54bde0b4.js"><link rel="prefetch" href="/es4x/assets/js/18.b5c20f2c.js"><link rel="prefetch" href="/es4x/assets/js/19.055d91ed.js"><link rel="prefetch" href="/es4x/assets/js/20.2a1467f5.js"><link rel="prefetch" href="/es4x/assets/js/21.351d0112.js"><link rel="prefetch" href="/es4x/assets/js/22.d7f7da51.js"><link rel="prefetch" href="/es4x/assets/js/23.8c7fdb15.js"><link rel="prefetch" href="/es4x/assets/js/24.e10c3043.js"><link rel="prefetch" href="/es4x/assets/js/25.c430d31f.js"><link rel="prefetch" href="/es4x/assets/js/26.16bd25ee.js"><link rel="prefetch" href="/es4x/assets/js/27.9eae56e3.js"><link rel="prefetch" href="/es4x/assets/js/28.7328b6a0.js"><link rel="prefetch" href="/es4x/assets/js/29.acbccb35.js"><link rel="prefetch" href="/es4x/assets/js/3.ea01a935.js"><link rel="prefetch" href="/es4x/assets/js/30.54c5acd8.js"><link rel="prefetch" href="/es4x/assets/js/31.be66d5df.js"><link rel="prefetch" href="/es4x/assets/js/32.65ce4eb7.js"><link rel="prefetch" href="/es4x/assets/js/33.ae2a52a4.js"><link rel="prefetch" href="/es4x/assets/js/34.0ad20f26.js"><link rel="prefetch" href="/es4x/assets/js/35.bb3728a5.js"><link rel="prefetch" href="/es4x/assets/js/36.0d06c159.js"><link rel="prefetch" href="/es4x/assets/js/37.b5eb90bc.js"><link rel="prefetch" href="/es4x/assets/js/38.96c660f9.js"><link rel="prefetch" href="/es4x/assets/js/39.41e1b587.js"><link rel="prefetch" href="/es4x/assets/js/4.fc776d3f.js"><link rel="prefetch" href="/es4x/assets/js/40.d0a26be1.js"><link rel="prefetch" href="/es4x/assets/js/41.59d59cd8.js"><link rel="prefetch" href="/es4x/assets/js/42.b78cae14.js"><link rel="prefetch" href="/es4x/assets/js/43.912b9356.js"><link rel="prefetch" href="/es4x/assets/js/44.e13ccccc.js"><link rel="prefetch" href="/es4x/assets/js/45.3ef02006.js"><link rel="prefetch" href="/es4x/assets/js/46.faa0287b.js"><link rel="prefetch" href="/es4x/assets/js/47.b487ba0e.js"><link rel="prefetch" href="/es4x/assets/js/48.ae8f3a89.js"><link rel="prefetch" href="/es4x/assets/js/49.83e2beca.js"><link rel="prefetch" href="/es4x/assets/js/5.2d4d3e75.js"><link rel="prefetch" href="/es4x/assets/js/50.5e1d5ffb.js"><link rel="prefetch" href="/es4x/assets/js/51.ff2c55ca.js"><link rel="prefetch" href="/es4x/assets/js/52.2ab6b963.js"><link rel="prefetch" href="/es4x/assets/js/53.003dce91.js"><link rel="prefetch" href="/es4x/assets/js/54.2f1ec2ff.js"><link rel="prefetch" href="/es4x/assets/js/55.27fcc794.js"><link rel="prefetch" href="/es4x/assets/js/56.f1494ba7.js"><link rel="prefetch" href="/es4x/assets/js/57.3dc75b31.js"><link rel="prefetch" href="/es4x/assets/js/58.ad7c5835.js"><link rel="prefetch" href="/es4x/assets/js/59.15c22822.js"><link rel="prefetch" href="/es4x/assets/js/6.08d23168.js"><link rel="prefetch" href="/es4x/assets/js/60.d88cd9dd.js"><link rel="prefetch" href="/es4x/assets/js/61.7f160678.js"><link rel="prefetch" href="/es4x/assets/js/62.a37de390.js"><link rel="prefetch" href="/es4x/assets/js/63.5d41db03.js"><link rel="prefetch" href="/es4x/assets/js/64.ef0f557b.js"><link rel="prefetch" href="/es4x/assets/js/65.82c56c7b.js"><link rel="prefetch" href="/es4x/assets/js/66.5db98484.js"><link rel="prefetch" href="/es4x/assets/js/67.1908aa6a.js"><link rel="prefetch" href="/es4x/assets/js/68.d7f74580.js"><link rel="prefetch" href="/es4x/assets/js/69.0d374e99.js"><link rel="prefetch" href="/es4x/assets/js/7.39a683cb.js"><link rel="prefetch" href="/es4x/assets/js/70.73111967.js"><link rel="prefetch" href="/es4x/assets/js/71.962e5b0d.js"><link rel="prefetch" href="/es4x/assets/js/72.e26b7b02.js"><link rel="prefetch" href="/es4x/assets/js/73.f9e5cfa0.js"><link rel="prefetch" href="/es4x/assets/js/74.63ba0b89.js"><link rel="prefetch" href="/es4x/assets/js/75.fa4a1977.js"><link rel="prefetch" href="/es4x/assets/js/76.3917601b.js"><link rel="prefetch" href="/es4x/assets/js/77.955be584.js"><link rel="prefetch" href="/es4x/assets/js/78.889ea1de.js"><link rel="prefetch" href="/es4x/assets/js/79.571498d4.js"><link rel="prefetch" href="/es4x/assets/js/8.3fc576d4.js"><link rel="prefetch" href="/es4x/assets/js/80.6adfce5e.js"><link rel="prefetch" href="/es4x/assets/js/81.d6ddc5b3.js"><link rel="prefetch" href="/es4x/assets/js/82.13fefac4.js"><link rel="prefetch" href="/es4x/assets/js/83.dfe401bf.js"><link rel="prefetch" href="/es4x/assets/js/84.cfff53fa.js"><link rel="prefetch" href="/es4x/assets/js/85.0f669957.js"><link rel="prefetch" href="/es4x/assets/js/86.1ea59e44.js"><link rel="prefetch" href="/es4x/assets/js/87.505880b7.js"><link rel="prefetch" href="/es4x/assets/js/88.b3b56624.js"><link rel="prefetch" href="/es4x/assets/js/89.7d996ac0.js"><link rel="prefetch" href="/es4x/assets/js/9.c659cef0.js"><link rel="prefetch" href="/es4x/assets/js/90.17d5c851.js"><link rel="prefetch" href="/es4x/assets/js/91.09fa57b1.js"><link rel="prefetch" href="/es4x/assets/js/92.9a5f5d37.js"><link rel="prefetch" href="/es4x/assets/js/93.9d0cf327.js"><link rel="prefetch" href="/es4x/assets/js/94.87202bb5.js"><link rel="prefetch" href="/es4x/assets/js/95.d8625634.js"><link rel="prefetch" href="/es4x/assets/js/96.c761c159.js"><link rel="prefetch" href="/es4x/assets/js/97.e8755c70.js"><link rel="prefetch" href="/es4x/assets/js/98.49262cb9.js"><link rel="prefetch" href="/es4x/assets/js/99.d62e0c5e.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.93ea0277.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/vertx-mqtt/" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/vertx-mqtt/" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-vert-x-mqtt"><a href="#using-vert-x-mqtt" class="header-anchor">#</a> Using Vert.x MQTT</h1> <p>This component had officially released in the Vert.x stack, just
following dependency to the <em>dependencies</em> section of your build
descriptor:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.vertx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>vertx-mqtt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>compile io<span class="token punctuation">.</span>vertx<span class="token punctuation">:</span>vertx<span class="token operator">-</span>mqtt<span class="token punctuation">:</span><span class="token punctuation">$</span><span class="token punctuation">{</span>maven<span class="token punctuation">.</span>version<span class="token punctuation">}</span>
</code></pre></div><h1 id="vert-x-mqtt-server"><a href="#vert-x-mqtt-server" class="header-anchor">#</a> Vert.x MQTT server</h1> <p>This component provides a server which is able to handle connections,
communication and messages exchange with remote <a href="http://mqtt.org/" target="_blank" rel="noopener noreferrer">MQTT<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
clients. Its API provides a bunch of events related to raw protocol
messages received by clients and exposes some features in order to send
messages to them.</p> <p>It’s not a fully featured MQTT broker but can be used for building
something like that or for protocol translation.</p> <blockquote><p><strong>Warning</strong></p> <p>this module has the tech preview status, this means the API can change
between versions.</p></blockquote> <h2 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting Started</h2> <h3 id="handling-client-connection-disconnection"><a href="#handling-client-connection-disconnection" class="header-anchor">#</a> Handling client connection/disconnection</h3> <p>This example shows how it’s possible to handle the connection request
from a remote MQTT client. First, an <code>MqttServer</code> instance is created
and the <code>endpointHandler</code> method is used to specify the handler called
when a remote client sends a CONNECT message for connecting to the
server itself. The <code>MqttEndpoint</code> instance, provided as parameter to the
handler, brings all main information related to the CONNECT message like
client identifier, username/password, &quot;will&quot; information, clean session
flag, protocol version and the &quot;keep alive&quot; timeout. Inside that
handler, the <em>endpoint</em> instance provides the <code>accept</code> method for
replying to the remote client with the corresponding CONNACK message :
in this way, the connection is established. Finally, the server is
started using the <code>listen</code> method with the default behavior (on
localhost and default MQTT port 1883). The same method allows to specify
an handler in order to check if the server is started properly or not.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MqttServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mqtt&quot;</span>

<span class="token keyword">let</span> mqttServer <span class="token operator">=</span> MqttServer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>
mqttServer<span class="token punctuation">.</span><span class="token function">endpointHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">endpoint</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// shows main connect info</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;MQTT client [&quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">clientIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] request to connect, clean session = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">isCleanSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> endpoint<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[username = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>username <span class="token operator">+</span> <span class="token string">&quot;, password = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>password <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[will topic = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>willTopic <span class="token operator">+</span> <span class="token string">&quot; msg = &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>willMessageBytes<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; QoS = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>willQos <span class="token operator">+</span> <span class="token string">&quot; isRetain = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>illRetain <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[keep alive timeout = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">keepAliveTimeSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// accept connection from the remote client</span>
  endpoint<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;MQTT server is listening on port &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actualPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error on starting the server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The same <em>endpoint</em> instance provides the <code>disconnectHandler</code> for
specifying the handler called when the remote client sends a DISCONNECT
message in order to disconnect from the server; this handler takes no
parameters.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// handling disconnect message</span>
endpoint<span class="token punctuation">.</span><span class="token function">disconnectHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received disconnect from client&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-client-connection-disconnection-with-ssl-tls-support"><a href="#handling-client-connection-disconnection-with-ssl-tls-support" class="header-anchor">#</a> Handling client connection/disconnection with SSL/TLS support</h3> <p>The server has the support for accepting connection requests through the
SSL/TLS protocol for authentication and encryption. In order to do that,
the <code>MqttServerOptions</code> class provides the <code>setSsl</code> method for setting
the usage of SSL/TLS (passing 'true' as value) and some other useful
methods for providing server certificate and related private key (as
Java key store reference, PEM or PFX format). In the following example,
the <code>setKeyCertOptions</code> method is used in order to pass the certificates
in PEM format. This method requires an instance of the possible
implementations of the <code>KeyCertOptions</code> interface and in this case the
<code>PemKeyCertOptions</code> class is used in order to provide the path for the
server certificate and the private key with the correspondent
<code>setCertPath</code> and <code>setKeyPath</code> methods. The MQTT server is started
passing the Vert.x instance as usual and the above MQTT options instance
to the creation method.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MqttServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mqtt&quot;</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MqttServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8883</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setKeyCertOptions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PemKeyCertOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setKeyPath</span><span class="token punctuation">(</span><span class="token string">&quot;./src/test/resources/tls/server-key.pem&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setCertPath</span><span class="token punctuation">(</span><span class="token string">&quot;./src/test/resources/tls/server-cert.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> mqttServer <span class="token operator">=</span> MqttServer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
mqttServer<span class="token punctuation">.</span><span class="token function">endpointHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">endpoint</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// shows main connect info</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;MQTT client [&quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">clientIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] request to connect, clean session = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">isCleanSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> endpoint<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[username = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>username <span class="token operator">+</span> <span class="token string">&quot;, password = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>password <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[will topic = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>willTopic <span class="token operator">+</span> <span class="token string">&quot; msg = &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>willMessageBytes<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; QoS = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>willQos <span class="token operator">+</span> <span class="token string">&quot; isRetain = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">will</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>illRetain <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[keep alive timeout = &quot;</span> <span class="token operator">+</span> endpoint<span class="token punctuation">.</span><span class="token function">keepAliveTimeSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// accept connection from the remote client</span>
  endpoint<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;MQTT server is listening on port &quot;</span> <span class="token operator">+</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actualPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error on starting the server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ar<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>All the other stuff related to handle endpoint connection and related
disconnection is managed in the same way without SSL/TLS support.</p> <h3 id="handling-client-subscription-unsubscription-request"><a href="#handling-client-subscription-unsubscription-request" class="header-anchor">#</a> Handling client subscription/unsubscription request</h3> <p>After a connection is established between client and server, the client
can send a subscription request for a topic using the SUBSCRIBE message.
The <code>MqttEndpoint</code> interface allows to specify an handler for the
incoming subscription request using the <code>subscribeHandler</code> method. Such
handler receives an instance of the <code>MqttSubscribeMessage</code> interface
which brings the list of topics with related QoS levels as desired by
the client. Finally, the endpoint instance provides the
<code>subscribeAcknowledge</code> method for replying to the client with the
related SUBACK message containing the granted QoS levels.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// handling requests for subscriptions</span>
endpoint<span class="token punctuation">.</span><span class="token function">subscribeHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">subscribe</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> grantedQosLevels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  subscribe<span class="token punctuation">.</span><span class="token function">topicSubscriptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Subscription for &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">topicName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; with QoS &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">qualityOfService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    grantedQosLevels<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">qualityOfService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ack the subscriptions request</span>
  endpoint<span class="token punctuation">.</span><span class="token function">subscribeAcknowledge</span><span class="token punctuation">(</span>subscribe<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> grantedQosLevels<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the same way, it’s possible to use the <code>unsubscribeHandler</code> method on
the endpoint in order to specify the handler called when the client
sends an UNSUBSCRIBE message. This handler receives an instance of the
<code>MqttUnsubscribeMessage</code> interface as parameter with the list of topics
to unsubscribe. Finally, the endpoint instance provides the
<code>unsubscribeAcknowledge</code> method for replying to the client with the
related UNSUBACK message.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// handling requests for unsubscriptions</span>
endpoint<span class="token punctuation">.</span><span class="token function">unsubscribeHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">unsubscribe</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  unsubscribe<span class="token punctuation">.</span><span class="token function">topics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Unsubscription for &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ack the subscriptions request</span>
  endpoint<span class="token punctuation">.</span><span class="token function">unsubscribeAcknowledge</span><span class="token punctuation">(</span>unsubscribe<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-client-published-message"><a href="#handling-client-published-message" class="header-anchor">#</a> Handling client published message</h3> <p>In order to handle incoming messages published by the remote client, the
<code>MqttEndpoint</code> interface provides the <code>publishHandler</code> method for
specifying the handler called when the client sends a PUBLISH message.
This handler receives an instance of the <code>MqttPublishMessage</code> interface
as parameter with the payload, the QoS level, the duplicate and retain
flags.</p> <p>If the QoS level is 0 (AT_MOST_ONCE), there is no need from the
endpoint to reply the client.</p> <p>If the QoS level is 1 (AT_LEAST_ONCE), the endpoind needs to reply
with a PUBACK message using the available <code>publishAcknowledge</code> method.</p> <p>If the QoS level is 2 (EXACTLY_ONCE), the endpoint needs to reply with
a PUBREC message using the available <code>publishReceived</code> method; in this
case the same endpoint should handle the PUBREL message received from
the client as well (the remote client sends it after receiving the
PUBREC from the endpoint) and it can do that specifying the handler
through the <code>publishReleaseHandler</code> method. In order to close the QoS
level 2 delivery, the endpoint can use the <code>publishComplete</code> method for
sending the PUBCOMP message to the client.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// handling incoming published messages</span>
endpoint<span class="token punctuation">.</span><span class="token function">publishHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Just received message [&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>Java<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;java.nio.charset.Charset&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] with QoS [&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">qosLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">qosLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'AT_LEAST_ONCE'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    endpoint<span class="token punctuation">.</span><span class="token function">publishAcknowledge</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">qosLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'EXACTLY_ONCE'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    endpoint<span class="token punctuation">.</span><span class="token function">publishReceived</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publishReleaseHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">messageId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  endpoint<span class="token punctuation">.</span><span class="token function">publishComplete</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="publish-message-to-the-client"><a href="#publish-message-to-the-client" class="header-anchor">#</a> Publish message to the client</h3> <p>The endpoint can publish a message to the remote client (sending a
PUBLISH message) using the <code>publish</code> method which takes the following
input parameters : the topic to publish, the payload, the QoS level, the
duplicate and retain flags.</p> <p>If the QoS level is 0 (AT_MOST_ONCE), the endpoint won’t receiving any
feedback from the client.</p> <p>If the QoS level is 1 (AT_LEAST_ONCE), the endpoint needs to handle
the PUBACK message received from the client in order to receive final
acknowledge of delivery. It’s possible using the
<code>publishAcknowledgeHandler</code> method specifying such an handler.</p> <p>If the QoS level is 2 (EXACTLY_ONCE), the endpoint needs to handle the
PUBREC message received from the client. The <code>publishReceivedHandler</code>
method allows to specify the handler for that. Inside that handler, the
endpoint can use the <code>publishRelease</code> method for replying to the client
with the PUBREL message. The last step is to handle the PUBCOMP message
received from the client as final acknowledge for the published message;
it’s possible using the <code>publishCompletionHandler</code> for specifying the
handler called when the final PUBCOMP message is received.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>

<span class="token comment">// just as example, publish a message with QoS level 2</span>
endpoint<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;my_topic&quot;</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;Hello from the Vert.x MQTT server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'EXACTLY_ONCE'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// specifing handlers for handling QoS 1 and 2</span>
endpoint<span class="token punctuation">.</span><span class="token function">publishAcknowledgeHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">messageId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received ack for message = &quot;</span> <span class="token operator">+</span> messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publishReceivedHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">messageId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  endpoint<span class="token punctuation">.</span><span class="token function">publishRelease</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publishCompletionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">messageId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received ack for message = &quot;</span> <span class="token operator">+</span> messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="be-notified-by-client-keep-alive"><a href="#be-notified-by-client-keep-alive" class="header-anchor">#</a> Be notified by client keep alive</h3> <p>The underlying MQTT keep alive mechanism is handled by the server
internally. When the CONNECT message is received, the server takes care
of the keep alive timeout specified inside that message in order to
check if the client doesn’t send messages in such timeout. At same time,
for every PINGREQ received, the server replies with the related
PINGRESP.</p> <p>Even if there is no need for the high level application to handle that,
the <code>MqttEndpoint</code> interface provides the <code>pingHandler</code> method for
specifying an handler called when a PINGREQ message is received from the
client. It’s just a notification to the application that the client
isn’t sending meaningful messages but only pings for keeping alive; in
any case the PINGRESP is automatically sent by the server internally as
described above.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// handling ping from client</span>
endpoint<span class="token punctuation">.</span><span class="token function">pingHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Ping received from client&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="closing-the-server"><a href="#closing-the-server" class="header-anchor">#</a> Closing the server</h3> <p>The <code>MqttServer</code> interface provides the <code>close</code> method that can be used
for closing the server; it stops to listen for incoming connections and
closes all the active connections with remote clients. This method is
asynchronous and one overload provides the possibility to specify a
complention handler that will be called when the server is really
closed.</p> <div class="language-js extra-class"><pre class="language-js"><code>mqttServer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;MQTT server closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="automatic-clean-up-in-verticles"><a href="#automatic-clean-up-in-verticles" class="header-anchor">#</a> Automatic clean-up in verticles</h3> <p>If you’re creating MQTT servers from inside verticles, those servers
will be automatically closed when the verticle is undeployed.</p> <h3 id="scaling-sharing-mqtt-servers"><a href="#scaling-sharing-mqtt-servers" class="header-anchor">#</a> Scaling : sharing MQTT servers</h3> <p>The handlers related to the MQTT server are always executed in the same
event loop thread. It means that on a system with more cores, only one
instance is deployed so only one core is used. In order to use more
cores, it’s possible to deploy more instances of the MQTT server.</p> <p>It’s possible to do that programmatically:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MqttServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mqtt&quot;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> mqttServer <span class="token operator">=</span> MqttServer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mqttServer<span class="token punctuation">.</span><span class="token function">endpointHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">endpoint</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// handling endpoint</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// handling start listening</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>or using a verticle specifying the number of instances:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeploymentOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setInstances</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vertx<span class="token punctuation">.</span><span class="token function">deployVerticle</span><span class="token punctuation">(</span><span class="token string">&quot;com.mycompany.MyVerticle&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>What’s really happen is that even only MQTT server is deployed but as
incoming connections arrive, Vert.x distributes them in a round-robin
fashion to any of the connect handlers executed on different cores.</p> <h1 id="vert-x-mqtt-client"><a href="#vert-x-mqtt-client" class="header-anchor">#</a> Vert.x MQTT client</h1> <p>This component provides an <a href="http://mqtt.org/" target="_blank" rel="noopener noreferrer">MQTT<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> client which is
compliant with the 3.1.1 spec. Its API provides a bunch of methods for
connecting/disconnecting to a broker, publishing messages (with all
three different levels of QoS) and subscribing to topics.</p> <blockquote><p><strong>Warning</strong></p> <p>this module has the tech preview status, this means the API can change
between versions.</p></blockquote> <h2 id="getting-started-2"><a href="#getting-started-2" class="header-anchor">#</a> Getting started</h2> <h3 id="connect-disconnect"><a href="#connect-disconnect" class="header-anchor">#</a> Connect/Disconnect</h3> <p>The client gives you opportunity to connect to a server and disconnect
from it. Also, you could specify things like the host and port of a
server you would like to connect to passing instance of
<code>MqttClientOptions</code> as a param through constructor.</p> <p>This example shows how you could connect to a server and disconnect from
it using Vert.x MQTT client and calling <code>connect</code> and <code>disconnect</code>
methods.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MqttClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/mqtt&quot;</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> MqttClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token number">1883</span><span class="token punctuation">,</span> <span class="token string">&quot;mqtt.eclipse.org&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note</strong></p> <p>default address of server provided by <code>MqttClientOptions</code> is
localhost:1883 and localhost:8883 if you are using SSL/TSL.</p></blockquote> <h3 id="subscribe-to-a-topic"><a href="#subscribe-to-a-topic" class="header-anchor">#</a> Subscribe to a topic</h3> <p>Now, lest go deeper and take look at this example:</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">publishHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;There are new message in topic: &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">topicName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Content(as string) of the message: &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;QoS: &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">qosLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;rpi2/temp&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here we have the example of usage of <code>subscribe</code> method. In order to
receive messages from rpi2/temp topic we call <code>subscribe</code> method.
Although, to handle received messages from server you need to provide a
handler, which will be called each time you have a new messages in the
topics you subscribe on. As this example shows, handler could be
provided via <code>publishHandler</code> method.</p> <h3 id="publishing-message-to-a-topic"><a href="#publishing-message-to-a-topic" class="header-anchor">#</a> Publishing message to a topic</h3> <p>If you would like to publish some message into topic then <code>publish</code>
should be called. Let’s take a look at the example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
client<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'AT_LEAST_ONCE'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the example we send message to topic with name &quot;temperature&quot;.</p> <h3 id="keep-connection-with-server-alive"><a href="#keep-connection-with-server-alive" class="header-anchor">#</a> Keep connection with server alive</h3> <p>In order to keep connection with server you should time to time send
something to server otherwise server will close the connection. The
right way to keep connection alive is a <code>ping</code> method.</p> <blockquote><p><strong>Important</strong></p> <p>by default you client keep connections with server automatically. That
means that you don’t need to call <code>ping</code> in order to keep connections
with server. The <code>MqttClient</code> will do it for you.</p></blockquote> <p>If you want to disable this feature then you should call
<code>setAutoKeepAlive</code> with <code>false</code> as argument:</p> <div class="language-js extra-class"><pre class="language-js"><code>options<span class="token punctuation">.</span>autoKeepAlive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="be-notified-when"><a href="#be-notified-when" class="header-anchor">#</a> Be notified when</h3> <ul><li><p>publish is completed</p> <p>You could provide handler by calling <code>publishCompletionHandler</code>. The
handler will be called each time publish is completed. This one is
pretty useful because you could see the packetId of just received
PUBACK or PUBCOMP packet.</p></li></ul> <div class="language- extra-class"><pre><code>import { Buffer } from &quot;@vertx/core&quot;
client.publishCompletionHandler((id) =&gt; {
  console.log(&quot;Id of just received PUBACK or PUBCOMP packet is &quot; + id);
}).publish(&quot;hello&quot;, Buffer.buffer(&quot;hello&quot;), 'EXACTLY_ONCE', false, false).publish(&quot;hello&quot;, Buffer.buffer(&quot;hello&quot;), 'AT_LEAST_ONCE', false, false).publish(&quot;hello&quot;, Buffer.buffer(&quot;hello&quot;), 'AT_LEAST_ONCE', false, false);
</code></pre></div><blockquote><p><strong>Warning</strong></p> <p>The handler WILL NOT BE CALLED if sent publish packet with QoS=0.</p></blockquote> <ul><li><p>subscribe completed</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">subscribeCompletionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mqttSubAckMessage</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Id of just received SUBACK packet is &quot;</span> <span class="token operator">+</span> mqttSubAckMessage<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mqttSubAckMessage<span class="token punctuation">.</span><span class="token function">grantedQoSLevels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">===</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Failure&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Success. Maximum QoS is &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;temp2&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>unsubscribe completed</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">unsubscribeCompletionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Id of just received UNSUBACK packet is &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>unsubscribe sent</p> <div class="language-js extra-class"><pre class="language-js"><code>Code not translatable
</code></pre></div></li> <li><p>PINGRESP received</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">pingResponseHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//The handler will be called time to time by default</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;We have just received PINGRESP packet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/vertx-mqtt/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/12/2020, 11:19:42 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.45f626e2.js" defer></script><script src="/es4x/assets/js/2.9528bf06.js" defer></script><script src="/es4x/assets/js/137.0cb036fd.js" defer></script>
  </body>
</html>
