<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES for Eclipse Vert.x</title>
    <meta name="description" content="A Modern JavaScript runtime for Eclipse Vert.x">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="shortcut icon" type="image/png" href="/es4x/favicon.png">
  <link rel="stylesheet" type="text/css" href="/es4x/player/asciinema-player.css">
  <script src="/es4x/player/asciinema-player.js"></script>
    
    <link rel="preload" href="/es4x/assets/css/0.styles.93ea0277.css" as="style"><link rel="preload" href="/es4x/assets/js/app.5c50c914.js" as="script"><link rel="preload" href="/es4x/assets/js/2.9528bf06.js" as="script"><link rel="preload" href="/es4x/assets/js/119.9b807fbd.js" as="script"><link rel="prefetch" href="/es4x/assets/js/10.3a8497eb.js"><link rel="prefetch" href="/es4x/assets/js/100.a16ae8c2.js"><link rel="prefetch" href="/es4x/assets/js/101.2f9de256.js"><link rel="prefetch" href="/es4x/assets/js/102.20df84c2.js"><link rel="prefetch" href="/es4x/assets/js/103.f5a0895a.js"><link rel="prefetch" href="/es4x/assets/js/104.ef6dd412.js"><link rel="prefetch" href="/es4x/assets/js/105.bbbf0dd0.js"><link rel="prefetch" href="/es4x/assets/js/106.db7eca08.js"><link rel="prefetch" href="/es4x/assets/js/107.c4898068.js"><link rel="prefetch" href="/es4x/assets/js/108.2dce77a0.js"><link rel="prefetch" href="/es4x/assets/js/109.c8cc9b8b.js"><link rel="prefetch" href="/es4x/assets/js/11.6cb08ab3.js"><link rel="prefetch" href="/es4x/assets/js/110.7e825b63.js"><link rel="prefetch" href="/es4x/assets/js/111.593de263.js"><link rel="prefetch" href="/es4x/assets/js/112.0670c01a.js"><link rel="prefetch" href="/es4x/assets/js/113.84f975b1.js"><link rel="prefetch" href="/es4x/assets/js/114.67df7f7d.js"><link rel="prefetch" href="/es4x/assets/js/115.335c4de1.js"><link rel="prefetch" href="/es4x/assets/js/116.b4b0b1b2.js"><link rel="prefetch" href="/es4x/assets/js/117.52c9c163.js"><link rel="prefetch" href="/es4x/assets/js/118.25ab0d2f.js"><link rel="prefetch" href="/es4x/assets/js/12.5d225bcb.js"><link rel="prefetch" href="/es4x/assets/js/120.34b00517.js"><link rel="prefetch" href="/es4x/assets/js/121.1f1ea408.js"><link rel="prefetch" href="/es4x/assets/js/122.efa391c4.js"><link rel="prefetch" href="/es4x/assets/js/123.cbf2e99f.js"><link rel="prefetch" href="/es4x/assets/js/124.e97ccb7b.js"><link rel="prefetch" href="/es4x/assets/js/125.b11510bd.js"><link rel="prefetch" href="/es4x/assets/js/126.87f4fa0f.js"><link rel="prefetch" href="/es4x/assets/js/127.8f8eb948.js"><link rel="prefetch" href="/es4x/assets/js/128.13d038e0.js"><link rel="prefetch" href="/es4x/assets/js/129.dc2cd690.js"><link rel="prefetch" href="/es4x/assets/js/13.9a9233c3.js"><link rel="prefetch" href="/es4x/assets/js/130.dc646b26.js"><link rel="prefetch" href="/es4x/assets/js/131.52e2a779.js"><link rel="prefetch" href="/es4x/assets/js/132.1e4b89d1.js"><link rel="prefetch" href="/es4x/assets/js/133.a0fbb880.js"><link rel="prefetch" href="/es4x/assets/js/134.b49897ea.js"><link rel="prefetch" href="/es4x/assets/js/135.3f05f822.js"><link rel="prefetch" href="/es4x/assets/js/136.08fa614d.js"><link rel="prefetch" href="/es4x/assets/js/137.0cb036fd.js"><link rel="prefetch" href="/es4x/assets/js/138.0d35423f.js"><link rel="prefetch" href="/es4x/assets/js/139.243cc65d.js"><link rel="prefetch" href="/es4x/assets/js/14.4d1a91f0.js"><link rel="prefetch" href="/es4x/assets/js/140.36143b91.js"><link rel="prefetch" href="/es4x/assets/js/141.c5923bc7.js"><link rel="prefetch" href="/es4x/assets/js/142.fda59539.js"><link rel="prefetch" href="/es4x/assets/js/143.28297a8b.js"><link rel="prefetch" href="/es4x/assets/js/144.66f8db50.js"><link rel="prefetch" href="/es4x/assets/js/145.1d1d85e0.js"><link rel="prefetch" href="/es4x/assets/js/146.2810738b.js"><link rel="prefetch" href="/es4x/assets/js/147.5606ed15.js"><link rel="prefetch" href="/es4x/assets/js/148.80cd8489.js"><link rel="prefetch" href="/es4x/assets/js/149.97b36e7e.js"><link rel="prefetch" href="/es4x/assets/js/15.32e17dad.js"><link rel="prefetch" href="/es4x/assets/js/150.fabcf288.js"><link rel="prefetch" href="/es4x/assets/js/151.f921c653.js"><link rel="prefetch" href="/es4x/assets/js/152.bf55767e.js"><link rel="prefetch" href="/es4x/assets/js/153.ed86c73a.js"><link rel="prefetch" href="/es4x/assets/js/154.ed046717.js"><link rel="prefetch" href="/es4x/assets/js/155.2b58da6a.js"><link rel="prefetch" href="/es4x/assets/js/156.fbc8b7da.js"><link rel="prefetch" href="/es4x/assets/js/157.63354900.js"><link rel="prefetch" href="/es4x/assets/js/158.4dfbf7de.js"><link rel="prefetch" href="/es4x/assets/js/159.42ae507c.js"><link rel="prefetch" href="/es4x/assets/js/16.fd9d1a51.js"><link rel="prefetch" href="/es4x/assets/js/160.3cf496ae.js"><link rel="prefetch" href="/es4x/assets/js/161.83304a96.js"><link rel="prefetch" href="/es4x/assets/js/162.d7cb8b75.js"><link rel="prefetch" href="/es4x/assets/js/163.98ad0a99.js"><link rel="prefetch" href="/es4x/assets/js/164.c60e6322.js"><link rel="prefetch" href="/es4x/assets/js/165.9f3eb69b.js"><link rel="prefetch" href="/es4x/assets/js/17.54bde0b4.js"><link rel="prefetch" href="/es4x/assets/js/18.b5c20f2c.js"><link rel="prefetch" href="/es4x/assets/js/19.5194252c.js"><link rel="prefetch" href="/es4x/assets/js/20.9bd5e5de.js"><link rel="prefetch" href="/es4x/assets/js/21.3a1f2566.js"><link rel="prefetch" href="/es4x/assets/js/22.c6abd98b.js"><link rel="prefetch" href="/es4x/assets/js/23.d0e8407e.js"><link rel="prefetch" href="/es4x/assets/js/24.24bd0c07.js"><link rel="prefetch" href="/es4x/assets/js/25.79b4d567.js"><link rel="prefetch" href="/es4x/assets/js/26.55e20f7d.js"><link rel="prefetch" href="/es4x/assets/js/27.954ec0d0.js"><link rel="prefetch" href="/es4x/assets/js/28.7328b6a0.js"><link rel="prefetch" href="/es4x/assets/js/29.70a1b946.js"><link rel="prefetch" href="/es4x/assets/js/3.ea01a935.js"><link rel="prefetch" href="/es4x/assets/js/30.72c26420.js"><link rel="prefetch" href="/es4x/assets/js/31.13bf88db.js"><link rel="prefetch" href="/es4x/assets/js/32.65ce4eb7.js"><link rel="prefetch" href="/es4x/assets/js/33.ae2a52a4.js"><link rel="prefetch" href="/es4x/assets/js/34.d6312781.js"><link rel="prefetch" href="/es4x/assets/js/35.bb3728a5.js"><link rel="prefetch" href="/es4x/assets/js/36.2217cb8a.js"><link rel="prefetch" href="/es4x/assets/js/37.b5eb90bc.js"><link rel="prefetch" href="/es4x/assets/js/38.7c03df83.js"><link rel="prefetch" href="/es4x/assets/js/39.e27e4593.js"><link rel="prefetch" href="/es4x/assets/js/4.fc776d3f.js"><link rel="prefetch" href="/es4x/assets/js/40.93417554.js"><link rel="prefetch" href="/es4x/assets/js/41.1f127357.js"><link rel="prefetch" href="/es4x/assets/js/42.b78cae14.js"><link rel="prefetch" href="/es4x/assets/js/43.912b9356.js"><link rel="prefetch" href="/es4x/assets/js/44.f0fd20e4.js"><link rel="prefetch" href="/es4x/assets/js/45.a7fdff61.js"><link rel="prefetch" href="/es4x/assets/js/46.cbceca3e.js"><link rel="prefetch" href="/es4x/assets/js/47.61ea5aa9.js"><link rel="prefetch" href="/es4x/assets/js/48.ae8f3a89.js"><link rel="prefetch" href="/es4x/assets/js/49.83e2beca.js"><link rel="prefetch" href="/es4x/assets/js/5.36188fd0.js"><link rel="prefetch" href="/es4x/assets/js/50.5e1d5ffb.js"><link rel="prefetch" href="/es4x/assets/js/51.ff2c55ca.js"><link rel="prefetch" href="/es4x/assets/js/52.2ab6b963.js"><link rel="prefetch" href="/es4x/assets/js/53.003dce91.js"><link rel="prefetch" href="/es4x/assets/js/54.f3ab8db1.js"><link rel="prefetch" href="/es4x/assets/js/55.03718cf7.js"><link rel="prefetch" href="/es4x/assets/js/56.7d18d4cf.js"><link rel="prefetch" href="/es4x/assets/js/57.cf1be33e.js"><link rel="prefetch" href="/es4x/assets/js/58.e81a6ae3.js"><link rel="prefetch" href="/es4x/assets/js/59.71d8f795.js"><link rel="prefetch" href="/es4x/assets/js/6.fc126a38.js"><link rel="prefetch" href="/es4x/assets/js/60.90f1735a.js"><link rel="prefetch" href="/es4x/assets/js/61.66d28a0d.js"><link rel="prefetch" href="/es4x/assets/js/62.0b18638e.js"><link rel="prefetch" href="/es4x/assets/js/63.ab499887.js"><link rel="prefetch" href="/es4x/assets/js/64.277b48e0.js"><link rel="prefetch" href="/es4x/assets/js/65.82c56c7b.js"><link rel="prefetch" href="/es4x/assets/js/66.86a2e5ed.js"><link rel="prefetch" href="/es4x/assets/js/67.c60348a1.js"><link rel="prefetch" href="/es4x/assets/js/68.dcab7f6b.js"><link rel="prefetch" href="/es4x/assets/js/69.9760a353.js"><link rel="prefetch" href="/es4x/assets/js/7.15d59e13.js"><link rel="prefetch" href="/es4x/assets/js/70.91d487f5.js"><link rel="prefetch" href="/es4x/assets/js/71.007f382a.js"><link rel="prefetch" href="/es4x/assets/js/72.dd8fc256.js"><link rel="prefetch" href="/es4x/assets/js/73.dabb918b.js"><link rel="prefetch" href="/es4x/assets/js/74.2d05d9d2.js"><link rel="prefetch" href="/es4x/assets/js/75.24e40fad.js"><link rel="prefetch" href="/es4x/assets/js/76.3917601b.js"><link rel="prefetch" href="/es4x/assets/js/77.8d933c53.js"><link rel="prefetch" href="/es4x/assets/js/78.889ea1de.js"><link rel="prefetch" href="/es4x/assets/js/79.707c2cfc.js"><link rel="prefetch" href="/es4x/assets/js/8.9d77fc4d.js"><link rel="prefetch" href="/es4x/assets/js/80.d16501dd.js"><link rel="prefetch" href="/es4x/assets/js/81.d6ddc5b3.js"><link rel="prefetch" href="/es4x/assets/js/82.83a52449.js"><link rel="prefetch" href="/es4x/assets/js/83.26253b37.js"><link rel="prefetch" href="/es4x/assets/js/84.55a5180b.js"><link rel="prefetch" href="/es4x/assets/js/85.0f669957.js"><link rel="prefetch" href="/es4x/assets/js/86.1ea59e44.js"><link rel="prefetch" href="/es4x/assets/js/87.1a523aae.js"><link rel="prefetch" href="/es4x/assets/js/88.c4790f82.js"><link rel="prefetch" href="/es4x/assets/js/89.943de6e9.js"><link rel="prefetch" href="/es4x/assets/js/9.6b0ac1d5.js"><link rel="prefetch" href="/es4x/assets/js/90.2ec0b578.js"><link rel="prefetch" href="/es4x/assets/js/91.4002b7d6.js"><link rel="prefetch" href="/es4x/assets/js/92.40b463c2.js"><link rel="prefetch" href="/es4x/assets/js/93.b7246002.js"><link rel="prefetch" href="/es4x/assets/js/94.ff76977a.js"><link rel="prefetch" href="/es4x/assets/js/95.62c8c9e0.js"><link rel="prefetch" href="/es4x/assets/js/96.e53f12ec.js"><link rel="prefetch" href="/es4x/assets/js/97.6dfe744d.js"><link rel="prefetch" href="/es4x/assets/js/98.59c44a32.js"><link rel="prefetch" href="/es4x/assets/js/99.afcf40c7.js">
    <link rel="stylesheet" href="/es4x/assets/css/0.styles.93ea0277.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/es4x/" class="home-link router-link-active"><!----> <span class="site-name">ES for Eclipse Vert.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/service-discovery/" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/es4x/get-started/" class="nav-link">
  Get started
</a></div><div class="nav-item"><a href="/es4x/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/es4x/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/es4x/api/" class="nav-link">
  APIs
</a></div><div class="nav-item"><a href="https://github.com/reactiverse/es4x/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es4x/manual/@vertx/service-discovery/" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/es4x/zh/" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/es4x/pt/" class="nav-link">
  Português
</a></li></ul></div></div> <a href="https://github.com/reactiverse/es4x" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Manuals</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es4x/manual/" class="sidebar-link">API Reference Manuals</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>This component provides an infrastructure to publish and discover
various resources, such as service proxies, HTTP endpoints, data
sources…​ These resources are called <code>services</code>. A <code>service</code> is a
discoverable functionality. It can be qualified by its type, metadata,
and location. So a <code>service</code> can be a database, a service proxy, a HTTP
endpoint and any other resource you can imagine as soon as you can
describe it, discover it and interact with it. It does not have to be a
vert.x entity, but can be anything. Each service is described by a
<code>Record</code>.</p> <p>The service discovery implements the interactions defined in
service-oriented computing. And to some extent, also provides the
dynamic service-oriented computing interactions. So, applications can
react to arrival and departure of services.</p> <p>A service provider can:</p> <ul><li><p>publish a service record</p></li> <li><p>un-publish a published record</p></li> <li><p>update the status of a published service (down, out of service…​)</p></li></ul> <p>A service consumer can:</p> <ul><li><p>lookup services</p></li> <li><p>bind to a selected service (it gets a <code>ServiceReference</code>) and use it</p></li> <li><p>release the service once the consumer is done with it</p></li> <li><p>listen for arrival, departure and modification of services.</p></li></ul> <p>Consumer would 1) lookup a service record matching their need, 2)
retrieve the <code>ServiceReference</code> that give access to the service, 3) get
a service object to access the service, 4) release the service object
once done.</p> <p>The process can be simplified using <em>service type</em> where you can
directly retrieve the service object if you know from which type it is
(JDBC client, Http client…​).</p> <p>As stated above, the central piece of information shared by the
providers and consumers are <code>records</code>.</p> <p>Providers and consumers must create their own <code>ServiceDiscovery</code>
instance. These instances are collaborating in the background
(distributed structure) to keep the set of services in sync.</p> <p>The service discovery supports bridges to import and export services
from / to other discovery technologies.</p> <h1 id="using-the-service-discovery"><a href="#using-the-service-discovery" class="header-anchor">#</a> Using the service discovery</h1> <p>To use the Vert.x service discovery, add the following dependency to the
<em>dependencies</em> section of your build descriptor:</p> <ul><li>Maven (in your <code>pom.xml</code>):</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.vertx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>vertx-service-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Gradle (in your <code>build.gradle</code> file):</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>compile <span class="token string">'io.vertx:vertx-service-discovery:${maven.version}'</span>
</code></pre></div><h1 id="overall-concepts"><a href="#overall-concepts" class="header-anchor">#</a> Overall concepts</h1> <p>The discovery mechanism is based on a few concepts explained in this
section.</p> <h2 id="service-records"><a href="#service-records" class="header-anchor">#</a> Service records</h2> <p>A service <code>Record</code> is an object that describes a service published by a
service provider. It contains a name, some metadata, a location object
(describing where is the service). This record is the only object shared
by the provider (having published it) and the consumer (retrieve it when
doing a lookup).</p> <p>The metadata and even the location format depend on the <code>service type</code>
(see below).</p> <p>A record is published when the provider is ready to be used, and
withdrawn when the service provider is stopping.</p> <h2 id="service-provider-and-publisher"><a href="#service-provider-and-publisher" class="header-anchor">#</a> Service Provider and publisher</h2> <p>A service provider is an entity providing a <em>service</em>. The publisher is
responsible for publishing a record describing the provider. It may be a
single entity (a provider publishing itself) or a different entity.</p> <h2 id="service-consumer"><a href="#service-consumer" class="header-anchor">#</a> Service Consumer</h2> <p>Service consumers search for services in the service discovery. Each
lookup retrieves <code>0..n</code> <code>Record</code>. From these records, a consumer can
retrieve a <code>ServiceReference</code>, representing the binding between the
consumer and the provider. This reference allows the consumer to
retrieve the <em>service object</em> (to use the service), and release the
service.</p> <p>It is important to release service references to cleanup the objects and
update the service usages.</p> <h2 id="service-object"><a href="#service-object" class="header-anchor">#</a> Service object</h2> <p>The service object is the object that gives access to a service. It can
come in various forms, such as a proxy, a client, and may even be
non-existent for some service types. The nature of the service object
depends on the service type.</p> <p>Notice that because of the polyglot nature of Vert.x, the service object
can differ if you retrieve it from Java, Groovy or another language.</p> <h2 id="service-types"><a href="#service-types" class="header-anchor">#</a> Service types</h2> <p>Services are just resources, and there are a lot of different kinds of
services. They can be functional services, databases, REST APIs, and so
on. The Vert.x service discovery has the concept of service types to
handle this heterogeneity. Each type defines:</p> <ul><li><p>how the service is located (URI, event bus address, IP / DNS…​) -
<em>location</em></p></li> <li><p>the nature of the service object (service proxy, HTTP client,
message consumer…​) - <em>client</em></p></li></ul> <p>Some service types are implemented and provided by the service discovery
component, but you can add your own.</p> <h2 id="service-events"><a href="#service-events" class="header-anchor">#</a> Service events</h2> <p>Every time a service provider is published or withdrawn, an event is
fired on the event bus. This event contains the record that has been
modified.</p> <p>In addition, in order to track who is using who, every time a reference
is retrieved with <code>getReference</code> or released with <code>release</code>, events are
emitted on the event bus to track the service usages.</p> <p>More details on these events below.</p> <h2 id="backend"><a href="#backend" class="header-anchor">#</a> Backend</h2> <p>The service discovery uses a Vert.x distributed data structure to store
the records. So, all members of the cluster have access to all the
records. This is the default backend implementation. You can implement
your own by implementing the <code>ServiceDiscoveryBackend</code> SPI. For
instance, we provide an implementation based on Redis.</p> <p>Notice that the discovery does not require Vert.x clustering. In
single-node mode, the structure is local. It can be populated with
<code>ServiceImporter`s. Since 3.5.0, you can use a local structure even in clustered mode by setting the system property `vertx-service-discovery-backend-local</code> to <code>true</code> (or the environment
variable <code>VERTX-SERVICE-DISCOVERY-BACKEND-LOCAL</code> to <code>true</code>).</p> <h1 id="creating-a-service-discovery-instance"><a href="#creating-a-service-discovery-instance" class="header-anchor">#</a> Creating a service discovery instance</h1> <p>Publishers and consumers must create their own <code>ServiceDiscovery</code>
instance to use the discovery infrastructure:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ServiceDiscovery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token comment">// Use default configuration</span>
<span class="token keyword">let</span> discovery <span class="token operator">=</span> ServiceDiscovery<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Customize the configuration</span>
discovery <span class="token operator">=</span> ServiceDiscovery<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>vertx<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ServiceDiscoveryOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAnnounceAddress</span><span class="token punctuation">(</span><span class="token string">&quot;service-announce&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;my-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Do something...</span>

discovery<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default, the announce address (the event bus address on which service
events are sent is: <code>vertx.discovery .announce</code>. You can also configure a name used for the service usage
(see section about service usage).</p> <p>When you don’t need the service discovery object anymore, don’t forget
to close it. It closes the different discovery importers and exporters
you have configured and releases the service references.</p> <p>You should avoid sharing the service discovery instance, so service
usage would represent the right &quot;usages&quot;.</p> <h1 id="publishing-services"><a href="#publishing-services" class="header-anchor">#</a> Publishing services</h1> <p>Once you have a service discovery instance, you can publish services.
The process is the following:</p> <ol><li><p>create a record for a specific service provider</p></li> <li><p>publish this record</p></li> <li><p>keep the published record that is used to un-publish a service or
modify it.</p></li></ol> <p>To create records, you can either use the <code>Record</code> class, or use
convenient methods from the service types.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpEndpoint <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token comment">// Manual record creation</span>
<span class="token keyword">let</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;eventbus-service-proxy&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;endpoint&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;the-service-address&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;my-service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;some-label&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-value&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// publication succeeded</span>
    <span class="token keyword">let</span> publishedRecord <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// publication failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Record creation from a type</span>
record <span class="token operator">=</span> HttpEndpoint<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-rest-api&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;/api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
discovery<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// publication succeeded</span>
    <span class="token keyword">let</span> publishedRecord <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// publication failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It is important to keep a reference on the returned records, as this
record has been extended by a <code>registration id</code>.</p> <h1 id="withdrawing-services"><a href="#withdrawing-services" class="header-anchor">#</a> Withdrawing services</h1> <p>To withdraw (un-publish) a record, use:</p> <div class="language-js extra-class"><pre class="language-js"><code>discovery<span class="token punctuation">.</span><span class="token function">unpublish</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>registration<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Ok</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// cannot un-publish the service, may have already been removed, or the record is not published</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="looking-for-services"><a href="#looking-for-services" class="header-anchor">#</a> Looking for services</h1> <p><em>This section explains the low-level process to retrieve services, each
service type provide convenient method to aggregates the different
steps.</em></p> <p>On the consumer side, the first thing to do is to lookup for records.
You can search for a single record or all the matching ones. In the
first case, the first matching record is returned.</p> <p>Consumer can pass a filter to select the service. There are two ways to
describe the filter:</p> <ol><li><p>A function taking a <code>Record</code> as parameter and returning a boolean
(it’s a predicate)</p></li> <li><p>This filter is a JSON object. Each entry of the given filter is
checked against the record. All entries must exactly match the
record. The entry can use the special <code>*</code> value to denote a
requirement on the key, but not on the value.</p></li></ol> <p>Let’s see an example of a JSON filter:</p> <div class="language- extra-class"><pre><code>{ &quot;name&quot; = &quot;a&quot; } =&gt; matches records with name set to &quot;a&quot;
{ &quot;color&quot; = &quot;*&quot; } =&gt; matches records with &quot;color&quot; set
{ &quot;color&quot; = &quot;red&quot; } =&gt; only matches records with &quot;color&quot; set to &quot;red&quot;
{ &quot;color&quot; = &quot;red&quot;, &quot;name&quot; = &quot;a&quot;} =&gt; only matches records with name set to &quot;a&quot;, and color set to &quot;red&quot;
</code></pre></div><p>If the JSON filter is not set (<code>null</code> or empty), it accepts all records.
When using functions, to accept all records, you must return <em>true</em>
regardless the record.</p> <p>Here are some examples:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Get any record</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// we have a record</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// the lookup succeeded, but no matching service</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// lookup failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// we have a record</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// the lookup succeeded, but no matching service</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// lookup failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// Get a record by name</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  r<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;some-name&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// we have a record</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// the lookup succeeded, but no matching service</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// lookup failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// we have a record</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// the lookup succeeded, but no matching service</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// lookup failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get all records matching the filter</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;some-value&quot;</span> <span class="token operator">==</span> r<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>some<span class="token operator">-</span>label<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If the list is not empty, we have matching record</span>
    <span class="token comment">// Else, the lookup succeeded, but no matching service</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// lookup failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


discovery<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;some-label&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-value&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If the list is not empty, we have matching record</span>
    <span class="token comment">// Else, the lookup succeeded, but no matching service</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// lookup failed</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can retrieve a single record or all matching records with
<code>getRecords</code>. By default, record lookup does include only records with a
<code>status</code> set to <code>UP</code>. This can be overridden:</p> <ul><li><p>when using JSON filter, just set <code>status</code> to the value you want (or
<code>*</code> to accept all status)</p></li> <li><p>when using function, set the <code>includeOutOfService</code> parameter to
<code>true</code> in <code>getRecords</code> .</p></li></ul> <h1 id="retrieving-a-service-reference"><a href="#retrieving-a-service-reference" class="header-anchor">#</a> Retrieving a service reference</h1> <p>Once you have chosen the <code>Record</code>, you can retrieve a <code>ServiceReference</code>
and then the service object:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MessageConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token keyword">let</span> reference1 <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span>record1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> reference2 <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span>record2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Then, gets the service object, the returned type depends on the service type:</span>
<span class="token comment">// For http endpoint:</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> reference1<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span>HttpClient<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// For message source</span>
<span class="token keyword">let</span> consumer <span class="token operator">=</span> reference2<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span>MessageConsumer<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// When done with the service</span>
reference1<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reference2<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Don’t forget to release the reference once done.</p> <p>The service reference represents a binding with the service provider.</p> <p>When retrieving a service reference you can pass a <code>JsonObject</code> used to
configure the service object. It can contain various data about the
service object. Some service types do not need additional configuration,
some require configuration (as data sources):</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> JDBCClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/jdbc-client&quot;</span>
<span class="token keyword">let</span> reference <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReferenceWithConfiguration</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> conf<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Then, gets the service object, the returned type depends on the service type:</span>
<span class="token comment">// For http endpoint:</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> reference<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span>JDBCClient<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Do something with the client...</span>

<span class="token comment">// When done with the service</span>
reference<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the previous examples, the code uses <code>getAs</code>. The parameter is the
type of object you expect to get. If you are using Java, you can use
<code>get</code>. However in the other language you must pass the expected type.</p> <h1 id="types-of-services"><a href="#types-of-services" class="header-anchor">#</a> Types of services</h1> <p>A said above, the service discovery has the service type concept to
manage the heterogeneity of the different services.</p> <p>These types are provided by default:</p> <ul><li><p><code>HttpEndpoint</code> - for REST API’s, the service object is a
<code>HttpClient</code> configured on the host and port (the location is the
url).</p></li> <li><p><code>EventBusService</code> - for service proxies, the service object is a
proxy. Its type is the proxies interface (the location is the
address).</p></li> <li><p><code>MessageSource</code> - for message sources (publisher), the service
object is a <code>MessageConsumer</code> (the location is the address).</p></li> <li><p><code>JDBCDataSource</code> - for JDBC data sources, the service object is a
<code>JDBCClient</code> (the configuration of the client is computed from the
location, metadata and consumer configuration).</p></li> <li><p><code>RedisDataSource</code> - for Redis data sources, the service object is a
<code>RedisClient</code> (the configuration of the client is computed from the
location, metadata and consumer configuration).</p></li> <li><p><code>MongoDataSource</code> - for Mongo data sources, the service object is a
<code>MongoClient</code> (the configuration of the client is computed from the
location, metadata and consumer configuration).</p></li></ul> <p>This section gives details about service types in general and describes
how to use the default service types.</p> <h2 id="services-with-no-type"><a href="#services-with-no-type" class="header-anchor">#</a> Services with no type</h2> <p>Some records may have no type (<code>ServiceType.UNKNOWN</code>). It is not
possible to retrieve a reference for these records, but you can build
the connection details from the <code>location</code> and <code>metadata</code> of the
<code>Record</code>.</p> <p>Using these services does not fire service usage events.</p> <h2 id="http-endpoints"><a href="#http-endpoints" class="header-anchor">#</a> HTTP endpoints</h2> <p>A HTTP endpoint represents a REST API or a service accessible using HTTP
requests. The HTTP endpoint service objects are <code>HttpClient</code> configured
with the host, port and ssl.</p> <h3 id="publishing-a-http-endpoint"><a href="#publishing-a-http-endpoint" class="header-anchor">#</a> Publishing a HTTP endpoint</h3> <p>To publish a HTTP endpoint, you need a <code>Record</code>. You can create the
record using <code>HttpEndpoint.createRecord</code>.</p> <p>The next snippet illustrates hot to create a <code>Record</code> from
<code>HttpEndpoint</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpEndpoint <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">let</span> record1 <span class="token operator">=</span> HttpEndpoint<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-http-service&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8433</span><span class="token punctuation">,</span> <span class="token string">&quot;/api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>record1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> record2 <span class="token operator">=</span> HttpEndpoint<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-other-name&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8433</span><span class="token punctuation">,</span> <span class="token string">&quot;/api&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;some-metadata&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some value&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When you run your service in a container or on the cloud, it may not
know its public IP and public port, so the publication must be done by
another entity having this info. Generally it’s a bridge.</p> <h3 id="consuming-a-http-endpoint"><a href="#consuming-a-http-endpoint" class="header-anchor">#</a> Consuming a HTTP endpoint</h3> <p>Once a HTTP endpoint is published, a consumer can retrieve it. The
service object is a <code>HttpClient</code> with a port and host configured:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// Get the record</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-http-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve the service reference</span>
    <span class="token keyword">let</span> reference <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Retrieve the service object</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> reference<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span>HttpClient<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// You need to path the complete path</span>
    client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;/api/persons&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token comment">// ...</span>

      <span class="token comment">// Dont' forget to release the service</span>
      reference<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also use the <code>HttpEndpoint.getClient</code> method to combine lookup
and service retrieval in one call:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ServiceDiscovery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpEndpoint <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
HttpEndpoint<span class="token punctuation">.</span><span class="token function">getClient</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-http-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// You need to path the complete path</span>
    client<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token string">&quot;/api/persons&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token comment">// ...</span>

      <span class="token comment">// Dont' forget to release the service</span>
      ServiceDiscovery<span class="token punctuation">.</span><span class="token function">releaseServiceObject</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this second version, the service object is released using
<code>ServiceDiscovery.releaseServiceObject</code>, so you don’t need to keep the
service reference.</p> <p>Since Vert.x 3.4.0, another client has been provided. This higher-level
client, named <code>WebClient</code> tends to be easier to use. You can retrieve a
<code>WebClient</code> instances using:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> WebClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/web-client&quot;</span>
<span class="token comment">// Get the record</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-http-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve the service reference</span>
    <span class="token keyword">let</span> reference <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Retrieve the service object</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> reference<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span>WebClient<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// You need to path the complete path</span>
    client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/persons&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token comment">// ...</span>

      <span class="token comment">// Dont' forget to release the service</span>
      reference<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And, if you prefer the approach using the service type:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ServiceDiscovery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpEndpoint <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
HttpEndpoint<span class="token punctuation">.</span><span class="token function">getWebClient</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-http-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// You need to path the complete path</span>
    client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/persons&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token comment">// ...</span>

      <span class="token comment">// Dont' forget to release the service</span>
      ServiceDiscovery<span class="token punctuation">.</span><span class="token function">releaseServiceObject</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="event-bus-services"><a href="#event-bus-services" class="header-anchor">#</a> Event bus services</h2> <p>Event bus services are service proxies. They implement async-RPC
services on top of the event bus. When retrieving a service object from
an event bus service, you get a service proxy of the right type. You can
access helper methods from <code>EventBusService</code>.</p> <p>Notice that service proxies (service implementations and service
interfaces) are developed in Java.</p> <h3 id="publishing-an-event-bus-service"><a href="#publishing-an-event-bus-service" class="header-anchor">#</a> Publishing an event bus service</h3> <p>To publish an event bus service, you need to create a <code>Record</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EventBusService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">let</span> record <span class="token operator">=</span> EventBusService<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-eventbus-service&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;examples.MyService&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;some-metadata&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some value&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="consuming-an-event-bus-service"><a href="#consuming-an-event-bus-service" class="header-anchor">#</a> Consuming an event bus service</h3> <p>To consume an event bus service you can either retrieve the record and
then get the reference, or use the <code>EventBusService</code> interface that
combines the two operations in one call.</p> <p>However, as the service is searched by (Java) interface, you need to
specify the type of client you expect.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ServiceDiscovery <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vertx-service-discovery-js/service_discovery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> EventBusService <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vertx-service-discovery-js/event_bus_service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> MyService <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;org-acme-js/MyService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
EventBusService<span class="token punctuation">.</span><span class="token function">getServiceProxyWithJsonFilter</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span>
<span class="token punctuation">{</span> <span class="token string">&quot;service.interface&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;org.acme.MyService&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
MyService<span class="token punctuation">,</span>
<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ar<span class="token punctuation">,</span> ar_err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ar_err <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> service <span class="token operator">=</span> ar<span class="token punctuation">;</span>

<span class="token comment">// Dont' forget to release the service</span>
ServiceDiscovery<span class="token punctuation">.</span><span class="token function">releaseServiceObject</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> service<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="message-source"><a href="#message-source" class="header-anchor">#</a> Message source</h2> <p>A message source is a component sending messages on the event bus on a
specific address. Message source clients are <code>MessageConsumer</code>.</p> <p>The <em>location</em> or a message source service is the event bus address on
which messages are sent.</p> <h3 id="publishing-a-message-source"><a href="#publishing-a-message-source" class="header-anchor">#</a> Publishing a message source</h3> <p>As for the other service types, publishing a message source is a 2-step
process:</p> <ol><li><p>create a record, using <code>MessageSource</code></p></li> <li><p>publish the record</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MessageSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">let</span> record <span class="token operator">=</span> MessageSource<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-message-source-service&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;some-address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

record <span class="token operator">=</span> MessageSource<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-other-message-source-service&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;some-address&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;examples.MyData&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the second record, the type of payload is also indicated. This
information is optional.</p> <h3 id="consuming-a-message-source"><a href="#consuming-a-message-source" class="header-anchor">#</a> Consuming a message source</h3> <p>On the consumer side, you can retrieve the record and the reference, or
use the <code>MessageSource</code> class to retrieve the service is one call.</p> <p>With the first approach, the code is the following:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MessageConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/core&quot;</span>
<span class="token comment">// Get the record</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-message-source-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve the service reference</span>
    <span class="token keyword">let</span> reference <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Retrieve the service object</span>
    <span class="token keyword">let</span> consumer <span class="token operator">=</span> reference<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span>MessageConsumer<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Attach a message handler on it</span>
    consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// message handler</span>
      <span class="token keyword">let</span> payload <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When, using <code>MessageSource</code>, it becomes:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MessageSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
MessageSource<span class="token punctuation">.</span><span class="token function">getConsumer</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-message-source-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> consumer <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Attach a message handler on it</span>
    consumer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// message handler</span>
      <span class="token keyword">let</span> payload <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="jdbc-data-source"><a href="#jdbc-data-source" class="header-anchor">#</a> JDBC Data source</h2> <p>Data sources represents databases or data stores. JDBC data sources are
a specialization for databases accessible using a JDBC driver. The
client of a JDBC data source service is a <code>JDBCClient</code>.</p> <h3 id="publishing-a-jdbc-service"><a href="#publishing-a-jdbc-service" class="header-anchor">#</a> Publishing a JDBC service</h3> <p>As for the other service types, publishing a JDBC data source is a
2-step process:</p> <ol><li><p>create a record, using <code>JDBCDataSource</code></p></li> <li><p>publish the record</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> JDBCDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">let</span> record <span class="token operator">=</span> JDBCDataSource<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-data-source-service&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some jdbc url&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;some-metadata&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-value&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As JDBC data sources can represent a high variety of databases, and
their access is often different, the record is rather unstructured. The
<code>location</code> is a simple JSON object that should provide the fields to
access the data source (JDBC url, username…​). The set of fields may
depend on the database but also on the connection pool used in front.</p> <h3 id="consuming-a-jdbc-service"><a href="#consuming-a-jdbc-service" class="header-anchor">#</a> Consuming a JDBC service</h3> <p>As stated in the previous section, how to access a data source depends
on the data source itself. To build the <code>JDBCClient</code>, you can merge
configuration: the record location, the metadata and a json object
provided by the consumer:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> JDBCClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/jdbc-client&quot;</span>
<span class="token comment">// Get the record</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-data-source-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve the service reference</span>
    <span class="token keyword">let</span> reference <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReferenceWithConfiguration</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;clement&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;*****&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Retrieve the service object</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> reference<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span>JDBCClient<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// when done</span>
    reference<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also use the <code>JDBCClient</code> class to the lookup and retrieval in
one call:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ServiceDiscovery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> JDBCDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
JDBCDataSource<span class="token punctuation">.</span><span class="token function">getJDBCClient</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-data-source-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;clement&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;*****&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// Dont' forget to release the service</span>
    ServiceDiscovery<span class="token punctuation">.</span><span class="token function">releaseServiceObject</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="redis-data-source"><a href="#redis-data-source" class="header-anchor">#</a> Redis Data source</h2> <p>Redis data sources are a specialization for Redis persistence databases.
The client of a Redis data source service is a <code>RedisClient</code>.</p> <h3 id="publishing-a-redis-service"><a href="#publishing-a-redis-service" class="header-anchor">#</a> Publishing a Redis service</h3> <p>Publishing a Redis data source is a 2-step process:</p> <ol><li><p>create a record, using <code>RedisDataSource</code></p></li> <li><p>publish the record</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RedisDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">let</span> record <span class="token operator">=</span> RedisDataSource<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-redis-data-source-service&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;some-metadata&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-value&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>location</code> is a simple JSON object that should provide the fields to
access the Redis data source (url, port…​).</p> <h3 id="consuming-a-redis-service"><a href="#consuming-a-redis-service" class="header-anchor">#</a> Consuming a Redis service</h3> <p>As stated in the previous section, how to access a data source depends
on the data source itself. To build the <code>RedisClient</code>, you can merge
configuration: the record location, the metadata and a json object
provided by the consumer:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RedisClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/redis-client&quot;</span>
<span class="token comment">// Get the record</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-redis-data-source-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve the service reference</span>
    <span class="token keyword">let</span> reference <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Retrieve the service instance</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> reference<span class="token punctuation">.</span><span class="token function">getAs</span><span class="token punctuation">(</span>RedisClient<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// when done</span>
    reference<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also use the <code>RedisDataSource</code> class to the lookup and retrieval
in one call:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ServiceDiscovery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RedisDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
RedisDataSource<span class="token punctuation">.</span><span class="token function">getRedisClient</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-redis-data-source-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// Dont' forget to release the service</span>
    ServiceDiscovery<span class="token punctuation">.</span><span class="token function">releaseServiceObject</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mongo-data-source"><a href="#mongo-data-source" class="header-anchor">#</a> Mongo Data source</h2> <p>Mongo data sources are a specialization for MongoDB databases. The
client of a Mongo data source service is a <code>MongoClient</code>.</p> <h3 id="publishing-a-mongo-service"><a href="#publishing-a-mongo-service" class="header-anchor">#</a> Publishing a Mongo service</h3> <p>Publishing a Mongo data source is a 2-step process:</p> <ol><li><p>create a record, using <code>MongoDataSource</code></p></li> <li><p>publish the record</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MongoDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">let</span> record <span class="token operator">=</span> MongoDataSource<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">&quot;some-data-source-service&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;connection_string&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some mongo connection&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;some-metadata&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-value&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discovery<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>location</code> is a simple JSON object that should provide the fields to
access the Redis data source (url, port…​).</p> <h3 id="consuming-a-mongo-service"><a href="#consuming-a-mongo-service" class="header-anchor">#</a> Consuming a Mongo service</h3> <p>As stated in the previous section, how to access a data source depends
on the data source itself. To build the <code>MongoClient</code>, you can merge
configuration: the record location, the metadata and a json object
provided by the consumer:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Get the record</span>
discovery<span class="token punctuation">.</span><span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-data-source-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve the service reference</span>
    <span class="token keyword">let</span> reference <span class="token operator">=</span> discovery<span class="token punctuation">.</span><span class="token function">getReferenceWithConfiguration</span><span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;clement&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;*****&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Retrieve the service object</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> reference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// when done</span>
    reference<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also use the <code>MongoDataSource</code> class to the lookup and retrieval
in one call:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ServiceDiscovery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MongoDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vertx/service-discovery&quot;</span>
MongoDataSource<span class="token punctuation">.</span><span class="token function">getMongoClient</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;some-data-source-service&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;clement&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;password&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;*****&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> ar<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

    <span class="token comment">// Dont' forget to release the service</span>
    ServiceDiscovery<span class="token punctuation">.</span><span class="token function">releaseServiceObject</span><span class="token punctuation">(</span>discovery<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="listening-for-service-arrivals-and-departures"><a href="#listening-for-service-arrivals-and-departures" class="header-anchor">#</a> Listening for service arrivals and departures</h1> <p>Every time a provider is published or removed, an event is published on
the <em>vertx.discovery.announce</em> address. This address is configurable
from the <code>ServiceDiscoveryOptions</code>.</p> <p>The received record has a <code>status</code> field indicating the new state of the
record:</p> <ul><li><p><code>UP</code> : the service is available, you can start using it</p></li> <li><p><code>DOWN</code> : the service is not available anymore, you should not use it
anymore</p></li> <li><p><code>OUT_OF_SERVICE</code> : the service is not running, you should not use it
anymore, but it may come back later.</p></li></ul> <h1 id="listening-for-service-usage"><a href="#listening-for-service-usage" class="header-anchor">#</a> Listening for service usage</h1> <p>Every time a service reference is retrieved (<code>bind</code>) or released
(<code>release</code>), an event is published on the <em>vertx .discovery.usage</em>
address. This address is configurable from the
<code>ServiceDiscoveryOptions</code>.</p> <p>It lets you listen for service usage and map the service bindings.</p> <p>The received message is a <code>JsonObject</code> containing:</p> <ul><li><p>the record in the <code>record</code> field</p></li> <li><p>the type of event in the <code>type</code> field. It’s either <code>bind</code> or
<code>release</code></p></li> <li><p>the id of the service discovery (either its name or the node id) in
the <code>id</code> field</p></li></ul> <p>This <code>id</code> is configurable from the <code>ServiceDiscoveryOptions</code>. By default
it’s &quot;localhost&quot; on single node configuration and the id of the node in
clustered mode.</p> <p>You can disable the service usage support by setting the usage address
to <code>null</code> with <code>setUsageAddress</code>.</p> <h1 id="service-discovery-bridges"><a href="#service-discovery-bridges" class="header-anchor">#</a> Service discovery bridges</h1> <p>Bridges let you import and export services from / to other discovery
mechanism such as Docker, Kubernetes, Consul…​ Each bridge decides how
the services are imported and exported. It does not have to be
bi-directional.</p> <p>You can provide your own bridge by implementing the <code>ServiceImporter</code>
interface and register it using <code>registerServiceImporter</code>.</p> <p>The second parameter can provide an optional configuration for the
bridge.</p> <p>When the bridge is registered the <code>start</code> method is called. It lets you
configure the bridge. When the bridge is configured, ready and has
imported / exported the initial services, it must complete the given
<code>Future</code>. If the bridge starts method is blocking, it must use an
<code>executeBlocking</code> construct, and complete the given future object.</p> <p>When the service discovery is stopped, the bridge is stopped. The
<code>close</code> method is called that provides the opportunity to cleanup
resources, removed imported / exported services…​ This method must
complete the given <code>Future</code> to notify the caller of the completion.</p> <p>Notice than in a cluster, only one member needs to register the bridge
as the records are accessible by all members.</p> <h1 id="additional-bridges"><a href="#additional-bridges" class="header-anchor">#</a> Additional bridges</h1> <p>In addition of the bridges supported by this library, Vert.x Service
Discovery provides additional bridges you can use in your application.</p> <p>Unresolved directive in index.adoc - include::consul-bridge.adoc[]</p> <p>Unresolved directive in index.adoc - include::kubernetes-bridge.adoc[]</p> <p>Unresolved directive in index.adoc - include::zookeeper-bridge.adoc[]</p> <p>Unresolved directive in index.adoc -
include::docker-links-bridge.adoc[]</p> <h1 id="additional-backends"><a href="#additional-backends" class="header-anchor">#</a> Additional backends</h1> <p>In addition of the backend supported by this library, Vert.x Service
Discovery provides additional backends you can use in your application.</p> <p>Unresolved directive in index.adoc - include::redis-backend.adoc[]</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reactiverse/es4x/edit/develop/docs/manual/@vertx/service-discovery/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/12/2020, 10:17:53 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/es4x/assets/js/app.5c50c914.js" defer></script><script src="/es4x/assets/js/2.9528bf06.js" defer></script><script src="/es4x/assets/js/119.9b807fbd.js" defer></script>
  </body>
</html>
